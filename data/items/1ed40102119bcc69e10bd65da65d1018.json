{
  "guid": "tag:blogger.com,1999:blog-6300367579216018061.post-5507396156360903260",
  "pubDate": "Wed, 14 Aug 2013 18:00:00 +0000",
  "atom:updated": "2015-12-08T00:10:14.443-08:00",
  "category": [
    "cypher",
    "delete duplicate records",
    "graph database",
    "neo4j",
    "nodes"
  ],
  "title": "Delete Duplicate Node By Index Using Neo4j Cypher Query",
  "description": "<p>Follow the steps below to find and delete duplicate nodes on property and index in Neo4j's web admin console.</p><h3>Step 1</h3><p>Select duplicate records by executing the following Cypher query in the Neo4j admin console.</p><pre data-lang=\"cypher\">START n=node:invoices(\"PO_NUMBER:(\\\"112233\\\")\")<br />// Cypher query for collecting the ids of indexed nodes containing duplicate properties<br />WITH n<br />ORDER BY id(n) DESC  // Order by descending to delete the most recent duplicated record<br />WITH n.Key? as DuplicateKey, COUNT(n) as ColCount, COLLECT(id(n)) as ColNode<br />WITH DuplicateKey, ColCount, ColNode, HEAD(ColNode) as DuplicateId<br />WHERE ColCount > 1 AND (DuplicateKey is not null) AND (DuplicateId is not null)<br />WITH DuplicateKey, ColCount, ColNode, DuplicateId <br />ORDER BY DuplicateId <br />RETURN DuplicateKey, ColCount, DuplicateId <br />//RETURN COLLECT(DuplicateId) as CommaSeparatedListOfIds<br />//** Toggle comments for the return statements above to validate duplicate records <br />//** Do not proceed to delete without validating<br /></pre><h3>Step 2</h3><p>Validate and copy duplicate record IDs from web admin console:</p><div style=\"float: left;\"><table cellpadding=\"0\" cellspacing=\"0\" class=\"tr-caption-container\" style=\"float: left; margin-bottom: 2em; margin-right: 1em; text-align: left;\"><tbody><tr><td style=\"text-align: center;\"><a href=\"http://3.bp.blogspot.com/-qazIr48H3dI/Ugu7wlQ0upI/AAAAAAAAA2w/rIkSJXZxkpw/s1600/validate-duplicates.PNG\" imageanchor=\"1\" style=\"clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;\"><img border=\"0\" src=\"http://3.bp.blogspot.com/-qazIr48H3dI/Ugu7wlQ0upI/AAAAAAAAA2w/rIkSJXZxkpw/s1600/validate-duplicates.PNG\" /></a></td></tr><tr><td class=\"tr-caption\">Execute the Cypher query from Step 1 to validate duplicate records exist.</td></tr></tbody></table><table cellpadding=\"0\" cellspacing=\"0\" class=\"tr-caption-container\" style=\"float: left; margin-bottom: 2em; text-align: left;\"><tbody><tr><td style=\"text-align: center;\"><a href=\"http://3.bp.blogspot.com/-BwIggYU3MUg/Ugu78nyPW3I/AAAAAAAAA24/jlHkRJip8Eo/s1600/comma-separated-list-id-duplicates.PNG\" imageanchor=\"1\" style=\"clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;\"><img border=\"0\" src=\"http://3.bp.blogspot.com/-BwIggYU3MUg/Ugu78nyPW3I/AAAAAAAAA24/jlHkRJip8Eo/s1600/comma-separated-list-id-duplicates.PNG\" /></a></td></tr><tr><td class=\"tr-caption\">After validating duplicate records, execute the Cypher query from Step 1 as a comma separated list of IDs.</td></tr></tbody></table></div><h3>Step 3</h3><p>Copy and paste CommaSeparatedListOfIds into the delete query below.</p><pre data-lang=\"cypher\"><br />START n=node(1120038,1120039,1120040,1120042,1120044,1120048,1120049,1120050,1120053,1120067,1120068)<br />// Replace above with the IDs from CommaSeparatedListOfIds in the previous step<br />MATCH n-[r]-()<br />DELETE r, n<br /></pre><p>** Execute the Cypher query above <b>ONLY</b> after replacing the example IDs in the START statement.</p><h3>Step 4</h3><p>Validate that the delete transaction committed.</p> <p><table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" class=\"tr-caption-container\" style=\"margin-bottom:2em; margin-right: 1em; text-align: left;\"><tbody><tr><td style=\"text-align: center;\"><a href=\"http://1.bp.blogspot.com/-5rXcl9VhY7Q/Ugu-PbcrFMI/AAAAAAAAA3I/OqN0nqhVFfI/s1600/comma-separated-list-id-duplicates-deleted.PNG\" imageanchor=\"1\" style=\"clear: both; margin-bottom: 1em; margin-left: auto; margin-right: auto;\"><img border=\"0\" src=\"http://1.bp.blogspot.com/-5rXcl9VhY7Q/Ugu-PbcrFMI/AAAAAAAAA3I/OqN0nqhVFfI/s1600/comma-separated-list-id-duplicates-deleted.PNG\" /></a></td></tr><tr><td class=\"tr-caption\" style=\"text-align: center;\">Execute the Cypher query from Step 1 to make sure that the transaction was committed.</td></tr></tbody></table></p><p>That's it! Comment below with questions or feedback.</p>",
  "link": "https://www.kennybastani.com/2013/08/delete-duplicate-node-by-index-using.html",
  "author": "noreply@blogger.com (Kenny Bastani)",
  "media:thumbnail": "",
  "thr:total": 0
}