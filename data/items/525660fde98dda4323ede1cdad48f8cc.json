{
  "title": "TimeMarker class for python",
  "link": "",
  "published": "2019-09-14T22:31:00-07:00",
  "updated": "2019-09-14T22:31:00-07:00",
  "author": {
    "name": "Jonathan Landy"
  },
  "id": "tag:efavdb.com,2019-09-14:/timemarker-class-for-python",
  "summary": "<p>We give a simple class for marking the time at different points in a code block and then printing out the time gaps between adjacent marked points. This is useful for identifying slow spots in&nbsp;code.</p>\n<h2>The TimeMarker&nbsp;class</h2>\n<p>In the past, whenever I needed to speed up a block …</p>",
  "content": "<p>We give a simple class for marking the time at different points in a code block and then printing out the time gaps between adjacent marked points. This is useful for identifying slow spots in&nbsp;code.</p>\n<h2>The TimeMarker&nbsp;class</h2>\n<p>In the past, whenever I needed to speed up a block of python code, the first thing I would do was import the time package, then manually insert a set of lines of the form <code>t1 = time.time()</code>, <code>t2 = time.time()</code>, etc. Then at the end, <code>print t2 - t1, t3 -t2, ...</code>, etc. This works reasonably well, but I found it annoying and time consuming to have to save each time point to a different variable name. In particular, this prevented quick copy and paste of the time marker line. I finally thought to fix it this evening: Behold the <code>TimeMarker</code> class, which solves this problem for&nbsp;me:</p>\n<div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">time</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">TimeMarker</span><span class=\"p\">():</span>\n\n<span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>  \n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">markers</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">mark</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>  \n    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">markers</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">time</span><span class=\"p\">())</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">print_markers</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>  \n    <span class=\"k\">for</span> <span class=\"n\">pair</span> <span class=\"ow\">in</span> <span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">markers</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">markers</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">:]):</span>  \n    <span class=\"nb\">print</span> <span class=\"n\">pair</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"n\">pair</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>  \n</pre></div>\n\n\n<p>Here is a simple code&nbsp;example:  </p>\n<div class=\"highlight\"><pre><span></span><span class=\"n\">tm</span> <span class=\"o\">=</span> <span class=\"n\">TimeMarker</span><span class=\"p\">()</span>\n\n<span class=\"n\">tm</span><span class=\"o\">.</span><span class=\"n\">mark</span><span class=\"p\">()</span>  \n<span class=\"nb\">sum</span><span class=\"p\">(</span><span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"o\">**</span> <span class=\"mi\">2</span><span class=\"p\">))</span>  \n<span class=\"n\">tm</span><span class=\"o\">.</span><span class=\"n\">mark</span><span class=\"p\">()</span>  \n<span class=\"nb\">sum</span><span class=\"p\">(</span><span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"o\">**</span> <span class=\"mi\">6</span><span class=\"p\">))</span>  \n<span class=\"n\">tm</span><span class=\"o\">.</span><span class=\"n\">mark</span><span class=\"p\">()</span>\n\n<span class=\"n\">tm</span><span class=\"o\">.</span><span class=\"n\">print_markers</span><span class=\"p\">()</span>  \n<span class=\"c1\"># (output...)  </span>\n<span class=\"c1\"># 7.9870223999e-05  </span>\n<span class=\"c1\"># 0.0279731750488  </span>\n</pre></div>\n\n\n<p>The key here is that I can quickly paste the <code>tm.mark()</code> repeatedly throughout my code and quickly check where the slow part&nbsp;sits.</p>",
  "category": [
    "",
    "",
    "",
    ""
  ]
}