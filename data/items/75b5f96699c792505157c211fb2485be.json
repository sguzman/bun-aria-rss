{
  "title": "Introducing Blaze - Practice",
  "link": "",
  "updated": "2014-09-01T00:00:00+00:00",
  "id": "https://mrocklin.github.io/blog/work/2014/09/01/Blaze-HMDA",
  "content": "<p><em>This work is supported by <a href=\"http://continuum.io\">Continuum Analytics</a>\nand the <a href=\"http://www.darpa.mil/program/XDATA\">XDATA Grant</a>\nas part of the <a href=\"http://blaze.pydata.org\">Blaze Project</a></em></p>\n\n<p>We look at data from the <a href=\"http://www.ffiec.gov/hmda/\">Home Mortgage Disclosure\nAct</a>, a collection of actions taken on\nhousing loans by various governmental agencies (gzip-ed csv file\n<a href=\"http://files.consumerfinance.gov/hmda/hmda_lar-2012.csv.gz\">here</a>)\n(thanks to <a href=\"http://aron.ahmadia.net/\">Aron Ahmadia</a> for the pointer).\nUncompressed this dataset is around 10GB on disk and so we don’t want to\nload it up into memory with a modern commercial notebook.</p>\n\n<p>Instead, we use Blaze to investigate the data, select down to the data\nwe care about, and then migrate that data into a suitable computational\nbackend.</p>\n\n<p>In this post we’re going to use the interactive <code class=\"language-plaintext highlighter-rouge\">Table</code> object, which\nwraps up a dataset and calls compute whenever we ask for something to be\nprinted to the screen. It retains the abstract delayed-evaluation nature\nof Blaze with the interactive feel of NumPy and Pandas.</p>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"kn\">from</span> <span class=\"nn\">blaze</span> <span class=\"kn\">import</span> <span class=\"n\">CSV</span><span class=\"p\">,</span> <span class=\"n\">Table</span>\n<span class=\"n\">csv</span> <span class=\"o\">=</span> <span class=\"n\">CSV</span><span class=\"p\">(</span><span class=\"s\">'hmda_lar-2012.csv'</span><span class=\"p\">)</span>  <span class=\"c1\"># Open the CSV file\n</span><span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">Table</span><span class=\"p\">(</span><span class=\"n\">csv</span><span class=\"p\">)</span>                  <span class=\"c1\"># Interact with CSV file using interactive Table object\n</span><span class=\"n\">t</span></code></pre>\n</figure>\n\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>action_taken</th>\n      <th>action_taken_name</th>\n      <th>agency_code</th>\n      <th>agency_abbr</th>\n      <th>agency_name</th>\n      <th>applicant_ethnicity</th>\n      <th>applicant_ethnicity_name</th>\n      <th>applicant_income_000s</th>\n      <th>applicant_race_1</th>\n      <th>applicant_race_2</th>\n      <th>applicant_race_3</th>\n      <th>applicant_race_4</th>\n      <th>applicant_race_5</th>\n      <th>applicant_race_name_1</th>\n      <th>applicant_race_name_2</th>\n      <th>applicant_race_name_3</th>\n      <th>applicant_race_name_4</th>\n      <th>applicant_race_name_5</th>\n      <th>applicant_sex</th>\n      <th>applicant_sex_name</th>\n      <th>application_date_indicator</th>\n      <th>as_of_year</th>\n      <th>census_tract_number</th>\n      <th>co_applicant_ethnicity</th>\n      <th>co_applicant_ethnicity_name</th>\n      <th>co_applicant_race_1</th>\n      <th>co_applicant_race_2</th>\n      <th>co_applicant_race_3</th>\n      <th>co_applicant_race_4</th>\n      <th>co_applicant_race_5</th>\n      <th>co_applicant_race_name_1</th>\n      <th>co_applicant_race_name_2</th>\n      <th>co_applicant_race_name_3</th>\n      <th>co_applicant_race_name_4</th>\n      <th>co_applicant_race_name_5</th>\n      <th>co_applicant_sex</th>\n      <th>co_applicant_sex_name</th>\n      <th>county_code</th>\n      <th>county_name</th>\n      <th>denial_reason_1</th>\n      <th>denial_reason_2</th>\n      <th>denial_reason_3</th>\n      <th>denial_reason_name_1</th>\n      <th>denial_reason_name_2</th>\n      <th>denial_reason_name_3</th>\n      <th>edit_status</th>\n      <th>edit_status_name</th>\n      <th>hoepa_status</th>\n      <th>hoepa_status_name</th>\n      <th>lien_status</th>\n      <th>lien_status_name</th>\n      <th>loan_purpose</th>\n      <th>loan_purpose_name</th>\n      <th>loan_type</th>\n      <th>loan_type_name</th>\n      <th>msamd</th>\n      <th>msamd_name</th>\n      <th>owner_occupancy</th>\n      <th>owner_occupancy_name</th>\n      <th>preapproval</th>\n      <th>preapproval_name</th>\n      <th>property_type</th>\n      <th>property_type_name</th>\n      <th>purchaser_type</th>\n      <th>purchaser_type_name</th>\n      <th>respondent_id</th>\n      <th>sequence_number</th>\n      <th>state_code</th>\n      <th>state_abbr</th>\n      <th>state_name</th>\n      <th>hud_median_family_income</th>\n      <th>loan_amount_000s</th>\n      <th>number_of_1_to_4_family_units</th>\n      <th>number_of_owner_occupied_units</th>\n      <th>minority_population</th>\n      <th>population</th>\n      <th>rate_spread</th>\n      <th>tract_to_msamd_income</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0 </th>\n      <td> 1</td>\n      <td>                   Loan originated</td>\n      <td> 7</td>\n      <td>  HUD</td>\n      <td> Department of Housing and Urban Development</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td> 173</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>                     White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 1</td>\n      <td>           Male</td>\n      <td> 0</td>\n      <td> 2012</td>\n      <td> 8803.06</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>           White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 2</td>\n      <td>          Female</td>\n      <td> 197</td>\n      <td>      Will County</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>NaN</td>\n      <td>                          </td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 1</td>\n      <td> Secured by a first lien</td>\n      <td> 3</td>\n      <td>      Refinancing</td>\n      <td> 1</td>\n      <td>  Conventional</td>\n      <td> 16974</td>\n      <td>            Chicago, Joliet, Naperville - IL</td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 6</td>\n      <td> Commercial bank, savings bank or savings assoc...</td>\n      <td> 36-4176531</td>\n      <td>    2712</td>\n      <td> 17</td>\n      <td> IL</td>\n      <td>  Illinois</td>\n      <td> 77300</td>\n      <td> 264</td>\n      <td> 2153</td>\n      <td> 1971</td>\n      <td> 45.820000</td>\n      <td> 7894</td>\n      <td>  NaN</td>\n      <td> 170.679993</td>\n    </tr>\n    <tr>\n      <th>1 </th>\n      <td> 1</td>\n      <td>                   Loan originated</td>\n      <td> 5</td>\n      <td> NCUA</td>\n      <td>        National Credit Union Administration</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td>  83</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>                     White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 1</td>\n      <td>           Male</td>\n      <td> 0</td>\n      <td> 2012</td>\n      <td> 2915.00</td>\n      <td> 5</td>\n      <td>        No co-applicant</td>\n      <td> 8</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> No co-applicant</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 5</td>\n      <td> No co-applicant</td>\n      <td> 111</td>\n      <td>   Midland County</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>NaN</td>\n      <td>                          </td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 1</td>\n      <td> Secured by a first lien</td>\n      <td> 3</td>\n      <td>      Refinancing</td>\n      <td> 1</td>\n      <td>  Conventional</td>\n      <td>   NaN</td>\n      <td>                                            </td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 0</td>\n      <td> Loan was not originated or was not sold in cal...</td>\n      <td> 0000060137</td>\n      <td>     328</td>\n      <td> 26</td>\n      <td> MI</td>\n      <td>  Michigan</td>\n      <td> 52100</td>\n      <td> 116</td>\n      <td> 1662</td>\n      <td> 1271</td>\n      <td>  3.340000</td>\n      <td> 4315</td>\n      <td>  NaN</td>\n      <td> 102.760002</td>\n    </tr>\n    <tr>\n      <th>2 </th>\n      <td> 6</td>\n      <td> Loan purchased by the institution</td>\n      <td> 9</td>\n      <td> CFPB</td>\n      <td>        Consumer Financial Protection Bureau</td>\n      <td> 4</td>\n      <td>         Not applicable</td>\n      <td>  70</td>\n      <td> 7</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>            Not applicable</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 4</td>\n      <td> Not applicable</td>\n      <td> 2</td>\n      <td> 2012</td>\n      <td>  212.01</td>\n      <td> 4</td>\n      <td>         Not applicable</td>\n      <td> 7</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>  Not applicable</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 4</td>\n      <td>  Not applicable</td>\n      <td>   7</td>\n      <td>    Benton County</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>  6</td>\n      <td> Quality edit failure only</td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 4</td>\n      <td>          Not applicable</td>\n      <td> 3</td>\n      <td>      Refinancing</td>\n      <td> 1</td>\n      <td>  Conventional</td>\n      <td> 22220</td>\n      <td>   Fayetteville, Springdale, Rogers - AR, MO</td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 8</td>\n      <td>                             Affiliate institution</td>\n      <td> 0000476810</td>\n      <td>   43575</td>\n      <td>  5</td>\n      <td> AR</td>\n      <td>  Arkansas</td>\n      <td> 58200</td>\n      <td> 159</td>\n      <td> 1194</td>\n      <td>  708</td>\n      <td> 21.870001</td>\n      <td> 4239</td>\n      <td>  NaN</td>\n      <td> 127.639999</td>\n    </tr>\n    <tr>\n      <th>3 </th>\n      <td> 6</td>\n      <td> Loan purchased by the institution</td>\n      <td> 9</td>\n      <td> CFPB</td>\n      <td>        Consumer Financial Protection Bureau</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td> 108</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>                     White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 2</td>\n      <td>         Female</td>\n      <td> 2</td>\n      <td> 2012</td>\n      <td>  407.06</td>\n      <td> 5</td>\n      <td>        No co-applicant</td>\n      <td> 8</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> No co-applicant</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 5</td>\n      <td> No co-applicant</td>\n      <td> 123</td>\n      <td>    Ramsey County</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>NaN</td>\n      <td>                          </td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 4</td>\n      <td>          Not applicable</td>\n      <td> 3</td>\n      <td>      Refinancing</td>\n      <td> 1</td>\n      <td>  Conventional</td>\n      <td> 33460</td>\n      <td> Minneapolis, St. Paul, Bloomington - MN, WI</td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 1</td>\n      <td>                                 Fannie Mae (FNMA)</td>\n      <td> 0000451965</td>\n      <td> 2374657</td>\n      <td> 27</td>\n      <td> MN</td>\n      <td> Minnesota</td>\n      <td> 83900</td>\n      <td> 100</td>\n      <td> 1927</td>\n      <td> 1871</td>\n      <td> 13.680000</td>\n      <td> 4832</td>\n      <td>  NaN</td>\n      <td> 137.669998</td>\n    </tr>\n    <tr>\n      <th>4 </th>\n      <td> 1</td>\n      <td>                   Loan originated</td>\n      <td> 3</td>\n      <td> FDIC</td>\n      <td>       Federal Deposit Insurance Corporation</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td> NaN</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>                     White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 1</td>\n      <td>           Male</td>\n      <td> 0</td>\n      <td> 2012</td>\n      <td>  104.00</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>           White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 2</td>\n      <td>          Female</td>\n      <td>   3</td>\n      <td>     Allen County</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>  6</td>\n      <td> Quality edit failure only</td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 1</td>\n      <td> Secured by a first lien</td>\n      <td> 2</td>\n      <td> Home improvement</td>\n      <td> 1</td>\n      <td>  Conventional</td>\n      <td> 23060</td>\n      <td>                             Fort Wayne - IN</td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 0</td>\n      <td> Loan was not originated or was not sold in cal...</td>\n      <td> 0000013801</td>\n      <td>      11</td>\n      <td> 18</td>\n      <td> IN</td>\n      <td>   Indiana</td>\n      <td> 63800</td>\n      <td> 267</td>\n      <td> 1309</td>\n      <td> 1160</td>\n      <td>  4.680000</td>\n      <td> 3612</td>\n      <td>  NaN</td>\n      <td> 139.100006</td>\n    </tr>\n    <tr>\n      <th>5 </th>\n      <td> 1</td>\n      <td>                   Loan originated</td>\n      <td> 7</td>\n      <td>  HUD</td>\n      <td> Department of Housing and Urban Development</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td> 144</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>                     White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 1</td>\n      <td>           Male</td>\n      <td> 0</td>\n      <td> 2012</td>\n      <td> 8057.01</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>           White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 1</td>\n      <td>            Male</td>\n      <td>  31</td>\n      <td>      Cook County</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>NaN</td>\n      <td>                          </td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 1</td>\n      <td> Secured by a first lien</td>\n      <td> 3</td>\n      <td>      Refinancing</td>\n      <td> 1</td>\n      <td>  Conventional</td>\n      <td> 16974</td>\n      <td>            Chicago, Joliet, Naperville - IL</td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 3</td>\n      <td>                               Freddie Mac (FHLMC)</td>\n      <td> 36-4327855</td>\n      <td>   22594</td>\n      <td> 17</td>\n      <td> IL</td>\n      <td>  Illinois</td>\n      <td> 77300</td>\n      <td> 260</td>\n      <td> 1390</td>\n      <td> 1700</td>\n      <td>  6.440000</td>\n      <td> 5074</td>\n      <td>  NaN</td>\n      <td> 140.550003</td>\n    </tr>\n    <tr>\n      <th>6 </th>\n      <td> 1</td>\n      <td>                   Loan originated</td>\n      <td> 7</td>\n      <td>  HUD</td>\n      <td> Department of Housing and Urban Development</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td>  51</td>\n      <td> 3</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> Black or African American</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 1</td>\n      <td>           Male</td>\n      <td> 0</td>\n      <td> 2012</td>\n      <td>   17.00</td>\n      <td> 5</td>\n      <td>        No co-applicant</td>\n      <td> 8</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> No co-applicant</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 5</td>\n      <td> No co-applicant</td>\n      <td>  19</td>\n      <td> Calcasieu Parish</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>NaN</td>\n      <td>                          </td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 1</td>\n      <td> Secured by a first lien</td>\n      <td> 1</td>\n      <td>    Home purchase</td>\n      <td> 1</td>\n      <td>  Conventional</td>\n      <td> 29340</td>\n      <td>                           Lake Charles - LA</td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 1</td>\n      <td>                                 Fannie Mae (FNMA)</td>\n      <td> 7056000000</td>\n      <td>   34177</td>\n      <td> 22</td>\n      <td> LA</td>\n      <td> Louisiana</td>\n      <td> 62400</td>\n      <td> 115</td>\n      <td> 3500</td>\n      <td> 2797</td>\n      <td> 29.260000</td>\n      <td> 8745</td>\n      <td>  NaN</td>\n      <td>  86.739998</td>\n    </tr>\n    <tr>\n      <th>7 </th>\n      <td> 1</td>\n      <td>                   Loan originated</td>\n      <td> 7</td>\n      <td>  HUD</td>\n      <td> Department of Housing and Urban Development</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td> 162</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>                     White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 1</td>\n      <td>           Male</td>\n      <td> 0</td>\n      <td> 2012</td>\n      <td>    2.01</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>           White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 2</td>\n      <td>          Female</td>\n      <td>  49</td>\n      <td>     Grand County</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>NaN</td>\n      <td>                          </td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 1</td>\n      <td> Secured by a first lien</td>\n      <td> 3</td>\n      <td>      Refinancing</td>\n      <td> 2</td>\n      <td>   FHA-insured</td>\n      <td>   NaN</td>\n      <td>                                            </td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 6</td>\n      <td> Commercial bank, savings bank or savings assoc...</td>\n      <td> 87-0623581</td>\n      <td>    2141</td>\n      <td>  8</td>\n      <td> CO</td>\n      <td>  Colorado</td>\n      <td> 61000</td>\n      <td> 283</td>\n      <td> 5706</td>\n      <td> 1724</td>\n      <td>  9.650000</td>\n      <td> 4817</td>\n      <td>  NaN</td>\n      <td> 128.559998</td>\n    </tr>\n    <tr>\n      <th>8 </th>\n      <td> 1</td>\n      <td>                   Loan originated</td>\n      <td> 3</td>\n      <td> FDIC</td>\n      <td>       Federal Deposit Insurance Corporation</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td>  32</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>                     White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 2</td>\n      <td>         Female</td>\n      <td> 0</td>\n      <td> 2012</td>\n      <td>  103.04</td>\n      <td> 5</td>\n      <td>        No co-applicant</td>\n      <td> 8</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> No co-applicant</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 5</td>\n      <td> No co-applicant</td>\n      <td>   3</td>\n      <td>     Allen County</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>NaN</td>\n      <td>                          </td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 1</td>\n      <td> Secured by a first lien</td>\n      <td> 3</td>\n      <td>      Refinancing</td>\n      <td> 1</td>\n      <td>  Conventional</td>\n      <td> 23060</td>\n      <td>                             Fort Wayne - IN</td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 0</td>\n      <td> Loan was not originated or was not sold in cal...</td>\n      <td> 0000013801</td>\n      <td>      10</td>\n      <td> 18</td>\n      <td> IN</td>\n      <td>   Indiana</td>\n      <td> 63800</td>\n      <td>  40</td>\n      <td> 2384</td>\n      <td> 2210</td>\n      <td>  6.640000</td>\n      <td> 6601</td>\n      <td> 3.33</td>\n      <td> 149.690002</td>\n    </tr>\n    <tr>\n      <th>9 </th>\n      <td> 1</td>\n      <td>                   Loan originated</td>\n      <td> 9</td>\n      <td> CFPB</td>\n      <td>        Consumer Financial Protection Bureau</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td>  38</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>                     White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 1</td>\n      <td>           Male</td>\n      <td> 0</td>\n      <td> 2012</td>\n      <td> 9608.00</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>           White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 2</td>\n      <td>          Female</td>\n      <td>  41</td>\n      <td>    Talbot County</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>NaN</td>\n      <td>                          </td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 1</td>\n      <td> Secured by a first lien</td>\n      <td> 3</td>\n      <td>      Refinancing</td>\n      <td> 1</td>\n      <td>  Conventional</td>\n      <td>   NaN</td>\n      <td>                                            </td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 3</td>\n      <td>                               Freddie Mac (FHLMC)</td>\n      <td> 0000504713</td>\n      <td>   18459</td>\n      <td> 24</td>\n      <td> MD</td>\n      <td>  Maryland</td>\n      <td> 72600</td>\n      <td> 108</td>\n      <td> 1311</td>\n      <td>  785</td>\n      <td>  6.040000</td>\n      <td> 1920</td>\n      <td>  NaN</td>\n      <td>  77.279999</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td> 1</td>\n      <td>                   Loan originated</td>\n      <td> 7</td>\n      <td>  HUD</td>\n      <td> Department of Housing and Urban Development</td>\n      <td> 2</td>\n      <td> Not Hispanic or Latino</td>\n      <td>  47</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>                     White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 1</td>\n      <td>           Male</td>\n      <td> 0</td>\n      <td> 2012</td>\n      <td>   22.04</td>\n      <td> 1</td>\n      <td>     Hispanic or Latino</td>\n      <td> 5</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>           White</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> 2</td>\n      <td>          Female</td>\n      <td>  19</td>\n      <td> Calcasieu Parish</td>\n      <td> None</td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td> </td>\n      <td>NaN</td>\n      <td>                          </td>\n      <td> 2</td>\n      <td> Not a HOEPA loan</td>\n      <td> 1</td>\n      <td> Secured by a first lien</td>\n      <td> 1</td>\n      <td>    Home purchase</td>\n      <td> 3</td>\n      <td> VA-guaranteed</td>\n      <td> 29340</td>\n      <td>                           Lake Charles - LA</td>\n      <td> 1</td>\n      <td> Owner-occupied as a principal dwelling</td>\n      <td> 3</td>\n      <td> Not applicable</td>\n      <td> 1</td>\n      <td> One-to-four family dwelling (other than manufa...</td>\n      <td> 6</td>\n      <td> Commercial bank, savings bank or savings assoc...</td>\n      <td> 7056000000</td>\n      <td>   33791</td>\n      <td> 22</td>\n      <td> LA</td>\n      <td> Louisiana</td>\n      <td> 62400</td>\n      <td> 158</td>\n      <td> 1854</td>\n      <td> 1463</td>\n      <td> 12.410000</td>\n      <td> 4955</td>\n      <td>  NaN</td>\n      <td> 112.010002</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2 id=\"reducing-the-dataset\">Reducing the Dataset</h2>\n\n<p>That’s a lot of columns, most of which are redundant or don’t carry much\ninformation. Let’s clean up our dataset a bit by selecting a smaller\nsubset of columns. Already this quick investigation improves our\ncomprehension and reduces the size of the dataset.</p>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"n\">columns</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s\">'action_taken_name'</span><span class=\"p\">,</span> <span class=\"s\">'agency_abbr'</span><span class=\"p\">,</span> <span class=\"s\">'applicant_ethnicity_name'</span><span class=\"p\">,</span>\n           <span class=\"s\">'applicant_race_name_1'</span><span class=\"p\">,</span> <span class=\"s\">'applicant_sex_name'</span><span class=\"p\">,</span> <span class=\"s\">'county_name'</span><span class=\"p\">,</span>\n           <span class=\"s\">'loan_purpose_name'</span><span class=\"p\">,</span> <span class=\"s\">'state_abbr'</span><span class=\"p\">]</span>\n\n<span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"p\">[</span><span class=\"n\">columns</span><span class=\"p\">]</span>\n<span class=\"n\">t</span></code></pre>\n</figure>\n\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>action_taken_name</th>\n      <th>agency_abbr</th>\n      <th>applicant_ethnicity_name</th>\n      <th>applicant_race_name_1</th>\n      <th>applicant_sex_name</th>\n      <th>county_name</th>\n      <th>loan_purpose_name</th>\n      <th>state_abbr</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0 </th>\n      <td>                   Loan originated</td>\n      <td>  HUD</td>\n      <td> Not Hispanic or Latino</td>\n      <td>                     White</td>\n      <td>           Male</td>\n      <td>      Will County</td>\n      <td>      Refinancing</td>\n      <td> IL</td>\n    </tr>\n    <tr>\n      <th>1 </th>\n      <td>                   Loan originated</td>\n      <td> NCUA</td>\n      <td> Not Hispanic or Latino</td>\n      <td>                     White</td>\n      <td>           Male</td>\n      <td>   Midland County</td>\n      <td>      Refinancing</td>\n      <td> MI</td>\n    </tr>\n    <tr>\n      <th>2 </th>\n      <td> Loan purchased by the institution</td>\n      <td> CFPB</td>\n      <td>         Not applicable</td>\n      <td>            Not applicable</td>\n      <td> Not applicable</td>\n      <td>    Benton County</td>\n      <td>      Refinancing</td>\n      <td> AR</td>\n    </tr>\n    <tr>\n      <th>3 </th>\n      <td> Loan purchased by the institution</td>\n      <td> CFPB</td>\n      <td> Not Hispanic or Latino</td>\n      <td>                     White</td>\n      <td>         Female</td>\n      <td>    Ramsey County</td>\n      <td>      Refinancing</td>\n      <td> MN</td>\n    </tr>\n    <tr>\n      <th>4 </th>\n      <td>                   Loan originated</td>\n      <td> FDIC</td>\n      <td> Not Hispanic or Latino</td>\n      <td>                     White</td>\n      <td>           Male</td>\n      <td>     Allen County</td>\n      <td> Home improvement</td>\n      <td> IN</td>\n    </tr>\n    <tr>\n      <th>5 </th>\n      <td>                   Loan originated</td>\n      <td>  HUD</td>\n      <td> Not Hispanic or Latino</td>\n      <td>                     White</td>\n      <td>           Male</td>\n      <td>      Cook County</td>\n      <td>      Refinancing</td>\n      <td> IL</td>\n    </tr>\n    <tr>\n      <th>6 </th>\n      <td>                   Loan originated</td>\n      <td>  HUD</td>\n      <td> Not Hispanic or Latino</td>\n      <td> Black or African American</td>\n      <td>           Male</td>\n      <td> Calcasieu Parish</td>\n      <td>    Home purchase</td>\n      <td> LA</td>\n    </tr>\n    <tr>\n      <th>7 </th>\n      <td>                   Loan originated</td>\n      <td>  HUD</td>\n      <td> Not Hispanic or Latino</td>\n      <td>                     White</td>\n      <td>           Male</td>\n      <td>     Grand County</td>\n      <td>      Refinancing</td>\n      <td> CO</td>\n    </tr>\n    <tr>\n      <th>8 </th>\n      <td>                   Loan originated</td>\n      <td> FDIC</td>\n      <td> Not Hispanic or Latino</td>\n      <td>                     White</td>\n      <td>         Female</td>\n      <td>     Allen County</td>\n      <td>      Refinancing</td>\n      <td> IN</td>\n    </tr>\n    <tr>\n      <th>9 </th>\n      <td>                   Loan originated</td>\n      <td> CFPB</td>\n      <td> Not Hispanic or Latino</td>\n      <td>                     White</td>\n      <td>           Male</td>\n      <td>    Talbot County</td>\n      <td>      Refinancing</td>\n      <td> MD</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>                   Loan originated</td>\n      <td>  HUD</td>\n      <td> Not Hispanic or Latino</td>\n      <td>                     White</td>\n      <td>           Male</td>\n      <td> Calcasieu Parish</td>\n      <td>    Home purchase</td>\n      <td> LA</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2 id=\"more-complex-computation\">More Complex Computation</h2>\n\n<p>Now that we can more clearly see what’s going on let’s ask a simple\nquestion:</p>\n\n<p><em>How many times does each action occur in the state of New York?</em></p>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"n\">t2</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"p\">[</span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">state_abbr</span> <span class=\"o\">==</span> <span class=\"s\">'NY'</span><span class=\"p\">]</span>\n<span class=\"n\">t2</span></code></pre>\n</figure>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"o\">%%</span><span class=\"n\">time</span>\n<span class=\"kn\">from</span> <span class=\"nn\">blaze</span> <span class=\"kn\">import</span> <span class=\"n\">into</span><span class=\"p\">,</span> <span class=\"n\">by</span>\n<span class=\"kn\">from</span> <span class=\"nn\">pandas</span> <span class=\"kn\">import</span> <span class=\"n\">DataFrame</span>\n<span class=\"c1\"># Group on action_taken_name, count each group\n</span><span class=\"n\">into</span><span class=\"p\">(</span><span class=\"n\">DataFrame</span><span class=\"p\">,</span> <span class=\"n\">by</span><span class=\"p\">(</span><span class=\"n\">t2</span><span class=\"p\">.</span><span class=\"n\">action_taken_name</span><span class=\"p\">,</span>\n                   <span class=\"n\">t2</span><span class=\"p\">.</span><span class=\"n\">action_taken_name</span><span class=\"p\">.</span><span class=\"n\">count</span><span class=\"p\">()).</span><span class=\"n\">sort</span><span class=\"p\">(</span><span class=\"s\">'action_taken_name_count'</span><span class=\"p\">,</span>\n                                                      <span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">))</span></code></pre>\n</figure>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>CPU times: user 13min 50s, sys: 5.23 s, total: 13min 55s\nWall time: 13min 55s\n</code></pre></div></div>\n\n<div style=\"max-height:1000px;max-width:1500px;overflow:auto;\">\n  <table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>action_taken_name</th>\n      <th>action_taken_name_count</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>                                   Loan originated</td>\n      <td> 285106</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>       Application denied by financial institution</td>\n      <td> 109423</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>                 Loan purchased by the institution</td>\n      <td>  75241</td>\n    </tr>\n        <tr>\n      <th>3</th>\n      <td>                Application withdrawn by applicant</td>\n      <td>  50563</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>             Application approved but not accepted</td>\n      <td>  25632</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>                    File closed for incompleteness</td>\n      <td>  20585</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>     Preapproval request approved but not accepted</td>\n      <td>    259</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td> Preapproval request denied by financial instit...</td>\n      <td>    171</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n<p>Great! Sadly, because it was reading through the CSV file and because it\nwas using a Pure Python backend, that computation took fourteen minutes.</p>\n\n<h2 id=\"moving-to-a-faster-backend\">Moving to a Faster Backend</h2>\n\n<p>By default computations on CSV files use the streaming Python backend.\nWhile robust for large files and decently fast, this backend parses the\nCSV file each time we do a full-data operation, and this parsing is very\nslow. Let’s move our reduced dataset to a more efficient and widely\naccessible backend, <code class=\"language-plaintext highlighter-rouge\">sqlite</code>.</p>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"kn\">from</span> <span class=\"nn\">blaze</span> <span class=\"kn\">import</span> <span class=\"n\">SQL</span>\n<span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"n\">SQL</span><span class=\"p\">(</span><span class=\"s\">'sqlite:///hmda.db'</span><span class=\"p\">,</span> <span class=\"s\">'data'</span><span class=\"p\">,</span> <span class=\"n\">schema</span><span class=\"o\">=</span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">schema</span><span class=\"p\">)</span> <span class=\"c1\"># A SQLite database\n</span><span class=\"n\">into</span><span class=\"p\">(</span><span class=\"n\">sql</span><span class=\"p\">,</span> <span class=\"n\">t</span><span class=\"p\">)</span>  <span class=\"c1\"># Migrate data</span></code></pre>\n</figure>\n\n<p>Yup, a little <code class=\"language-plaintext highlighter-rouge\">sqlite</code> database just arrived</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>$ ls -lh hmda*\n\n-rw-r--r-- 1 mrocklin mrocklin 2.7G Aug 25 13:38 hmda.db\n-rw-r--r-- 1 mrocklin mrocklin  12G Jul 10 12:15 hmda_lar-2012.csv\n</code></pre></div></div>\n\n<h2 id=\"working-with-sql\">Working with SQL</h2>\n\n<p>Now that we’ve migrated our csv file into a sqlite database let’s redefine <code class=\"language-plaintext highlighter-rouge\">t</code>\nto use the SQL backend and repeat our computation.</p>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"c1\"># t = Table(csv)\n</span><span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">Table</span><span class=\"p\">(</span><span class=\"n\">sql</span><span class=\"p\">)</span>\n<span class=\"n\">t2</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"p\">[</span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">state_abbr</span> <span class=\"o\">==</span> <span class=\"s\">'NY'</span><span class=\"p\">]</span></code></pre>\n</figure>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"o\">%%</span><span class=\"n\">time</span>\n<span class=\"n\">into</span><span class=\"p\">(</span><span class=\"n\">DataFrame</span><span class=\"p\">,</span> <span class=\"n\">by</span><span class=\"p\">(</span><span class=\"n\">t2</span><span class=\"p\">.</span><span class=\"n\">action_taken_name</span><span class=\"p\">,</span>\n                   <span class=\"n\">t2</span><span class=\"p\">.</span><span class=\"n\">action_taken_name</span><span class=\"p\">.</span><span class=\"n\">count</span><span class=\"p\">()).</span><span class=\"n\">sort</span><span class=\"p\">(</span><span class=\"s\">'action_taken_name_count'</span><span class=\"p\">,</span>\n                                                      <span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">))</span></code></pre>\n</figure>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>CPU times: user 5.55 s, sys: 1.64 s, total: 7.19 s\nWall time: 7.46 s\n</code></pre></div></div>\n\n<div style=\"max-height:1000px;max-width:1500px;overflow:auto;\">\n  <table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>action_taken_name</th>\n      <th>action_taken_name_count</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>                                   Loan originated</td>\n      <td> 285106</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>       Application denied by financial institution</td>\n      <td> 109423</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>                 Loan purchased by the institution</td>\n      <td>  75241</td>\n    </tr>\n        <tr>\n      <th>3</th>\n      <td>                Application withdrawn by applicant</td>\n      <td>  50563</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>             Application approved but not accepted</td>\n      <td>  25632</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>                    File closed for incompleteness</td>\n      <td>  20585</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>     Preapproval request approved but not accepted</td>\n      <td>    259</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td> Preapproval request denied by financial instit...</td>\n      <td>    171</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n<p><em>We’re about to repeat this same computation many times.  We’ll omit the table\nresult from here on out.  It will always be the same.</em></p>\n\n<h2 id=\"create-an-index-on-state-name\">Create an index on state name</h2>\n\n<p>This was much faster, largely because the data was stored in a binary\nformat. We can improve the query speed significantly by placing an index\non the <code class=\"language-plaintext highlighter-rouge\">state_abbr</code> field. This will cause the selection\n<code class=\"language-plaintext highlighter-rouge\">t[t.state_abbr == 'NY']</code> to return more quickly, eliminating the need\nfor an expensive full table scan.</p>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"kn\">from</span> <span class=\"nn\">blaze</span> <span class=\"kn\">import</span> <span class=\"n\">create_index</span>\n<span class=\"n\">create_index</span><span class=\"p\">(</span><span class=\"n\">sql</span><span class=\"p\">,</span> <span class=\"s\">'state_abbr'</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s\">'state_abbr_index'</span><span class=\"p\">)</span></code></pre>\n</figure>\n\n<p>Now we can ask this same query for many states at interactive\ntimescales.</p>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"n\">t2</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"p\">[</span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">state_abbr</span> <span class=\"o\">==</span> <span class=\"s\">'NY'</span><span class=\"p\">]</span></code></pre>\n</figure>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"o\">%%</span><span class=\"n\">time</span>\n<span class=\"n\">into</span><span class=\"p\">(</span><span class=\"n\">DataFrame</span><span class=\"p\">,</span> <span class=\"n\">by</span><span class=\"p\">(</span><span class=\"n\">t2</span><span class=\"p\">.</span><span class=\"n\">action_taken_name</span><span class=\"p\">,</span>\n                   <span class=\"n\">t2</span><span class=\"p\">.</span><span class=\"n\">action_taken_name</span><span class=\"p\">.</span><span class=\"n\">count</span><span class=\"p\">()).</span><span class=\"n\">sort</span><span class=\"p\">(</span><span class=\"s\">'action_taken_name_count'</span><span class=\"p\">,</span>\n                                                      <span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">))</span></code></pre>\n</figure>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>CPU times: user 1.74 s, sys: 430 ms, total: 2.17 s\nWall time: 2.17 s\n</code></pre></div></div>\n\n<h1 id=\"comparing-against-mongodb\">Comparing against MongoDB</h1>\n\n<p>Because moving between computational backends is now easy, we can quickly\ncompare performance between backends. SQLite and MongoDB are similarly\navailable technologies, each being trivial to set up on a personal computer.\nHowever they’re also fairly different technologies with varying communities.</p>\n\n<p>Which performs faster for our sample computation?</p>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"kn\">import</span> <span class=\"nn\">pymongo</span>\n<span class=\"n\">db</span> <span class=\"o\">=</span> <span class=\"n\">pymongo</span><span class=\"p\">.</span><span class=\"n\">MongoClient</span><span class=\"p\">().</span><span class=\"n\">db</span>\n\n<span class=\"n\">into</span><span class=\"p\">(</span><span class=\"n\">db</span><span class=\"p\">.</span><span class=\"n\">hmda</span><span class=\"p\">,</span> <span class=\"n\">sql</span><span class=\"p\">)</span>  <span class=\"c1\"># Migrate to Mongo DB from SQLite database</span></code></pre>\n</figure>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"c1\"># t = Table(csv)\n# t = Table(sql)\n</span><span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">Table</span><span class=\"p\">(</span><span class=\"n\">db</span><span class=\"p\">.</span><span class=\"n\">hmda</span><span class=\"p\">)</span></code></pre>\n</figure>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"n\">t2</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"p\">[</span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">state_abbr</span> <span class=\"o\">==</span> <span class=\"s\">'NY'</span><span class=\"p\">]</span></code></pre>\n</figure>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"o\">%%</span><span class=\"n\">time</span>\n<span class=\"n\">into</span><span class=\"p\">(</span><span class=\"n\">DataFrame</span><span class=\"p\">,</span> <span class=\"n\">by</span><span class=\"p\">(</span><span class=\"n\">t2</span><span class=\"p\">.</span><span class=\"n\">action_taken_name</span><span class=\"p\">,</span>\n                   <span class=\"n\">t2</span><span class=\"p\">.</span><span class=\"n\">action_taken_name</span><span class=\"p\">.</span><span class=\"n\">count</span><span class=\"p\">()).</span><span class=\"n\">sort</span><span class=\"p\">(</span><span class=\"s\">'action_taken_name_count'</span><span class=\"p\">,</span>\n                                                      <span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">))</span></code></pre>\n</figure>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>CPU times: user 4.05 ms, sys: 701 µs, total: 4.76 ms\nWall time: 7.61 s\n</code></pre></div></div>\n\n<p>Almost exactly the same time as for SQLite.</p>\n\n<p>We just did a complex thing easily.  If we weren’t familiar\nwith MongoDB we would need to learn how to set up a database, how to migrate\ndata from SQL to MongoDB, and finally how to perform queries.  Blaze eased that\nprocess <em>considerably</em>.</p>\n\n<h3 id=\"create-an-index-on-state-name-1\">Create an index on state name</h3>\n\n<p>Again we create an index on the state name and observe the performance\ndifference.</p>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"n\">create_index</span><span class=\"p\">(</span><span class=\"n\">db</span><span class=\"p\">.</span><span class=\"n\">hmda</span><span class=\"p\">,</span> <span class=\"s\">'state_abbr'</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s\">'state_abbr_index'</span><span class=\"p\">)</span></code></pre>\n</figure>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"n\">t2</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"p\">[</span><span class=\"n\">t</span><span class=\"p\">.</span><span class=\"n\">state_abbr</span> <span class=\"o\">==</span> <span class=\"s\">'NY'</span><span class=\"p\">]</span></code></pre>\n</figure>\n\n<figure class=\"highlight\">\n  <pre><code class=\"language-python\" data-lang=\"python\"><span class=\"o\">%%</span><span class=\"n\">time</span>\n<span class=\"n\">into</span><span class=\"p\">(</span><span class=\"n\">DataFrame</span><span class=\"p\">,</span> <span class=\"n\">by</span><span class=\"p\">(</span><span class=\"n\">t2</span><span class=\"p\">.</span><span class=\"n\">action_taken_name</span><span class=\"p\">,</span>\n                   <span class=\"n\">t2</span><span class=\"p\">.</span><span class=\"n\">action_taken_name</span><span class=\"p\">.</span><span class=\"n\">count</span><span class=\"p\">()).</span><span class=\"n\">sort</span><span class=\"p\">(</span><span class=\"s\">'action_taken_name_count'</span><span class=\"p\">,</span>\n                                                      <span class=\"n\">ascending</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">))</span></code></pre>\n</figure>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>CPU times: user 4.13 ms, sys: 844 µs, total: 4.97 ms\nWall time: 954 ms\n</code></pre></div></div>\n\n<p>Here the indexed MongoDB system seems about twice as fast as the comparably\nindexed SQLite system.</p>\n\n<h2 id=\"results\">Results</h2>\n\n<p><em>Disclaimer: These results come from a single run.  No attempt was made to\noptimize the backend configuration, nor was any consideration taken into\naccount about databases being warmed up.  These numbers are far from\nconclusive, and are merely here to present the ease with which\nintuitive-building experiments are easy with Blaze and the value of choosing\nthe right backend.</em></p>\n\n<table>\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Backend</th>\n      <th>Duration</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td> NumPy/Pandas </td>\n      <td> <i>need bigger machine</i> </td>\n    </tr>\n    <tr>\n      <td> Python/CSV </td>\n      <td> 14 minutes </td>\n    </tr>\n    <tr>\n      <td> SQLite </td>\n      <td> 7 seconds </td>\n    </tr>\n    <tr>\n      <td> MongoDB </td>\n      <td> 7 seconds </td>\n    </tr>\n    <tr>\n      <td> SQLite (indexed) </td>\n      <td> 2 seconds</td>\n    </tr>\n    <tr>\n      <td> MongoDB (indexed) </td>\n      <td> 1 second </td>\n    </tr>\n  </tbody>\n</table>\n\n<h1 id=\"conclusion\">Conclusion</h1>\n\n<p>Blaze enables you to investigate, transform, and migrate large data\nintuitively. You can choose the right technology for your application\nwithout having to worry about learning a new syntax.</p>\n\n<p>We hope that by lowering this barrier more users will use the right tool for\nthe job.</p>\n\n<h2 id=\"more-information\">More Information</h2>\n\n<ul>\n  <li>Documentation: <a href=\"http://blaze.pydata.org/\">blaze.pydata.org/</a></li>\n  <li>Source: <a href=\"http://github.com/ContinuumIO/blaze/\">github.com/ContinuumIO/blaze/</a></li>\n  <li>\n    <p>Install with <a href=\"https://store.continuum.io/cshop/anaconda/\">Anaconda</a>:</p>\n\n    <div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>conda install blaze\n</code></pre></div>    </div>\n  </li>\n</ul>"
}