{
  "title": "Blogging with Jekyll and R Markdown using knitr",
  "link": "",
  "id": "http://brooksandrew.github.io/simpleblog/articles/blogging-with-r-markdown-and-jekyll-using-knitr",
  "published": "2015-01-25T00:00:00+00:00",
  "updated": "2015-01-25T00:00:00+00:00",
  "author": {
    "name": "andrew brooks",
    "uri": "http://brooksandrew.github.io/simpleblog",
    "email": "andrewbrooksct@gmail.com"
  },
  "content": "<h4 id=\"use-knitr\">use knitr</h4>\n\n<p>One way to blog using R and Jekyll is to copy and paste every code chunk, output and plot into a plain vanilla markdown file by hand.  This is cumbersome, especially for plots which need to be saved as images and embedded.  I tried this for my first few posts.  It was clunky.</p>\n\n<p>A more seamless solution is to use <a href=\"http://yihui.name/knitr/\">knitr</a> to convert <a href=\"http://rmarkdown.rstudio.com/\">R Markdown</a> files to Jekyll friendly markdown files.  Knitr allows you to write your entire post in R Markdown utilizing all the features of traditional markdown while conveniently running your code, printing your output and displaying your charts.  And it looks fresh.</p>\n\n<h4 id=\"rmd--jekyll-markdown\">Rmd ==&gt; Jekyll markdown</h4>\n\n<p>Knitr is good at transforming R Markdown to HTML, PDF or even Word files.  Jekyll is good at turning traditional/Jekyll markdown to HTML (your website).  There might be an elegant way to shove the HTML generated by knitr into a jekyll site, but I haven’t found one.  I found it much easier to convert R Markdown to its close cousin of markdown that is compatible with Jekyll.  This conversion really just boils down to handling the R chunks: saving the plots as SVGs, formatting the code chunks with R syntax highlighting and printing the output for selected chunks.</p>\n\n<p>A convenient feature provided in knitr is the ability to suppress code, messages, warnings, errors and output printed to the console for specific code chunks using the <code class=\"highlighter-rouge\">echo</code>, <code class=\"highlighter-rouge\">message</code>, <code class=\"highlighter-rouge\">warning</code>, <code class=\"highlighter-rouge\">error</code> and <code class=\"highlighter-rouge\">eval</code> parameters respectively.</p>\n\n<h4 id=\"fuzzy-middle\">fuzzy middle</h4>\n\n<p>I tried a few approaches, but this one from <a href=\"http://chepec.se/2014/07/16/knitr-jekyll.html\">chepec</a> both worked the best and made the most sense to me.  I had to make a couple adjustments to make it work for my setup, but they were small and included below.  As I started generating more posts from R Markdown, I found a need to overwrite specific posts (rather than all or none).  So I added a parameter <code class=\"highlighter-rouge\">overwriteOne</code> which takes a string input and will overwrite any post that partially matches it (a simple <code class=\"highlighter-rouge\">grep</code> ignoring case).  However, my additions are trivial – all the credit goes to <a href=\"http://chepec.se/2014/07/16/knitr-jekyll.html\">chepec</a>.</p>\n\n<h4 id=\"how-to-use-knitpost\">how to use KnitPost</h4>\n\n<ol>\n  <li>Configure the directories at the top of <code class=\"highlighter-rouge\">KnitPost</code> to match the file system of your blog.  I could have included these as parameters, but I figured I wouldn’t re-architect my blog very often… so I left them hard-coded.</li>\n  <li>Create an R Markdown post and save it as a <code class=\"highlighter-rouge\">.Rmd</code> file in <code class=\"highlighter-rouge\">rmd.path</code>.  Be sure to include the proper YAML front matter for Jekyll.  This tripped me up initially.  I forgot to change the date from the knitr style date (“Month, day YYYY”) that auto-generates when you create a new .Rmd to a Jekyll style date (‘YYYY-MM-DD’).</li>\n  <li>Run <code class=\"highlighter-rouge\">KnitPost</code> to publish your R Markdown file.</li>\n</ol>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">KnitPost</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">site.path</span><span class=\"o\">=</span><span class=\"s1\">'/pathToYourBlog/'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">overwriteAll</span><span class=\"o\">=</span><span class=\"nb\">F</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">overwriteOne</span><span class=\"o\">=</span><span class=\"kc\">NULL</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n  </span><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"s1\">'package:knitr'</span><span class=\"w\"> </span><span class=\"o\">%in%</span><span class=\"w\"> </span><span class=\"n\">search</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"s1\">'knitr'</span><span class=\"p\">)</span><span class=\"w\">\n  \n  </span><span class=\"c1\">## Blog-specific directories.  This will depend on how you organize your blog.</span><span class=\"w\">\n  </span><span class=\"n\">site.path</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">site.path</span><span class=\"w\"> </span><span class=\"c1\"># directory of jekyll blog (including trailing slash)</span><span class=\"w\">\n  </span><span class=\"n\">rmd.path</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">paste0</span><span class=\"p\">(</span><span class=\"n\">site.path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"_Rmd\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># directory where your Rmd-files reside (relative to base)</span><span class=\"w\">\n  </span><span class=\"n\">fig.dir</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"s2\">\"assets/Rfig/\"</span><span class=\"w\"> </span><span class=\"c1\"># directory to save figures</span><span class=\"w\">\n  </span><span class=\"n\">posts.path</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">paste0</span><span class=\"p\">(</span><span class=\"n\">site.path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"_posts/articles/\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># directory for converted markdown files</span><span class=\"w\">\n  </span><span class=\"n\">cache.path</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">paste0</span><span class=\"p\">(</span><span class=\"n\">site.path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"_cache\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># necessary for plots</span><span class=\"w\">\n  \n  </span><span class=\"n\">render_jekyll</span><span class=\"p\">(</span><span class=\"n\">highlight</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"pygments\"</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">opts_knit</span><span class=\"o\">$</span><span class=\"n\">set</span><span class=\"p\">(</span><span class=\"n\">base.url</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s1\">'/'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">base.dir</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">site.path</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">opts_chunk</span><span class=\"o\">$</span><span class=\"n\">set</span><span class=\"p\">(</span><span class=\"n\">fig.path</span><span class=\"o\">=</span><span class=\"n\">fig.dir</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fig.width</span><span class=\"o\">=</span><span class=\"m\">8.5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fig.height</span><span class=\"o\">=</span><span class=\"m\">5.25</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dev</span><span class=\"o\">=</span><span class=\"s1\">'svg'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"nb\">F</span><span class=\"p\">,</span><span class=\"w\"> \n                 </span><span class=\"n\">warning</span><span class=\"o\">=</span><span class=\"nb\">F</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">message</span><span class=\"o\">=</span><span class=\"nb\">F</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cache.path</span><span class=\"o\">=</span><span class=\"n\">cache.path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">tidy</span><span class=\"o\">=</span><span class=\"nb\">F</span><span class=\"p\">)</span><span class=\"w\">   \n  \n\n  </span><span class=\"n\">setwd</span><span class=\"p\">(</span><span class=\"n\">rmd.path</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># setwd to base</span><span class=\"w\">\n  \n  </span><span class=\"c1\"># some logic to help us avoid overwriting already existing md files</span><span class=\"w\">\n  </span><span class=\"n\">files.rmd</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.frame</span><span class=\"p\">(</span><span class=\"n\">rmd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list.files</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">rmd.path</span><span class=\"p\">,</span><span class=\"w\">\n                                </span><span class=\"n\">full.names</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">T</span><span class=\"p\">,</span><span class=\"w\">\n                                </span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"\\\\.Rmd$\"</span><span class=\"p\">,</span><span class=\"w\">\n                                </span><span class=\"n\">ignore.case</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">T</span><span class=\"p\">,</span><span class=\"w\">\n                                </span><span class=\"n\">recursive</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">F</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">stringsAsFactors</span><span class=\"o\">=</span><span class=\"nb\">F</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">corresponding.md.file</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">paste0</span><span class=\"p\">(</span><span class=\"n\">posts.path</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"/\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">basename</span><span class=\"p\">(</span><span class=\"n\">gsub</span><span class=\"p\">(</span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"\\\\.Rmd$\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">replacement</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\".md\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">rmd</span><span class=\"p\">)))</span><span class=\"w\">\n  </span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">corresponding.md.exists</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">file.exists</span><span class=\"p\">(</span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">corresponding.md.file</span><span class=\"p\">)</span><span class=\"w\">\n  \n  </span><span class=\"c1\">## determining which posts to overwrite from parameters overwriteOne &amp; overwriteAll</span><span class=\"w\">\n  </span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">md.overwriteAll</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">overwriteAll</span><span class=\"w\">\n  </span><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nf\">is.null</span><span class=\"p\">(</span><span class=\"n\">overwriteOne</span><span class=\"p\">)</span><span class=\"o\">==</span><span class=\"nb\">F</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">md.overwriteAll</span><span class=\"p\">[</span><span class=\"n\">grep</span><span class=\"p\">(</span><span class=\"n\">overwriteOne</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">files.rmd</span><span class=\"p\">[,</span><span class=\"s1\">'rmd'</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">ignore.case</span><span class=\"o\">=</span><span class=\"nb\">T</span><span class=\"p\">)]</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nb\">T</span><span class=\"w\">\n  </span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">md.render</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nb\">F</span><span class=\"w\">\n  </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">dim</span><span class=\"p\">(</span><span class=\"n\">files.rmd</span><span class=\"p\">)[</span><span class=\"m\">1</span><span class=\"p\">])</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">corresponding.md.exists</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">F</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">md.render</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nb\">T</span><span class=\"w\">\n    </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">corresponding.md.exists</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">T</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">md.overwriteAll</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">T</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">md.render</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nb\">T</span><span class=\"w\">\n    </span><span class=\"p\">}</span><span class=\"w\">\n  </span><span class=\"p\">}</span><span class=\"w\">\n  \n  </span><span class=\"c1\"># For each Rmd file, render markdown (contingent on the flags set above)</span><span class=\"w\">\n  </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">dim</span><span class=\"p\">(</span><span class=\"n\">files.rmd</span><span class=\"p\">)[</span><span class=\"m\">1</span><span class=\"p\">])</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">md.render</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"nb\">T</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"n\">out.file</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">knit</span><span class=\"p\">(</span><span class=\"nf\">as.character</span><span class=\"p\">(</span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">rmd</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]),</span><span class=\"w\"> \n                      </span><span class=\"n\">output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">as.character</span><span class=\"p\">(</span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">corresponding.md.file</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]),</span><span class=\"w\">\n                      </span><span class=\"n\">envir</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">parent.frame</span><span class=\"p\">(),</span><span class=\"w\"> \n                      </span><span class=\"n\">quiet</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">T</span><span class=\"p\">)</span><span class=\"w\">\n      </span><span class=\"n\">message</span><span class=\"p\">(</span><span class=\"n\">paste0</span><span class=\"p\">(</span><span class=\"s2\">\"KnitPost(): \"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">basename</span><span class=\"p\">(</span><span class=\"n\">files.rmd</span><span class=\"o\">$</span><span class=\"n\">rmd</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">])))</span><span class=\"w\">\n    </span><span class=\"p\">}</span><span class=\"w\">     \n  </span><span class=\"p\">}</span><span class=\"w\">\n  \n</span><span class=\"p\">}</span></code></pre></figure>\n\n\n  <p><a href=\"http://brooksandrew.github.io/simpleblog/articles/blogging-with-r-markdown-and-jekyll-using-knitr/\">Blogging with Jekyll and R Markdown using knitr</a> was originally published by andrew brooks at <a href=\"http://brooksandrew.github.io/simpleblog\">andrew brooks</a> on January 25, 2015.</p>"
}