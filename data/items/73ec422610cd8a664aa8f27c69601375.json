{
  "title": "Visualizing Website Pathing With Sankey Charts",
  "description": "<p>In my prior post on <a href=\"http://randyzwitch.com/rsitecatalyst-d3-network-graphs/\" title=\"Visualizing Website Structure With Network Graphs\">visualizing website structure using network graphs</a>, I referenced that network graphs showed the pairwise relationships between two pages (in a bi-directional manner). However, if you want to analyze how your visitors are pathing through your site, you can visualize your data using a Sankey chart.</p>",
  "pubDate": "Wed, 10 Sep 2014 21:27:10 +0000",
  "link": "http://randyzwitch.com/rsitecatalyst-website-pathing-sankey-charts/",
  "guid": "http://randyzwitch.com/rsitecatalyst-website-pathing-sankey-charts/",
  "content": "<p>In my prior post on <a href=\"http://randyzwitch.com/rsitecatalyst-d3-network-graphs/\" title=\"Visualizing Website Structure With Network Graphs\">visualizing website structure using network graphs</a>, I referenced that network graphs showed the pairwise relationships between two pages (in a bi-directional manner). However, if you want to analyze how your visitors are pathing through your site, you can visualize your data using a Sankey chart.</p>\n\n<h2 id=\"visualizing-single-page-to-next-page-pathing\">Visualizing Single Page-to-Next Page Pathing</h2>\n\n<p>Most digital analytics tools allow you to visualize the path between pages. In the case of Adobe Analytics, the Next Page Flow diagram is limited to 10 second-level branches in the visualization. However, the Adobe Analytics API has no such limitation, and as such we can use RSiteCatalyst to create the following visualization (<a href=\"https://gist.github.com/randyzwitch/008be202b94bde7c4359\">GitHub Gist containing R code</a>):</p>\n\n<iframe src=\"http://randyzwitch.com/wp-content/uploads/2014/09/sankey.html\" width=\"750\" height=\"650\" frameborder=\"0\" scrolling=\"no\"></iframe>\n\n<p>The data processing for this visualization is near identical to the network diagrams. We can use <code class=\"language-plaintext highlighter-rouge\">QueuePathing()</code> from RSiteCatalyst to download our pathing data, except in this case, I specified an exact page name as the first level of the pathing pattern instead of using the <code class=\"language-plaintext highlighter-rouge\">::anything::</code> operator. In all Sankey charts created by <code class=\"language-plaintext highlighter-rouge\">d3Network</code>, you can hover over the right-hand side nodes to see the values (you can also drag around the nodes on either side if you desire!). It‚Äôs pretty clear from this diagram that I need to do a better job retaining my visitors, as the most common path from this page is to leave. üôÅ</p>\n\n<h2 id=\"many-to-many-page-pathing\">Many-to-Many Page Pathing</h2>\n\n<p>The example above picks a single page related to Hadoop, then shows how my visitors continue through my site; sometimes, they go to other Hadoop pages, some view <a title=\"Data Science content\" href=\"http://randyzwitch.com/#DataScience\" target=\"_blank\">Data Science related content</a> or any number of other paths. If we want, however, we can visualize how all visitors path through all pages. Like the force-directed graph, we can get this information by using the <code class=\"language-plaintext highlighter-rouge\">(\"::anything::\", \"::anything::\")</code> path pattern with <code class=\"language-plaintext highlighter-rouge\">QueuePathing()</code>:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n</pre></td><td class=\"code\"><pre><span class=\"c1\">#Multi-page pathing</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"s2\">\"d3Network\"</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"s2\">\"RSiteCatalyst\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#### Authentication</span><span class=\"w\">\n</span><span class=\"n\">SCAuth</span><span class=\"p\">(</span><span class=\"s2\">\"name\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"secret\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#### Get All Possible Paths with (\"::anything::\", \"::anything::\")</span><span class=\"w\">\n</span><span class=\"n\">pathpattern</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"::anything::\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"::anything::\"</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">next_page</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">QueuePathing</span><span class=\"p\">(</span><span class=\"s2\">\"zwitchdev\"</span><span class=\"p\">,</span><span class=\"w\">\n                          </span><span class=\"s2\">\"2014-01-01\"</span><span class=\"p\">,</span><span class=\"w\">\n                          </span><span class=\"s2\">\"2014-08-31\"</span><span class=\"p\">,</span><span class=\"w\">\n                          </span><span class=\"n\">metric</span><span class=\"o\">=</span><span class=\"s2\">\"pageviews\"</span><span class=\"p\">,</span><span class=\"w\">\n                          </span><span class=\"n\">element</span><span class=\"o\">=</span><span class=\"s2\">\"page\"</span><span class=\"p\">,</span><span class=\"w\">\n                          </span><span class=\"n\">pathpattern</span><span class=\"p\">,</span><span class=\"w\">\n                          </span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">50000</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#Optional step: Cleaning my pagename URLs to remove to domain for clarity</span><span class=\"w\">\n</span><span class=\"n\">next_page</span><span class=\"o\">$</span><span class=\"n\">step.1</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">sub</span><span class=\"p\">(</span><span class=\"s2\">\"http://randyzwitch.com/\"</span><span class=\"p\">,</span><span class=\"s2\">\"\"</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"n\">next_page</span><span class=\"o\">$</span><span class=\"n\">step.1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ignore.case</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">next_page</span><span class=\"o\">$</span><span class=\"n\">step.2</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">sub</span><span class=\"p\">(</span><span class=\"s2\">\"http://randyzwitch.com/\"</span><span class=\"p\">,</span><span class=\"s2\">\"\"</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"n\">next_page</span><span class=\"o\">$</span><span class=\"n\">step.2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ignore.case</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#Filter out Entered Site and duplicate rows, &gt;120 for chart legibility</span><span class=\"w\">\n</span><span class=\"n\">links</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">subset</span><span class=\"p\">(</span><span class=\"n\">next_page</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">count</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"m\">120</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"n\">step.1</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"s2\">\"Entered Site\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#Get unique values of page name to create nodes df</span><span class=\"w\">\n</span><span class=\"c1\">#Create an index value, starting at 0</span><span class=\"w\">\n</span><span class=\"n\">nodes</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">as.data.frame</span><span class=\"p\">(</span><span class=\"n\">unique</span><span class=\"p\">(</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"n\">links</span><span class=\"o\">$</span><span class=\"n\">step.1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">links</span><span class=\"o\">$</span><span class=\"n\">step.2</span><span class=\"p\">)))</span><span class=\"w\">\n</span><span class=\"nf\">names</span><span class=\"p\">(</span><span class=\"n\">nodes</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"s2\">\"name\"</span><span class=\"w\">\n</span><span class=\"n\">nodes</span><span class=\"o\">$</span><span class=\"n\">nodevalue</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">as.numeric</span><span class=\"p\">(</span><span class=\"n\">row.names</span><span class=\"p\">(</span><span class=\"n\">nodes</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"w\">\n\n</span><span class=\"c1\">#Convert string to numeric nodeid</span><span class=\"w\">\n</span><span class=\"n\">links</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">merge</span><span class=\"p\">(</span><span class=\"n\">links</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">nodes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">by.x</span><span class=\"o\">=</span><span class=\"s2\">\"step.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">by.y</span><span class=\"o\">=</span><span class=\"s2\">\"name\"</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"nf\">names</span><span class=\"p\">(</span><span class=\"n\">links</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"step.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"step.2\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"value\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"segment.id\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"segment.name\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"source\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"n\">links</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">merge</span><span class=\"p\">(</span><span class=\"n\">links</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">nodes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">by.x</span><span class=\"o\">=</span><span class=\"s2\">\"step.2\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">by.y</span><span class=\"o\">=</span><span class=\"s2\">\"name\"</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"nf\">names</span><span class=\"p\">(</span><span class=\"n\">links</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"step.2\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"step.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"value\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"segment.id\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"segment.name\"</span><span class=\"p\">,</span><span class=\"s2\">\"source\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"target\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#Create next page Sankey chart</span><span class=\"w\">\n</span><span class=\"n\">d3output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"~/Desktop/sankey_all.html\"</span><span class=\"w\">\n</span><span class=\"n\">d3Sankey</span><span class=\"p\">(</span><span class=\"n\">Links</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">links</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Nodes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">nodes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Source</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"source\"</span><span class=\"p\">,</span><span class=\"w\">\n         </span><span class=\"n\">Target</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"target\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"value\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">NodeID</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"name\"</span><span class=\"p\">,</span><span class=\"w\">\n         </span><span class=\"n\">fontsize</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">nodeWidth</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">50</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">d3output</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">width</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">750</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">height</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">700</span><span class=\"p\">)</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>Running the code above provides the following visualization:</p>\n\n<iframe src=\"http://randyzwitch.com/wp-content/uploads/2014/09/sankey_all1.html\" width=\"750\" height=\"700\" frameborder=\"0\" scrolling=\"no\"></iframe>\n\n<p>For legibility purposes, I‚Äôm only plotting paths that occur more than 120 times. But given a large enough display, it would be possible to visualize all valid combinations of paths.</p>\n\n<p>One thing to keep in mind is that with the <code class=\"language-plaintext highlighter-rouge\">d3.js</code> library, there is a weird hiccup where if your dataset contains ‚Äúduplicate‚Äù paths such that both <code class=\"language-plaintext highlighter-rouge\">Source -&gt; Target &amp; Target -&gt; Source</code> exists, <code class=\"language-plaintext highlighter-rouge\">d3.js</code> will go into an infinite loop/not show any visualization. My R code doesn‚Äôt provide a solution to this issue, but it should be trivial to remove these ‚Äúduplicates‚Äù should they arise in your dataset.</p>\n\n<h2 id=\"interpretation\">Interpretation</h2>\n\n<p>Unlike the network graphs, Sankey Charts are fairly easy to understand. The ‚Äúworst‚Äù path on my site in terms of keeping visitors on site is where I praised Apple for <a href=\"http://randyzwitch.com/broken-macbook-pro-hinge-fixed-free/\">fixing my MacBook Pro screen</a> out-of-warranty. The easy explanation for this poor performance is that this article attracts people who aren‚Äôt really my target audience in data science, but looking for information about getting THEIR screens fixed. If I wanted to engage these readers more, I guess I would need to write more Apple-related content.</p>\n\n<p>To the extent there are multi-stage paths, these tend to be <a href=\"http://randyzwitch.com/tags/#hadoop\">Hadoop</a> and <a href=\"http://randyzwitch.com/tags/#julia\">Julia</a>-related content. This makes sense as both technologies are fairly new, I have a lot more content in these areas, and especially in the case of Julia, I‚Äôm one of the few people writing practical content. So I‚Äôm glad to see I‚Äôm achieving some level of success in these areas.</p>\n\n<p>Hopefully this blog post and my previous post on¬†<a href=\"http://randyzwitch.com/rsitecatalyst-d3-network-graphs/\">visualizing your website visitors using network graphs</a> have given a feel for the <a href=\"http://randyzwitch.com/rsitecatalyst-version-1-4-release-notes/\">new functionality available in RSiteCatalyst v1.4</a>, as well¬†providing a new way of thinking about data visualization beyond just the default graphs provided by the Adobe Analytics interface.</p>"
}