{
  "title": "Sessionizing Log Data Using data.table [Follow-up #2]",
  "description": "<p>Thanks to user <a title=\"dnlbrky comment\" href=\"http://randyzwitch.com/sessionizing-log-data-dplyr-r-window-functions/#comment-16205\" target=\"_blank\">dnlbrky</a>, we now have a third way to accomplish sessionizing log data for any arbitrary time out period (see methods <a href=\"/sessionizing-log-data-sql/\" title=\"Sessionizing Log Data Using SQL\">1</a> and <a href=\"/sessionizing-log-data-dplyr-r-window-functions/\" title=\"Sessionizing Log Data Using dplyr [Follow-up]\">2</a>), this time using data.table from R along with magrittr for piping:</p>",
  "pubDate": "Tue, 20 Jan 2015 09:01:19 +0000",
  "link": "http://randyzwitch.com/sessionizing-log-data-using-data-table-follow-2/",
  "guid": "http://randyzwitch.com/sessionizing-log-data-using-data-table-follow-2/",
  "content": "<p>Thanks to user <a title=\"dnlbrky comment\" href=\"http://randyzwitch.com/sessionizing-log-data-dplyr-r-window-functions/#comment-16205\" target=\"_blank\">dnlbrky</a>, we now have a third way to accomplish sessionizing log data for any arbitrary time out period (see methods <a href=\"/sessionizing-log-data-sql/\" title=\"Sessionizing Log Data Using SQL\">1</a> and <a href=\"/sessionizing-log-data-dplyr-r-window-functions/\" title=\"Sessionizing Log Data Using dplyr [Follow-up]\">2</a>), this time using data.table from R along with magrittr for piping:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n</pre></td><td class=\"code\"><pre><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">magrittr</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">## Download, unzip, and load data (first 10,000 lines):</span><span class=\"w\">\n</span><span class=\"n\">single_col_timestamp</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">url</span><span class=\"p\">(</span><span class=\"s2\">\"http://randyzwitch.com/wp-content/uploads/2015/01/single_col_timestamp.csv.gz\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">\n  </span><span class=\"n\">gzcon</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">\n  </span><span class=\"n\">readLines</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"o\">=</span><span class=\"m\">10000L</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">\n  </span><span class=\"n\">textConnection</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">\n  </span><span class=\"n\">read.csv</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">\n  </span><span class=\"n\">setDT</span><span class=\"w\">\n\n</span><span class=\"c1\">## Convert to timestamp:</span><span class=\"w\">\n</span><span class=\"n\">single_col_timestamp</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">event_timestamp</span><span class=\"o\">:=</span><span class=\"n\">as.POSIXct</span><span class=\"p\">(</span><span class=\"n\">event_timestamp</span><span class=\"p\">)]</span><span class=\"w\">\n\n</span><span class=\"c1\">## Order by uid and event_timestamp:</span><span class=\"w\">\n</span><span class=\"n\">setkey</span><span class=\"p\">(</span><span class=\"n\">single_col_timestamp</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">uid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">event_timestamp</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">## Sessionize the data (more than 30 minutes between events is a new session):</span><span class=\"w\">\n</span><span class=\"n\">single_col_timestamp</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">session_id</span><span class=\"o\">:=</span><span class=\"n\">paste</span><span class=\"p\">(</span><span class=\"n\">uid</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">cumsum</span><span class=\"p\">((</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">diff</span><span class=\"p\">(</span><span class=\"n\">event_timestamp</span><span class=\"p\">))</span><span class=\"o\">/</span><span class=\"m\">60</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"m\">30</span><span class=\"p\">)</span><span class=\"o\">*</span><span class=\"m\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"o\">=</span><span class=\"s2\">\"_\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"o\">=</span><span class=\"n\">uid</span><span class=\"p\">]</span><span class=\"w\">\n\n</span><span class=\"c1\">## Examine the results:</span><span class=\"w\">\n</span><span class=\"c1\">#single_col_timestamp[uid %like% \"a55bb9\"]</span><span class=\"w\">\n</span><span class=\"n\">single_col_timestamp</span><span class=\"p\">[</span><span class=\"n\">session_id</span><span class=\"w\"> </span><span class=\"o\">%like%</span><span class=\"w\"> </span><span class=\"s2\">\"fc895c3babd\"</span><span class=\"p\">]</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>I agree with dnlbrky in that this feels a little better than the dplyr method for heavy SQL users like me, but ultimately, I still think the SQL method is the most elegant and obvious to understand. But that’s the great thing with open-source software; pick any tool you want, accomplish whatever you choose using any method you choose.</p>"
}