{
  "title": "How accurate is Next Bus III: getting the answers",
  "link": "",
  "id": "http://brooksandrew.github.io/simpleblog/articles/nextbus3_analyze",
  "published": "2014-09-17T00:00:00+00:00",
  "updated": "2014-09-17T00:00:00+00:00",
  "author": {
    "name": "andrew brooks",
    "uri": "http://brooksandrew.github.io/simpleblog",
    "email": "andrewbrooksct@gmail.com"
  },
  "content": "<p>So now that we’ve <a href=\"../nextbus1_api\">collected data from the web</a> and <a href=\"../nextbus2_wrangle\">wrangled it into something useful</a>, what can we say about how accurate Next Bus is?</p>\n\n<p>This post is about the “making of the analysis” … which might be rather boring to those non data geeks (normal people).  If you’re just interested in the story and the pictures, jump straight <a href=\"http://brooksandrew.github.io/projects/wmata/\">here</a>!</p>\n\n<p>I worked in R, as I usually do for most things statistical and graphical.</p>\n\n<p>Our cleaned up data looks like this:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-bash\" data-lang=\"bash\"><span class=\"nb\">time                </span>Minutes      VehicleID DirectionText              RouteID   TripID    hour  ID                   departure  arrival   est        err\n2014-08-12 10:56:04      98      6470      South to Federal Triangle  64        6464164   10    6464164_6470         1          0         100.90513  2.905133\n2014-08-12 10:56:14      98      6470      South to Federal Triangle  64        6464164   10    6464164_6470         0          0         100.73572  2.735717\n2014-08-12 10:56:24      98      6470      South to Federal Triangle  64        6464164   10    6464164_6470         0          0         100.56467  2.564667\n2014-08-12 10:56:35      98      6470      South to Federal Triangle  64        6464164   10    6464164_6470         0          0         100.39257  2.392567\n2014-08-12 10:56:45      98      6470      South to Federal Triangle  64        6464164   10    6464164_6470         0          0         100.22040  2.220400\n2014-08-12 10:56:55      98      6470      South to Federal Triangle  64        6464164   10    6464164_6470         0          0         100.04953  2.049533\n2014-08-12 10:57:05      97      6470      South to Federal Triangle  64        6464164   10    6464164_6470         0          0          99.87928  2.879283\n2014-08-12 10:57:16      97      6470      South to Federal Triangle  64        6464164   10    6464164_6470         0          0          99.70852  2.708517\n2014-08-12 10:57:26      97      6470      South to Federal Triangle  64        6464164   10    6464164_6470         0          0          99.53807  2.538067\n2014-08-12 10:57:36      97      6470      South to Federal Triangle  64        6464164   10    6464164_6470         0          0          99.36845  2.368450</code></pre></figure>\n\n<p><code class=\"highlighter-rouge\">est</code> is the actual time until arrival from the time of prediction.  <br />\n<code class=\"highlighter-rouge\">err</code> is the prediction error in minutes (postive values are late buses, negative values are early buses).<br />\n<code class=\"highlighter-rouge\">Minutes</code> is the prediction made at <code class=\"highlighter-rouge\">time</code>.</p>\n\n<p>Next Bus predictions are discrete, that is they are made in whole numbers such as 1, 2, 3 … up to 99 minutes — no decimals or seconds.\nEach prediction (5 minutes, 10 minutes, etc) is made many times. So we can calculate some statistics around each prediction.\nFirst I simply calculated the average prediction error.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"w\"> \n</span><span class=\"n\">mape</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">aggregate</span><span class=\"p\">(</span><span class=\"n\">err</span><span class=\"o\">~</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">df</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">mean</span><span class=\"p\">(</span><span class=\"nf\">abs</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)))</span><span class=\"w\">\n</span><span class=\"n\">mape60</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">mape</span><span class=\"p\">[</span><span class=\"n\">mape</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"o\">&lt;=</span><span class=\"m\">60</span><span class=\"p\">,]</span><span class=\"w\">\n\n</span><span class=\"n\">plt4</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">=</span><span class=\"n\">mape60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">err</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">geom_bar</span><span class=\"p\">(</span><span class=\"n\">stat</span><span class=\"o\">=</span><span class=\"s1\">'identity'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fill</span><span class=\"o\">=</span><span class=\"s1\">'darkblue'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> \n  </span><span class=\"n\">xlab</span><span class=\"p\">(</span><span class=\"s1\">'Prediction (minutes)'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">ylab</span><span class=\"p\">(</span><span class=\"s1\">'Average prediction error (minutes)'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">scale_x_continuous</span><span class=\"p\">(</span><span class=\"n\">breaks</span><span class=\"o\">=</span><span class=\"n\">seq</span><span class=\"p\">(</span><span class=\"nf\">floor</span><span class=\"p\">(</span><span class=\"nf\">min</span><span class=\"p\">(</span><span class=\"n\">mape60</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"p\">)),</span><span class=\"w\"> </span><span class=\"nf\">ceiling</span><span class=\"p\">(</span><span class=\"nf\">max</span><span class=\"p\">(</span><span class=\"n\">mape60</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"p\">)),</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">))</span><span class=\"w\">\n  \n</span><span class=\"n\">ggsave</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"o\">=</span><span class=\"s2\">\"/png/ggmapebar.png\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">plot</span><span class=\"o\">=</span><span class=\"n\">plt4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">width</span><span class=\"o\">=</span><span class=\"m\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">height</span><span class=\"o\">=</span><span class=\"m\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dpi</span><span class=\"o\">=</span><span class=\"m\">200</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">scale</span><span class=\"o\">=</span><span class=\"m\">1.3</span><span class=\"p\">)</span><span class=\"w\"> </span></code></pre></figure>\n\n<p><img src=\"/simpleblog/assets/png/ggmapebar.png\" alt=\"average prediction error by minute\" /></p>\n\n<p>Then I calculated the quantiles of actual arrival times (<code class=\"highlighter-rouge\">df$est</code>) for each possible prediction (0, 1, 2, 3…100 minutes) using .05 increments for flexibilibity.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"w\"> \n\n</span><span class=\"n\">estq</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.frame</span><span class=\"p\">(</span><span class=\"n\">as.matrix</span><span class=\"p\">(</span><span class=\"n\">aggregate</span><span class=\"p\">(</span><span class=\"w\">\n\t\t</span><span class=\"n\">est</span><span class=\"o\">~</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">df</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">quantile</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">seq</span><span class=\"p\">(</span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"m\">1</span><span class=\"p\">,</span><span class=\"m\">.05</span><span class=\"p\">)))</span><span class=\"w\">\n\t</span><span class=\"p\">))</span></code></pre></figure>\n\n<p>which turns out to be this (only showing predictions 0-5 minutes):</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"w\">  </span><span class=\"n\">Minutes</span><span class=\"w\">    </span><span class=\"n\">est.0.</span><span class=\"w\">    </span><span class=\"n\">est.5.</span><span class=\"w\">  </span><span class=\"n\">est.10.</span><span class=\"w\">  </span><span class=\"n\">est.15.</span><span class=\"w\">   </span><span class=\"n\">est.20.</span><span class=\"w\">   </span><span class=\"n\">est.25.</span><span class=\"w\">  </span><span class=\"n\">est.30.</span><span class=\"w\">  </span><span class=\"n\">est.35.</span><span class=\"w\">  </span><span class=\"n\">est.40.</span><span class=\"w\">  </span><span class=\"n\">est.45.</span><span class=\"w\">  </span><span class=\"n\">est.50.</span><span class=\"w\">  </span><span class=\"n\">est.55.</span><span class=\"w\">   </span><span class=\"n\">est.60.</span><span class=\"w\">   </span><span class=\"n\">est.65.</span><span class=\"w\">   </span><span class=\"n\">est.70.</span><span class=\"w\">   </span><span class=\"n\">est.75.</span><span class=\"w\">   </span><span class=\"n\">est.80.</span><span class=\"w\">  </span><span class=\"n\">est.85.</span><span class=\"w\">  </span><span class=\"n\">est.90.</span><span class=\"w\">  </span><span class=\"n\">est.95.</span><span class=\"w\">  </span><span class=\"n\">est.100.</span><span class=\"w\">\n       </span><span class=\"m\">0</span><span class=\"w\"> </span><span class=\"m\">0.0000000</span><span class=\"w\"> </span><span class=\"m\">0.0000000</span><span class=\"w\"> </span><span class=\"m\">0.000000</span><span class=\"w\"> </span><span class=\"m\">0.000000</span><span class=\"w\"> </span><span class=\"m\">0.1702833</span><span class=\"w\"> </span><span class=\"m\">0.1708667</span><span class=\"w\"> </span><span class=\"m\">0.171920</span><span class=\"w\"> </span><span class=\"m\">0.340590</span><span class=\"w\"> </span><span class=\"m\">0.341700</span><span class=\"w\"> </span><span class=\"m\">0.343200</span><span class=\"w\"> </span><span class=\"m\">0.510850</span><span class=\"w\"> </span><span class=\"m\">0.512670</span><span class=\"w\"> </span><span class=\"m\">0.5157933</span><span class=\"w\"> </span><span class=\"m\">0.6817667</span><span class=\"w\"> </span><span class=\"m\">0.6845333</span><span class=\"w\"> </span><span class=\"m\">0.7331833</span><span class=\"w\"> </span><span class=\"m\">0.8552367</span><span class=\"w\"> </span><span class=\"m\">1.021637</span><span class=\"w\"> </span><span class=\"m\">1.031120</span><span class=\"w\"> </span><span class=\"m\">1.203293</span><span class=\"w\">  </span><span class=\"m\">2.252650</span><span class=\"w\">\n       </span><span class=\"m\">1</span><span class=\"w\"> </span><span class=\"m\">0.1713333</span><span class=\"w\"> </span><span class=\"m\">0.6837833</span><span class=\"w\"> </span><span class=\"m\">0.853850</span><span class=\"w\"> </span><span class=\"m\">0.912685</span><span class=\"w\"> </span><span class=\"m\">1.0263000</span><span class=\"w\"> </span><span class=\"m\">1.1005667</span><span class=\"w\"> </span><span class=\"m\">1.197133</span><span class=\"w\"> </span><span class=\"m\">1.229026</span><span class=\"w\"> </span><span class=\"m\">1.366980</span><span class=\"w\"> </span><span class=\"m\">1.373926</span><span class=\"w\"> </span><span class=\"m\">1.536183</span><span class=\"w\"> </span><span class=\"m\">1.541720</span><span class=\"w\"> </span><span class=\"m\">1.7034033</span><span class=\"w\"> </span><span class=\"m\">1.7104717</span><span class=\"w\"> </span><span class=\"m\">1.7542533</span><span class=\"w\"> </span><span class=\"m\">1.8816333</span><span class=\"w\"> </span><span class=\"m\">2.0454300</span><span class=\"w\"> </span><span class=\"m\">2.058844</span><span class=\"w\"> </span><span class=\"m\">2.228947</span><span class=\"w\"> </span><span class=\"m\">2.560958</span><span class=\"w\">  </span><span class=\"m\">3.624817</span><span class=\"w\">\n       </span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"m\">0.8558500</span><span class=\"w\"> </span><span class=\"m\">1.5370892</span><span class=\"w\"> </span><span class=\"m\">1.710678</span><span class=\"w\"> </span><span class=\"m\">1.880133</span><span class=\"w\"> </span><span class=\"m\">2.0340733</span><span class=\"w\"> </span><span class=\"m\">2.0560000</span><span class=\"w\"> </span><span class=\"m\">2.219588</span><span class=\"w\"> </span><span class=\"m\">2.228256</span><span class=\"w\"> </span><span class=\"m\">2.389870</span><span class=\"w\"> </span><span class=\"m\">2.398855</span><span class=\"w\"> </span><span class=\"m\">2.559617</span><span class=\"w\"> </span><span class=\"m\">2.568933</span><span class=\"w\"> </span><span class=\"m\">2.7259833</span><span class=\"w\"> </span><span class=\"m\">2.7410317</span><span class=\"w\"> </span><span class=\"m\">2.9015967</span><span class=\"w\"> </span><span class=\"m\">2.9216333</span><span class=\"w\"> </span><span class=\"m\">3.0806933</span><span class=\"w\"> </span><span class=\"m\">3.248529</span><span class=\"w\"> </span><span class=\"m\">3.423398</span><span class=\"w\"> </span><span class=\"m\">3.760646</span><span class=\"w\">  </span><span class=\"m\">5.174917</span><span class=\"w\">\n       </span><span class=\"m\">3</span><span class=\"w\"> </span><span class=\"m\">1.3672333</span><span class=\"w\"> </span><span class=\"m\">2.3879967</span><span class=\"w\"> </span><span class=\"m\">2.568347</span><span class=\"w\"> </span><span class=\"m\">2.738833</span><span class=\"w\"> </span><span class=\"m\">2.9066067</span><span class=\"w\"> </span><span class=\"m\">3.0677500</span><span class=\"w\"> </span><span class=\"m\">3.087460</span><span class=\"w\"> </span><span class=\"m\">3.246477</span><span class=\"w\"> </span><span class=\"m\">3.271973</span><span class=\"w\"> </span><span class=\"m\">3.419170</span><span class=\"w\"> </span><span class=\"m\">3.461833</span><span class=\"w\"> </span><span class=\"m\">3.593877</span><span class=\"w\"> </span><span class=\"m\">3.6993467</span><span class=\"w\"> </span><span class=\"m\">3.7717700</span><span class=\"w\"> </span><span class=\"m\">3.9336867</span><span class=\"w\"> </span><span class=\"m\">4.0939833</span><span class=\"w\"> </span><span class=\"m\">4.1599733</span><span class=\"w\"> </span><span class=\"m\">4.334380</span><span class=\"w\"> </span><span class=\"m\">4.616890</span><span class=\"w\"> </span><span class=\"m\">4.962980</span><span class=\"w\">  </span><span class=\"m\">6.411083</span><span class=\"w\">\n       </span><span class=\"m\">4</span><span class=\"w\"> </span><span class=\"m\">1.9013167</span><span class=\"w\"> </span><span class=\"m\">3.2562533</span><span class=\"w\"> </span><span class=\"m\">3.588217</span><span class=\"w\"> </span><span class=\"m\">3.762400</span><span class=\"w\"> </span><span class=\"m\">3.9303300</span><span class=\"w\"> </span><span class=\"m\">4.0656333</span><span class=\"w\"> </span><span class=\"m\">4.145327</span><span class=\"w\"> </span><span class=\"m\">4.281953</span><span class=\"w\"> </span><span class=\"m\">4.443430</span><span class=\"w\"> </span><span class=\"m\">4.511590</span><span class=\"w\"> </span><span class=\"m\">4.628600</span><span class=\"w\"> </span><span class=\"m\">4.785950</span><span class=\"w\"> </span><span class=\"m\">4.8661900</span><span class=\"w\"> </span><span class=\"m\">4.9807400</span><span class=\"w\"> </span><span class=\"m\">5.1377533</span><span class=\"w\"> </span><span class=\"m\">5.3032667</span><span class=\"w\"> </span><span class=\"m\">5.4775833</span><span class=\"w\"> </span><span class=\"m\">5.666597</span><span class=\"w\"> </span><span class=\"m\">5.984240</span><span class=\"w\"> </span><span class=\"m\">6.335517</span><span class=\"w\"> </span><span class=\"m\">15.470133</span><span class=\"w\">\n       </span><span class=\"m\">5</span><span class=\"w\"> </span><span class=\"m\">2.5674667</span><span class=\"w\"> </span><span class=\"m\">4.1172400</span><span class=\"w\"> </span><span class=\"m\">4.453617</span><span class=\"w\"> </span><span class=\"m\">4.688427</span><span class=\"w\"> </span><span class=\"m\">4.9506233</span><span class=\"w\"> </span><span class=\"m\">5.1217750</span><span class=\"w\"> </span><span class=\"m\">5.205957</span><span class=\"w\"> </span><span class=\"m\">5.337202</span><span class=\"w\"> </span><span class=\"m\">5.481750</span><span class=\"w\"> </span><span class=\"m\">5.643520</span><span class=\"w\"> </span><span class=\"m\">5.803400</span><span class=\"w\"> </span><span class=\"m\">5.849483</span><span class=\"w\"> </span><span class=\"m\">5.9972100</span><span class=\"w\"> </span><span class=\"m\">6.1619100</span><span class=\"w\"> </span><span class=\"m\">6.3218600</span><span class=\"w\"> </span><span class=\"m\">6.4860917</span><span class=\"w\"> </span><span class=\"m\">6.6677600</span><span class=\"w\"> </span><span class=\"m\">6.863565</span><span class=\"w\"> </span><span class=\"m\">7.217443</span><span class=\"w\"> </span><span class=\"m\">7.708432</span><span class=\"w\"> </span><span class=\"m\">16.494933</span></code></pre></figure>\n\n<p>So when the Next Bus app predicts 5 minutes:<br />\n50% of the time the bus arrives between 5.1 and 6.5 minutes.<br />\n70% of the time the bus arrives between 4.7 and 6.9 minutes.<br />\n90% of the time the bus arrives between 4.1 and 7.7 minutes.</p>\n\n<p>We can visualize this using the code below to explore the confidence intervals for each possible prediction: 0,1,2,3…60 minutes.  I cut it off at 60 minutes because the data gets sparse after that and the lines generally continue to flat line.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">require</span><span class=\"p\">(</span><span class=\"s1\">'ggplot2'</span><span class=\"p\">)</span><span class=\"w\">  \n</span><span class=\"n\">estq60</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">estq</span><span class=\"p\">[</span><span class=\"n\">estq</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"o\">&lt;=</span><span class=\"m\">60</span><span class=\"p\">,]</span><span class=\"w\"> </span><span class=\"c1\"># keeping just predictions 0-60</span><span class=\"w\">\n</span><span class=\"n\">colfunc</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">colorRampPalette</span><span class=\"p\">(</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"pink\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick\"</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">cols</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">colfunc</span><span class=\"p\">(</span><span class=\"m\">4</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"n\">plt</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">estq60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Minutes</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">plt1</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">plt</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> \n  </span><span class=\"n\">geom_ribbon</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">ymin</span><span class=\"o\">=</span><span class=\"n\">est.5.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"n\">ymax</span><span class=\"o\">=</span><span class=\"n\">est.15.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">fill</span><span class=\"o\">=</span><span class=\"n\">cols</span><span class=\"p\">[</span><span class=\"m\">3</span><span class=\"p\">])</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> \n  </span><span class=\"n\">geom_ribbon</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">ymin</span><span class=\"o\">=</span><span class=\"n\">est.15.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"n\">ymax</span><span class=\"o\">=</span><span class=\"n\">est.25.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">fill</span><span class=\"o\">=</span><span class=\"n\">cols</span><span class=\"p\">[</span><span class=\"m\">2</span><span class=\"p\">])</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_ribbon</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">ymin</span><span class=\"o\">=</span><span class=\"n\">est.25.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"n\">ymax</span><span class=\"o\">=</span><span class=\"n\">est.50.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">fill</span><span class=\"o\">=</span><span class=\"n\">cols</span><span class=\"p\">[</span><span class=\"m\">1</span><span class=\"p\">])</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_ribbon</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">ymin</span><span class=\"o\">=</span><span class=\"n\">est.50.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"n\">ymax</span><span class=\"o\">=</span><span class=\"n\">est.75.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">fill</span><span class=\"o\">=</span><span class=\"n\">cols</span><span class=\"p\">[</span><span class=\"m\">1</span><span class=\"p\">])</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_ribbon</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">ymin</span><span class=\"o\">=</span><span class=\"n\">est.75.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"n\">ymax</span><span class=\"o\">=</span><span class=\"n\">est.85.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">fill</span><span class=\"o\">=</span><span class=\"n\">cols</span><span class=\"p\">[</span><span class=\"m\">2</span><span class=\"p\">])</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_ribbon</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">ymin</span><span class=\"o\">=</span><span class=\"n\">est.85.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"n\">ymax</span><span class=\"o\">=</span><span class=\"n\">est.95.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">fill</span><span class=\"o\">=</span><span class=\"n\">cols</span><span class=\"p\">[</span><span class=\"m\">3</span><span class=\"p\">])</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">est.50.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">col</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"black\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">lwd</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"m\">0</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">col</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"black\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">lwd</span><span class=\"o\">=</span><span class=\"m\">0.5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">linetype</span><span class=\"o\">=</span><span class=\"s1\">'dashed'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">xlab</span><span class=\"p\">(</span><span class=\"s2\">\"Prediction (minutes)\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">ylab</span><span class=\"p\">(</span><span class=\"s2\">\"Prediction error (minutes)\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">scale_y_continuous</span><span class=\"p\">(</span><span class=\"n\">breaks</span><span class=\"o\">=</span><span class=\"n\">seq</span><span class=\"p\">(</span><span class=\"nf\">floor</span><span class=\"p\">(</span><span class=\"nf\">min</span><span class=\"p\">(</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">est.10.</span><span class=\"o\">-</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"p\">)),</span><span class=\"w\"> </span><span class=\"nf\">ceiling</span><span class=\"p\">(</span><span class=\"nf\">max</span><span class=\"p\">(</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">est.95.</span><span class=\"o\">-</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"p\">)),</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> \n  </span><span class=\"n\">scale_x_continuous</span><span class=\"p\">(</span><span class=\"n\">breaks</span><span class=\"o\">=</span><span class=\"n\">seq</span><span class=\"p\">(</span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">10</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_errorbar</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">=</span><span class=\"n\">estq</span><span class=\"p\">[</span><span class=\"m\">58</span><span class=\"p\">,],</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">ymin</span><span class=\"o\">=</span><span class=\"n\">est.5.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ymax</span><span class=\"o\">=</span><span class=\"n\">est.95.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">width</span><span class=\"o\">=</span><span class=\"m\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">lwd</span><span class=\"o\">=</span><span class=\"m\">0.25</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_errorbar</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">=</span><span class=\"n\">estq</span><span class=\"p\">[</span><span class=\"m\">53</span><span class=\"p\">,],</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">ymin</span><span class=\"o\">=</span><span class=\"n\">est.15.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ymax</span><span class=\"o\">=</span><span class=\"n\">est.85.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">width</span><span class=\"o\">=</span><span class=\"m\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">lwd</span><span class=\"o\">=</span><span class=\"m\">0.25</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_errorbar</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">=</span><span class=\"n\">estq</span><span class=\"p\">[</span><span class=\"m\">47</span><span class=\"p\">,],</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">ymin</span><span class=\"o\">=</span><span class=\"n\">est.25.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ymax</span><span class=\"o\">=</span><span class=\"n\">est.75.</span><span class=\"o\">-</span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">width</span><span class=\"o\">=</span><span class=\"m\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">lwd</span><span class=\"o\">=</span><span class=\"m\">0.25</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"s2\">\"text\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s2\">\"50% confidence interval\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"m\">47-1.5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">est.65.</span><span class=\"p\">[</span><span class=\"m\">47</span><span class=\"p\">]</span><span class=\"o\">-</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"p\">[</span><span class=\"m\">47</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"o\">=</span><span class=\"m\">2.5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">hjust</span><span class=\"o\">=</span><span class=\"m\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"s2\">\"text\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s2\">\"70% confidence interval\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"m\">53-1.5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">est.80.</span><span class=\"p\">[</span><span class=\"m\">53</span><span class=\"p\">]</span><span class=\"o\">-</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"p\">[</span><span class=\"m\">53</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"o\">=</span><span class=\"m\">2.5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">hjust</span><span class=\"o\">=</span><span class=\"m\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"s2\">\"text\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s2\">\"90% confidence interval\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"m\">58-1.5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">est.90.</span><span class=\"p\">[</span><span class=\"m\">58</span><span class=\"p\">]</span><span class=\"o\">-</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"p\">[</span><span class=\"m\">58</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"o\">=</span><span class=\"m\">2.5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">hjust</span><span class=\"o\">=</span><span class=\"m\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">annotate</span><span class=\"p\">(</span><span class=\"s2\">\"text\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s2\">\"Median\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"m\">12+1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">est.50.</span><span class=\"p\">[</span><span class=\"m\">12</span><span class=\"p\">]</span><span class=\"o\">-</span><span class=\"n\">estq60</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"p\">[</span><span class=\"m\">12</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"o\">=</span><span class=\"m\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">hjust</span><span class=\"o\">=</span><span class=\"m\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fontface</span><span class=\"o\">=</span><span class=\"s2\">\"bold\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">plt1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\">#visualize plot before saving</span><span class=\"w\">\n</span><span class=\"n\">ggsave</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"o\">=</span><span class=\"s2\">\"/png/ggconf.png\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">plot</span><span class=\"o\">=</span><span class=\"n\">plt1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">width</span><span class=\"o\">=</span><span class=\"m\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">height</span><span class=\"o\">=</span><span class=\"m\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dpi</span><span class=\"o\">=</span><span class=\"m\">200</span><span class=\"p\">)</span><span class=\"w\"> </span></code></pre></figure>\n\n<p><img src=\"/simpleblog/assets/png/ggconf.png\" alt=\"confidence intervals for Next Bus predictions\" /></p>\n\n<p>First note from the red waves above that <strong>predictions are consistently biased conservatively.</strong>  That is, buses usually (~80% of the time) arrive after their predicted time.</p>\n\n<p>Second note that the <strong>something weird aboout predictions of 11,12 and 13 minutes</strong>.  As one would expect, the error of predictions is less when the bus is closer (&lt;10 minutes away).  As the bus gets closer, Next Bus only has to predict a couple periods ahead rather than many.  It’s well known among forecasters (and non-forecasters) that the general happenings of tomorrow is a much\neasier task than predicting the general happenings for a specific day decades in the future.\nWe have more information about tomorrow.</p>\n\n<p>So why are predictions made a few months (11-13 minutes) into the future worse than \nthose made years into the future (14-60 minutes)?  <strong>My first thought was that forecasts are recalibrated when they start predicting in the 11-13 minute window.</strong></p>\n\n<p>I used to forecast macroeconomic indicators for a small <a href=\"http://en.wikipedia.org/wiki/Chile\">emerging market country</a> when I worked at the <a href=\"http://www.federalreserve.gov/\">Fed</a>.  GDP, CPI inflation, monetary policy, all that good stuff.  If there’s one thing I learned from my role as a country analyst, it was that forecasting is hard and usually more art than science… at least for macro indicators.  Forecasts more than a couple years out are based on, well, usually not much.  However macroeconomic forecasts for the\nnext quarter or two are more grounded.\nThere is higher frequency and more recent (useful) data to make forecasts based on nowcasts, timeseries models, and knowledge of policy, momentum, etc.</p>\n\n<p>So when presented with new information about the economy of my forecast country during the forecast period (every month or two), I often faced a choice: revise or the stay the course.  Knowing when to revise is hard.  One doesn’t want to overreact\nto information too soon just to revise a forecast in the opposite direction next time.  Consumers of forecasts value both accuracy AND\nconsistency.  The balance of which is tricky – there is usually a tradeoff.</p>\n\n<p>This revision behavior explains why the Next Bus errors trend downward as predictions decrease from 10 to 0 minutes.  But why the spike in \nerrors 11-13 minutes out?  My second thought led me to create the visualization below which allows for an investigation of individual buses and their predictions throughout the week.  Possibly a forecast bug? An idiosyncrasy of this particular bus route?</p>\n\n<iframe style=\"border: 0px;\" src=\"/simpleblog/assets/html/busScatter.html\" width=\"1000\" height=\"550\"></iframe>\n\n<p>Surprisingly, the revision hypothesis appears to be dead wrong (or at least very poorly implemented).\nPredictions often follow a consistent trend (straight diagonal line) until some point where predictions \nprematurely jump to 11, 12, or 13 minutes, when in reality, there is much longer to wait.</p>\n\n<p><strong>Below:</strong> Exploring the variation around predictions 0, 1, 2, 3 … 60 minutes.  Reaffirming that predictions of 11-13 minutes\nare the most volatile.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">estvar</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.frame</span><span class=\"p\">(</span><span class=\"n\">as.matrix</span><span class=\"p\">(</span><span class=\"n\">aggregate</span><span class=\"p\">(</span><span class=\"n\">err</span><span class=\"o\">~</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">df</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"nf\">sqrt</span><span class=\"p\">(</span><span class=\"n\">var</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)))))</span><span class=\"w\">\n\n</span><span class=\"n\">plt2</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">=</span><span class=\"n\">estvar</span><span class=\"p\">[</span><span class=\"n\">estvar</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"o\">&lt;=</span><span class=\"m\">60</span><span class=\"p\">,],</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">err</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"n\">Minutes</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n          </span><span class=\"n\">geom_text</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Minutes</span><span class=\"p\">,</span><span class=\"n\">err</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"o\">=</span><span class=\"m\">3</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n          </span><span class=\"n\">ylab</span><span class=\"p\">(</span><span class=\"s2\">\"Standard deviation of prediction error\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n          </span><span class=\"n\">xlab</span><span class=\"p\">(</span><span class=\"s2\">\"Prediction (minutes)\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"n\">ggsave</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"o\">=</span><span class=\"s2\">\"/png/ggstddev.png\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">plot</span><span class=\"o\">=</span><span class=\"n\">plt2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">width</span><span class=\"o\">=</span><span class=\"m\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">height</span><span class=\"o\">=</span><span class=\"m\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dpi</span><span class=\"o\">=</span><span class=\"m\">200</span><span class=\"p\">)</span><span class=\"w\"> </span></code></pre></figure>\n\n<p><img src=\"/simpleblog/assets/png/ggstddev.png\" alt=\"standard deviations for Next Bus prediction errors\" /></p>\n\n<p><strong>Are Next Bus predictions less reliable during certain parts of the day, like rush hour?</strong>\nShort answer, yes - predictions are off the mark (late) most in the morning between 8am and 10am.\nNote this analysis is for the <a href=\"http://www.wmata.com/bus/timetables/dc/60-64.pdf\">64 bus</a> heading from a residential neighborhood (Petworth) south to Federal Triangle (downtown DC). So peak ridership and traffic and thus prediction errors along the bus route would likely be in the morning.</p>\n\n<p>I’m particularly interested in assessing relative accuracy of rush hour predictions, so I’m only looking at predictions on the weekdays.  The <code class=\"highlighter-rouge\">lubridate</code> R package makes working with POSIXct dates easy. First creating dummies for weekday and extracting hour.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">require</span><span class=\"p\">(</span><span class=\"s1\">'lubridate'</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">day</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">weekdays</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">time</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">weekday</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">ifelse</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">day</span><span class=\"w\"> </span><span class=\"o\">%in%</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s1\">'Monday'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'Tuesday'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'Wednesday'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'Thursday'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'Friday'</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">hour</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">hour</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">time</span><span class=\"p\">)</span></code></pre></figure>\n\n<p>Calculating the median prediction error for each prediction increment (1,2,3 … 60 minutes) by hour of day the prediction was made.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">agg</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">[</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">weekday</span><span class=\"o\">==</span><span class=\"m\">1</span><span class=\"p\">,],</span><span class=\"w\"> </span><span class=\"n\">aggregate</span><span class=\"p\">(</span><span class=\"n\">err</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"o\">=</span><span class=\"nf\">list</span><span class=\"p\">(</span><span class=\"n\">hour</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Minutes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">median</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"nf\">names</span><span class=\"p\">(</span><span class=\"n\">agg</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s1\">'hour'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'Minutes'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'err'</span><span class=\"p\">)</span></code></pre></figure>\n\n<p>which returns something like this (sample below).  So the average error for predictions made between 20:00 (8pm) 21:00 (9pm) when Next Bus predicts 3 minutes is 0.59874 minutes or 36 seconds (late).</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"c1\">#print(agg)</span><span class=\"w\">\n</span><span class=\"n\">hour</span><span class=\"w\">     </span><span class=\"n\">Minutes</span><span class=\"w\">    </span><span class=\"n\">err</span><span class=\"w\">\n</span><span class=\"m\">20</span><span class=\"w\">       </span><span class=\"m\">3</span><span class=\"w\">          </span><span class=\"m\">0.59874167</span><span class=\"w\">\n</span><span class=\"m\">21</span><span class=\"w\">       </span><span class=\"m\">3</span><span class=\"w\">          </span><span class=\"m\">0.26386667</span><span class=\"w\">\n</span><span class=\"m\">22</span><span class=\"w\">       </span><span class=\"m\">3</span><span class=\"w\">         </span><span class=\"m\">-0.04255000</span><span class=\"w\">\n</span><span class=\"m\">23</span><span class=\"w\">       </span><span class=\"m\">3</span><span class=\"w\">         </span><span class=\"m\">-0.25696667</span><span class=\"w\">\n </span><span class=\"m\">0</span><span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">          </span><span class=\"m\">1.82138333</span><span class=\"w\">\n </span><span class=\"m\">5</span><span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">          </span><span class=\"m\">0.62696667</span><span class=\"w\">\n </span><span class=\"m\">6</span><span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">         </span><span class=\"m\">-0.06708333</span><span class=\"w\">\n </span><span class=\"m\">7</span><span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">          </span><span class=\"m\">0.80045000</span><span class=\"w\">\n </span><span class=\"m\">8</span><span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">          </span><span class=\"m\">0.96903333</span><span class=\"w\">\n </span><span class=\"m\">9</span><span class=\"w\">       </span><span class=\"m\">4</span><span class=\"w\">          </span><span class=\"m\">0.80225000</span></code></pre></figure>\n\n<p>To make this easier to interpret and analyze, I want to reshape the results from long to wide format.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">agg2</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">reshape</span><span class=\"p\">(</span><span class=\"n\">agg</span><span class=\"p\">[</span><span class=\"n\">agg</span><span class=\"o\">$</span><span class=\"n\">Minutes</span><span class=\"o\">&lt;=</span><span class=\"m\">60</span><span class=\"p\">,],</span><span class=\"w\"> </span><span class=\"n\">timevar</span><span class=\"o\">=</span><span class=\"s1\">'Minutes'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">idvar</span><span class=\"o\">=</span><span class=\"s1\">'hour'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">direction</span><span class=\"o\">=</span><span class=\"s1\">'wide'</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">agg2</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">agg2</span><span class=\"p\">[</span><span class=\"n\">agg2</span><span class=\"o\">$</span><span class=\"n\">hour</span><span class=\"o\">&gt;=</span><span class=\"m\">5</span><span class=\"p\">,]</span></code></pre></figure>\n\n<p>which creates something like this (sample):</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"c1\">#print(agg2)</span><span class=\"w\">\n</span><span class=\"n\">hour</span><span class=\"w\">     </span><span class=\"n\">err.0</span><span class=\"w\">     </span><span class=\"n\">err.1</span><span class=\"w\">      </span><span class=\"n\">err.2</span><span class=\"w\">      </span><span class=\"n\">err.3</span><span class=\"w\">       </span><span class=\"n\">err.4</span><span class=\"w\">     </span><span class=\"n\">err.5</span><span class=\"w\">     </span><span class=\"n\">err.6</span><span class=\"w\">     </span><span class=\"n\">err.7</span><span class=\"w\">      </span><span class=\"n\">err.8</span><span class=\"w\">\n    </span><span class=\"m\">5</span><span class=\"w\"> </span><span class=\"m\">0.5116583</span><span class=\"w\"> </span><span class=\"m\">0.5411750</span><span class=\"w\"> </span><span class=\"m\">0.73470833</span><span class=\"w\">  </span><span class=\"m\">0.7683667</span><span class=\"w\">  </span><span class=\"m\">0.62696667</span><span class=\"w\"> </span><span class=\"m\">0.3133833</span><span class=\"w\"> </span><span class=\"m\">0.5913083</span><span class=\"w\"> </span><span class=\"m\">0.8793417</span><span class=\"w\"> </span><span class=\"m\">1.04840000</span><span class=\"w\">\n    </span><span class=\"m\">6</span><span class=\"w\"> </span><span class=\"m\">0.3423917</span><span class=\"w\"> </span><span class=\"m\">0.1991000</span><span class=\"w\"> </span><span class=\"m\">0.05491667</span><span class=\"w\"> </span><span class=\"m\">-0.0438500</span><span class=\"w\"> </span><span class=\"m\">-0.06708333</span><span class=\"w\"> </span><span class=\"m\">0.1321667</span><span class=\"w\"> </span><span class=\"m\">0.1897833</span><span class=\"w\"> </span><span class=\"m\">0.3459500</span><span class=\"w\"> </span><span class=\"m\">0.07853334</span><span class=\"w\">\n    </span><span class=\"m\">7</span><span class=\"w\"> </span><span class=\"m\">0.5158500</span><span class=\"w\"> </span><span class=\"m\">0.8785333</span><span class=\"w\"> </span><span class=\"m\">0.91016666</span><span class=\"w\">  </span><span class=\"m\">1.0939833</span><span class=\"w\">  </span><span class=\"m\">0.80045000</span><span class=\"w\"> </span><span class=\"m\">0.9994833</span><span class=\"w\"> </span><span class=\"m\">0.8455833</span><span class=\"w\"> </span><span class=\"m\">0.9087167</span><span class=\"w\"> </span><span class=\"m\">0.77608333</span><span class=\"w\">\n    </span><span class=\"m\">8</span><span class=\"w\"> </span><span class=\"m\">0.5109667</span><span class=\"w\"> </span><span class=\"m\">0.7079833</span><span class=\"w\"> </span><span class=\"m\">0.90148333</span><span class=\"w\">  </span><span class=\"m\">1.1051333</span><span class=\"w\">  </span><span class=\"m\">0.96903333</span><span class=\"w\"> </span><span class=\"m\">1.1482167</span><span class=\"w\"> </span><span class=\"m\">1.1714500</span><span class=\"w\"> </span><span class=\"m\">1.0322583</span><span class=\"w\"> </span><span class=\"m\">1.39443333</span><span class=\"w\">\n    </span><span class=\"m\">9</span><span class=\"w\"> </span><span class=\"m\">0.5126917</span><span class=\"w\"> </span><span class=\"m\">0.7099667</span><span class=\"w\"> </span><span class=\"m\">0.91218333</span><span class=\"w\">  </span><span class=\"m\">0.5982667</span><span class=\"w\">  </span><span class=\"m\">0.80225000</span><span class=\"w\"> </span><span class=\"m\">0.9846500</span><span class=\"w\"> </span><span class=\"m\">1.2013000</span><span class=\"w\"> </span><span class=\"m\">1.8911333</span><span class=\"w\"> </span><span class=\"m\">2.78528333</span><span class=\"w\">\n   </span><span class=\"m\">10</span><span class=\"w\"> </span><span class=\"m\">0.3447833</span><span class=\"w\"> </span><span class=\"m\">0.3663167</span><span class=\"w\"> </span><span class=\"m\">0.43183333</span><span class=\"w\">  </span><span class=\"m\">0.3377000</span><span class=\"w\">  </span><span class=\"m\">0.50693334</span><span class=\"w\"> </span><span class=\"m\">0.5863583</span><span class=\"w\"> </span><span class=\"m\">0.8441750</span><span class=\"w\"> </span><span class=\"m\">0.7526417</span><span class=\"w\"> </span><span class=\"m\">1.30873333</span></code></pre></figure>\n\n<p>Now creating the graphic that puts it all together.  I chose to not show average errors when predictions are 1,2,3 … 60 minutes separately.\nFirstly because the trend is the same and secondly because it’s messy.  So I averaged together the median errors for predictions of 5,6,7,8,9 minutes in one\ngoup and 10,11,12,13,14 minutes in a separate group.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">require</span><span class=\"p\">(</span><span class=\"s1\">'ggplot2'</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"n\">cols</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s1\">'firebrick'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'forestgreen'</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">agg2</span><span class=\"o\">$</span><span class=\"n\">err.5.9</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">rowMeans</span><span class=\"p\">(</span><span class=\"n\">agg2</span><span class=\"p\">[,</span><span class=\"n\">paste</span><span class=\"p\">(</span><span class=\"s1\">'err.'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">5</span><span class=\"o\">:</span><span class=\"m\">9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"o\">=</span><span class=\"s1\">''</span><span class=\"p\">)])</span><span class=\"w\">\n</span><span class=\"n\">agg2</span><span class=\"o\">$</span><span class=\"n\">err.10.14</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">rowMeans</span><span class=\"p\">(</span><span class=\"n\">agg2</span><span class=\"p\">[,</span><span class=\"n\">paste</span><span class=\"p\">(</span><span class=\"s1\">'err.'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">10</span><span class=\"o\">:</span><span class=\"m\">14</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"o\">=</span><span class=\"s1\">''</span><span class=\"p\">)])</span><span class=\"w\">\n\n</span><span class=\"n\">plt3</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">agg2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"n\">hour</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">err.5.9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"o\">=</span><span class=\"n\">cols</span><span class=\"p\">[</span><span class=\"m\">1</span><span class=\"p\">]),</span><span class=\"w\"> </span><span class=\"n\">lwd</span><span class=\"o\">=</span><span class=\"m\">1.5</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">err.10.14</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"o\">=</span><span class=\"n\">cols</span><span class=\"p\">[</span><span class=\"m\">2</span><span class=\"p\">]),</span><span class=\"w\"> </span><span class=\"n\">lwd</span><span class=\"o\">=</span><span class=\"m\">1.5</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_text</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">err.10.14</span><span class=\"m\">+.1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"n\">military2std</span><span class=\"p\">(</span><span class=\"n\">hour</span><span class=\"p\">)),</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"o\">=</span><span class=\"m\">4</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">scale_x_continuous</span><span class=\"p\">(</span><span class=\"n\">breaks</span><span class=\"o\">=</span><span class=\"n\">seq</span><span class=\"p\">(</span><span class=\"nf\">min</span><span class=\"p\">(</span><span class=\"n\">agg2</span><span class=\"o\">$</span><span class=\"n\">hour</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">max</span><span class=\"p\">(</span><span class=\"n\">agg2</span><span class=\"o\">$</span><span class=\"n\">hour</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">labels</span><span class=\"o\">=</span><span class=\"n\">military2std</span><span class=\"p\">(</span><span class=\"n\">seq</span><span class=\"p\">(</span><span class=\"nf\">min</span><span class=\"p\">(</span><span class=\"n\">agg2</span><span class=\"o\">$</span><span class=\"n\">hour</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">max</span><span class=\"p\">(</span><span class=\"n\">agg2</span><span class=\"o\">$</span><span class=\"n\">hour</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">)))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">ylab</span><span class=\"p\">(</span><span class=\"s1\">'Average prediction error (minutes)'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">xlab</span><span class=\"p\">(</span><span class=\"s1\">'Time of prediction'</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> \n  </span><span class=\"n\">scale_colour_manual</span><span class=\"p\">(</span><span class=\"n\">values</span><span class=\"o\">=</span><span class=\"n\">cols</span><span class=\"p\">[</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"m\">2</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"n\">labels</span><span class=\"o\">=</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s1\">'average error when prediction is 5-9 minutes'</span><span class=\"p\">,</span><span class=\"s1\">'average error when prediction is 10-14 minutes'</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> \n  </span><span class=\"n\">theme</span><span class=\"p\">(</span><span class=\"n\">legend.title</span><span class=\"o\">=</span><span class=\"n\">element_blank</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme</span><span class=\"p\">(</span><span class=\"n\">legend.position</span><span class=\"o\">=</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">.5</span><span class=\"p\">,</span><span class=\"m\">.1</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme</span><span class=\"p\">(</span><span class=\"n\">legend.text</span><span class=\"o\">=</span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"o\">=</span><span class=\"m\">12</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> \n  </span><span class=\"n\">theme</span><span class=\"p\">(</span><span class=\"n\">legend.background</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_rect</span><span class=\"p\">(</span><span class=\"n\">fill</span><span class=\"o\">=</span><span class=\"n\">alpha</span><span class=\"p\">(</span><span class=\"s1\">'white'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">0.5</span><span class=\"p\">)))</span><span class=\"w\">\n  \n</span><span class=\"n\">ggsave</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"o\">=</span><span class=\"s2\">\"png/gghourmedian.png\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">plot</span><span class=\"o\">=</span><span class=\"n\">plt3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">width</span><span class=\"o\">=</span><span class=\"m\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">height</span><span class=\"o\">=</span><span class=\"m\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">dpi</span><span class=\"o\">=</span><span class=\"m\">200</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">scale</span><span class=\"o\">=</span><span class=\"m\">1.3</span><span class=\"p\">)</span><span class=\"w\"> </span></code></pre></figure>\n\n<p><img src=\"/simpleblog/assets/png/gghourmedian.png\" alt=\"average prediction error by hour\" /></p>\n\n<p>So predictions are wrong (late) the most between 8am and 10am on the weekdays.  The errors jump around a bit throughout the day.  Some of this could be the chosen frequency (hours)… it would likely be smoother if I chose 4 or 5 periods of the day spanning several hours each.  Some of this could be the fact that I’m only analyzing one week of data for one bus line.  Perhaps there was anomalous behavior around predictions made at 9pm for a couple buses that is driving the spike in prediction errors between 9pm and 10pm.</p>\n\n<p>Analysis for next time!</p>\n\n<!-- **Analysis for another day: possible extensions**\n\n * **Interpolation:**  One question that is still not fully answered is when does Next Bus swallow their pride and revise forecasts.\n There is a lot of jumbling and flat lining around predictions of 8-13 minutes if you play with the scrolly d3 scatter plot app above.\n I was thinking one could use some interpolation methods (revisiting my Numerical Methods class in grad school) to fit a curve (some n-degree polynomial)\n to these data points.  The slope of the curve at the various prediction increments would determine how Next Bus revises their forecasts  \n -->\n\n<!-- The graphic below shows confidence intervals for Next Bus predictions ranging from 0-60 minutes.\nSo when the Next Bus app reads 10 minutes:  \n50% of the time the bus arrives between 31 seconds and 3:11 minutes late.  \n70% of the time the bus arrives between 19 seconds and 4:07 minutes late.  \n90% of the time the bus arrives between 50 seconds early and 6:20 minutes late. -->\n\n  <p><a href=\"http://brooksandrew.github.io/simpleblog/articles/nextbus3_analyze/\">How accurate is Next Bus III: getting the answers</a> was originally published by andrew brooks at <a href=\"http://brooksandrew.github.io/simpleblog\">andrew brooks</a> on September 17, 2014.</p>"
}