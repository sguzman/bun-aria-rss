{
  "title": "Even easier frequency tables in pandas 0.7.0",
  "link": "",
  "published": "2012-01-18T00:00:00-08:00",
  "updated": "2012-01-18T00:00:00-08:00",
  "author": {
    "name": "Wes McKinney"
  },
  "id": "tag:wesmckinney.com,2012-01-18:/blog/even-easier-frequency-tables-in-pandas-0-7-0/",
  "summary": "<p>I put in a little work on a new <code>crosstab</code> function in the main pandas namespace. It's basically a convenient shortcut to calling <code>pivot_table</code> to make it easy to compute cross-tabulations for a set of factors using <a href=\"http://pandas.sf.net\" title=\"pandas\" target=\"_blank\">pandas</a> DataFrame or even vanilla NumPy arrays!</p>\n<p>Here's an example:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]:</span> <span class=\"kn\">from â€¦</span></code></pre></div>",
  "content": "<p>I put in a little work on a new <code>crosstab</code> function in the main pandas namespace. It's basically a convenient shortcut to calling <code>pivot_table</code> to make it easy to compute cross-tabulations for a set of factors using <a href=\"http://pandas.sf.net\" title=\"pandas\" target=\"_blank\">pandas</a> DataFrame or even vanilla NumPy arrays!</p>\n<p>Here's an example:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]:</span> <span class=\"kn\">from</span> <span class=\"nn\">pandas</span> <span class=\"kn\">import</span> <span class=\"o\">*</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]:</span> <span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">DataFrame</span><span class=\"p\">({</span><span class=\"s1\">&#39;a&#39;</span> <span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">randint</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">),</span>\n   <span class=\"o\">...</span><span class=\"p\">:</span>                 <span class=\"s1\">&#39;b&#39;</span> <span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">randint</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">),</span>\n   <span class=\"o\">...</span><span class=\"p\">:</span>                 <span class=\"s1\">&#39;c&#39;</span> <span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">randint</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">)})</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]:</span> <span class=\"n\">df</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]:</span>\n    <span class=\"n\">a</span>  <span class=\"n\">b</span>  <span class=\"n\">c</span>\n<span class=\"mi\">0</span>   <span class=\"mi\">0</span>  <span class=\"mi\">1</span>  <span class=\"mi\">2</span>\n<span class=\"mi\">1</span>   <span class=\"mi\">1</span>  <span class=\"mi\">4</span>  <span class=\"mi\">1</span>\n<span class=\"mi\">2</span>   <span class=\"mi\">1</span>  <span class=\"mi\">4</span>  <span class=\"mi\">2</span>\n<span class=\"mi\">3</span>   <span class=\"mi\">1</span>  <span class=\"mi\">2</span>  <span class=\"mi\">2</span>\n<span class=\"mi\">4</span>   <span class=\"mi\">0</span>  <span class=\"mi\">0</span>  <span class=\"mi\">0</span>\n<span class=\"mi\">5</span>   <span class=\"mi\">0</span>  <span class=\"mi\">0</span>  <span class=\"mi\">2</span>\n<span class=\"mi\">6</span>   <span class=\"mi\">1</span>  <span class=\"mi\">2</span>  <span class=\"mi\">2</span>\n<span class=\"mi\">7</span>   <span class=\"mi\">1</span>  <span class=\"mi\">2</span>  <span class=\"mi\">0</span>\n<span class=\"mi\">8</span>   <span class=\"mi\">1</span>  <span class=\"mi\">1</span>  <span class=\"mi\">1</span>\n<span class=\"mi\">9</span>   <span class=\"mi\">1</span>  <span class=\"mi\">2</span>  <span class=\"mi\">0</span>\n<span class=\"mi\">10</span>  <span class=\"mi\">1</span>  <span class=\"mi\">4</span>  <span class=\"mi\">1</span>\n<span class=\"mi\">11</span>  <span class=\"mi\">1</span>  <span class=\"mi\">1</span>  <span class=\"mi\">2</span>\n<span class=\"mi\">12</span>  <span class=\"mi\">0</span>  <span class=\"mi\">1</span>  <span class=\"mi\">2</span>\n<span class=\"mi\">13</span>  <span class=\"mi\">1</span>  <span class=\"mi\">1</span>  <span class=\"mi\">0</span>\n<span class=\"mi\">14</span>  <span class=\"mi\">1</span>  <span class=\"mi\">4</span>  <span class=\"mi\">1</span>\n<span class=\"mi\">15</span>  <span class=\"mi\">1</span>  <span class=\"mi\">4</span>  <span class=\"mi\">0</span>\n<span class=\"mi\">16</span>  <span class=\"mi\">0</span>  <span class=\"mi\">4</span>  <span class=\"mi\">1</span>\n<span class=\"mi\">17</span>  <span class=\"mi\">0</span>  <span class=\"mi\">3</span>  <span class=\"mi\">1</span>\n<span class=\"mi\">18</span>  <span class=\"mi\">1</span>  <span class=\"mi\">0</span>  <span class=\"mi\">1</span>\n<span class=\"mi\">19</span>  <span class=\"mi\">0</span>  <span class=\"mi\">4</span>  <span class=\"mi\">1</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">]:</span> <span class=\"n\">crosstab</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;b&#39;</span><span class=\"p\">],</span> <span class=\"p\">[</span><span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;a&#39;</span><span class=\"p\">],</span> <span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;c&#39;</span><span class=\"p\">]])</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">]:</span>\n<span class=\"n\">a</span>  <span class=\"mi\">0</span>        <span class=\"mi\">1</span>\n<span class=\"n\">c</span>  <span class=\"mi\">0</span>  <span class=\"mi\">1</span>  <span class=\"mi\">2</span>  <span class=\"mi\">0</span>  <span class=\"mi\">1</span>  <span class=\"mi\">2</span>\n<span class=\"n\">b</span>\n<span class=\"mi\">0</span>  <span class=\"mi\">1</span>  <span class=\"mi\">0</span>  <span class=\"mi\">1</span>  <span class=\"mi\">0</span>  <span class=\"mi\">1</span>  <span class=\"mi\">0</span>\n<span class=\"mi\">1</span>  <span class=\"mi\">0</span>  <span class=\"mi\">0</span>  <span class=\"mi\">2</span>  <span class=\"mi\">1</span>  <span class=\"mi\">1</span>  <span class=\"mi\">1</span>\n<span class=\"mi\">2</span>  <span class=\"mi\">0</span>  <span class=\"mi\">0</span>  <span class=\"mi\">0</span>  <span class=\"mi\">2</span>  <span class=\"mi\">0</span>  <span class=\"mi\">2</span>\n<span class=\"mi\">3</span>  <span class=\"mi\">0</span>  <span class=\"mi\">1</span>  <span class=\"mi\">0</span>  <span class=\"mi\">0</span>  <span class=\"mi\">0</span>  <span class=\"mi\">0</span>\n<span class=\"mi\">4</span>  <span class=\"mi\">0</span>  <span class=\"mi\">2</span>  <span class=\"mi\">0</span>  <span class=\"mi\">1</span>  <span class=\"mi\">3</span>  <span class=\"mi\">1</span>\n</code></pre></div>\n\n<p>This makes it very easy to produce an easy-on-the-eyes frequency table. <code>crosstab</code> can also take NumPy arrays. Suppose we had 1 million draws from a normal distribution, and we wish to produce a histogram-like table showing the number of draws whose absolute values fall into the bins defined by <code>[0, 1, 2, 3]</code>. Also, let's divide things up by sign. Using <code>crosstab</code> this becomes dead simple.</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">19</span><span class=\"p\">]:</span> <span class=\"n\">arr</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">randn</span><span class=\"p\">(</span><span class=\"mi\">1000000</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">20</span><span class=\"p\">]:</span> <span class=\"n\">buckets</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">]</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">22</span><span class=\"p\">]:</span> <span class=\"n\">crosstab</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">digitize</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">arr</span><span class=\"p\">),</span> <span class=\"n\">buckets</span><span class=\"p\">),</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">sign</span><span class=\"p\">(</span><span class=\"n\">arr</span><span class=\"p\">),</span>\n   <span class=\"o\">....</span><span class=\"p\">:</span>          <span class=\"n\">rownames</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;bucket&#39;</span><span class=\"p\">],</span> <span class=\"n\">colnames</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;sign&#39;</span><span class=\"p\">])</span>\n   <span class=\"o\">....</span><span class=\"p\">:</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">22</span><span class=\"p\">]:</span>\n<span class=\"n\">sign</span>    <span class=\"o\">-</span><span class=\"mf\">1.0</span>    <span class=\"mf\">1.0</span>\n<span class=\"n\">bucket</span>\n<span class=\"mi\">1</span>       <span class=\"mi\">341678</span>  <span class=\"mi\">340498</span>\n<span class=\"mi\">2</span>       <span class=\"mi\">136104</span>  <span class=\"mi\">135999</span>\n<span class=\"mi\">3</span>       <span class=\"mi\">21424</span>   <span class=\"mi\">21607</span>\n<span class=\"mi\">4</span>       <span class=\"mi\">1334</span>    <span class=\"mi\">1356</span>\n</code></pre></div>\n\n<p>Of course since the result is a DataFrame you can customize the indexes:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">28</span><span class=\"p\">]:</span> <span class=\"n\">table</span> <span class=\"o\">=</span> <span class=\"n\">crosstab</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">digitize</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">arr</span><span class=\"p\">),</span> <span class=\"n\">buckets</span><span class=\"p\">),</span>\n   <span class=\"o\">....</span><span class=\"p\">:</span>                  <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">sign</span><span class=\"p\">(</span><span class=\"n\">arr</span><span class=\"p\">),</span> <span class=\"n\">rownames</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;bucket&#39;</span><span class=\"p\">],</span>\n   <span class=\"o\">....</span><span class=\"p\">:</span>                  <span class=\"n\">colnames</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;sign&#39;</span><span class=\"p\">])</span>\n   <span class=\"o\">....</span><span class=\"p\">:</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">29</span><span class=\"p\">]:</span> <span class=\"n\">table</span><span class=\"o\">.</span><span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">Index</span><span class=\"p\">([</span><span class=\"s1\">&#39;[0, 1)&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;[1, 2)&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;[2, 3)&#39;</span><span class=\"p\">,</span>\n   <span class=\"o\">....</span><span class=\"p\">:</span>                      <span class=\"s1\">&#39;[3, inf)&#39;</span><span class=\"p\">],</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;bin&quot;</span><span class=\"p\">)</span>\n   <span class=\"o\">....</span><span class=\"p\">:</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">30</span><span class=\"p\">]:</span> <span class=\"n\">table</span><span class=\"o\">.</span><span class=\"n\">columns</span> <span class=\"o\">=</span> <span class=\"n\">Index</span><span class=\"p\">([</span><span class=\"s1\">&#39;negative&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;positive&#39;</span><span class=\"p\">],</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;sign&quot;</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">31</span><span class=\"p\">]:</span> <span class=\"n\">table</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">31</span><span class=\"p\">]:</span>\n<span class=\"n\">sign</span>      <span class=\"n\">negative</span>  <span class=\"n\">positive</span>\n<span class=\"nb\">bin</span>\n<span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>    <span class=\"mi\">341678</span>    <span class=\"mi\">340498</span>\n<span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>    <span class=\"mi\">136104</span>    <span class=\"mi\">135999</span>\n<span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">)</span>    <span class=\"mi\">21424</span>     <span class=\"mi\">21607</span>\n<span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"n\">inf</span><span class=\"p\">)</span>  <span class=\"mi\">1334</span>      <span class=\"mi\">1356</span>\n</code></pre></div>"
}