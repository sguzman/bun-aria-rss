{
  "id": "tag:blogger.com,1999:blog-1176949257541686127.post-5612903452487693830",
  "published": "2022-04-13T12:00:00.002-04:00",
  "updated": "2022-04-13T12:35:03.233-04:00",
  "title": "How to SLSA Part 2 - The Details",
  "content": "<span class=\"byline-author\">Posted by Tom&nbsp; Hennen, software engineer, BCID &amp; GOSST&nbsp;</span><div><br /></div><div><span id=\"docs-internal-guid-6dda854b-7fff-91c4-18ba-7c8c98353417\">In <a href=\"https://security.googleblog.com/2022/04/how-to-slsa-part-1-basics.html\">our last post</a> we introduced a fictional example of Squirrel, Oppy, and Acme learning to use SLSA and covered the basics of what their implementations might look like. Today we’ll cover the details: where to store attestations and policies, what policies should check, and how to handle key distribution and trust.<br /></span><h1 style=\"text-align: left;\"><span>Attestation storage</span></h1><span>Attestations play a large role in SLSA and it’s essential that consumers of artifacts know where to find the attestations for those artifacts.<br /><br /></span></div><div><span><b>Co-located in repo<br /></b><br />Attestations could be colocated in the repository that hosts the artifact. This is how Squirrel plans to store attestations for packages. They even want to add support to the Squirrel CLI (e.g. acorn get-attestations foo@1.2.3).<br /><br />Acme really likes this approach because the attestations are always available and it doesn’t introduce any new dependencies.</span></div><div><b><br /></b></div><div><b>Rekor</b></div><div><span><br />Meanwhile, Oppy plans to store attestations in <a href=\"https://github.com/sigstore/rekor\">Rekor</a>. They like being able to direct users to an existing public instance while not having to maintain any new infrastructure themselves, and the in-depth defense the transparency log provides against tampering with the attestations.<br /><br />Though the latency of querying attestations from Rekor is likely too high for doing verification at time of use, Oppy isn’t too concerned since they expect users to query Rekor at install time.<br /><br /><b>Hybrid</b><br /><br />A hybrid model is also available where the publisher stores the attestations in Rekor as well as co-located with the artifact in the repo—along with Rekor’s inclusion proof. This provides confidence the data was added to Rekor while providing the benefits of co-locating attestations in the repository.<br /><br /></span><h1 style=\"text-align: left;\"><span>Policy content</span></h1><span>‘Policy’ refers to the rules used to determine if an artifact should be allowed for a use case.<br /><br />Policies often use the package name as a proxy for determining the use case. An example being, if you want to find the policy to apply you could look up the policy using the package name of the artifact you’re evaluating.<br /><br />Policy specifics may vary based on ease of use, availability of data, risk tolerance and more. Full verification needs more from policies than delegated verification does.<br /><br /></span></div><div><span><b>Default policy</b><br /><br />Default policies allow admission decisions without the need to create specific policies for each package. A default policy is a way of saying “anything that doesn’t have a more specific policy must comply with this policy”.<br /><br />Squirrel plans to eventually implement a default policy of “any package without a more specific policy will be accepted as long as it meets SLSA 3”, but they recognize that most packages don’t support this yet. Until they achieve critical mass they’ll have a default SLSA 0 policy (all artifacts are accepted).<br /><br />While Oppy is leaving verification to their users, they’ll suggest a default policy of “any package built by ‘https://oppy.example/slsa/builder/v1’”.<br /><br /></span></div><div><span><b>Specific policy</b><br /><br />Squirrel also plans to allow users to create policies for specific packages. For example, this policy requires that package ‘foo’ must have been built by GitHub Actions, from github.com/foo/acorn-foo, and be SLSA 4.</span></div><div><span><br /><div align=\"left\" dir=\"ltr\" style=\"margin-left: 0pt;\"><table style=\"border-collapse: collapse; border: none;\"><colgroup></colgroup><tbody><tr style=\"height: 0pt;\"><td style=\"background-color: #fafafa; border-bottom: solid #e0e0e0 1pt; border-color: rgb(224, 224, 224); border-left: solid #e0e0e0 1pt; border-right: solid #e0e0e0 1pt; border-style: solid; border-top: solid #e0e0e0 1pt; border-width: 1pt; overflow-wrap: break-word; overflow: hidden; padding: 5pt; vertical-align: top;\"><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">scope</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'acorn://foo'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">target_level</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> SLSA_L4</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">allow_github_actions </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">{</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">&nbsp;&nbsp;workflow</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'https://github.com/gossts/slsa-acorn/.github/workflows/builder.yml@main'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">&nbsp;&nbsp;source_repo</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'https://github.com/foo/acorn-foo.git'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">&nbsp;&nbsp;allow_branch</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'main'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">}</span></p></td></tr></tbody></table></div><br />Squirrel will also allow packages to create SLSA 0 policies if they’re not using SLSA compliant infrastructure.<p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span style=\"font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"><br /></span></p><div align=\"left\" dir=\"ltr\" style=\"margin-left: 0pt;\"><table style=\"border-collapse: collapse; border: none;\"><colgroup></colgroup><tbody><tr style=\"height: 0pt;\"><td style=\"background-color: #fafafa; border-bottom: solid #e0e0e0 1pt; border-color: rgb(224, 224, 224); border-left: solid #e0e0e0 1pt; border-right: solid #e0e0e0 1pt; border-style: solid; border-top: solid #e0e0e0 1pt; border-width: 1pt; overflow-wrap: break-word; overflow: hidden; padding: 5pt; vertical-align: top;\"><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">scope</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'acorn://qux'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">target_level</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> SLSA_L0</span></p></td></tr></tbody></table></div><br /><br /></span><b>Policy auto generation</b></div><div><span><br /></span></div><div><span>Squirrel has an enormous number of existing packages. It’s not feasible to get all those package maintainers to create specific policies themselves. Therefore, Squirrel plans to leverage <a href=\"https://en.wikipedia.org/wiki/Process_mining\">process mining</a> to auto generate policies for packages based on the history of the package. E.g. “The last 10 times Squirrel package foo was published it was built by GitHub Actions from github.com/foo/acorn-foo, and met SLSA 4 (this is the policy above). Let’s create a policy that requires that and send it to the maintainers to review.”<br />Policy add-ons<br /><br />Policy evaluation could do more than just evaluate the SLSA requirements. The same policies that check SLSA requirements are well placed to check other properties that are important to organizations like “was static analysis performed”, “are there any known CVEs in this artifact”, “was integration testing successful”, etc…<br /><br />Acme is really interested in some of these policy add-ons. They’d like to avoid the embarrassing situation of publishing a new container image with known CVEs. They’re not sure how to implement it yet but they’ll be on the lookout for tools that can help them do so.<br /><b><br /></b></span></div><div><span><b>Delegated policies<br /></b><br />When using delegated verification there’s much less that actually needs to be checked and they can be hard-coded directly in tooling. A minimal delegated verification policy might be “allow if trusted-party verified this artifact (identified by digest) as &lt;package name&gt;”. This can be tightened further by adding requirements on the artifact &amp; its dependencies SLSA levels (data which is available in the VSA). For example, “allow if trusted-party verified this artifact as &lt;package name&gt; at SLSA 3 and it doesn’t have any dependencies less than SLSA 2”.</span></div><div><span><br /><div align=\"left\" dir=\"ltr\" style=\"margin-left: 0pt;\"><table style=\"border-collapse: collapse; border: none;\"><colgroup></colgroup><tbody><tr style=\"height: 0pt;\"><td style=\"background-color: #fafafa; border-bottom: solid #e0e0e0 1pt; border-color: rgb(224, 224, 224); border-left: solid #e0e0e0 1pt; border-right: solid #e0e0e0 1pt; border-style: solid; border-top: solid #e0e0e0 1pt; border-width: 1pt; overflow-wrap: break-word; overflow: hidden; padding: 5pt; vertical-align: top;\"><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #455a64; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"># Delegated verification implicitly checks that the package name we're</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #455a64; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"># checking matches the VSA's subject.name field.</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">allow_delegated_verification </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">{</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">&nbsp;&nbsp;trusted_verifier</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'https://delegatedverifier.com/slsa/v1'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">&nbsp;&nbsp;minimum_level</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> SLSA_L3</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">&nbsp;&nbsp;minimum_dependency_level</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> SLSA_L2</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">}</span></p></td></tr></tbody></table></div></span><h1 style=\"text-align: left;\"><span><br /></span><span>Policy storage</span></h1><span><br />When using specific, non-default, policies verifiers need to know where to find the policy they need to evaluate.<br /><br /></span></div><div><span><b>Co-located in repo</b><br /><br />Squirrel plans to store specific policies as a property of the package in the repository. This makes them very easy for users and their tooling to find. It also allows the maintainer of the package to easily set the policy (they already have write permissions!).<br /><br />A potential downside is that the write permissions are the same as for the package itself. An attacker that compromises the developer’s credentials could also change the policy. This may not be as bad as it seems. Policies are human-readable so anyone paying attention would notice that package foo’s policy now says that it can be built from github.com/not-foo/acorn-foo. Squirrel plans to notify interested parties (including the maintainer!) when the policy changes, potentially letting them “sound the alarm” if anything nefarious happens.<br /><br />A similar approach is taken in a number of contact-change workflows. For example, when you change your address with your bank, the bank will send you an email (and a letter to the old address) letting you know the address has been changed. This type of notification would alert the maintainer to a potential compromise.<br /><br />Squirrel would also consider requiring a second person to review any policy changes for packages with over 10,000 users.</span></div><div><span><br /><b>Public canonical Git repo</b><br /><br />Another option might be to just create a canonical git repo (e.g. github.com/slsa-framework/slsa-acorn-policies) and let people publish proposed policies there. This has the advantage of using a separate ACL control mechanism from the package repository itself, but the disadvantages of being difficult to ensure the author of the policy is actually allowed to set the policy for that package and not scaling well as the repo grows.<br /><br />The approach outlined in policy auto generation could help here. Automation in the repo could just look at the last N releases of the package and determine if the proposed policy matches what’s actually been published. Proactive changes to the policy (like deciding to switch from GitHub Actions to CircleCI) would be harder to coordinate however.</span></div><div><span><br /><b>Org specific repo<br /></b><br />Acme plans to establish their own org specific repo for policy storage. This gives them a single place to store all their policies, regardless of ecosystem type, and lets them provide more specific policies for packages provided by upstream repos. Since Oppy doesn’t have any plans to provide package-specific policies this gives Acme a place to store their own policies for Oppy packages (if they ever get around to it).<br /><br />Organizations can also use their policy repo to vet any upstream changes to policy and potentially add additional checks (e.g. “doesn’t have any known vulnerabilities”).<br /></span><h1 style=\"text-align: left;\"><span><br /></span><span>T</span>rusted Verifier</h1></div><div><span><br />Acme wants to use delegated verification and that relies on having trusted verifiers to make decisions for downstream users. Who are these trusted verifiers?<br /><br /></span></div><div><span><b>Public verifier<br /></b><br />A public repo is in a great position to act as a trusted verifier for their users. Users already trust these repos and they may already be doing verification on import.<br /><br />Squirrel plans to make use of this by making VSAs available for each artifact published, publicizing their verifier ID (i.e. ‘https://squirrel.example/slsa-verifier’) and the public key used to sign the VSAs. They even plan to build VSA verification directly into the Squirrel tooling, so that users can get SLSA protection by default.</span></div><div><span><br /><b>Org-wide verifier</b><br /><br />While Acme is happy to use Squirrel’s verifier (and the verification built into the tooling) they still need their own verifier so they can publish VSAs to Acme customers. So Acme plans to stand up their own verification service and publish their verifier ID (i.e. ‘https://acme.example/private-verifier’) and signing key. Acme customers can then verify the software they get from Acme.<br /><br />In the future Acme could require all software used throughout the company to be verified with this verifier (instead of relying on public verifiers). They’d do the verification and generate VSAs whenever artifacts are imported into their private Artifactory instance. They could then configure this ID/key pair for use throughout Acme and be confident that any software used has been verified according to Acme policy. That’s not Acme’s highest priority at the moment, but they like having this option open to them.</span><h1 style=\"text-align: left;\"><span>Key distribution &amp; Trust</span></h1></div><div><span>Both full and delegated verification depend upon key distribution to the users doing the verification. Depending on the specifics and what’s getting verified this can be a difficult problem.<br /><br /></span></div><div><span><b>Org-specific keys</b><br /><br />When using delegated verification this could be the easiest case. Squirrel can just build the key they used for delegated verification directly into the Squirrel tooling. Acme can also fairly easily configure the use of their keys through the company using existing configuration control mechanisms.<br /><br />When using full verification this can be harder. If there are multiple builders that could be accepted the keys that sign the attestations need to be distributed to everyone that might use that builder. For Squirrel this would be really difficult since they plan to allow package maintainers to use whatever builder they want. How those keys get configured would be tricky just for Squirrel, and much more difficult if downstream Squirrel users wanted to do full verification of the Squirrel packages.<br /><br />The situation is easier, however, for Oppy. That’s because Oppy plans to only accept artifacts built by their autobuilder network. Oppy can configure this network to use a single (or small set) of keys and then publish those keys (and the SLSA level Oppy believes it meets) for downstream users.<br /><br /></span></div><div><span><b>Fulcio</b><br /><br />Squirrel plans to solve the problem of which keys they accept by leveraging Fulcio. Squirrel will build support for Fulcio root keys into their verifier and then express which Fulcio subject is allowed to sign attestations in the specific policy of each package. E.g. “Squirrel package ‘foo’ must have been built &amp; signed by ‘spiffe://foobar.com/foo-builder, from github.com/foo/acorn-foo, and be SLSA 4”.</span></div><div><span><br /><div align=\"left\" dir=\"ltr\" style=\"margin-left: 0pt;\"><table style=\"border-collapse: collapse; border: none;\"><colgroup></colgroup><tbody><tr style=\"height: 0pt;\"><td style=\"background-color: #fafafa; border-bottom: solid #e0e0e0 1pt; border-color: rgb(224, 224, 224); border-left: solid #e0e0e0 1pt; border-right: solid #e0e0e0 1pt; border-style: solid; border-top: solid #e0e0e0 1pt; border-width: 1pt; overflow-wrap: break-word; overflow: hidden; padding: 5pt; vertical-align: top;\"><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">scope</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'acorn://foo'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">target_level</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> SLSA_L4</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">allow_fulcio_builder </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">{</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">&nbsp;&nbsp;id</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'spiffe://foobar.com/foo-builder'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">&nbsp;&nbsp;source_repo</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'https://github.com/foo/acorn-foo.git'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">&nbsp;&nbsp;allow_branch</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'main'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">&nbsp;&nbsp;allow_entrypoint</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">:</span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\"> </span><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #0f9d58; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">'package.json'</span></p><p dir=\"ltr\" style=\"line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;\"><span face=\"Consolas, sans-serif\" style=\"background-color: transparent; color: #616161; font-size: 10pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;\">}</span></p></td></tr></tbody></table></div><br /><br /><b>The Update Framework (TUF)<br /></b><br />The above methods could be further enhanced with <a href=\"https://theupdateframework.io/\">TUF</a> to allow the secure maintenance of keys. TUF metadata could include all the SLSA keys, the build services and other entities they’re valid for, and the SLSA levels they’re qualified at. Oppy is considering using TUF to let verifiers securely fetch and update keys used by the Autobuilder network. Oppy would use a TUF delegation to indicate that these keys should only be used for the builder id ‘https://oppy.example/slsa/builder/v1’. Squirrel might do something similar to allow for updating the Fulcio key in its tooling.</span></div><div><span><br /></span><h1 style=\"text-align: left;\"><span>Recording &amp; verifying dependencies</span></h1><span>Acme wants to record and verify the dependencies that go into its container into the SLSA provenance. Acme would prefer that this functionality were just built-in their build service, but that feature isn’t available yet. Instead they’ll need to do something themselves. They have a few options at their disposal:<br /><br /></span></div><div><span><b>Tool wrappers<br /></b><br />Since Oppy doesn’t build SLSA into it’s tooling Acme will create wrapper scripts for dependency import/installation that record and verify (using <a href=\"https://github.com/sigstore/cosign\">cosign</a>) dependencies as they’re installed. Acme will update their build scripts to replace all instances of Oppy package installation with the wrapper script and then use the recorded results to help populate the <a href=\"https://slsa.dev/provenance/v0.2#materials\">materials</a> section of the provenance.<br /><br />A downside is that this approach, if run in the build itself, is not guaranteed to be complete and cannot meet the “<a href=\"https://slsa.dev/spec/v0.1/requirements#non-falsifiable\">non-falsifiable</a>” requirement (since the results reported by the wrapper could be falsified by the build process), relegating this approach to SLSA 2. Still, it allows Acme to make progress SLSA-fying their builds and provides a starting point for achieving higher SLSA levels.</span></div><div><span><br /><b>Built into ecosystem tooling</b><br /><br />Since Squirrel does build verification into their tooling, Acme can just use acorn install to verify the dependencies and record what was installed. Acme can use this information to populate the Squirrel packages installed in the materials section of the provenance and it can include the attestations of those dependencies in the in-toto bundle for their container image.<br /><br />As with tool wrappers, if this method is used in the build itself it cannot meet “non-falsifiable” requirement.<br /><br /></span></div><div><span><b>Proxied verification<br /></b><br />Acme considered creating a proxy for their existing builder to proxy outbound connections. This proxy could verify everything fetched and use its logs to populate the provenance. Since this proxy is trusted it would be easier to meet “non-falsifiable” requirement. Unfortunately it’s also a lot of work for Acme so they’re going to defer this idea for now.<br /></span><h1 style=\"text-align: left;\"><span>Next time</span></h1><span>In the first two parts of this series, we’ve covered the basics of getting started with SLSA and the details of policy and provenance storage, policy verification, and key handling. In our next post we’ll cover how Squirrel, Oppy, and Acme put this all together to protect a heterogeneous supply chain.<br /></span></div>",
  "link": [
    "",
    "",
    "",
    "",
    ""
  ],
  "author": {
    "name": "Unknown",
    "email": "noreply@blogger.com",
    "gd:image": ""
  },
  "thr:total": 0
}