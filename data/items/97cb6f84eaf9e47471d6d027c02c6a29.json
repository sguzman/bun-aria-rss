{
  "title": "TSrepr use case - Clustering time series representations in R",
  "description": "<p>In the previous blog post, I showed you usage of my <a href=\"https://cran.r-project.org/package=TSrepr\"><strong>TSrepr</strong></a> package. There was shown what kind of <a href=\"https://petolau.github.io/TSrepr-time-series-representations/\">time series representations</a> are implemented and what are they good for.</p>\n\n<p>In this tutorial, I will show you one use case how to use time series representations effectively. This use case is <strong>clustering</strong> of time series and it will be clustering of consumers of electricity load.</p>\n\n<p>By clustering of consumers of electricity load, we can extract typical load <strong>profiles</strong>, improve the accuracy of consequent electricity consumption forecasting, detect anomalies or monitor a whole smart grid (grid of consumers) (Laurinec et al. (2016), Laurinec and Lucká (2016)). I will show you the first use case, the extraction of typical electricity load profiles by <a href=\"https://en.wikipedia.org/wiki/K-medoids\"><strong>K-medoids</strong></a> clustering method.</p>\n\n<p>Firstly, let’s load the required packages, data (<code class=\"language-plaintext highlighter-rouge\">elec_load</code>) and return the dimensions of the dataset.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">TSrepr</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">ggplot2</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">cluster</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">clusterCrit</span><span class=\"p\">)</span><span class=\"w\">\n \n</span><span class=\"n\">data</span><span class=\"p\">(</span><span class=\"s2\">\"elec_load\"</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"nf\">dim</span><span class=\"p\">(</span><span class=\"n\">elec_load</span><span class=\"p\">)</span></code></pre></figure>\n\n<figure class=\"highlight\"><pre><code class=\"language-text\" data-lang=\"text\">## [1]  50 672</code></pre></figure>\n\n<p>There are 50 time series (consumers) of length 672, specifically time series of length 2 weeks of electricity consumption.\nThese measurements are from smart meters from an unknown country.</p>\n\n<p>It is obvious that dimensionality is too high and the <a href=\"https://en.wikipedia.org/wiki/Curse_of_dimensionality\"><strong>curse of dimensionality</strong></a> can happen.\nFor this reason, we have to reduce dimensionality in some way. One of the best approaches is to use time series representations in order to reduce dimensionality, reduce noise and emphasize the main characteristics of time series.</p>\n\n<p>For double seasonal time series of electricity consumption (daily and weekly seasonality), the model-based representation approaches seem to have best ability to extract typical profiles of consumption.\nHowever, I will use some other representation methods implemented in <strong>TSrepr</strong> too.</p>\n\n<p>Let’s use one of the basic model-based representation methods - <strong>mean seasonal profile</strong>. It is implemented in the <code class=\"language-plaintext highlighter-rouge\">repr_seas_profile</code> function and we will use it alongside <code class=\"language-plaintext highlighter-rouge\">repr_matrix</code> function that computes representations for every row of a matrix of time series. One more very important notice here, normalisation of time series is a necessary procedure before every clustering or classification of time series. It is due to a fact that we want to extract typical curves of consumption and don’t cluster based on an amount of consumption.\nBy using the <strong>TSrepr</strong> package, we can do it all in one function - <code class=\"language-plaintext highlighter-rouge\">repr_matrix</code>. We will use z-score normalisation implemented in <code class=\"language-plaintext highlighter-rouge\">norm_z</code> function.\nWe have 48 measurements during a day, so set <code class=\"language-plaintext highlighter-rouge\">freq = 48</code>.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">data_seasprof</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">repr_matrix</span><span class=\"p\">(</span><span class=\"n\">elec_load</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">repr_seas_profile</span><span class=\"p\">,</span><span class=\"w\">\n                             </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">list</span><span class=\"p\">(</span><span class=\"n\">freq</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">48</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mean</span><span class=\"p\">),</span><span class=\"w\">\n                             </span><span class=\"n\">normalise</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">func_norm</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">norm_z</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"nf\">dim</span><span class=\"p\">(</span><span class=\"n\">data_seasprof</span><span class=\"p\">)</span></code></pre></figure>\n\n<figure class=\"highlight\"><pre><code class=\"language-text\" data-lang=\"text\">## [1] 50 48</code></pre></figure>\n\n<p>We can see that dimensionality was in fact reduced significantly. Now, let’s use the K-medoids (<code class=\"language-plaintext highlighter-rouge\">pam</code> function from <code class=\"language-plaintext highlighter-rouge\">cluster</code> package) clustering method to extract typical consumption profiles.\nSince we don’t know a proper number of clusters to create, i.e. a priori information about a number of clusters, an <a href=\"https://en.wikipedia.org/wiki/Cluster_analysis#Internal_evaluation\">internal validation index</a> is have to be used to determine an optimal number of clusters.\nI will use well known <a href=\"https://en.wikipedia.org/wiki/Davies%E2%80%93Bouldin_index\">Davies-Bouldin index</a> for this evaluation. By Davies-Bouldin index computation, we want to find a minimum of its values.</p>\n\n<p>I will set the range of number of clusters to 2-7.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">clusterings</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">lapply</span><span class=\"p\">(</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">2</span><span class=\"o\">:</span><span class=\"m\">7</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\">\n                  </span><span class=\"n\">pam</span><span class=\"p\">(</span><span class=\"n\">data_seasprof</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">))</span><span class=\"w\">\n \n</span><span class=\"n\">DB_values</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">sapply</span><span class=\"p\">(</span><span class=\"nf\">seq_along</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> \n                  </span><span class=\"n\">intCriteria</span><span class=\"p\">(</span><span class=\"n\">data_seasprof</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">as.integer</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"n\">x</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">clustering</span><span class=\"p\">),</span><span class=\"w\">\n                              </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"Davies_Bouldin\"</span><span class=\"p\">)))</span></code></pre></figure>\n\n<p>Let’s plot results of internal evaluation.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Clusters</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"o\">:</span><span class=\"m\">7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">DBindex</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">DB_values</span><span class=\"p\">)),</span><span class=\"w\">\n       </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Clusters</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">DBindex</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_point</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_bw</span><span class=\"p\">()</span></code></pre></figure>\n\n<p><img src=\"/images/post_8/unnamed-chunk-4-1.png\" alt=\"plot of chunk unnamed-chunk-4\" /></p>\n\n<p>The “best” number of clusters is 7 (lowest value of the index).</p>\n\n<p>Let’s plot the results of clustering with 7 number of clusters. I will use computed medoids stored in the object <code class=\"language-plaintext highlighter-rouge\">clustering</code>. For a visualization, the <code class=\"language-plaintext highlighter-rouge\">facet_wrap</code> function is very handy here.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"c1\"># prepare data for plotting</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">melt</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">class</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">as.factor</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"m\">6</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">clustering</span><span class=\"p\">),</span><span class=\"w\">\n                                        </span><span class=\"n\">data_seasprof</span><span class=\"p\">)))</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"n\">ncol</span><span class=\"p\">(</span><span class=\"n\">data_seasprof</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">data_seasprof</span><span class=\"p\">))]</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">data_seasprof</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"p\">(</span><span class=\"n\">data_seasprof</span><span class=\"p\">))]</span><span class=\"w\">\n \n</span><span class=\"c1\"># prepare medoids</span><span class=\"w\">\n</span><span class=\"n\">centers</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">melt</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"m\">6</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">medoids</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">setnames</span><span class=\"p\">(</span><span class=\"n\">centers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"Var1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Var2\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"class\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Time\"</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">centers</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">class</span><span class=\"p\">]</span><span class=\"w\">\n \n</span><span class=\"c1\"># plot the results</span><span class=\"w\">\n</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data_plot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">facet_wrap</span><span class=\"p\">(</span><span class=\"o\">~</span><span class=\"n\">class</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">scales</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"free_y\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"grey10\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.65</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">centers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">),</span><span class=\"w\">\n            </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.80</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1.2</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">labs</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Time\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Load (normalised)\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_bw</span><span class=\"p\">()</span></code></pre></figure>\n\n<p><img src=\"/images/post_8/unnamed-chunk-5-1.png\" alt=\"plot of chunk unnamed-chunk-5\" /></p>\n\n<p>We can see 5 typical extracted profiles - red lines (medoids of clusters). The next two clusters are one-elemental, so they can be referred as outliers.</p>\n\n<p>Now, let’s try some more sophisticated method for the extraction of seasonal profiles - <strong>GAM regression coefficients</strong>. By <code class=\"language-plaintext highlighter-rouge\">repr_gam</code> function, we can extract double seasonal regression coefficients - daily and weekly (you can read more about the <a href=\"https://petolau.github.io/Analyzing-double-seasonal-time-series-with-GAM-in-R/\">analysis of seasonal time series with <strong>GAM</strong> here</a>).\nHowever, the number of weekly seasonal regression coefficients will be only 6, because the number of the second seasonality coefficients is set to freq_2 / freq_1, so 48*7 / 48 = 7, and 7 - 1 = 6 because of splines computation (differentiation). I will again use <code class=\"language-plaintext highlighter-rouge\">repr_matrix</code> function.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">data_gam</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">repr_matrix</span><span class=\"p\">(</span><span class=\"n\">elec_load</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">repr_gam</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">list</span><span class=\"p\">(</span><span class=\"n\">freq</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">48</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">48</span><span class=\"o\">*</span><span class=\"m\">7</span><span class=\"p\">)),</span><span class=\"w\">\n                        </span><span class=\"n\">normalise</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">func_norm</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">norm_z</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"nf\">dim</span><span class=\"p\">(</span><span class=\"n\">data_gam</span><span class=\"p\">)</span></code></pre></figure>\n\n<figure class=\"highlight\"><pre><code class=\"language-text\" data-lang=\"text\">## [1] 50 53</code></pre></figure>\n\n<p>So the dimension is 47 + 6 = 53 because of usage of splines in GAM method. Let’s cluster the data and visualize results of it.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">clusterings</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">lapply</span><span class=\"p\">(</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">2</span><span class=\"o\">:</span><span class=\"m\">7</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\">\n                  </span><span class=\"n\">pam</span><span class=\"p\">(</span><span class=\"n\">data_gam</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">))</span><span class=\"w\">\n \n</span><span class=\"n\">DB_values</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">sapply</span><span class=\"p\">(</span><span class=\"nf\">seq_along</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> \n                  </span><span class=\"n\">intCriteria</span><span class=\"p\">(</span><span class=\"n\">data_gam</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">as.integer</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"n\">x</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">clustering</span><span class=\"p\">),</span><span class=\"w\">\n                              </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"Davies_Bouldin\"</span><span class=\"p\">)))</span></code></pre></figure>\n\n<p>Let’s plot results of internal evaluation.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Clusters</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"o\">:</span><span class=\"m\">7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">DBindex</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">DB_values</span><span class=\"p\">)),</span><span class=\"w\">\n       </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Clusters</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">DBindex</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_point</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_bw</span><span class=\"p\">()</span></code></pre></figure>\n\n<p><img src=\"/images/post_8/unnamed-chunk-8-1.png\" alt=\"plot of chunk unnamed-chunk-8\" /></p>\n\n<p>The optimal number of clusters is again 7. Let’s plot results.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"c1\"># prepare data for plotting</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">melt</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">class</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">as.factor</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"m\">6</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">clustering</span><span class=\"p\">),</span><span class=\"w\">\n                                        </span><span class=\"n\">data_gam</span><span class=\"p\">)))</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"n\">ncol</span><span class=\"p\">(</span><span class=\"n\">data_gam</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">data_gam</span><span class=\"p\">))]</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">data_gam</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"p\">(</span><span class=\"n\">data_gam</span><span class=\"p\">))]</span><span class=\"w\">\n \n</span><span class=\"c1\"># prepare medoids</span><span class=\"w\">\n</span><span class=\"n\">centers</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">melt</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"m\">6</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">medoids</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">setnames</span><span class=\"p\">(</span><span class=\"n\">centers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"Var1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Var2\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"class\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Time\"</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">centers</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">class</span><span class=\"p\">]</span><span class=\"w\">\n \n</span><span class=\"c1\"># plot the results</span><span class=\"w\">\n</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data_plot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">facet_wrap</span><span class=\"p\">(</span><span class=\"o\">~</span><span class=\"n\">class</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">scales</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"free_y\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"grey10\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.65</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">centers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">),</span><span class=\"w\">\n            </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.80</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1.2</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_vline</span><span class=\"p\">(</span><span class=\"n\">xintercept</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">46</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"dodgerblue2\"</span><span class=\"p\">,</span><span class=\"w\">\n             </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1.4</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">linetype</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">labs</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Time\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Load (normalised)\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_bw</span><span class=\"p\">()</span></code></pre></figure>\n\n<p><img src=\"/images/post_8/unnamed-chunk-9-1.png\" alt=\"plot of chunk unnamed-chunk-9\" /></p>\n\n<p>That is a more delightful result, isn’t it? Extracted consumption profiles are smoother than in the case of average seasonal profiles. The blue dashed line borders daily and weekly seasonal coefficients.\nThe K-medoids now extracted 4 typical profiles and determined 3 one-element clusters.</p>\n\n<p>I will show you also result of clustering of some nondata adaptive representation, let’s pick for example <strong>DFT</strong> (Discrete Fourier Transform) method and extract first 48 DFT coefficients.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">data_dft</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">repr_matrix</span><span class=\"p\">(</span><span class=\"n\">elec_load</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">repr_dft</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">list</span><span class=\"p\">(</span><span class=\"n\">coef</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">48</span><span class=\"p\">),</span><span class=\"w\">\n                        </span><span class=\"n\">normalise</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">func_norm</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">norm_z</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"nf\">dim</span><span class=\"p\">(</span><span class=\"n\">data_dft</span><span class=\"p\">)</span></code></pre></figure>\n\n<figure class=\"highlight\"><pre><code class=\"language-text\" data-lang=\"text\">## [1] 50 48</code></pre></figure>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">clusterings</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">lapply</span><span class=\"p\">(</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">2</span><span class=\"o\">:</span><span class=\"m\">7</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\">\n                  </span><span class=\"n\">pam</span><span class=\"p\">(</span><span class=\"n\">data_dft</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">))</span><span class=\"w\">\n \n</span><span class=\"n\">DB_values</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">sapply</span><span class=\"p\">(</span><span class=\"nf\">seq_along</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> \n                  </span><span class=\"n\">intCriteria</span><span class=\"p\">(</span><span class=\"n\">data_dft</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">as.integer</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"n\">x</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">clustering</span><span class=\"p\">),</span><span class=\"w\">\n                              </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"Davies_Bouldin\"</span><span class=\"p\">)))</span></code></pre></figure>\n\n<p>Let’s plot results of internal evaluation.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Clusters</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"o\">:</span><span class=\"m\">7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">DBindex</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">DB_values</span><span class=\"p\">)),</span><span class=\"w\">\n       </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Clusters</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">DBindex</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_point</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_bw</span><span class=\"p\">()</span></code></pre></figure>\n\n<p><img src=\"/images/post_8/unnamed-chunk-12-1.png\" alt=\"plot of chunk unnamed-chunk-12\" /></p>\n\n<p>We can see nice <a href=\"https://en.wikipedia.org/wiki/Determining_the_number_of_clusters_in_a_data_set#The_elbow_method\">“elbow”</a> here at 4 number of clusters.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"c1\"># prepare data for plotting</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">melt</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">class</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">as.factor</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"m\">3</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">clustering</span><span class=\"p\">),</span><span class=\"w\">\n                                        </span><span class=\"n\">data_dft</span><span class=\"p\">)))</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"n\">ncol</span><span class=\"p\">(</span><span class=\"n\">data_dft</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">data_dft</span><span class=\"p\">))]</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">data_dft</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"p\">(</span><span class=\"n\">data_dft</span><span class=\"p\">))]</span><span class=\"w\">\n \n</span><span class=\"c1\"># prepare medoids</span><span class=\"w\">\n</span><span class=\"n\">centers</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">melt</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"m\">3</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">medoids</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">setnames</span><span class=\"p\">(</span><span class=\"n\">centers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"Var1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Var2\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"class\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Time\"</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">centers</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">class</span><span class=\"p\">]</span><span class=\"w\">\n \n</span><span class=\"c1\"># plot the results</span><span class=\"w\">\n</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data_plot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">facet_wrap</span><span class=\"p\">(</span><span class=\"o\">~</span><span class=\"n\">class</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">scales</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"free_y\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"grey10\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.65</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">centers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">),</span><span class=\"w\">\n            </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.80</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1.2</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">labs</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Time\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Load (normalised)\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_bw</span><span class=\"p\">()</span></code></pre></figure>\n\n<p><img src=\"/images/post_8/unnamed-chunk-13-1.png\" alt=\"plot of chunk unnamed-chunk-13\" /></p>\n\n<p>The interpretability of these results would be difficult. Therefore, model-based time series representations are very effective in this use case (so the typical profiles extraction).</p>\n\n<p>I will show you the usage of one more representation method - <strong>FeaClip</strong>. The <strong>FeaClip</strong> is feature extraction method from a clipped representation (Laurinec and Lucká (2018)). The windowing approach alongside FeaClip is recommended to use for every day of time series. The big advantage is that normalisation is not needed alongside FeaClip method. Let’s use it in our case. The windowing method is also directly implemented in <code class=\"language-plaintext highlighter-rouge\">repr_matrix</code> function.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">data_feaclip</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">repr_matrix</span><span class=\"p\">(</span><span class=\"n\">elec_load</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">func</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">repr_feaclip</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"n\">windowing</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">win_size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">48</span><span class=\"p\">)</span><span class=\"w\">\n \n</span><span class=\"nf\">dim</span><span class=\"p\">(</span><span class=\"n\">data_feaclip</span><span class=\"p\">)</span></code></pre></figure>\n\n<figure class=\"highlight\"><pre><code class=\"language-text\" data-lang=\"text\">## [1]  50 112</code></pre></figure>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">clusterings</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">lapply</span><span class=\"p\">(</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">2</span><span class=\"o\">:</span><span class=\"m\">7</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\">\n                  </span><span class=\"n\">pam</span><span class=\"p\">(</span><span class=\"n\">data_feaclip</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">))</span><span class=\"w\">\n \n</span><span class=\"n\">DB_values</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">sapply</span><span class=\"p\">(</span><span class=\"nf\">seq_along</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> \n                  </span><span class=\"n\">intCriteria</span><span class=\"p\">(</span><span class=\"n\">data_feaclip</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">as.integer</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"n\">x</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">clustering</span><span class=\"p\">),</span><span class=\"w\">\n                              </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"Davies_Bouldin\"</span><span class=\"p\">)))</span></code></pre></figure>\n\n<p>Let’s plot results of internal evaluation.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Clusters</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"o\">:</span><span class=\"m\">7</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">DBindex</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">DB_values</span><span class=\"p\">)),</span><span class=\"w\">\n       </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Clusters</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">DBindex</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_point</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_bw</span><span class=\"p\">()</span></code></pre></figure>\n\n<p><img src=\"/images/post_8/unnamed-chunk-16-1.png\" alt=\"plot of chunk unnamed-chunk-16\" /></p>\n\n<p>We can see that now 2 “elbows” appeared. The biggest change is between 2 and 3 number of clusters, so I will choose number 3.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"c1\"># prepare data for plotting</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">melt</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">class</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">as.factor</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"m\">2</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">clustering</span><span class=\"p\">),</span><span class=\"w\">\n                                        </span><span class=\"n\">data_feaclip</span><span class=\"p\">)))</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"n\">ncol</span><span class=\"p\">(</span><span class=\"n\">data_feaclip</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">data_feaclip</span><span class=\"p\">))]</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">data_feaclip</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"p\">(</span><span class=\"n\">data_feaclip</span><span class=\"p\">))]</span><span class=\"w\">\n \n</span><span class=\"c1\"># prepare medoids</span><span class=\"w\">\n</span><span class=\"n\">centers</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">melt</span><span class=\"p\">(</span><span class=\"n\">clusterings</span><span class=\"p\">[[</span><span class=\"m\">2</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">medoids</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">setnames</span><span class=\"p\">(</span><span class=\"n\">centers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"Var1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Var2\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"class\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Time\"</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">centers</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">class</span><span class=\"p\">]</span><span class=\"w\">\n \n</span><span class=\"c1\"># plot the results</span><span class=\"w\">\n</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data_plot</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">facet_wrap</span><span class=\"p\">(</span><span class=\"o\">~</span><span class=\"n\">class</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">scales</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"free_y\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"grey10\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.65</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">centers</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"p\">),</span><span class=\"w\">\n            </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.80</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1.2</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">labs</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Time\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Load (normalised)\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_bw</span><span class=\"p\">()</span></code></pre></figure>\n\n<p><img src=\"/images/post_8/unnamed-chunk-17-1.png\" alt=\"plot of chunk unnamed-chunk-17\" /></p>\n\n<p>It seems like good separability of clusters, better than in the case of DFT.\nBut you can check also other results of clusterings with the different number of clusters.</p>\n\n<h2 id=\"conclusion\">Conclusion</h2>\n\n<p>In this tutorial, I showed you the usage of time series representation methods to create more characteristic profiles of consumers.\nThen, time series representations, calculated by <strong>TSrepr</strong> package, were clustered by K-medoids and typical consumption profiles were extracted from created clusters.</p>\n\n<p>Time series representations can be helpful also in other use cases as classification or time series indexing.\nYou can check how I use time series representations in my dissertation thesis in more detail on the <a href=\"https://petolau.github.io/research\"><strong>research</strong> section</a> of this site.</p>\n\n<h2 id=\"references\">References</h2>\n\n<p>Laurinec, Peter, and Mária Lucká. 2016. “Comparison of Representations of Time Series for Clustering Smart Meter Data.” In Lecture Notes in Engineering and Computer Science: Proceedings of the World Congress on Engineering and Computer Science 2016, 458–63.</p>\n\n<p>Laurinec, Peter, Marek Lóderer, Petra Vrablecová, Mária Lucká, Viera Rozinajová, and Anna Bou Ezzeddine. 2016. “Adaptive Time Series Forecasting of Energy Consumption Using Optimized Cluster Analysis.” In Data Mining Workshops (Icdmw), 2016 Ieee 16th International Conference on, 398–405. IEEE.</p>\n\n<p>Laurinec, Peter, and Mária Lucká. 2018. “Interpretable multiple data streams clustering with clipped streams representation for the improvement of electricity consumption forecasting”. Data Mining and Knowledge Discovery. Springer. DOI: <a href=\"https://doi.org/10.1007/s10618-018-0598-2\">10.1007/s10618-018-0598-2</a>.</p>",
  "pubDate": "Tue, 13 Mar 2018 00:00:00 +0000",
  "link": "https://petolau.github.io/TSrepr-clustering-time-series-representations/",
  "guid": {
    "@isPermaLink": true,
    "#text": "https://petolau.github.io/TSrepr-clustering-time-series-representations/"
  }
}