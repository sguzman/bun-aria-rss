{
  "title": "Bulk Downloading Adobe Analytics Data",
  "description": "<p><em>This blog post also serves as release notes for RSiteCatalyst v1.4.9, as only one feature was added (batch report request and download). But it’s a feature big enough for its own post!</em></p>",
  "pubDate": "Thu, 21 Jul 2016 08:25:02 +0000",
  "link": "http://randyzwitch.com/rsitecatalyst-bulk-download-version-1-4-9-release-notes/",
  "guid": "http://randyzwitch.com/rsitecatalyst-bulk-download-version-1-4-9-release-notes/",
  "content": "<p><em>This blog post also serves as release notes for RSiteCatalyst v1.4.9, as only one feature was added (batch report request and download). But it’s a feature big enough for its own post!</em></p>\n\n<p>Recently, I was asked how I would approach replicating the <a href=\"http://33sticks.com/rsitecatalyst-market-basket-analysis-adobe-analytics/\">market basket analysis</a> blog post I wrote for <a href=\"http://33sticks.com/\">33 Sticks</a>, but using a lot more data. Like, months and months of order-level data. While you <em>might</em> be able to submit multiple months worth of data in a single RSiteCatalyst call, it’s a lot more elegant to request data from the Adobe Analytics API in several calls. With the new batch-submit and batch-receive functionality in RSiteCatalyst, this process can be a LOT faster.</p>\n\n<h2 id=\"non-batched-method\">Non-Batched Method</h2>\n\n<p>Prior to version 1.4.9 of RSiteCatalyst, API calls could only be made in a serial fashion:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n</pre></td><td class=\"code\"><pre><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">RSiteCatalyst</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">dplyr</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"n\">SCAuth</span><span class=\"p\">(</span><span class=\"n\">Sys.getenv</span><span class=\"p\">(</span><span class=\"s2\">\"USER\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">Sys.getenv</span><span class=\"p\">(</span><span class=\"s2\">\"SECRET\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">))</span><span class=\"w\">\n\n</span><span class=\"n\">combined_orders</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.frame</span><span class=\"p\">()</span><span class=\"w\">\n</span><span class=\"k\">for</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">seq</span><span class=\"p\">(</span><span class=\"n\">as.Date</span><span class=\"p\">(</span><span class=\"s2\">\"2016-06-01\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">as.Date</span><span class=\"p\">(</span><span class=\"s2\">\"2016-06-30\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"day\"</span><span class=\"p\">)){</span><span class=\"w\">\n\n  </span><span class=\"n\">d_</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">as.character</span><span class=\"p\">(</span><span class=\"n\">as.Date</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"1970-01-01\"</span><span class=\"p\">))</span><span class=\"w\">\n  </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"n\">d_</span><span class=\"p\">)</span><span class=\"w\">\n\n  </span><span class=\"n\">order_details</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">QueueRanked</span><span class=\"p\">(</span><span class=\"w\">\n    </span><span class=\"n\">reportsuite.id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"reportsuite\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"n\">date.from</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">d_</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"n\">date.to</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">d_</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"n\">elements</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s1\">'evar13'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'product'</span><span class=\"p\">),</span><span class=\"w\">\n    </span><span class=\"n\">metrics</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s1\">'revenue'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'units'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'orders'</span><span class=\"p\">),</span><span class=\"w\">\n    </span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">50000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">10000</span><span class=\"p\">),</span><span class=\"w\">\n    </span><span class=\"n\">interval.seconds</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">60</span><span class=\"w\">\n  </span><span class=\"p\">)</span><span class=\"w\">\n\n  </span><span class=\"n\">order_details</span><span class=\"o\">$</span><span class=\"n\">order_date</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">d_</span><span class=\"w\">\n  </span><span class=\"n\">combined_orders</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">rbind.fill</span><span class=\"p\">(</span><span class=\"n\">combined_orders</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">order_details</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">rm</span><span class=\"p\">(</span><span class=\"n\">order_details</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"p\">}</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>The underlying assumption from a package development standpoint was that the user would be working in an interactive fashion; submit a report request, wait to get the answer back. There’s nothing inherently wrong with this code from an R standpoint that made this a slow process, you just had to wait until one report was calculated by the Adobe Analytics API until the next one was submitted.</p>\n\n<h2 id=\"batch-method\">Batch Method</h2>\n\n<p>Of course, most APIs can process multiple calls simultaneously, and the Adobe Analytics API is no exception. Thanks to user <a href=\"https://github.com/shashispace\">shashispace</a>, it’s now possible to submit all of your report calls at once, then retrieve the results:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n</pre></td><td class=\"code\"><pre><span class=\"n\">queued</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">list</span><span class=\"p\">()</span><span class=\"w\">\n</span><span class=\"k\">for</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">seq</span><span class=\"p\">(</span><span class=\"n\">as.Date</span><span class=\"p\">(</span><span class=\"s2\">\"2016-06-01\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">as.Date</span><span class=\"p\">(</span><span class=\"s2\">\"2016-06-30\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"day\"</span><span class=\"p\">)){</span><span class=\"w\">\n  </span><span class=\"n\">d_</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">as.character</span><span class=\"p\">(</span><span class=\"n\">as.Date</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">origin</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"1970-01-01\"</span><span class=\"p\">))</span><span class=\"w\">\n\n  </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"n\">d_</span><span class=\"p\">)</span><span class=\"w\">\n\n  </span><span class=\"n\">reportid</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">QueueRanked</span><span class=\"p\">(</span><span class=\"w\">\n    </span><span class=\"n\">reportsuite.id</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"reportsuite\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"n\">date.from</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">d_</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"n\">date.to</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">d_</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"n\">elements</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s1\">'evar13'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'product'</span><span class=\"p\">),</span><span class=\"w\">\n    </span><span class=\"n\">metrics</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s1\">'revenue'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'units'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s1\">'orders'</span><span class=\"p\">),</span><span class=\"w\">\n    </span><span class=\"n\">top</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">50000</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">10000</span><span class=\"p\">),</span><span class=\"w\">\n    </span><span class=\"n\">interval.seconds</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"n\">enqueueOnly</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"w\">\n  </span><span class=\"p\">)</span><span class=\"w\">\n\n  </span><span class=\"n\">queued</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">cbind</span><span class=\"p\">(</span><span class=\"n\">queued</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">reportid</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"p\">}</span><span class=\"w\">\n\n</span><span class=\"n\">queued_df</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.frame</span><span class=\"p\">()</span><span class=\"w\">\n</span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">queued</span><span class=\"p\">){</span><span class=\"w\">\n  </span><span class=\"n\">queued_df</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">bind_rows</span><span class=\"p\">(</span><span class=\"n\">queued_df</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">GetReport</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"p\">}</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>This code is nearly identical to the serial snippet above, except for 1) the addition of the <code class=\"language-plaintext highlighter-rouge\">enqueueOnly = TRUE</code> keyword argument and 2) lowering the <code class=\"language-plaintext highlighter-rouge\">interval.seconds</code> keyword argument to <code class=\"language-plaintext highlighter-rouge\">1</code> second instead of <code class=\"language-plaintext highlighter-rouge\">60</code>. When you use the enqueueOnly keyword, instead of returning the report results back, a <code class=\"language-plaintext highlighter-rouge\">Queue*</code> function will return the <code class=\"language-plaintext highlighter-rouge\">report.id</code>; by accumulating these <code class=\"language-plaintext highlighter-rouge\">report.id</code> values in a list, we can next retrieve the reports and bind them together using dplyr.</p>\n\n<h2 id=\"performance-gain-4x-speed-up\">Performance gain: 4x speed-up</h2>\n\n<p>Although the code snippets are nearly identical, it is way faster to submit the reports all at once then retrieve the results. By submitting the requests all at once, the API will process numerous calls at once, and while you are retrieving the results of one call the others will continue to process in the background.</p>\n\n<p>I wouldn’t have thought this would make such a difference, but retrieving one month of daily order-level data went from taking 2420 seconds to 560 seconds! If you were to retrieve the same amount of daily data, but for an entire year, that would mean saving 6 hours in processing time.</p>\n\n<h2 id=\"keep-the-pull-requests-coming\">Keep The Pull Requests Coming!</h2>\n\n<p>The last several RSiteCatalyst releases have been driven by contributions from the community and I couldn’t be happier! Given that I don’t spend much time in my professional life now using Adobe Analytics, having improvements driven by a community of users using the library daily is just so rewarding.</p>\n\n<p>So please, if you have a comment for improvement (and especially if you find a bug), please submit an <a href=\"https://github.com/randyzwitch/RSiteCatalyst/issues\">issue on GitHub</a>. Submitting questions and issues to GitHub is the easiest way for me to provide support, while also giving other users the possibility to answer your question before I might. It will also provide a means for others to determine if they are experiencing a new or previously-known problem.</p>"
}