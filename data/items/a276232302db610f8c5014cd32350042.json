{
  "title": "Getting Started Using Hadoop, Part 4: Creating Tables With Hive",
  "description": "<p>In the previous three tutorials (<a title=\"Hadoop for beginners\" href=\"http://randyzwitch.com/big-data-hadoop-amazon-ec2-cloudera-part-1/\" target=\"_blank\">1</a>, <a title=\"Building Hadoop cluster on Amazon EC2\" href=\"http://randyzwitch.com/big-data-hadoop-amazon-ec2-cloudera-part-2/\" target=\"_blank\">2</a>, <a title=\"Loading data Hadoop Hue\" href=\"http://randyzwitch.com/uploading-data-hadoop-amazon-ec2-cloudera-part-3/\" target=\"_blank\">3</a>), we’ve covered the background of Hadoop, how to build a proof-of-concept Hadoop cluster using Amazon EC2 and how to upload a .zip file to the cluster using Hue. In Part 4, we’ll use the data uploaded from the .zip file to create a master table of all files, as well as creating a view.</p>",
  "pubDate": "Thu, 22 Aug 2013 18:03:19 +0000",
  "link": "http://randyzwitch.com/hadoop-creating-tables-hive/",
  "guid": "http://randyzwitch.com/hadoop-creating-tables-hive/",
  "content": "<p>In the previous three tutorials (<a title=\"Hadoop for beginners\" href=\"http://randyzwitch.com/big-data-hadoop-amazon-ec2-cloudera-part-1/\" target=\"_blank\">1</a>, <a title=\"Building Hadoop cluster on Amazon EC2\" href=\"http://randyzwitch.com/big-data-hadoop-amazon-ec2-cloudera-part-2/\" target=\"_blank\">2</a>, <a title=\"Loading data Hadoop Hue\" href=\"http://randyzwitch.com/uploading-data-hadoop-amazon-ec2-cloudera-part-3/\" target=\"_blank\">3</a>), we’ve covered the background of Hadoop, how to build a proof-of-concept Hadoop cluster using Amazon EC2 and how to upload a .zip file to the cluster using Hue. In Part 4, we’ll use the data uploaded from the .zip file to create a master table of all files, as well as creating a view.</p>\n\n<h2 id=\"creating-tables-using-hive\">Creating Tables Using Hive</h2>\n\n<p>Like SQL for ‘regular’ relational databases, Hive is the tool we can use within Hadoop to create tables from data loaded into HDFS. Because Hadoop was built with large, messy data in mind, there are some amazingly convenient features for creating and loading data, such as being able to load all files in a directory (assuming they have the same format).  Here’s the Hive statement we can use to load the <a title=\"airline dataset\" href=\"http://stat-computing.org/dataexpo/2009/the-data.html\" target=\"_blank\">airline dataset</a>:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-sql\" data-lang=\"sql\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n</pre></td><td class=\"code\"><pre><span class=\"c1\">-- Create table from yearly airline csv files</span>\n<span class=\"k\">CREATE</span> <span class=\"k\">EXTERNAL</span> <span class=\"k\">TABLE</span> <span class=\"n\">airline</span> <span class=\"p\">(</span>\n  <span class=\"nv\">`Year`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`Month`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`DayofMonth`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`DayOfWeek`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`DepTime`</span>  <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`CRSDepTime`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`ArrTime`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`CRSArrTime`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`UniqueCarrier`</span> <span class=\"n\">string</span><span class=\"p\">,</span>\n  <span class=\"nv\">`FlightNum`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`TailNum`</span> <span class=\"n\">string</span><span class=\"p\">,</span>\n  <span class=\"nv\">`ActualElapsedTime`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`CRSElapsedTime`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`AirTime`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`ArrDelay`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`DepDelay`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`Origin`</span> <span class=\"n\">string</span><span class=\"p\">,</span>\n  <span class=\"nv\">`Dest`</span> <span class=\"n\">string</span><span class=\"p\">,</span>\n  <span class=\"nv\">`Distance`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`TaxiIn`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`TaxiOut`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`Cancelled`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`CancellationCode`</span> <span class=\"n\">string</span><span class=\"p\">,</span>\n  <span class=\"nv\">`Diverted`</span> <span class=\"n\">string</span><span class=\"p\">,</span>\n  <span class=\"nv\">`CarrierDelay`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`WeatherDelay`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`NASDelay`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`SecurityDelay`</span> <span class=\"nb\">int</span><span class=\"p\">,</span>\n  <span class=\"nv\">`LateAircraftDelay`</span> <span class=\"nb\">int</span><span class=\"p\">)</span>\n<span class=\"k\">ROW</span> <span class=\"n\">FORMAT</span> <span class=\"n\">DELIMITED</span>\n<span class=\"n\">FIELDS</span> <span class=\"n\">TERMINATED</span> <span class=\"k\">BY</span> <span class=\"s1\">','</span>\n<span class=\"n\">ESCAPED</span> <span class=\"k\">BY</span> <span class=\"s1\">'</span><span class=\"se\">\\\\</span><span class=\"s1\">'</span>\n<span class=\"n\">STORED</span> <span class=\"k\">AS</span> <span class=\"n\">TEXTFILE</span>\n<span class=\"k\">LOCATION</span> <span class=\"s1\">'/user/hue/airline/airline'</span><span class=\"p\">;</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>The above statement starts by outlining the structure of the table, which is mostly integers with a few string columns. The next four lines of code specifies what type of data we have, which are delimited files where the fields are terminated (separated) by commas and where the delimiter is escaped using a backslash. Finally, we type the location of our files, which is the location of the directory where we uploaded the .zip file in <a title=\"Part 3\" href=\"http://randyzwitch.com/uploading-data-hadoop-amazon-ec2-cloudera-part-3/\" target=\"_blank\">part 3 of this tutorial</a>. Note that we specify an “external table”, which means that if we drop the ‘airline’ table, we will still retain our raw data. Had we not specified the <code class=\"language-plaintext highlighter-rouge\">external</code> keyword, Hive would’ve moved our raw data files into Hive, and had we decided to drop the ‘airline’ table, all our data would be deleted. Specifying <code class=\"language-plaintext highlighter-rouge\">external</code> also lets us build multiple tables on the same underlying dataset if we so choose.</p>\n\n<h2 id=\"creating-a-view-using-hive\">Creating a View Using Hive</h2>\n\n<p>One thing that’s slightly awkward above Hive is that you can’t specify that there is a header row in your files. As such, once the above code loads, we have 22 rows in our ‘airline’ table where the data is invalid. Another thing that’s awkward about Hive is that there is no row-level operations, so you can’t delete data! However, we can very easily fix our problem using a view:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-sql\" data-lang=\"sql\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n</pre></td><td class=\"code\"><pre><span class=\"c1\">-- Create view to \"remove\" 22 bad records from our table</span>\n<span class=\"k\">create</span> <span class=\"k\">view</span> <span class=\"n\">vw_airline</span> <span class=\"k\">as</span>\n<span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"n\">airline</span>\n<span class=\"k\">where</span> <span class=\"n\">uniquecarrier</span> <span class=\"o\">&lt;&gt;</span> <span class=\"nv\">\"UniqueCarrier\"</span><span class=\"p\">;</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>Now that we have our view defined, we no longer have to explicitly exclude the rows in every future query we run. Just like in SQL, views are “free” from a performance standpoint, as they don’t require any additional data storage space (they just represent stored code references).</p>\n\n<h2 id=\"time-for-analysis\">Time for Analysis?!</h2>\n\n<p>If you’ve made it this far, you’ve waited a long time to do some actual analysis! The next and final part of this tutorial will do some interesting things using Hive and/or Pig to analyze the data. The origin of this dataset was a data mining contest to predict why a flight would arrive late to its destination and we’ll do examples towards that end.</p>"
}