{
  "title": "Average queue wait times with random arrivals",
  "link": "",
  "published": "2016-04-23T09:51:00-07:00",
  "updated": "2016-04-23T09:51:00-07:00",
  "author": {
    "name": "Jonathan Landy"
  },
  "id": "tag:efavdb.com,2016-04-23:/average-queue-wait-times-with-random-arrivals",
  "summary": "<p>Queries ping a certain computer server at random times, on average <span class=\"math\">\\(\\lambda\\)</span> arriving per second. The server can respond to one per second and those that can&#8217;t be serviced immediately are queued up. What is the average wait time per query? Clearly if <span class=\"math\">\\(\\lambda \\ll 1\\)</span>, the average wait …</p>",
  "content": "<p>Queries ping a certain computer server at random times, on average <span class=\"math\">\\(\\lambda\\)</span> arriving per second. The server can respond to one per second and those that can&#8217;t be serviced immediately are queued up. What is the average wait time per query? Clearly if <span class=\"math\">\\(\\lambda \\ll 1\\)</span>, the average wait time is zero. But if <span class=\"math\">\\(\\lambda &gt; 1\\)</span>, the queue grows indefinitely and the answer is infinity! Here, we give a simple derivation of the general result &#8212; (9)&nbsp;below.</p>\n<h3>Introduction</h3>\n<p>The mathematics of queue waiting times &#8212; first worked out by <a href=\"https://en.wikipedia.org/wiki/Erlang_(unit)\">Agner Krarup Erlang</a> &#8212; is interesting for two reasons. First, as noted above, queues can exhibit phase-transition like behaviors: If the average arrival time is shorter than the average time it takes to serve a customer, the line will grow indefinitely, causing the average wait time to diverge. Second, when the average arrival time is less than the service time, waiting times are governed entirely by fluctuations &#8212; and so can&#8217;t be estimated well using mean-field arguments. For example, in the very low arrival rate limit, the only situation where anyone would ever have to wait at all is that where someone else happens to arrive just before them &#8212; an unlucky, rare&nbsp;event.</p>\n<p>Besides being interesting from a theoretical perspective, an understanding of queue formation phenomena is also critical for many practical applications &#8212; both in computer science and in wider industry settings. Optimal staffing of a queue requires a careful estimate of the expected customer arrival rate. If too many workers are staffed, the average wait time will be nicely low, but workers will largely be idle. Staff too few, and the business could enter into the divergent queue length regime &#8212; certainly resulting in unhappy customers and lost business (or dropped queries). Staffing just the right amount requires a sensitive touch &#8212; and in complex cases, a good understanding of the&nbsp;theory.</p>\n<p>In order to derive the average wait time for queues of different sorts, one often works within the framework of Markov processes. This approach is very general and elementary, but requires a bit of effort to develop the machinery needed get to the end results. Here, we demonstrate an alternative, sometimes faster approach that is based on writing down an integral equation for the wait time distribution. We consider only a simple case &#8212; that where the queue is serviced by only one staff member, the customers arrive at random times via a Poisson process, and each customer requires the same time to service, one&nbsp;second.</p>\n<h3>Integral equation&nbsp;formulation</h3>\n<p>Suppose the <span class=\"math\">\\(N\\)</span>-th customer arrives at time <span class=\"math\">\\(0\\)</span>, and let <span class=\"math\">\\(P(t)\\)</span> be the probability that this customer has to wait a time <span class=\"math\">\\(t\\geq 0\\)</span> before being served. This wait time can be written in terms of the arrival and wait times of the previous customer: If this previous customer arrived at time <span class=\"math\">\\(t^{\\prime}\\)</span> and has to wait a time <span class=\"math\">\\(w\\)</span> before being served, his service will conclude at time <span class=\"math\">\\(t = t^{\\prime} + w + 1\\)</span>. If this is greater than <span class=\"math\">\\(0\\)</span>, the <span class=\"math\">\\(N\\)</span>-th customer will have to wait before being served. In particular, he will wait <span class=\"math\">\\(t\\)</span> if the previous customer waited <span class=\"math\">\\(w = t - t^{\\prime} - 1\\)</span>.</p>\n<p>The above considerations allow us to write down an equation satisfied by the wait time distribution. If we let the probability that the previous customer arrived at <span class=\"math\">\\(t^{\\prime}\\)</span> be <span class=\"math\">\\(A(t^{\\prime})\\)</span>, we have (for <span class=\"math\">\\(t &gt; 0\\)</span>)\n</p>\n<div class=\"math\">\\begin{eqnarray}\n\\tag{1} \\label{int_eqn}\nP(t) &amp;=&amp; \\int_{-\\infty}^{0^-} A(t^{\\prime}) P(t - t^{\\prime} - 1) d t^{\\prime}  \\\\\n&amp;=&amp; \\int_{-\\infty}^{0^-} \\lambda e^{\\lambda t^{\\prime}} P(t - t^{\\prime} - 1) d t^{\\prime}\n\\end{eqnarray}</div>\n<p>\nHere, in the first equality we&#8217;re simply averaging over the possible arrival times of the previous customer (which had to occur before the <span class=\"math\">\\(N\\)</span>-th, at <span class=\"math\">\\(0\\)</span>), multiplying by the probability <span class=\"math\">\\(P(t - t^{\\prime} - 1)\\)</span> that this customer had to wait the amount of time <span class=\"math\">\\(w\\)</span> needed so that the <span class=\"math\">\\(N\\)</span>-th customer will wait <span class=\"math\">\\(t\\)</span>. We also use the symmetry that each customer has the same wait time distribution at steady state. In the second equality, we have plugged in the arrival time distribution appropriate for our Poisson&nbsp;model.</p>\n<p>To proceed, we differentiate both sides of (\\ref{int_eqn}) with respect to <span class=\"math\">\\(t\\)</span>,\n</p>\n<div class=\"math\">\\begin{eqnarray}\\tag{2} \\label{int2}\nP^{\\prime}(t) &amp;=&amp; \\int_{-\\infty}^{0^-} \\lambda e^{\\lambda t^{\\prime}} \\frac{d}{dt}P(t - t^{\\prime} - 1) d t^{\\prime} \\\\\n&amp;=&amp; - \\int_{-\\infty}^{0^-} \\lambda e^{\\lambda t^{\\prime}} \\frac{d}{dt^{\\prime}}P(t - t^{\\prime} - 1) d t^{\\prime}.\n\\end{eqnarray}</div>\n<p>\nThe second equality follows after noticing that we can switch the parameter being differentiated in the first. Integrating by parts, we&nbsp;obtain\n</p>\n<div class=\"math\">\\begin{eqnarray}\nP^{\\prime}(t) = \\lambda \\left [P(t) - P(t-1) \\right], \\tag{3} \\label{sol}\n\\end{eqnarray}</div>\n<p>\na delay differential equation for the wait time distribution. This could be integrated numerically to get the full solution. However, our interest here is primarily the mean waiting time &#8212; as we show next, it&#8217;s easy to extract this part of the solution&nbsp;analytically.</p>\n<h3>Probability of no wait and the mean wait&nbsp;time</h3>\n<p>We can obtain a series of useful relations by multiplying (\\ref{sol}) by powers of <span class=\"math\">\\(t\\)</span> and integrating. The first such expression is obtained by multiplying by <span class=\"math\">\\(t^1\\)</span>. Doing this and integrating its left side, we&nbsp;obtain\n</p>\n<div class=\"math\">\\begin{eqnarray} \\tag{4} \\label{int3}\n\\int_{0^{+}}^{\\infty} P^{\\prime}(t) t dt = \\left . P(t) t \\right |_{0^{+}}^{\\infty} - \\int_{0^+}^{\\infty} P(t) dt = 1 - P(0).\n\\end{eqnarray}</div>\n<p>\nSimilarly integrating its right side, we&nbsp;obtain</p>\n<div class=\"math\">\\begin{eqnarray}\\tag{5} \\label{int4}\n\\lambda \\int_{0^{+}}^{\\infty} t \\left [P(t) - P(t-1) \\right] = \\lambda [ \\overline{t} - \\overline{(t + 1)} ] = - \\lambda.\n\\end{eqnarray}</div>\n<p>\nEquating the last two lines, we obtain the probability of no&nbsp;wait,\n</p>\n<div class=\"math\">\\begin{eqnarray} \\tag{6} \\label{int5}\nP(0) = 1 - \\lambda.\n\\end{eqnarray}</div>\n<p>\nThis shows that when the arrival rate is low, the probability of no wait goes to one &#8212; an intuitively reasonable result. On the other hand, as <span class=\"math\">\\(\\lambda \\to 1\\)</span>, the probability of no wait approaches zero. In between, the idle time fraction of our staffer (which is equal to the probability of no wait, given a random arrival time) grows linearly, connecting these two&nbsp;limits.</p>\n<p>To obtain an expression for the average wait time, we carry out a similar analysis to that above, but multiply (\\ref{sol}) by <span class=\"math\">\\(t^2\\)</span> instead. The integral on left is&nbsp;then\n</p>\n<div class=\"math\">\\begin{eqnarray} \\tag{7} \\label{int6}\n\\int_{0^{+}}^{\\infty} P^{\\prime}(t) t^2 dt = \\left . P(t) t^2 \\right |_{0^{+}}^{\\infty} - 2\\int_{0^+}^{\\infty} P(t) t dt = - 2 \\overline{t}.\n\\end{eqnarray}</div>\n<p>\nSimilarly, the integral at right&nbsp;is\n</p>\n<div class=\"math\">\\begin{eqnarray} \\tag{8} \\label{fin_int}\n\\lambda \\int_{0^{+}}^{\\infty} t^2 \\left [P(t) - P(t-1) \\right] &amp;=&amp; \\lambda \\overline{ t^2} - \\overline{ (t + 1)^2} \\\\\n&amp;=&amp; - \\lambda (2 \\overline{t} +1).\n\\end{eqnarray}</div>\n<p>\nEquating the last two lines and rearranging gives our solution for the average&nbsp;wait,\n</p>\n<div class=\"math\">\\begin{eqnarray} \\tag{9} \\label{fin}\n\\overline{t} = \\frac{\\lambda}{2 (1 - \\lambda)}.\n\\end{eqnarray}</div>\n<p>\nAs advertised, this diverges as <span class=\"math\">\\(\\lambda \\to 1\\)</span>, see illustration in the plot below. It&#8217;s very interesting that even as <span class=\"math\">\\(\\lambda\\)</span> approaches this extreme limit, the line is still empty a finite fraction of the time &#8212; see (\\ref{int5}). Evidently a finite idle time fraction can&#8217;t be avoided, even as one approaches the divergent <span class=\"math\">\\(\\lambda = 1\\)</span>&nbsp;limit.</p>\n<p><img alt=\"average wait time\" src=\"https://efavdb.com/wp-content/uploads/2016/04/Screen-Shot-2016-04-23-at-5.02.38-PM.png\"></p>\n<h3>Conclusions and&nbsp;extensions</h3>\n<p>To carry this approach further, one could consider the case where the queue feeds <span class=\"math\">\\(k\\)</span> staff, rather than just one. I&#8217;ve made progress on this effort in certain cases, but have been stumped on the general problem. One interesting thing you can intuit about this <span class=\"math\">\\(k\\)</span>-staff version is that one approaches the mean-field analysis as <span class=\"math\">\\(k\\to \\infty\\)</span> (adding more staff tends to smooth things over, resulting in a diminishing of the importance of the randomness of the arrival times). This means that as <span class=\"math\">\\(k\\)</span> grows, we&#8217;ll have very little average wait time for any <span class=\"math\">\\(\\lambda&lt;1\\)</span>, but again divergent wait times for any <span class=\"math\">\\(\\lambda \\geq 1\\)</span> &#8212; like an infinite step function. Another direction one could pursue is to allow the service times to follow a distribution. Both cases can also be worked out using the Markov approach &#8212; references to such work can be found in the link provided in the&nbsp;introduction.</p>\n<script type=\"text/javascript\">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {\n    var align = \"center\",\n        indent = \"0em\",\n        linebreak = \"false\";\n\n    if (false) {\n        align = (screen.width < 768) ? \"left\" : align;\n        indent = (screen.width < 768) ? \"0em\" : indent;\n        linebreak = (screen.width < 768) ? 'true' : linebreak;\n    }\n\n    var mathjaxscript = document.createElement('script');\n    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';\n    mathjaxscript.type = 'text/javascript';\n    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';\n\n    var configscript = document.createElement('script');\n    configscript.type = 'text/x-mathjax-config';\n    configscript[(window.opera ? \"innerHTML\" : \"text\")] =\n        \"MathJax.Hub.Config({\" +\n        \"    config: ['MMLorHTML.js'],\" +\n        \"    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } },\" +\n        \"    jax: ['input/TeX','input/MathML','output/HTML-CSS'],\" +\n        \"    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],\" +\n        \"    displayAlign: '\"+ align +\"',\" +\n        \"    displayIndent: '\"+ indent +\"',\" +\n        \"    showMathMenu: true,\" +\n        \"    messageStyle: 'normal',\" +\n        \"    tex2jax: { \" +\n        \"        inlineMath: [ ['\\\\\\\\(','\\\\\\\\)'] ], \" +\n        \"        displayMath: [ ['$$','$$'] ],\" +\n        \"        processEscapes: true,\" +\n        \"        preview: 'TeX',\" +\n        \"    }, \" +\n        \"    'HTML-CSS': { \" +\n        \"        availableFonts: ['STIX', 'TeX'],\" +\n        \"        preferredFont: 'STIX',\" +\n        \"        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} },\" +\n        \"        linebreaks: { automatic: \"+ linebreak +\", width: '90% container' },\" +\n        \"    }, \" +\n        \"}); \" +\n        \"if ('default' !== 'default') {\" +\n            \"MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {\" +\n                \"var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;\" +\n                \"VARIANT['normal'].fonts.unshift('MathJax_default');\" +\n                \"VARIANT['bold'].fonts.unshift('MathJax_default-bold');\" +\n                \"VARIANT['italic'].fonts.unshift('MathJax_default-italic');\" +\n                \"VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');\" +\n            \"});\" +\n            \"MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {\" +\n                \"var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;\" +\n                \"VARIANT['normal'].fonts.unshift('MathJax_default');\" +\n                \"VARIANT['bold'].fonts.unshift('MathJax_default-bold');\" +\n                \"VARIANT['italic'].fonts.unshift('MathJax_default-italic');\" +\n                \"VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');\" +\n            \"});\" +\n        \"}\";\n\n    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);\n    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);\n}\n</script>",
  "category": ""
}