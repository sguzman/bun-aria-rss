{
  "title": "Stochastic geometric series",
  "link": "",
  "published": "2015-09-13T06:00:00-07:00",
  "updated": "2015-09-13T06:00:00-07:00",
  "author": {
    "name": "Jonathan Landy"
  },
  "id": "tag:efavdb.com,2015-09-13:/stochastic-geometric-series",
  "summary": "<p>Let <span class=\"math\">\\(a_1, a_2, \\ldots\\)</span> be an infinite set of non-negative samples taken from a distribution <span class=\"math\">\\(P_0(a)\\)</span>, and&nbsp;write\n</p>\n<div class=\"math\">$$\\tag{1} \\label{problem}\nS = 1 + a_1 + a_1 a_2 + a_1 a_2 a_3 + \\ldots.\n$$</div>\n<p>\nNotice that if the <span class=\"math\">\\(a_i\\)</span> were all the same, <span class=\"math\">\\(S\\)</span> would be a regular geometric series, with value …</p>",
  "content": "<p>Let <span class=\"math\">\\(a_1, a_2, \\ldots\\)</span> be an infinite set of non-negative samples taken from a distribution <span class=\"math\">\\(P_0(a)\\)</span>, and&nbsp;write\n</p>\n<div class=\"math\">$$\\tag{1} \\label{problem}\nS = 1 + a_1 + a_1 a_2 + a_1 a_2 a_3 + \\ldots.\n$$</div>\n<p>\nNotice that if the <span class=\"math\">\\(a_i\\)</span> were all the same, <span class=\"math\">\\(S\\)</span> would be a regular geometric series, with value <span class=\"math\">\\(S = \\frac{1}{1-a}\\)</span>. How will the introduction of <span class=\"math\">\\(a_i\\)</span> randomness change this sum? Will <span class=\"math\">\\(S\\)</span> necessarily converge? How is <span class=\"math\">\\(S\\)</span> distributed? In this post, we discuss some simple techniques to answer these&nbsp;questions.</p>\n<p>Note: This post covers work done in collaboration with my aged p, S.&nbsp;Landy.</p>\n<h3>Introduction &#8212; a stock dividend&nbsp;problem</h3>\n<p>To motivate the sum (\\ref{problem}), consider the problem of evaluating the total output of a stock that pays dividends each year in proportion to its present value &#8212; say <span class=\"math\">\\(x %\\)</span>. The price dynamics of a typical stock can be reasonably modeled as a geometric random walk<span class=\"math\">\\(^1\\)</span>:\n</p>\n<div class=\"math\">$$\\label{prod} \\tag{2}\nprice(t) = price(t-1) * a_t,\n$$</div>\n<p>\nwhere <span class=\"math\">\\(a_t\\)</span> is a random variable, having distribution <span class=\"math\">\\(P_0(a_t)\\)</span>. Assuming this form for our hypothetical stock, its total lifetime dividends output will&nbsp;be\n</p>\n<div class=\"math\">$$\\tag{3}\nx \\times \\sum_{t = 0}^{\\infty} price(t) = x \\times price(0) \\left ( 1 + a_1 + a_1 a_2 + a_1 a_2 a_3 + \\ldots \\right)\n$$</div>\n<p>\nThe inner term in parentheses here is precisely (\\ref{problem}). More generally, a series of this form will be of interest pretty much whenever geometric series are: Population growth problems, the length of a cylindrical bacterium at a series of time steps<span class=\"math\">\\(^2\\)</span>, etc. Will the nature of these sums change dramatically through the introduction of growth&nbsp;variance?</p>\n<p>To characterize these types of stochastic geometric series, we will start below by considering their moments: This will allow us to determine the average value of (\\ref{problem}), it&#8217;s variance etc. This approach will also allow us to determine a condition that is both necessary and sufficient for the sum&#8217;s convergence. Following this, we will introduce an integral equation satisfied by the <span class=\"math\">\\(P(S)\\)</span> distribution. We demonstrate its application by solving the equation for a simple&nbsp;example.</p>\n<h3>The moments of <span class=\"math\">\\(S\\)</span></h3>\n<p>To solve for the moments of <span class=\"math\">\\(S\\)</span>, we use a trick similar to that used to sum the regular geometric series: We&nbsp;write\n</p>\n<div class=\"math\">$$\\tag{4} \\label{trick}\nS = 1 + a_1 + a_1 a_2 + \\ldots \\equiv 1 + a_1 T,\n$$</div>\n<p>\nwhere <span class=\"math\">\\(T = 1 + a_2 + a_2 a_3 + \\ldots.\\)</span> Now, because we assume that the <span class=\"math\">\\(a_i\\)</span> are independent, it follows that <span class=\"math\">\\(a_1\\)</span> and <span class=\"math\">\\(T\\)</span> are independent. Further, <span class=\"math\">\\(S\\)</span> and <span class=\"math\">\\(T\\)</span> are clearly distributed identically, since they take the same form. Subtracting <span class=\"math\">\\(1\\)</span> from both sides of the above equation, these observations&nbsp;imply\n</p>\n<div class=\"math\">$$\\tag{5} \\label{moments}\n\\overline{(S-1)^k} = \\sum_j {k \\choose j} (-1)^j \\overline{S^{k-j}} = \\overline{ a^k S^k} = \\overline{a^k} \\ \\overline{S^k}.\n$$</div>\n<p>\nThis expression can be used to relate the moments of <span class=\"math\">\\(S\\)</span> to those of <span class=\"math\">\\(a\\)</span> &#8212; a useful result, whenever the distribution of <span class=\"math\">\\(a\\)</span> is known, allowing for the direct evaluation of its&nbsp;moments.</p>\n<p>To illustrate, let us get the first couple of moments of <span class=\"math\">\\(S\\)</span>, using (\\ref{moments}). Setting <span class=\"math\">\\(k=1\\)</span> above, we&nbsp;obtain\n</p>\n<div class=\"math\">$$\\tag{6} \\label{mean}\n\\overline{S -1} = \\overline{a} \\overline{S} \\ \\ \\to \\ \\ \\overline{S} = \\frac{1}{1 - \\overline{a}}\n$$</div>\n<p>\nThe right side here looks just like the usual geometric sum result, with <span class=\"math\">\\(a\\)</span> replaced by its average value. Similarly, setting <span class=\"math\">\\(k =2\\)</span> in (\\ref{moments}), we can solve for the second moment of <span class=\"math\">\\(S\\)</span>. Subtracting the square of the first gives the following expression for the sum&#8217;s&nbsp;variance,\n</p>\n<div class=\"math\">$$\\tag{7} \\label{var}\nvar(S) = \\frac{var(a)}{(1 - \\overline{a})^2(1 - \\overline{a^2})}.\n$$</div>\n<p>\nAs one might intuit, the variance of <span class=\"math\">\\(S\\)</span> is proportional to the variance of <span class=\"math\">\\(a\\)</span>.</p>\n<p>Expressions (\\ref{mean}) and (\\ref{var}) are the most practical results of this post: They provide formal general expressions for the mean and variance for a sum of form (\\ref{problem}). They can be used to provide a statistical estimate and error bar for a sum of form <span class=\"math\">\\(S\\)</span> in any practical context. It is interesting/nice that the mean takes such a natural looking form &#8212; one that many people likely make use of already, without putting much thought&nbsp;into.</p>\n<p>The expressions above are also of some theoretical interest: Note, for example, that as <span class=\"math\">\\(\\overline{a} \\to 1\\)</span> from below, the average value of <span class=\"math\">\\(S\\)</span> diverges, and then becomes negative as <span class=\"math\">\\(a\\)</span> goes above this value. This is clearly impossible, as <span class=\"math\">\\(S\\)</span> is a sum of positive terms. This indicates that <span class=\"math\">\\(S\\)</span> has no first moment whenever <span class=\"math\">\\(\\overline{a} \\geq 1\\)</span>, while (\\ref{mean}) holds whenever <span class=\"math\">\\(\\overline{a} &lt; 1\\)</span>. Similarly, (\\ref{var}) indicates that the second moment of <span class=\"math\">\\(S\\)</span> exists and is finite whenever <span class=\"math\">\\(\\overline{a^2} &lt; 1\\)</span>. In fact, this pattern continues for all <span class=\"math\">\\(k\\)</span>: <span class=\"math\">\\(\\overline{S^k}\\)</span> exists and is finite if and only if <span class=\"math\">\\(\\overline{a^k} &lt; 1\\)</span> &#8212; a result that can be obtained from (\\ref{moments}). A rigorous and elementary proof of these statements can be found in an earlier work by Szabados and Szekeley<span class=\"math\">\\(^3\\)</span>. The simple moment equation (\\ref{moments}) can also be found&nbsp;there.</p>\n<h3>Condition for the convergence of <span class=\"math\">\\(S\\)</span></h3>\n<p>A simple condition for the convergence of <span class=\"math\">\\(S\\)</span> can also be obtained using (\\ref{moments}). The trick is to consider the limit as <span class=\"math\">\\(k\\)</span> goes to zero of the <span class=\"math\">\\(k\\)</span>-th moments. This gives, for example, the average of <span class=\"math\">\\(1\\)</span> with respect to <span class=\"math\">\\(P(S)\\)</span>. If this is finite, then the distribution of <span class=\"math\">\\(P\\)</span> is normalizable. Otherwise, <span class=\"math\">\\(S\\)</span> must diverge: Setting <span class=\"math\">\\(k = \\epsilon\\)</span> in (\\ref{moments}), expanding to first order in <span class=\"math\">\\(\\epsilon\\)</span>&nbsp;gives\n</p>\n<div class=\"math\">$$\\tag{8} \\label{approximate_log}\n\\overline{ \\exp [\\epsilon \\log (S -1) ]} \\sim \\overline{ 1 + \\epsilon \\log (S -1) } \\sim \\overline{ 1 + \\epsilon \\log S } \\ \\overline{ 1 + \\epsilon \\log a}.\n$$</div>\n<p>\nSolving for <span class=\"math\">\\(\\overline{1}_S\\)</span>, the average of <span class=\"math\">\\(1\\)</span> with respect to <span class=\"math\">\\(P(S)\\)</span>,&nbsp;gives\n</p>\n<div class=\"math\">$$\\tag{9}\n\\overline{1}_S = \\frac{\\overline{\\log( 1 - \\frac{1}{S})}}{\\log a} + O(\\epsilon).\n$$</div>\n<p>\nLike the integer moment expressions above, the right side here is finite up to the point where its denominator diverges. That is, the series will converge, if and only if <span class=\"math\">\\(\\overline{\\log a} &lt; 0\\)</span>, a very simple condition<span class=\"math\">\\(^4\\)</span>.</p>\n<h3>Integral equation for the distribution <span class=\"math\">\\(P(S)\\)</span></h3>\n<p>We have also found that one can sometimes go beyond solving for the moments of <span class=\"math\">\\(S\\)</span>, and instead solve directly for its full distribution: Integrating (\\ref{trick}) over <span class=\"math\">\\(a\\)</span>&nbsp;gives\n</p>\n<div class=\"math\">\\begin{eqnarray}\n\\tag{10} \\label{int}\nP(S_0) &amp;=&amp; \\int da P_0(a) \\int dS P(S) \\delta(1+ a S - S_0) \\\\\n&amp;=&amp; \\int \\frac{da}{a} P_0(a) P \\left (\\frac{S_0 -1}{a} \\right).\n\\end{eqnarray}</div>\n<p>\nThis is a general, linear integral equation for <span class=\"math\">\\(P(S)\\)</span>. At least in some cases, it can solved in closed-form. An example&nbsp;follows.</p>\n<p><strong>Uniformly distributed <span class=\"math\">\\(a_i\\)</span></strong></p>\n<p>To demonstrate how one might solve the equation (\\ref{int}), we consider here the case where the <span class=\"math\">\\(a_i\\)</span> are uniform on <span class=\"math\">\\([0,1]\\)</span>. In this case, writing <span class=\"math\">\\(a = \\frac{S_0 -1}{v}\\)</span>, (\\ref{int}) goes&nbsp;to\n</p>\n<div class=\"math\">$$\\tag{11} \\label{int2}\nP(S_0) = \\int_{S_0-1}^{\\infty} P\\left (v\\right) \\frac{1}{v}dv.\n$$</div>\n<p>\nTo progress, we differentiate with respect to <span class=\"math\">\\(S_0\\)</span>, which&nbsp;gives\n</p>\n<div class=\"math\">$$\\tag{12} \\label{delay}\nP^{\\prime} (S_0)\\equiv - \\frac{1 }{S_0 -1}\\times P\\left (S_0 -1\\right).\n$$</div>\n<p>\nEquation (\\ref{delay}) is a <a href=\"https://en.wikipedia.org/wiki/Delay_differential_equation\">delay differential equation</a>. It can be solved through iterated integrations: To initiate the process, we note that <span class=\"math\">\\(P(S_0)\\)</span> is equal to zero for all <span class=\"math\">\\(S_0&lt; 1\\)</span>. Plugging this observation into (\\ref{delay}) implies that <span class=\"math\">\\(P(S_0) \\equiv J\\)</span> &#8212; some constant &#8212; for <span class=\"math\">\\(S \\in (1,2)\\)</span>. Continuing in this fashion, repeated integrations of (\\ref{delay})&nbsp;gives\n</p>\n<div class=\"math\">$$\\tag{13}\nP (S_0) = \\begin{cases}\nJ, \\ \\ \\ S_0 \\in (1,2) \\\\\nJ[1 - \\log (S_0 -1)], \\ \\ \\ S_0 \\in (2,3) \\\\\nJ \\left [ 1 - \\log(S_0 - 1) + Li_2(2-S_0) + \\frac{ \\log(S_0 - 2)}{\\log(S_0 - 1)} - Li_2(-1) \\right ], \\ \\ S_0 \\in (3,4) \\\\\n\\ldots,\n\\end{cases}\n$$</div>\n<p>\nwhere <span class=\"math\">\\(Li_2\\)</span> is the polylogarithm&nbsp;function.</p>\n<p>In practice, to find <span class=\"math\">\\(J\\)</span> one can solve (\\ref{delay}) numerically, requiring <span class=\"math\">\\(P(S)\\)</span> to be normalized. The figure below compares the result to a simulation estimate, obtained via binning the results of 250,000 random sums of form (\\ref{problem}). The two agree&nbsp;nicely.</p>\n<p><a href=\"https://efavdb.com/wp-content/uploads/2015/08/Screen-Shot-2015-08-16-at-10.34.46-PM.png\"><img alt=\"Screen Shot 2015-08-16 at 10.34.46 PM\" src=\"https://efavdb.com/wp-content/uploads/2015/08/Screen-Shot-2015-08-16-at-10.34.46-PM.png\"></a></p>\n<h3>Discussion</h3>\n<p>Consideration of this problem was motivated by a geometric series of type (\\ref{problem}) that arose in my work at Square. In this case, I was interested in understanding the bias and variance in the natural estimate (\\ref{mean}) to this problem. After some weeks of tinkering with S Landy, I was delighted to find that rigorous, simple results could be obtained to characterize these sums, the simplest being the moment and convergence results above. We now realize that these particular issues have already been well- (and better-)studied, by others<span class=\"math\">\\(^3\\)</span>.</p>\n<p>As for the integral equation approach, we have not found any other works aimed at solving this problem in general. The method discussed in the example above can be used for any <span class=\"math\">\\(P_0(a)\\)</span> that is uniform over a finite segment. We have also found solutions for a few other cases. Unfortunately, we have so far been unable to obtain a formal, general solution in closed form. However, we note that standard iterative approaches can always be used to estimate the solution to (\\ref{int}). Finally, in cases where all moments exist, these can also be used to determine <span class=\"math\">\\(P\\)</span>.</p>\n<h4>References and&nbsp;comments</h4>\n<p>[1] For a discussion on the geometric random walk model for stocks, see <a href=\"http://people.duke.edu/~rnau/411georw.htm\">here</a>.</p>\n<p>[2] Elongated bacteria &#8212; eg., e. coli &#8212; grow longer at an exponential rate &#8212; see my <a href=\"https://www.sites.google.com/site/Jonathan Landy/%282014%29cellgrowth.pdf?attredirects=0&amp;d=1\">paper on how cell shape affects growth rates</a>. Due to randomness inherent in the growth rates, bacteria populations will have a length distribution, similar in form to <span class=\"math\">\\(P(S)\\)</span>.</p>\n<p>[3] &#8220;An exponential functional of random walks&#8221; by Szabados and Szekeley, Journal of Applied Probability&nbsp;2003.</p>\n<p>[4] Although we have given only a hand-waving argument for this result, the authors of [3] state &#8212; and give a reference for &#8212; the fact that it can be proven using the law of large numbers: By independence of the <span class=\"math\">\\(a_i\\)</span>, the <span class=\"math\">\\(k\\)</span>-th term in the series approaches <span class=\"math\">\\((\\overline{\\log a})^k\\)</span> with probability one, at large <span class=\"math\">\\(k\\)</span>. Simple convergence criteria then give the&nbsp;result.</p>\n<p>[5] The moment equation (\\ref{moments}) can also be obtained from the integral equation (\\ref{int}), where it arrises from the application of the convolution&nbsp;theorem.</p>\n<script type=\"text/javascript\">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {\n    var align = \"center\",\n        indent = \"0em\",\n        linebreak = \"false\";\n\n    if (false) {\n        align = (screen.width < 768) ? \"left\" : align;\n        indent = (screen.width < 768) ? \"0em\" : indent;\n        linebreak = (screen.width < 768) ? 'true' : linebreak;\n    }\n\n    var mathjaxscript = document.createElement('script');\n    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';\n    mathjaxscript.type = 'text/javascript';\n    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';\n\n    var configscript = document.createElement('script');\n    configscript.type = 'text/x-mathjax-config';\n    configscript[(window.opera ? \"innerHTML\" : \"text\")] =\n        \"MathJax.Hub.Config({\" +\n        \"    config: ['MMLorHTML.js'],\" +\n        \"    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } },\" +\n        \"    jax: ['input/TeX','input/MathML','output/HTML-CSS'],\" +\n        \"    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],\" +\n        \"    displayAlign: '\"+ align +\"',\" +\n        \"    displayIndent: '\"+ indent +\"',\" +\n        \"    showMathMenu: true,\" +\n        \"    messageStyle: 'normal',\" +\n        \"    tex2jax: { \" +\n        \"        inlineMath: [ ['\\\\\\\\(','\\\\\\\\)'] ], \" +\n        \"        displayMath: [ ['$$','$$'] ],\" +\n        \"        processEscapes: true,\" +\n        \"        preview: 'TeX',\" +\n        \"    }, \" +\n        \"    'HTML-CSS': { \" +\n        \"        availableFonts: ['STIX', 'TeX'],\" +\n        \"        preferredFont: 'STIX',\" +\n        \"        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} },\" +\n        \"        linebreaks: { automatic: \"+ linebreak +\", width: '90% container' },\" +\n        \"    }, \" +\n        \"}); \" +\n        \"if ('default' !== 'default') {\" +\n            \"MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {\" +\n                \"var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;\" +\n                \"VARIANT['normal'].fonts.unshift('MathJax_default');\" +\n                \"VARIANT['bold'].fonts.unshift('MathJax_default-bold');\" +\n                \"VARIANT['italic'].fonts.unshift('MathJax_default-italic');\" +\n                \"VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');\" +\n            \"});\" +\n            \"MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {\" +\n                \"var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;\" +\n                \"VARIANT['normal'].fonts.unshift('MathJax_default');\" +\n                \"VARIANT['bold'].fonts.unshift('MathJax_default-bold');\" +\n                \"VARIANT['italic'].fonts.unshift('MathJax_default-italic');\" +\n                \"VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');\" +\n            \"});\" +\n        \"}\";\n\n    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);\n    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);\n}\n</script>",
  "category": [
    "",
    ""
  ]
}