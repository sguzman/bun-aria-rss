{
  "title": "Adobe Analytics Clickstream Data Feed: Loading To Relational Database",
  "description": "<p>In my previous post about the <a href=\"http://randyzwitch.com/adobe-analytics-clickstream-raw-data-feed/\">Adobe Analytics Clickstream Data Feed</a>, I showed how it was possible to take a single day worth of data and build a dataframe in R. However, most likely your analysis will require using multiple days/weeks/months of data, and given the size and complexity of the feed, loading the files into a relational database makes a lot of sense.</p>",
  "pubDate": "Fri, 18 Mar 2016 14:42:23 +0000",
  "link": "http://randyzwitch.com/adobe-analytics-clickstream-data-feed-relational-database/",
  "guid": "http://randyzwitch.com/adobe-analytics-clickstream-data-feed-relational-database/",
  "content": "<p>In my previous post about the <a href=\"http://randyzwitch.com/adobe-analytics-clickstream-raw-data-feed/\">Adobe Analytics Clickstream Data Feed</a>, I showed how it was possible to take a single day worth of data and build a dataframe in R. However, most likely your analysis will require using multiple days/weeks/months of data, and given the size and complexity of the feed, loading the files into a relational database makes a lot of sense.</p>\n\n<p>Although there may be database-specific “fast-load” tools more appropriate for this application, this blog post will show how to handle this process using only R and <a href=\"http://www.postgresql.org/download/\">PostgresSQL</a>.</p>\n\n<h2 id=\"file-organization\">File Organization</h2>\n\n<p>Before getting into the loading of the data into PostgreSQL, I like to sort my files by type into separate directories (remember from the <a href=\"http://randyzwitch.com/adobe-analytics-clickstream-raw-data-feed/\">previous post</a>, you’ll receive three files per day). R makes OS-level operations simple enough:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n</pre></td><td class=\"code\"><pre><span class=\"c1\">#### 1. Setting directory to FTP folder where files incoming from Adobe</span><span class=\"w\">\n</span><span class=\"c1\">## Has ~2000 files in it from 2 years of data</span><span class=\"w\">\n</span><span class=\"n\">setwd</span><span class=\"p\">(</span><span class=\"s2\">\"~/Downloads/datafeed/\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#### 2. Sort files into three separate folders</span><span class=\"w\">\n</span><span class=\"c1\">## Manifests - plain text files</span><span class=\"w\">\n</span><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">dir.exists</span><span class=\"p\">(</span><span class=\"s2\">\"manifest\"</span><span class=\"p\">)){</span><span class=\"w\">\n  </span><span class=\"n\">dir.create</span><span class=\"p\">(</span><span class=\"s2\">\"manifest\"</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">lapply</span><span class=\"p\">(</span><span class=\"n\">list.files</span><span class=\"p\">(</span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"*.txt\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">file.rename</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">paste</span><span class=\"p\">(</span><span class=\"s2\">\"manifest\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"/\"</span><span class=\"p\">)))</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n\n</span><span class=\"c1\">## Server calls tsv.gz</span><span class=\"w\">\n</span><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">dir.exists</span><span class=\"p\">(</span><span class=\"s2\">\"servercalls\"</span><span class=\"p\">)){</span><span class=\"w\">\n  </span><span class=\"n\">dir.create</span><span class=\"p\">(</span><span class=\"s2\">\"servercalls\"</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">lapply</span><span class=\"p\">(</span><span class=\"n\">list.files</span><span class=\"p\">(</span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"*.tsv.gz\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">file.rename</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">paste</span><span class=\"p\">(</span><span class=\"s2\">\"servercalls\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"/\"</span><span class=\"p\">)))</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n\n</span><span class=\"c1\">## Lookup files .tar.gz</span><span class=\"w\">\n</span><span class=\"k\">if</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">dir.exists</span><span class=\"p\">(</span><span class=\"s2\">\"lookup\"</span><span class=\"p\">)){</span><span class=\"w\">\n  </span><span class=\"n\">dir.create</span><span class=\"p\">(</span><span class=\"s2\">\"lookup\"</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">lapply</span><span class=\"p\">(</span><span class=\"n\">list.files</span><span class=\"p\">(</span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"*.tar.gz\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">file.rename</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">paste</span><span class=\"p\">(</span><span class=\"s2\">\"lookup\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"/\"</span><span class=\"p\">)))</span><span class=\"w\">\n</span><span class=\"p\">}</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>Were there more file types, I could’ve abstracted this into a function instead of copying the code three times, but the idea is the same: Check to see if the directory exists, if it doesn’t then create it and move the files into the directory.</p>\n\n<h2 id=\"connecting-and-loading-data-topostgresql-from-r\">Connecting and Loading Data to PostgreSQL from R</h2>\n\n<p>Once we have our files organized, we can begin the process of loading the files into PostgreSQL using the <a href=\"https://cran.r-project.org/web/packages/RPostgreSQL/index.html\">RPostgreSQL</a> R package.  RPostgreSQL is <a href=\"https://github.com/rstats-db/DBI\">DBI-compliant</a>, so the connection string is the same for any other type of database engine; the biggest caveat of loading your <code class=\"language-plaintext highlighter-rouge\">servercall</code> data into a database is the first load is almost guaranteed to require loading as text (using <code class=\"language-plaintext highlighter-rouge\">colClasses = \"character\"</code> argument in R). The reason that you’ll need to load the data as text is that Adobe Analytics implementations necessarily change over time; text is the only column format that allows for no loss of data (we can fix the schema later within Postgres either by using <code class=\"language-plaintext highlighter-rouge\">ALTER TABLE</code> or by writing a view).</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n</pre></td><td class=\"code\"><pre><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">RPostgreSQL</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\"># Connect to database</span><span class=\"w\">\n</span><span class=\"n\">conn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">dbConnect</span><span class=\"p\">(</span><span class=\"n\">dbDriver</span><span class=\"p\">(</span><span class=\"s2\">\"PostgreSQL\"</span><span class=\"p\">),</span><span class=\"w\">\n                 </span><span class=\"n\">user</span><span class=\"o\">=</span><span class=\"s2\">\"postgres\"</span><span class=\"p\">,</span><span class=\"w\">\n                 </span><span class=\"n\">password</span><span class=\"o\">=</span><span class=\"s2\">\"\"</span><span class=\"p\">,</span><span class=\"w\">\n                 </span><span class=\"n\">host</span><span class=\"o\">=</span><span class=\"s2\">\"localhost\"</span><span class=\"p\">,</span><span class=\"w\">\n                 </span><span class=\"n\">port</span><span class=\"o\">=</span><span class=\"m\">5432</span><span class=\"p\">,</span><span class=\"w\">\n                 </span><span class=\"n\">dbname</span><span class=\"o\">=</span><span class=\"s2\">\"adobe\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#Set directory to avoid having to use paste to build urls</span><span class=\"w\">\n</span><span class=\"n\">setwd</span><span class=\"p\">(</span><span class=\"s2\">\"~/Downloads/datafeed/servercalls\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#Set column headers for server calls</span><span class=\"w\">\n</span><span class=\"n\">column_headers</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">read.delim</span><span class=\"p\">(</span><span class=\"s2\">\"~/Downloads/datafeed/lookup/column_headers.tsv\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stringsAsFactors</span><span class=\"o\">=</span><span class=\"kc\">FALSE</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#Loop over entire list of files</span><span class=\"w\">\n</span><span class=\"c1\">#Setting colClasses to character only way to guarantee all data loads</span><span class=\"w\">\n</span><span class=\"c1\">#File formats or implementations can change over time; fix schema in database after data loaded</span><span class=\"w\">\n</span><span class=\"k\">for</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">list.files</span><span class=\"p\">()){</span><span class=\"w\">\n  </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">df</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">read.csv2</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"\\t\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">header</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">FALSE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stringsAsFactors</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">FALSE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">colClasses</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"character\"</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">dbWriteTable</span><span class=\"p\">(</span><span class=\"n\">conn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s1\">'servercalls'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">df</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">row.names</span><span class=\"o\">=</span><span class=\"kc\">FALSE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">append</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">rm</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n\n</span><span class=\"c1\">#Run analyze in PostgreSQL so that query planner has accurate information</span><span class=\"w\">\n</span><span class=\"n\">dbGetQuery</span><span class=\"p\">(</span><span class=\"n\">conn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"analyze servercalls\"</span><span class=\"p\">)</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>With this small amount of code, we’ve generated the table definition structure (<a href=\"https://gist.github.com/randyzwitch/e26b97d26689b6b31044\">see here for the underlying Postgres code</a>), loaded the data, and told Postgres to analyze the table to gather statistics for efficient queries. Sweet, two years of data loaded with minimal effort!</p>\n\n<h2 id=\"loading-lookup-tables-into-postgresql\">Loading Lookup Tables Into PostgreSQL</h2>\n\n<p>With the server call data loaded into our database, we now need to load our lookup tables. Lucky for us, these do maintain a constant format, so we don’t need to worry about setting all the fields to text, RPostgreSQL should get the column types correct.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n</pre></td><td class=\"code\"><pre><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">RPostgreSQL</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\"># Connect to database</span><span class=\"w\">\n</span><span class=\"n\">conn</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">dbConnect</span><span class=\"p\">(</span><span class=\"n\">dbDriver</span><span class=\"p\">(</span><span class=\"s2\">\"PostgreSQL\"</span><span class=\"p\">),</span><span class=\"w\">\n                 </span><span class=\"n\">user</span><span class=\"o\">=</span><span class=\"s2\">\"postgres\"</span><span class=\"p\">,</span><span class=\"w\">\n                 </span><span class=\"n\">password</span><span class=\"o\">=</span><span class=\"s2\">\"\"</span><span class=\"p\">,</span><span class=\"w\">\n                 </span><span class=\"n\">host</span><span class=\"o\">=</span><span class=\"s2\">\"localhost\"</span><span class=\"p\">,</span><span class=\"w\">\n                 </span><span class=\"n\">port</span><span class=\"o\">=</span><span class=\"m\">5432</span><span class=\"p\">,</span><span class=\"w\">\n                 </span><span class=\"n\">dbname</span><span class=\"o\">=</span><span class=\"s2\">\"adobe\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"n\">setwd</span><span class=\"p\">(</span><span class=\"s2\">\"~/Downloads/datafeed/lookup/\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#Create function due to repetitiveness</span><span class=\"w\">\n</span><span class=\"c1\">#Since we're loading lookup tables with mostly same values each time, put source file in table</span><span class=\"w\">\n</span><span class=\"n\">loadlookup</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">tblname</span><span class=\"p\">){</span><span class=\"w\">\n  </span><span class=\"n\">df</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">read.csv2</span><span class=\"p\">(</span><span class=\"n\">paste</span><span class=\"p\">(</span><span class=\"n\">tblname</span><span class=\"p\">,</span><span class=\"s2\">\".tsv\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"o\">=</span><span class=\"s2\">\"\"</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">sep</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"\\t\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">header</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">FALSE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stringsAsFactors</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">FALSE</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">file</span><span class=\"w\">\n  </span><span class=\"n\">dbWriteTable</span><span class=\"p\">(</span><span class=\"n\">conn</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">tblname</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">df</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">row.names</span><span class=\"o\">=</span><span class=\"kc\">FALSE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">append</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n\n</span><span class=\"c1\">#untar files, place in directory by day</span><span class=\"w\">\n</span><span class=\"k\">for</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"n\">list.files</span><span class=\"p\">(</span><span class=\"n\">pattern</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"*.tar.gz\"</span><span class=\"p\">)){</span><span class=\"w\">\n  </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">untar</span><span class=\"p\">(</span><span class=\"n\">file</span><span class=\"p\">)</span><span class=\"w\">\n\n  </span><span class=\"k\">for</span><span class=\"p\">(</span><span class=\"n\">tbl</span><span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"browser_type\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"browser\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"color_depth\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"column_headers\"</span><span class=\"p\">,</span><span class=\"w\">\n               </span><span class=\"s2\">\"connection_type\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"country\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"event\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"javascript_version\"</span><span class=\"p\">,</span><span class=\"w\">\n               </span><span class=\"s2\">\"languages\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"operating_systems\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"plugins\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"referrer_type\"</span><span class=\"p\">,</span><span class=\"w\">\n               </span><span class=\"s2\">\"resolution\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"search_engines\"</span><span class=\"p\">)){</span><span class=\"w\">\n\n    </span><span class=\"n\">loadlookup</span><span class=\"p\">(</span><span class=\"n\">tbl</span><span class=\"p\">)</span><span class=\"w\">\n\n  </span><span class=\"p\">}</span><span class=\"w\">\n</span><span class=\"p\">}</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p><strong>SHORTCUT</strong>: The dimension tables that are common to all report suites don’t really change over time, although that isn’t guaranteed.  In the 758 days of files I loaded (<a href=\"https://gist.github.com/randyzwitch/5ed2f4fc8574b91efd29\">code</a>), the only files having more than one value for a given key were: <code class=\"language-plaintext highlighter-rouge\">browser</code>, <code class=\"language-plaintext highlighter-rouge\">browser_type</code>, <code class=\"language-plaintext highlighter-rouge\">operating_system</code>, <code class=\"language-plaintext highlighter-rouge\">search_engines</code>, <code class=\"language-plaintext highlighter-rouge\">event</code> (report suite specific for every company) and <code class=\"language-plaintext highlighter-rouge\">column_headers</code> (report suite specific for every company). So if you’re doing a bulk load of data, it’s generally sufficient to use the newest lookup table and save yourself some time. If you are processing the data every day, you can use an <a href=\"https://wiki.postgresql.org/wiki/UPSERT\">upsert process</a> and generally there will be few if any updates.</p>\n\n<h2 id=\"lets-do-analytics\">Let’s Do Analytics!!!!???!!!</h2>\n\n<p><em><moan>Why is there always so much ETL work, I want to data science the hell out of some data</moan></em></p>\n\n<p>At this point, if you were uploading the same amount of data for the traffic my blog does (not much), you’d be about 1-2 hours into loading data, still having done no analysis. In fact, in order to do analysis, you’d still need to modify the column names and types in your <code class=\"language-plaintext highlighter-rouge\">servercalls</code> table, update the lookup tables to have the proper column names, and maybe you’d even want to pre-summarize the tables into views/materialized views for Page View/Visit/Visitor level. Whew, that’s a lot of work just to calculate daily page views.</p>\n\n<p>Yes it is. But taking on a project like this isn’t for page views; just use the Adobe Analytics UI!</p>\n\n<p>In a future blog post or two, I’ll demonstrate how to use this relational database layout to perform analyses not possible within the Adobe Analytics interface, and also show how we can skip this ETL process altogether using a <a href=\"http://blog.cask.co/2015/03/schema-on-read-in-action/\">schema-on-read process</a> with Spark.</p>"
}