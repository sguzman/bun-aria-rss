{
  "title": "cransays - Follow your R Package Journey to CRANterbury with our Dashboard!",
  "link": "https://itsalocke.com/blog/cransays---follow-your-r-package-journey-to-cranterbury-with-our-dashboard/",
  "pubDate": "Thu, 11 Oct 2018 00:00:00 +0000",
  "guid": "https://itsalocke.com/blog/cransays---follow-your-r-package-journey-to-cranterbury-with-our-dashboard/",
  "description": "<p>We at <a href=\"https://github.com/lockedata\">Locke Data</a> maintain a few R packages that we&rsquo;ve submitted to CRAN to help increase their userbase. After running <code>devtools::release()</code>, clicking in a confirmation email&hellip; what remains is <em>waiting</em>. Inspired by our experience, we&rsquo;ve created <a href=\"https://cransays.itsalocke.com/articles/dashboard.html\">a dashboard</a> to help other package maintainers follow their package&rsquo;s journey to CRANterbury. Read more about its making in this post!</p>\n\n<h1 id=\"why-create-the-cransays-dashboard\">Why create the cransays dashboard?</h1>\n\n<p>Sometimes, depending on the workload of CRAN volunteers, it can last a while before a package ends up on their way to CRAN. The number of submissions has increased a lot within the last few years! As per <a href=\"https://cran.r-project.org/web/packages/policies.html#Submission\">CRAN policies</a>, &ldquo;You can check that the submission was received by looking at <a href=\"ftp://CRAN.R-project.org/incoming/.&quot;\">ftp://CRAN.R-project.org/incoming/.&quot;</a>. The content of that ftp server is divided into various subfolders, making the research of one&rsquo;s package pretty tricky.</p>\n\n\n<figure >\n    \n        <img src=\"../img/cran-incoming.png\" />\n    \n    \n    <figcaption>\n        <h4>Part of the content of CRAN incoming ftp server</h4>\n        \n    </figcaption>\n    \n</figure>\n\n\n<p>After having to do that a few days in a row for checking on one of our submissions, we decided a dashboard showing all packages and their submission stage in one go would be quite useful, so we made it happen!</p>\n\n<h1 id=\"how-we-made-the-cransays-dashboard\">How we made the cransays dashboard?</h1>\n\n<p>In this section you&rsquo;ll discover how we create a snapshot of the CRAN incoming state, format it, and then deploy it to the interwebs every hour!</p>\n\n<h2 id=\"creating-a-snapshot-of-cran-incoming\">Creating a snapshot of CRAN incoming</h2>\n\n<p>First of all, we wrote a function <code>take_snapshot()</code> to create a snapshot of the ftp server. Technically, we query the different ftp folders using <code>curl</code> and <code>utils::read.delim()</code>, munging strings and datetimes along the way. Our original code was adapted from <a href=\"https://github.com/edgararuiz/cran-stages/\">an insightful repo by Edgar Ruiz at RStudio</a>, that is a good read about the different stages of submission.</p>\n\n<p>The <code>take_snapshot()</code> function was improved thanks to the contributions of <a href=\"https://mitchelloharawild.com/\">Mitchell O&rsquo;Hara-Wild</a> and <a href=\"https://www.normalesup.org/~hgruson/\">Hugo Gruson</a>. Receiving PRs so rapidly after opening <a href=\"https://itsalocke.com/blog/up-your-open-source-game-with-hacktoberfest-at-locke-data/\">hacktoberfest issues</a> was really appreciated!</p>\n\n<h2 id=\"presenting-the-snapshot\">Presenting the snapshot</h2>\n\n\n<figure >\n    \n        <img src=\"../img/cransays.png\" />\n    \n    \n    <figcaption>\n        <h4>cransays dashboard</h4>\n        \n    </figcaption>\n    \n</figure>\n\n\n<p>Then, the dashboard itself is the <code>data.frame</code> returned by <code>take_snapshot()</code> formatted by the <code>DT</code> package. The formatting of that <code>datatable</code> was improved thanks to external contributions again! Thank you, <a href=\"https://www.normalesup.org/~hgruson/\">Hugo Gruson</a> and <a href=\"https://www.jimhester.com\">Jim Hester</a>!</p>\n\n<h2 id=\"packaging-it-all-together\">Packaging it all together</h2>\n\n<p>Find the source for our dashboard <a href=\"https://github.com/lockedata/cransays\">here</a>. <code>cransays</code> is structured as a package, because</p>\n\n<ul>\n<li><p>Packages are cool, duh!</p></li>\n\n<li><p>It helps with managing dependencies thanks to DESCRIPTION.</p></li>\n\n<li><p>It allowed us to rip off the benefits of <a href=\"https://github.com/r-lib/pkgdown\"><code>pkgdown</code></a> and <a href=\"https://github.com/ropenscilabs/travis\"><code>travis</code></a> + <a href=\"https://github.com/ropenscilabs/tic\"><code>tic</code></a>. We wrote the <code>DT</code> code inside a vignette &ndash; <a href=\"https://usethis.r-lib.org/reference/use_vignette.html\"><code>usethis::use_vignette()</code></a> for the win. Then, with the two lines below, we were able to deploy a website for the package from Travis! Every push to the master branch of our repo meant <code>pkgdown::build_site()</code> is run on Travis and the result is pushed to a gh-pages branch!</p></li>\n</ul>\n<div class=\"highlight\"><pre style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"><code class=\"language-r\" data-lang=\"r\"><span style=\"color:#75715e\"># install.packages(&#34;usethis&#34;)</span>\n<span style=\"color:#75715e\"># remotes::install_github(&#34;ropenscilabs/tic&#34;)</span>\n\nusethis<span style=\"color:#f92672\">::</span>use_pkgdown() <span style=\"color:#75715e\"># creates the pkgdown config file</span>\ntravis<span style=\"color:#f92672\">::</span>use_tic() <span style=\"color:#75715e\"># creates boilerplate deploy code, lets you browse GitHub and Travis to create tokens.</span></code></pre></div>\n<p>We added a few lines to and <a href=\"https://github.com/lockedata/cransays/blob/master/_pkgdown.yml#L2\">_pkgdown.yml</a> and <a href=\"https://github.com/lockedata/cransays/blob/master/.travis.yml#L6\">travis.yml</a> to be able to use <a href=\"https://github.com/lockedatapublished/lockedatapkg\">our own <code>pkgdown</code> style</a>. Steph wrote <a href=\"https://itsalocke.com/blog/automated-documentation-hosting-on-github-via-travis-ci/\">posts about deploying docs from Travis in case you want to know more about the process</a> but when using rOpenSci&rsquo;s packages <code>tic</code> and <code>travis</code>, you don&rsquo;t even need to think about it much.</p>\n\n<p>Thanks to this <code>pkgdown</code>-Travis setup, you can find our dashboard <a href=\"https://cransays.itsalocke.com/articles/dashboard.html\">here</a> with <a href=\"https://cransays.itsalocke.com/index.html\">a homepage with more information</a>.</p>\n\n<h2 id=\"updating-it-regularly\">Updating it regularly!</h2>\n\n<p>Steph took care of the deploy via Netlify to a subdomain of itsalocke.com, otherwise we could have used the GitHub pages hosting from the gh-pages branch. Steph also created a Zapier zap so that there&rsquo;d be a Travis build triggered every hour. It means that our dashboard is updated at least every hour, which seemed <a href=\"https://en.wikipedia.org/wiki/Lagom\"><em>lagom</em></a>.</p>\n\n<h1 id=\"sit-back-and-enjoy-or-improve-the-project\">Sit back and enjoy, or improve the project?</h1>\n\n<p>Now, we&rsquo;re able to follow our submissions using our nifty dashboard, and you can do that too! We&rsquo;ve also been thinking about:</p>\n\n<ul>\n<li><p>getting metadata about each submission by unpacking them and using the <a href=\"https://github.com/r-lib/desc\"><code>desc</code> package</a> and <a href=\"https://github.com/r-lib/pkgload\"><code>pkgload::parse_ns_file()</code></a>,</p></li>\n\n<li><p>and saving the snapshots over time, very similar to <a href=\"https://github.com/edgararuiz/cran-stages/\">what the RStudio folks did in the spring</a>.</p></li>\n</ul>\n\n<p>Stay tuned via <a href=\"https://github.com/lockedata/cransays/issues\"><code>cransays</code>&rsquo; issue tracker</a>! In the meantime, happy R package development, and good luck with your CRAN submissions!</p>"
}