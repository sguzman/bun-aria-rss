{
  "title": "Opening a spatial subset with {sf}",
  "link": "https://www.r-bloggers.com/2022/11/opening-a-spatial-subset-with-sf/",
  "dc:creator": "Michael",
  "pubDate": "Fri, 04 Nov 2022 11:31:20 +0000",
  "category": "R bloggers",
  "guid": "http://r.iresmi.net/?p=492",
  "description": "<p>Intersecting an area of interest with a layer at opening time Days 3 and 4 of 30DayMapChallenge : « polygons » and « green » (previously). The CORINE Landcover dataset is distributed as a geopackage weighting more than 8 Go. To limit the memory used when we only work on a subset, we can clip it at opening ...</p>\n<strong>Continue reading</strong>: <a href=\"https://www.r-bloggers.com/2022/11/opening-a-spatial-subset-with-sf/\">Opening a spatial subset with {sf}</a>",
  "content:encoded": "<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"http://r.iresmi.net/2022/11/04/opening-a-spatial-subset-with-sf/\"> r.iresmi.net</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n\n<blockquote class=\"wp-block-quote\"><p>Intersecting an area of interest with a layer at opening time</p></blockquote>\n\n\n\n<p>Days 3 and 4 of <a href=\"https://30daymapchallenge.com/\" data-type=\"URL\" data-id=\"https://30daymapchallenge.com/\" rel=\"nofollow\" target=\"_blank\">30DayMapChallenge</a> : « polygons » and « green » (<a href=\"http://r.iresmi.net/tag/30daymapchallenge/\" rel=\"nofollow\" target=\"_blank\">previously</a>).</p>\n\n\n\n<p>The <a href=\"https://land.copernicus.eu/pan-european/corine-land-cover/clc2018\" rel=\"nofollow\" target=\"_blank\">CORINE Landcover dataset</a> is distributed as a geopackage weighting more than 8 Go. To limit the memory used when we only work on a subset, we can clip it at opening time. Here we will map the Cyprus Island :</p>\n\n\n\n<pre>library(dplyr)\nlibrary(ggplot2)\nlibrary(stringr)\nlibrary(sf)\nlibrary(rnaturalearth)\nlibrary(glue)\n\n# Using the contour of Cyprus (enlarged) from naturalearth to clip\nbb <- ne_countries(scale = \"medium\", country = \"cyprus\", returnclass = \"sf\") %>% \n  st_transform(\"EPSG:3035\") %>% \n  st_buffer(90000) %>% \n  pull(geometry) %>% \n  st_as_text()\n\n# Corine Land Cover \n# download from https://land.copernicus.eu/pan-european/corine-land-cover/clc2018\n# (registration required)\n# passing the bounding area\ncyprus_clc <- read_sf(\"data/U2018_CLC2018_V2020_20u1.gpkg\", query = glue(\"\n  SELECT * \n  FROM U2018_CLC2018_V2020_20u1\n  WHERE st_intersects(Shape, st_polygonfromtext('{bb}'))\"))\n\nlegend_colors <- list(\"TRUE\"  = \"mediumaquamarine\",\n                      \"FALSE\" = \"grey90\")\n\nlegend_labs <- list(\"TRUE\"  = \"forest\",\n                    \"FALSE\" = \"other\")\n\n# exclude sea (code 523)\n# and classify on forest (codes 3xx)\ncyprus_clc %>% \n  filter(Code_18 != \"523\") %>% \n  ggplot() +\n  geom_sf(aes(fill = str_detect(Code_18, \"^3\"),\n              color = str_detect(Code_18, \"^3\"))) +\n  scale_fill_manual(name= \"type\",\n                    values = legend_colors,\n                    labels = legend_labs) +\n  scale_color_manual(name = \"type\",\n                     values = legend_colors,\n                     labels = legend_labs) +\n  labs(title = \"Cyprus\",\n       subtitle = \"Landcover\",\n       caption = glue(\"data: Copernicus CLC 2018\n                      projection LAEA\n                      r.iresmi.net {Sys.Date()}\")) +\n  theme_minimal() +\n  theme(legend.position = \"bottom\",\n               plot.caption = element_text(size = 7))\n\nggsave(\"cyprus.png\", width = 20, height = 12.36, units = \"cm\", scale = 1.1, type = \"cairo\")\n</pre>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" src=\"https://i1.wp.com/r.iresmi.net/wp-content/uploads/2022/11/cyprus-1024x633.png?w=450\" alt=\"\" class=\"wp-image-493\" srcset_temp=\"https://i1.wp.com/r.iresmi.net/wp-content/uploads/2022/11/cyprus-1024x633.png?w=450 1024w, http://r.iresmi.net/wp-content/uploads/2022/11/cyprus-300x185.png 300w, http://r.iresmi.net/wp-content/uploads/2022/11/cyprus-768x474.png 768w, http://r.iresmi.net/wp-content/uploads/2022/11/cyprus-1536x949.png 1536w, http://r.iresmi.net/wp-content/uploads/2022/11/cyprus-2048x1265.png 2048w, http://r.iresmi.net/wp-content/uploads/2022/11/cyprus-1200x741.png 1200w, http://r.iresmi.net/wp-content/uploads/2022/11/cyprus-1980x1223.png 1980w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" data-recalc-dims=\"1\" /><figcaption>Cyprus landcover</figcaption></figure>\n\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"http://r.iresmi.net/2022/11/04/opening-a-spatial-subset-with-sf/\"> r.iresmi.net</a></strong>.</div>\n<hr />\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a title=\"The R Project for Statistical Computing\" href=\"https://www.r-project.org/\" rel=\"nofollow\">R</a> news and tutorials about <a title=\"R tutorials\" href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\">learning R</a> and many other topics. <a title=\"Data science jobs\" href=\"https://www.r-users.com/\" rel=\"nofollow\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div><strong>Continue reading</strong>: <a href=\"https://www.r-bloggers.com/2022/11/opening-a-spatial-subset-with-sf/\">Opening a spatial subset with {sf}</a>",
  "enclosure": "",
  "post-id": 334302
}