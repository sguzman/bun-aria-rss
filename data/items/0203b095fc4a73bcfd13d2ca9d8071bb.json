{
  "title": "Peering into the Black Box : Visualizing LambdaMART",
  "link": "https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/",
  "comments": "https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/#respond",
  "dc:creator": "wellecks",
  "pubDate": "Sat, 21 Feb 2015 22:13:29 +0000",
  "category": [
    "artificial intelligence",
    "machine learning",
    "d3.js",
    "heatmap tree",
    "jforests",
    "LambdaMART",
    "learning to rank",
    "Machine learning",
    "visualization"
  ],
  "guid": "http://wellecks.wordpress.com/?p=1045",
  "description": "In the last post, I gave a broad overview of the Learning to Rank domain of machine learning that has applications in web search, machine translation, and question-answering systems. In this post, we&#8217;ll look at a state of the art model used in Learning to Rank called LambdaMART. We&#8217;ll take a look at some math underlying LambdaMART, then focus [&#8230;]",
  "content:encoded": "<p>In the <span style=\"color:#808080;\"><a style=\"color:#808080;\" title=\"Learning to Rank Overview\" href=\"https://wellecks.wordpress.com/2015/01/15/learning-to-rank-overview/\">last post</a></span>, I gave a broad overview of the Learning to Rank domain of machine learning that has applications in web search, machine translation, and question-answering systems. In this post, we&#8217;ll look at a state of the art model used in Learning to Rank called LambdaMART. We&#8217;ll take a look at some math underlying LambdaMART, then focus on developing ways to visualize the model.</p>\n<p>LambdaMART produces a tree ensemble model, a class of models traditionally viewed as &#8216;black boxes&#8217; since they take into account predictions of 10&#8217;s or 100&#8217;s of underlying trees. While viewing a single decision tree is intuitive and interpretable, viewing 100 at once would be overwhelming and uninformative:</p>\n<p><a href=\"https://wellecks.files.wordpress.com/2015/02/tree.png\"><img loading=\"lazy\" data-attachment-id=\"1049\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/tree/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/tree.png\" data-orig-size=\"1378,1284\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"tree\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/tree.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/tree.png?w=525\" class=\"aligncenter wp-image-1049\" src=\"https://wellecks.files.wordpress.com/2015/02/tree.png?w=285&#038;h=266\" alt=\"tree\" width=\"285\" height=\"266\" srcset=\"https://wellecks.files.wordpress.com/2015/02/tree.png?w=285&h=266 285w, https://wellecks.files.wordpress.com/2015/02/tree.png?w=570&h=532 570w, https://wellecks.files.wordpress.com/2015/02/tree.png?w=150&h=140 150w, https://wellecks.files.wordpress.com/2015/02/tree.png?w=300&h=280 300w\" sizes=\"(max-width: 285px) 100vw, 285px\" /></a></p>\n<p>&nbsp;</p>\n<p style=\"text-align:center;\"><span style=\"color:#999999;\">Single Tree</span></p>\n<p>&nbsp;</p>\n<p><a href=\"https://wellecks.files.wordpress.com/2015/02/ensemble1.png\"><img loading=\"lazy\" data-attachment-id=\"1051\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/ensemble-2/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/ensemble1.png\" data-orig-size=\"2788,2082\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"ensemble\" data-image-description=\"\" data-image-caption=\"<p>Ensemble of Trees</p>\n\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/ensemble1.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/ensemble1.png?w=525\" class=\"aligncenter wp-image-1051\" src=\"https://wellecks.files.wordpress.com/2015/02/ensemble1.png?w=316&#038;h=236\" alt=\"Ensemble of Trees\" width=\"316\" height=\"236\" srcset=\"https://wellecks.files.wordpress.com/2015/02/ensemble1.png?w=316&h=236 316w, https://wellecks.files.wordpress.com/2015/02/ensemble1.png?w=632&h=472 632w, https://wellecks.files.wordpress.com/2015/02/ensemble1.png?w=150&h=112 150w, https://wellecks.files.wordpress.com/2015/02/ensemble1.png?w=300&h=224 300w\" sizes=\"(max-width: 316px) 100vw, 316px\" /></a></p>\n<p style=\"text-align:center;\"><span style=\"color:#999999;\"> Ensemble of Trees</span></p>\n<p>By moving from a single tree to an ensemble of trees, we tradeoff interpretability for performance.</p>\n<p>In this post, we&#8217;ll take a look at the trees produced by the LambdaMART training process, and develop a visualization to view the ensemble of trees as a single collective unit. By doing so, we&#8217;ll gain back some of the intuitive interpretability that make tree models appealing. Through the visualization, we&#8217;ll peer into the black box model and gain some sense of the factors that the model uses to make predictions.</p>\n<p>We use Java and the <span style=\"color:#808080;\"><a style=\"color:#808080;\" href=\"https://code.google.com/p/jforests/\">JForests</a></span> library to train LambdaMART and parse its output, and d3.js for visualization. To get a sneak peek, the <span style=\"color:#808080;\"><a style=\"color:#808080;\" title=\"Heatmap Tree\" href=\"http://heatmap-tree.herokuapp.com\">final visualization is here</a></span>.</p>\n<p style=\"text-align:center;\"><strong>LambdaMART Overview</strong></p>\n<p>Let&#8217;s take a look at some details of LambdaMART. For the full story, check out <span style=\"color:#808080;\"><a style=\"color:#808080;\" href=\"http://research-srv.microsoft.com/pubs/132652/MSR-TR-2010-82.pdf\">this paper</a></span> from Microsoft Research.</p>\n<p>At a high level, LambdaMART is an algorithm that uses gradient boosting to directly optimize Learning to Rank specific cost functions such as NDCG. To understand LambdaMART we&#8217;ll look at two aspects: Lambda and MART.</p>\n<p><strong>MART</strong></p>\n<p>LambdaMART is a specific instance of Gradient Boosted Regression Trees, also referred to as Multiple Additive Regression Trees (MART). Gradient Boosting is a technique for forming a model that is a weighted combination of an ensemble of &#8220;weak learners&#8221;. In our case, each &#8220;weak learner&#8221; is a decision tree.</p>\n<p>Our goal is to find a function <img src=\"https://s0.wp.com/latex.php?latex=f%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=f%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=f%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"f(x)\" class=\"latex\" /> that minimizes the expected loss <img src=\"https://s0.wp.com/latex.php?latex=L&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=L&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=L&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"L\" class=\"latex\" />:</p>\n<p style=\"text-align:center;\"><img src=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29+%3D+%5Carg%5Cmin_%7Bf%28x%29%7DE%5BL%28y%2C+f%28x%29%29%7Cx%5D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29+%3D+%5Carg%5Cmin_%7Bf%28x%29%7DE%5BL%28y%2C+f%28x%29%29%7Cx%5D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29+%3D+%5Carg%5Cmin_%7Bf%28x%29%7DE%5BL%28y%2C+f%28x%29%29%7Cx%5D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;hat{f}(x) = &#92;arg&#92;min_{f(x)}E[L(y, f(x))|x]\" class=\"latex\" /></p>\n<p style=\"text-align:left;\">for feature vectors <img src=\"https://s0.wp.com/latex.php?latex=x&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=x&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=x&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"x\" class=\"latex\" /> and labels <img src=\"https://s0.wp.com/latex.php?latex=y&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=y&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=y&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"y\" class=\"latex\" />.</p>\n<p style=\"text-align:left;\">To do so we first view <img src=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;hat{f}(x)\" class=\"latex\" /> as a sum of weak learners <img src=\"https://s0.wp.com/latex.php?latex=f_m&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=f_m&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=f_m&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"f_m\" class=\"latex\" />:</p>\n<p style=\"text-align:center;\"><img src=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29%3D%5Csum_%7Bm%3D1%7D%5EM+f_%7Bm%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29%3D%5Csum_%7Bm%3D1%7D%5EM+f_%7Bm%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29%3D%5Csum_%7Bm%3D1%7D%5EM+f_%7Bm%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;hat{f}(x)=&#92;sum_{m=1}^M f_{m}(x)\" class=\"latex\" /></p>\n<p style=\"text-align:left;\">Since we are dealing with decision trees, evaluating <img src=\"https://s0.wp.com/latex.php?latex=f_%7Bm%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=f_%7Bm%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=f_%7Bm%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"f_{m}(x)\" class=\"latex\" /> corresponds to passing <img src=\"https://s0.wp.com/latex.php?latex=x&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=x&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=x&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"x\" class=\"latex\" /> down the tree <img src=\"https://s0.wp.com/latex.php?latex=f_%7Bm%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=f_%7Bm%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=f_%7Bm%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"f_{m}\" class=\"latex\" /> until it reaches a leaf node <img src=\"https://s0.wp.com/latex.php?latex=l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"l\" class=\"latex\" />. The predicted value is then equal to a parameter <img src=\"https://s0.wp.com/latex.php?latex=%5Cgamma_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cgamma_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cgamma_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;gamma_l\" class=\"latex\" />.</p>\n<p style=\"text-align:left;\">Decision trees consist of two types of parameters: region assignments <img src=\"https://s0.wp.com/latex.php?latex=R_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=R_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=R_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"R_i\" class=\"latex\" /> that assign a training example <img src=\"https://s0.wp.com/latex.php?latex=x_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=x_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=x_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"x_i\" class=\"latex\" /> to a leaf node <img src=\"https://s0.wp.com/latex.php?latex=l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"l\" class=\"latex\" />, and leaf outputs <img src=\"https://s0.wp.com/latex.php?latex=%5Cgamma_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cgamma_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cgamma_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;gamma_l\" class=\"latex\" /> that represent the tree&#8217;s output for all examples assigned to region <img src=\"https://s0.wp.com/latex.php?latex=R_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=R_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=R_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"R_l\" class=\"latex\" />. Hence we can write each weak learner <img src=\"https://s0.wp.com/latex.php?latex=f_%7Bm%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=f_%7Bm%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=f_%7Bm%7D%28x%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"f_{m}(x)\" class=\"latex\" /> as a parameterized tree <img src=\"https://s0.wp.com/latex.php?latex=h_%7Bm%7D%28x%3BR_%7Bm%7D%2C+%5Cgamma_%7Bm%7D%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=h_%7Bm%7D%28x%3BR_%7Bm%7D%2C+%5Cgamma_%7Bm%7D%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=h_%7Bm%7D%28x%3BR_%7Bm%7D%2C+%5Cgamma_%7Bm%7D%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"h_{m}(x;R_{m}, &#92;gamma_{m})\" class=\"latex\" />, giving:</p>\n<p style=\"text-align:center;\"><img src=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29%3D%5Csum_%7Bm%3D1%7D%5EM+f_%7Bm%7D%28x%29%3D%5Csum_%7Bm%3D1%7D%5EM+h_%7Bm%7D%28x%3B+R_%7Bm%7D%2C+%5Cgamma_%7Bm%7D%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29%3D%5Csum_%7Bm%3D1%7D%5EM+f_%7Bm%7D%28x%29%3D%5Csum_%7Bm%3D1%7D%5EM+h_%7Bm%7D%28x%3B+R_%7Bm%7D%2C+%5Cgamma_%7Bm%7D%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D%28x%29%3D%5Csum_%7Bm%3D1%7D%5EM+f_%7Bm%7D%28x%29%3D%5Csum_%7Bm%3D1%7D%5EM+h_%7Bm%7D%28x%3B+R_%7Bm%7D%2C+%5Cgamma_%7Bm%7D%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;hat{f}(x)=&#92;sum_{m=1}^M f_{m}(x)=&#92;sum_{m=1}^M h_{m}(x; R_{m}, &#92;gamma_{m})\" class=\"latex\" /></p>\n<p style=\"text-align:left;\">Gradient Boosting finds each tree in a stepwise fashion. We start with an initial tree <img src=\"https://s0.wp.com/latex.php?latex=f_1&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=f_1&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=f_1&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"f_1\" class=\"latex\" />, then step to another tree <img src=\"https://s0.wp.com/latex.php?latex=f_2&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=f_2&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=f_2&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"f_2\" class=\"latex\" />, and so on:</p>\n<p style=\"text-align:center;\"><img src=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D_%7B1%7D%28x%29+%3D+f_%7B1%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D_%7B1%7D%28x%29+%3D+f_%7B1%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D_%7B1%7D%28x%29+%3D+f_%7B1%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;hat{f}_{1}(x) = f_{1}\" class=\"latex\" /></p>\n<p style=\"text-align:center;\"><img src=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D_%7B2%7D%28x%29+%3D+f_%7B1%7D+%2B+f_%7B2%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D_%7B2%7D%28x%29+%3D+f_%7B1%7D+%2B+f_%7B2%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D_%7B2%7D%28x%29+%3D+f_%7B1%7D+%2B+f_%7B2%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;hat{f}_{2}(x) = f_{1} + f_{2}\" class=\"latex\" /></p>\n<p style=\"text-align:center;\">&#8230;</p>\n<p style=\"text-align:center;\"><img src=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D_%7BM%7D%28x%29+%3D+%5Csum_%7Bm%3D1%7D%5E%7BM%7Df_%7Bm%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D_%7BM%7D%28x%29+%3D+%5Csum_%7Bm%3D1%7D%5E%7BM%7Df_%7Bm%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Chat%7Bf%7D_%7BM%7D%28x%29+%3D+%5Csum_%7Bm%3D1%7D%5E%7BM%7Df_%7Bm%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;hat{f}_{M}(x) = &#92;sum_{m=1}^{M}f_{m}\" class=\"latex\" /></p>\n<p style=\"text-align:left;\">How do we determine the steps? At each step, we&#8217;d like the model to change such that the loss decreases as much as possible. The locally optimal decrease corresponds to the gradient of the loss with respect to the current model <img src=\"https://s0.wp.com/latex.php?latex=m&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=m&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=m&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"m\" class=\"latex\" />:</p>\n<p style=\"text-align:center;\"><img src=\"https://s0.wp.com/latex.php?latex=g_%7Bim%7D%3D%5Cfrac%7B%5Cpartial+L%5Bf%28x_i%29%2C+y_i%5D%7D%7B%5Cpartial+f%28x_i%29%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=g_%7Bim%7D%3D%5Cfrac%7B%5Cpartial+L%5Bf%28x_i%29%2C+y_i%5D%7D%7B%5Cpartial+f%28x_i%29%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=g_%7Bim%7D%3D%5Cfrac%7B%5Cpartial+L%5Bf%28x_i%29%2C+y_i%5D%7D%7B%5Cpartial+f%28x_i%29%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"g_{im}=&#92;frac{&#92;partial L[f(x_i), y_i]}{&#92;partial f(x_i)}\" class=\"latex\" /></p>\n<p style=\"text-align:left;\">Hence we define the step as <img src=\"https://s0.wp.com/latex.php?latex=f_m%3D-%5Crho_mg_m&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=f_m%3D-%5Crho_mg_m&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=f_m%3D-%5Crho_mg_m&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"f_m=-&#92;rho_mg_m\" class=\"latex\" />. This gives us insight into how Gradient Boosting solves the minimization &#8211; the algorithm is performing Gradient Descent in function space.</p>\n<p style=\"text-align:left;\">Now, we know that we want to take a gradient step, but still haven&#8217;t said how that translates to finding a tree. To do so, we build a tree that <em>models the gradient</em>; by adding such a tree to the ensemble, we effectively take a gradient step from the previous model. To fit the tree, we use squared error loss, giving the minimization problem:</p>\n<p style=\"text-align:center;\"><img src=\"https://s0.wp.com/latex.php?latex=argmin_%7BR%2C+%5Cgamma%7D%5Csum_%7Bi%3D1%7D%5EN%28-g_%7Bim%7D-F%28x_i%3BR%2C+%5Cgamma%29%29%5E2&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=argmin_%7BR%2C+%5Cgamma%7D%5Csum_%7Bi%3D1%7D%5EN%28-g_%7Bim%7D-F%28x_i%3BR%2C+%5Cgamma%29%29%5E2&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=argmin_%7BR%2C+%5Cgamma%7D%5Csum_%7Bi%3D1%7D%5EN%28-g_%7Bim%7D-F%28x_i%3BR%2C+%5Cgamma%29%29%5E2&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"argmin_{R, &#92;gamma}&#92;sum_{i=1}^N(-g_{im}-F(x_i;R, &#92;gamma))^2\" class=\"latex\" /></p>\n<p style=\"text-align:left;\">Where <img src=\"https://s0.wp.com/latex.php?latex=F%28x_i%3BR%2C+%5Cgamma%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=F%28x_i%3BR%2C+%5Cgamma%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=F%28x_i%3BR%2C+%5Cgamma%29&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"F(x_i;R, &#92;gamma)\" class=\"latex\" /> denotes a regression tree with parameters <img src=\"https://s0.wp.com/latex.php?latex=R%2C+%5Cgamma&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=R%2C+%5Cgamma&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=R%2C+%5Cgamma&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"R, &#92;gamma\" class=\"latex\" />.</p>\n<p style=\"text-align:left;\">Let&#8217;s take a step back. We&#8217;ve just set up a framework for finding an ensemble of trees that, when added together, minimizes a loss function. It&#8217;s a &#8220;framework&#8221; in the sense that we can use it if we merely supply gradients of the loss function at each training point. This is where the &#8220;Lambda&#8221; part of LambdaMART comes into play.</p>\n<p><span style=\"color:#999999;\">For further reading, Chapter 10 of <a style=\"color:#999999;\" href=\"http://statweb.stanford.edu/~tibs/ElemStatLearn/\">Elements of Statistical Learning</a> provides a great and thorough overview. <span style=\"color:#808080;\"><a style=\"color:#808080;\" href=\"http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3885826/\">This paper</a> </span>also provides a good intro of Gradient Boosting.</span></p>\n<p style=\"text-align:left;\"><strong>Lambda</strong></p>\n<p style=\"text-align:left;\">In ranking, the loss function that we&#8217;ll most likely care about optimizing is probably either NDCG, MAP, or MRR. Unfortunately, these loss functions aren&#8217;t differentiable at all points, so we can&#8217;t use them directly in our Gradient Boosting &#8220;framework&#8221;, since it&#8217;s unclear how we can provide the gradients at each training point.</p>\n<p style=\"text-align:left;\">To address this, LambdaMART uses an idea from a model called <span style=\"color:#808080;\"><a style=\"color:#808080;\" href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.180.634\">LambdaRank</a></span>. For each training point pair <img src=\"https://s0.wp.com/latex.php?latex=i%2Cj&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=i%2Cj&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=i%2Cj&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"i,j\" class=\"latex\" />, we compute a value <img src=\"https://s0.wp.com/latex.php?latex=%5Clambda_%7Bi%2Cj%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Clambda_%7Bi%2Cj%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Clambda_%7Bi%2Cj%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;lambda_{i,j}\" class=\"latex\" /> that acts as the gradient we need. Intuitively, <img src=\"https://s0.wp.com/latex.php?latex=%5Clambda_%7Bi%2Cj%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Clambda_%7Bi%2Cj%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Clambda_%7Bi%2Cj%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;lambda_{i,j}\" class=\"latex\" /> can be thought of as a force that moves documents up and down the ranked list. For instance, if document <img src=\"https://s0.wp.com/latex.php?latex=i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"i\" class=\"latex\" /> is ranked lower than document <img src=\"https://s0.wp.com/latex.php?latex=j&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=j&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=j&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"j\" class=\"latex\" />, then document <img src=\"https://s0.wp.com/latex.php?latex=i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"i\" class=\"latex\" /> will receive a push of size <img src=\"https://s0.wp.com/latex.php?latex=%7C%5Clambda_%7Bi%2Cj%7D%7C&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%7C%5Clambda_%7Bi%2Cj%7D%7C&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%7C%5Clambda_%7Bi%2Cj%7D%7C&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"|&#92;lambda_{i,j}|\" class=\"latex\" /> downwards in the ranked list, and <img src=\"https://s0.wp.com/latex.php?latex=j&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=j&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=j&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"j\" class=\"latex\" /> will be pushed upwards the same amount. The LambdaMART <span style=\"color:#808080;\"><a style=\"color:#808080;\" href=\"http://research-srv.microsoft.com/pubs/132652/MSR-TR-2010-82.pdf\">paper</a></span> reports that empirically, the <img src=\"https://s0.wp.com/latex.php?latex=%5Clambda&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Clambda&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Clambda&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;lambda\" class=\"latex\" />&#8216;s have been used successfully to optimize NDCG, MAP, and MRR.</p>\n<p style=\"text-align:left;\">Hence in LambdaMART we use the Gradient Boosting framework with the <img src=\"https://s0.wp.com/latex.php?latex=%5Clambda_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Clambda_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Clambda_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;lambda_i\" class=\"latex\" />&#8216;s acting as the gradients <img src=\"https://s0.wp.com/latex.php?latex=g_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=g_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=g_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"g_i\" class=\"latex\" />. This leads to update rules for the leaf values <img src=\"https://s0.wp.com/latex.php?latex=%5Cgamma_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cgamma_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cgamma_l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;gamma_l\" class=\"latex\" /> that depend on the <img src=\"https://s0.wp.com/latex.php?latex=%5Clambda&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Clambda&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Clambda&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;lambda\" class=\"latex\" /> values of the training instances that fall in leaf <img src=\"https://s0.wp.com/latex.php?latex=l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=l&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"l\" class=\"latex\" />.</p>\n<h2 style=\"text-align:center;\">Visualizing Gradient Boosting</h2>\n<p>We&#8217;ve observed that LambdaMART trains an ensemble of trees sequentially. What does this sequence of trees look like? Let&#8217;s look at an ensemble of 19 trees trained with LambdaMART on the OHSUMED dataset:</p>\n<p><a href=\"https://wellecks.files.wordpress.com/2015/02/ensemble.gif\"><img loading=\"lazy\" data-attachment-id=\"1075\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/ensemble-3/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/ensemble.gif\" data-orig-size=\"855,666\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"ensemble\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/ensemble.gif?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/ensemble.gif?w=525\" class=\"aligncenter size-full wp-image-1075\" src=\"https://wellecks.files.wordpress.com/2015/02/ensemble.gif?w=525&#038;h=409\" alt=\"ensemble\" width=\"525\" height=\"409\" /></a></p>\n<p>At each inner node, the small number denotes the feature label, and the larger number denotes the threshold. The number at each leaf node denotes the leaf output.</p>\n<p>We can see that each tree is somewhat similar to the previous tree. This makes sense given that each tree <img src=\"https://s0.wp.com/latex.php?latex=t_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=t_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=t_i&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"t_i\" class=\"latex\" /> is dependent on the model state <img src=\"https://s0.wp.com/latex.php?latex=F_%7Bi-1%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=F_%7Bi-1%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=F_%7Bi-1%7D&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"F_{i-1}\" class=\"latex\" /> since it is fit to the gradient with respect to that model&#8217;s gradient.</p>\n<p>The step-by-step animation gives us insight into what is happening during training. It&#8217;s a great way to visualize and gain an intuition of the gradient boosting process &#8211; we see consecutive trees being produced that depend on the previous tree. However, we are still viewing the LambdaMART model as a group of <em>separate</em> trees; we still need to develop a way of viewing the final model cohesively.</p>\n<p>Does the sequence animation tell us anything that could help with developing a single, cohesive model view? We can start with the observation that often, the trees look &#8220;roughly similar&#8221;.</p>\n<p>Sometimes two trees will have the same feature at a given node position; for instance the root favors features 7, 9, and 11. Trees may not even change from step-to-step or may share a similar overall structure, such as trees #3 and #4 &#8211; notice how the numbers change, but the structure remains the same. Finally, all of the trees only draw from a subset of the total feature set; for instance feature 4 is never used by any of the trees.</p>\n<p><strong>Grouping Similar Nodes</strong></p>\n<p>Given these observations, we can think about how to build a unified visualization that takes advantage of reused features and similar structure between trees. Let&#8217;s consider the root node. We can count the frequency of each feature that occurs as the root node across the entire ensemble, leading to a single node that shows that feature 7 was used as the feature for the root node for 3 trees, feature 9 for 5 trees, and so on:</p>\n<p style=\"text-align:center;\"><a href=\"https://wellecks.files.wordpress.com/2015/02/node1.png\"><img loading=\"lazy\" data-attachment-id=\"1077\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/node1/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/node1.png\" data-orig-size=\"622,564\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"node1\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/node1.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/node1.png?w=525\" class=\"aligncenter  wp-image-1077\" src=\"https://wellecks.files.wordpress.com/2015/02/node1.png?w=174&#038;h=142\" alt=\"node1\" width=\"174\" height=\"142\" /></a></p>\n<p>At each tree level <em>h</em>, there are <img src=\"https://s0.wp.com/latex.php?latex=2%5Eh&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=2%5Eh&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=2%5Eh&#038;bg=ffffff&#038;fg=404040&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"2^h\" class=\"latex\" /> possible node positions. We can collect the feature frequencies for each of these positions across the ensemble. If a position doesn&#8217;t appear in a tree, we mark it as &#8216;DNE&#8217;, and if a position is a leaf, we mark it as &#8216;Leaf&#8217;, such as position (3, 6):</p>\n<p style=\"text-align:center;\"><a href=\"https://wellecks.files.wordpress.com/2015/02/node2.png\"><img loading=\"lazy\" data-attachment-id=\"1078\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/node2/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/node2.png\" data-orig-size=\"600,562\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"node2\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/node2.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/node2.png?w=525\" class=\"aligncenter  wp-image-1078\" src=\"https://wellecks.files.wordpress.com/2015/02/node2.png?w=150&#038;h=141\" alt=\"node2\" width=\"150\" height=\"141\" srcset=\"https://wellecks.files.wordpress.com/2015/02/node2.png?w=150&h=141 150w, https://wellecks.files.wordpress.com/2015/02/node2.png?w=300&h=282 300w\" sizes=\"(max-width: 150px) 100vw, 150px\" /></a></p>\n<p style=\"text-align:center;\"><strong>Heatmap Tree</strong></p>\n<p>At each node, we have a list of feature (or DNE or Leaf) counts. Heatmaps provide a natural way of visualizing this count information. We can make each node of the ordered-pair-tree into a heatmap, giving rise to the &#8220;Heatmap Tree&#8221;:</p>\n<p style=\"text-align:center;\"><a href=\"http://heatmap-tree.herokuapp.com/\"><img data-attachment-id=\"1086\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/ohsumed_10_1_1_1/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png\" data-orig-size=\"1529,367\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"ohsumed_10_1_1_1\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=525\" class=\"aligncenter wp-image-1086 size-full\" src=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=525\" alt=\"ohsumed_10_1_1_1\" srcset=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=525 525w, https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=1050 1050w, https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=150 150w, https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=300 300w, https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=768 768w, https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=1024 1024w\" sizes=\"(max-width: 525px) 100vw, 525px\"   /></a></p>\n<p style=\"text-align:center;\"><span style=\"color:#808080;\">The Heatmap Tree</span></p>\n<p>To view the interactive d3.js visualization, see <span style=\"color:#808080;\"><a style=\"color:#808080;\" title=\"Heatmap Tree\" href=\"http://heatmap-tree.herokuapp.com/\">this link</a></span>.</p>\n<p>The Heatmap Tree shows the entire ensemble as a single unit. Each number is a feature, and the color scale tells us how many trees use that feature at the given node:</p>\n<p style=\"text-align:center;\"><a href=\"http://heatmap-tree.herokuapp.com/\"><img data-attachment-id=\"1120\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/screen-shot-2015-02-19-at-9-07-21-pm/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/screen-shot-2015-02-19-at-9-07-21-pm.png\" data-orig-size=\"404,103\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"Heatmap Detail\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/screen-shot-2015-02-19-at-9-07-21-pm.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/screen-shot-2015-02-19-at-9-07-21-pm.png?w=404\" class=\"aligncenter size-full wp-image-1120\" src=\"https://wellecks.files.wordpress.com/2015/02/screen-shot-2015-02-19-at-9-07-21-pm.png?w=525\" alt=\"Heatmap Detail\" srcset=\"https://wellecks.files.wordpress.com/2015/02/screen-shot-2015-02-19-at-9-07-21-pm.png 404w, https://wellecks.files.wordpress.com/2015/02/screen-shot-2015-02-19-at-9-07-21-pm.png?w=150 150w, https://wellecks.files.wordpress.com/2015/02/screen-shot-2015-02-19-at-9-07-21-pm.png?w=300 300w\" sizes=\"(max-width: 404px) 100vw, 404px\"   /></a></p>\n<p>By looking at the Heatmap Tree we can get a sense of which features the tree uses when it classifies instances. The ensemble uses features 7, 9, 11, 25, and 29 to perform the initial split, with 11 being used the most often. Further down the tree, we see features 7 and 9 again, along with common features such as 33 and 37. We can easily see that most of the trees in the ensemble are between 5 and 7 levels deep, and that while there are 46 total features, at a given node location the most variation we see is 9 features.</p>\n<p>The Heatmap Tree can bring together hundreds of trees, such as this visualization of a 325 tree ensemble:</p>\n<p style=\"text-align:center;\"><a href=\"https://wellecks.files.wordpress.com/2015/02/325.png\"><img loading=\"lazy\" data-attachment-id=\"1091\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/attachment/325/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/325.png\" data-orig-size=\"1538,443\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"325\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/325.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/325.png?w=525\" class=\"aligncenter size-full wp-image-1091\" src=\"https://wellecks.files.wordpress.com/2015/02/325.png?w=525&#038;h=151\" alt=\"325\" width=\"525\" height=\"151\" srcset=\"https://wellecks.files.wordpress.com/2015/02/325.png?w=525&h=151 525w, https://wellecks.files.wordpress.com/2015/02/325.png?w=1050&h=302 1050w, https://wellecks.files.wordpress.com/2015/02/325.png?w=150&h=43 150w, https://wellecks.files.wordpress.com/2015/02/325.png?w=300&h=86 300w, https://wellecks.files.wordpress.com/2015/02/325.png?w=768&h=221 768w, https://wellecks.files.wordpress.com/2015/02/325.png?w=1024&h=295 1024w\" sizes=\"(max-width: 525px) 100vw, 525px\" /></a></p>\n<p><strong>Tuning Parameters</strong></p>\n<p>The Heatmap Tree also lets us see how tuning parameters affect the final model. For instance, as we decrease the learning rate from 0.10 to 0.001, we see the ensemble size fluctuate:</p>\n<p style=\"text-align:center;\"><a href=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png\"><img loading=\"lazy\" data-attachment-id=\"1086\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/ohsumed_10_1_1_1/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png\" data-orig-size=\"1529,367\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"ohsumed_10_1_1_1\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=525\" class=\"aligncenter size-full wp-image-1086\" src=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=525&#038;h=126\" alt=\"ohsumed_10_1_1_1\" width=\"525\" height=\"126\" srcset=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=525&h=126 525w, https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=1050&h=252 1050w, https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=150&h=36 150w, https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=300&h=72 300w, https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=768&h=184 768w, https://wellecks.files.wordpress.com/2015/02/ohsumed_10_1_1_1.png?w=1024&h=246 1024w\" sizes=\"(max-width: 525px) 100vw, 525px\" /></a></p>\n<p style=\"text-align:center;\"><span style=\"color:#808080;\">Learning Rate 0.10</span></p>\n<p style=\"text-align:center;\"><a href=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png\"><img loading=\"lazy\" data-attachment-id=\"1080\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/ohsumed_fold2_10_01_1_1/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png\" data-orig-size=\"1533,449\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"ohsumed_fold2_10_01_1_1\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png?w=525\" class=\"aligncenter size-full wp-image-1080\" src=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png?w=525&#038;h=154\" alt=\"ohsumed_fold2_10_01_1_1\" width=\"525\" height=\"154\" srcset=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png?w=525&h=154 525w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png?w=1050&h=308 1050w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png?w=150&h=44 150w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png?w=300&h=88 300w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png?w=768&h=225 768w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_01_1_1.png?w=1024&h=300 1024w\" sizes=\"(max-width: 525px) 100vw, 525px\" /></a></p>\n<p style=\"text-align:center;\"><span style=\"color:#808080;\">Learning Rate 0.01</span></p>\n<p style=\"text-align:center;\"><a href=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png\"><img loading=\"lazy\" data-attachment-id=\"1081\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/ohsumed_fold2_10_001_1_1/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png\" data-orig-size=\"1506,418\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"ohsumed_fold2_10_001_1_1\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png?w=525\" class=\"aligncenter size-full wp-image-1081\" src=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png?w=525&#038;h=146\" alt=\"ohsumed_fold2_10_001_1_1\" width=\"525\" height=\"146\" srcset=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png?w=525&h=146 525w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png?w=1050&h=292 1050w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png?w=150&h=42 150w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png?w=300&h=83 300w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png?w=768&h=213 768w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_001_1_1.png?w=1024&h=284 1024w\" sizes=\"(max-width: 525px) 100vw, 525px\" /></a></p>\n<p style=\"text-align:center;\"><span style=\"color:#808080;\">Learning Rate 0.001</span></p>\n<p>Notice how in the 0.01 case, the Heatmap Tree concisely summarized a 111-tree ensemble.</p>\n<p>When we use feature subsampling, we see the number of features at each node increase (in general). Each tree has a different limited subset of features to choose from, leading to a spread in the overall distribution of chosen features:</p>\n<p style=\"text-align:center;\"><a href=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png\"><img loading=\"lazy\" data-attachment-id=\"1083\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/ohsumed_fold2_10_05_1_06/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png\" data-orig-size=\"1566,441\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"ohsumed_fold2_10_05_1_06\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png?w=525\" class=\"aligncenter size-full wp-image-1083\" src=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png?w=525&#038;h=148\" alt=\"ohsumed_fold2_10_05_1_06\" width=\"525\" height=\"148\" srcset=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png?w=525&h=148 525w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png?w=1050&h=296 1050w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png?w=150&h=42 150w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png?w=300&h=84 300w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png?w=768&h=216 768w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_1_06.png?w=1024&h=288 1024w\" sizes=\"(max-width: 525px) 100vw, 525px\" /></a></p>\n<p style=\"text-align:center;\"><span style=\"color:#808080;\">Feature subsampling 0.6</span></p>\n<p>Feature subsampling <em>and</em> training data subsampling makes this ensemble more crowded:</p>\n<p style=\"text-align:center;\"><a href=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png\"><img loading=\"lazy\" data-attachment-id=\"1084\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/ohsumed_fold2_10_05_06_06/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png\" data-orig-size=\"1550,438\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"ohsumed_fold2_10_05_06_06\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png?w=525\" class=\"aligncenter size-full wp-image-1084\" src=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png?w=525&#038;h=148\" alt=\"ohsumed_fold2_10_05_06_06\" width=\"525\" height=\"148\" srcset=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png?w=525&h=148 525w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png?w=1047&h=296 1047w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png?w=150&h=42 150w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png?w=300&h=85 300w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png?w=768&h=217 768w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_10_05_06_06.png?w=1024&h=289 1024w\" sizes=\"(max-width: 525px) 100vw, 525px\" /></a></p>\n<p style=\"text-align:center;\"><span style=\"color:#808080;\">Feature subsampling 0.6, Data subsampling 0.6</span></p>\n<p>Note that these parameter trends do not necessarily generalize. However, the Heatmap Tree captures all of the trees and features in a single structure, and gives us insight into the structural results of our parameter choices.</p>\n<p><strong>Limitations</strong></p>\n<p>The Heatmap Tree, unfortunately, has its limits. With wide variation of features and many leaves, the tree becomes crowded:</p>\n<p style=\"text-align:center;\"><a href=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png\"><img loading=\"lazy\" data-attachment-id=\"1085\" data-permalink=\"https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/ohsumed_fold2_25/#main\" data-orig-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png\" data-orig-size=\"1599,869\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\",\"orientation\":\"0\"}\" data-image-title=\"ohsumed_fold2_25\" data-image-description=\"\" data-image-caption=\"\" data-medium-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png?w=300\" data-large-file=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png?w=525\" class=\"aligncenter size-full wp-image-1085\" src=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png?w=525&#038;h=285\" alt=\"ohsumed_fold2_25\" width=\"525\" height=\"285\" srcset=\"https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png?w=525&h=285 525w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png?w=1050&h=570 1050w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png?w=150&h=82 150w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png?w=300&h=163 300w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png?w=768&h=417 768w, https://wellecks.files.wordpress.com/2015/02/ohsumed_fold2_25.png?w=1024&h=557 1024w\" sizes=\"(max-width: 525px) 100vw, 525px\" /></a></p>\n<p>Since the number of possible node locations at a given level increases exponentially with height, the tree also suffers when trying to visualize deep trees.</p>\n<p><strong>Expansions</strong></p>\n<p>Another nice aspect of decision trees is that we can visualize how a test instance gets classified; we simply show the path it takes from root to leaf.</p>\n<p>How could we visualize the classification process in an ensemble, via the Heatmap Tree or otherwise? With the Heatmap Tree, we would need to be able to simultaneously visualize 10&#8217;s or 100&#8217;s of paths, since there would be an individual path for every tree in the ensemble. One idea is to have weighted edges on the Heatmap Tree; an edge would become thicker each time the edge is used when classifying an instance.</p>\n<p>Another next step is to test the generalizability of this visualization; could it work for any gradient boosting model? What would a Heatmap Tree of a random forest look like?</p>\n<p><strong>Conclusion</strong></p>\n<p>We&#8217;ve taken a close look at LambdaMART and gradient boosting. We&#8217;ve devised a way to capture the complexity of gradient boosted tree ensembles in a cohesive way. In doing so we bought back some of the interpretability that we lost by moving from a single tree to an ensemble, gained insight into the training process, and made the black box LambdaMART model a bit more transparent.</p>\n<p>To see an interactive d3 Heatmap Tree, visit <span style=\"color:#808080;\"><a style=\"color:#808080;\" title=\"Heatmap Tree\" href=\"http://heatmap-tree.herokuapp.com\">this link</a></span>.</p>\n<p><strong>References and Further Reading</strong></p>\n<p><span style=\"color:#808080;\"><a style=\"color:#808080;\" href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.180.634\">From RankNet to LambdaRank to LambdaMART: An Overview</a></span></p>\n<p><span style=\"color:#808080;\"><a style=\"color:#808080;\" title=\"Gradient boosting machines, a tutorial\" href=\"http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3885826/\">Gradient Boosting Machines: A Tutorial</a></span></p>\n<p>“Tree Ensembles for Learning to Rank”, Yasser Ganjisaffar 2011 PhD Thesis</p>\n",
  "wfw:commentRss": "https://wellecks.wordpress.com/2015/02/21/peering-into-the-black-box-visualizing-lambdamart/feed/",
  "slash:comments": 0,
  "media:content": [
    {
      "media:title": "wellecks"
    },
    {
      "media:title": "tree"
    },
    {
      "media:title": "Ensemble of Trees"
    },
    {
      "media:title": "ensemble"
    },
    {
      "media:title": "node1"
    },
    {
      "media:title": "node2"
    },
    {
      "media:title": "ohsumed_10_1_1_1"
    },
    {
      "media:title": "Heatmap Detail"
    },
    {
      "media:title": 325
    },
    {
      "media:title": "ohsumed_10_1_1_1"
    },
    {
      "media:title": "ohsumed_fold2_10_01_1_1"
    },
    {
      "media:title": "ohsumed_fold2_10_001_1_1"
    },
    {
      "media:title": "ohsumed_fold2_10_05_1_06"
    },
    {
      "media:title": "ohsumed_fold2_10_05_06_06"
    },
    {
      "media:title": "ohsumed_fold2_25"
    }
  ]
}