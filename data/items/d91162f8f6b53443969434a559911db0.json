{
  "title": "Deploying static sites with Github Actions",
  "link": "",
  "published": "2020-12-09T00:00:00-08:00",
  "updated": "2022-11-03T04:16:07-07:00",
  "author": {
    "name": "Greg Reda"
  },
  "id": "tag:www.gregreda.com,2020-12-09:/2020/12/09/deploying-static-sites-with-github-actions/",
  "summary": "<p>A while back I <a href=\"http://gregreda.com/2015/03/26/static-site-deployments/\">wrote</a> about deploying my site using Github and Travis CI. But recently it seems <a href=\"https://news.ycombinator.com/item?id=25338983\">Travis CI stopped being free for open source projects</a>.</p>\n<p>If you're using a static site generator for your site and hosting it on it on S3, you can use <a href=\"https://docs.github.com/en/free-pro-team@latest/actions\">Github Actions</a> to â€¦</p>",
  "content": "<p>A while back I <a href=\"http://gregreda.com/2015/03/26/static-site-deployments/\">wrote</a> about deploying my site using Github and Travis CI. But recently it seems <a href=\"https://news.ycombinator.com/item?id=25338983\">Travis CI stopped being free for open source projects</a>.</p>\n<p>If you're using a static site generator for your site and hosting it on it on S3, you can use <a href=\"https://docs.github.com/en/free-pro-team@latest/actions\">Github Actions</a> to build and deploy your site on each commit (or PR, or whatever).</p>\n<h2>Setup</h2>\n<p>If you've already set up Travis CI to deploy your site to S3, switching to Github Actions won't be very difficult.</p>\n<p>Actions are defined in YAML and need to live at a path of <code>.github/workflows</code> within your repo. We'll name ours <code>deploy.yml</code>, so its path will be <code>.github/workflows/deploy.yml</code>.</p>\n<p>Before defining our workflow steps, we'll want to add any necessary secret passwords, keys, tokens, and such to our repo's <a href=\"https://docs.github.com/en/free-pro-team@latest/actions/reference/encrypted-secrets\">encryped secrets</a>. This will allow them to be accessed by the workflow, but securely stored and only visible to those with access to the repo.</p>\n<p>Since my site is hosted using S3 and Cloudfront, I'll need secrets for my AWS access keys.</p>\n<p><img alt=\"My repo's Github Secrets page\" src=\"/images/github-secrets.png\"></p>\n<p>Next, we'll create our <code>deploy.yml</code> file. Github kindly supplies <a href=\"https://github.com/actions/starter-workflows\">starter workflows</a> in many languages, but since this site uses Pelican, a static site generator for Python, we'll use the <a href=\"https://docs.github.com/en/free-pro-team@latest/actions/guides/building-and-testing-python\">Python starter workflow</a>.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">deploy</span><span class=\"w\"></span>\n<span class=\"nt\">on</span><span class=\"p\">:</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">push</span><span class=\"p\">:</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">branches</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span><span class=\"nv\">master</span><span class=\"p p-Indicator\">]</span><span class=\"w\"></span>\n<span class=\"nt\">jobs</span><span class=\"p\">:</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">deploy</span><span class=\"p\">:</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">runs-on</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">ubuntu-latest</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">steps</span><span class=\"p\">:</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">actions/checkout@v2</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Set up Python</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">actions/setup-python@v2</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">with</span><span class=\"p\">:</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">python-version</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s\">&#39;2.7&#39;</span><span class=\"w\"></span>\n</code></pre></div>\n\n<p>Yes, I'm still using a very old version of Pelican with Python 2.7. I swear I use Python3 everywhere else.</p>\n<p>Since we're deploying to S3, we'll need to add a step for configuring our AWS credentials using the <a href=\"https://github.com/marketplace/actions/configure-aws-credentials-action-for-github-actions\">configure credentials action</a>. The <code>aws-region</code> should match whichever region your bucket is in.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Configure AWS credentials</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">uses</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">aws-actions/configure-aws-credentials@v1</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">with</span><span class=\"p\">:</span><span class=\"w\"> </span>\n<span class=\"w\">        </span><span class=\"nt\">aws-access-key-id</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">${{ secrets.AWS_ACCESS_KEY_ID }}</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">aws-secret-access-key</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">${{ secrets.AWS_SECRET_ACCESS_KEY }}</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">aws-region</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">us-east-1</span><span class=\"w\"></span>\n</code></pre></div>\n\n<p>Because my website's repo uses <a href=\"https://git-scm.com/book/en/v2/Git-Tools-Submodules\">git submodules</a>, I need to add another step for checking out and updating these submodules on each build.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Build submodules</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"no\">sed -i &#39;s/git@github.com:/https:\\/\\/github.com\\//&#39; .gitmodules</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"no\">git submodule update --init --recursive</span><span class=\"w\"></span>\n</code></pre></div>\n\n<p>We also need to <code>pip install</code> any dependencies from <code>requirements.txt</code>, like Pelican.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Install dependencies</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"no\">sudo apt-get install -qq pandoc</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"no\">python -m pip install --upgrade pip</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"no\">pip install -r requirements.txt</span><span class=\"w\"></span>\n</code></pre></div>\n\n<p>And finally, we can build our site, deploy it to S3, and invalidate the Cloudfront cache.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Build website</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"no\">pelican content</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Deploy to S3</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"no\">aws s3 sync output/. s3://www.gregreda.com --acl public-read</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"nt\">name</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"l l-Scalar l-Scalar-Plain\">Invalidate Cloudfront cache</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">run</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"no\">aws configure set preview.cloudfront true</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"no\">aws cloudfront create-invalidation --distribution-id ${{ secrets.AWS_CLOUDFRONT_DISTRIBUTION_ID }} --paths &quot;/*&quot;</span><span class=\"w\"></span>\n</code></pre></div>\n\n<p>Putting it all together gives us <a href=\"https://github.com/gjreda/gregreda.com/blob/master/.github/workflows/deploy.yml\">this YAML file</a>, which builds and deploys this website on every commit to <code>master</code>.</p>\n<p>That's it. Continuous deployment for your S3 hosted website.</p>",
  "category": [
    "",
    "",
    ""
  ]
}