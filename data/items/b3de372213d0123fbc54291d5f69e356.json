{
  "title": "Evaluating BreakoutDetection",
  "description": "<p>A couple of weeks ago, Twitter open-sourced their <a href=\"https://blog.twitter.com/2014/breakout-detection-in-the-wild\">BreakoutDetection</a> package for R, a package designed to determine shifts in time-series data. The <a href=\"https://blog.twitter.com/2014/breakout-detection-in-the-wild\">Twitter announcement</a> does a great job of explaining the main technique for detection (E-Divisive with Medians), so I won’t rehash that material here. Rather, I wanted to see how this package works relative to the <a href=\"http://randyzwitch.com/anomaly-detection-adobe-analytics-api/\">anomaly detection</a> feature in the Adobe Analytics API, which I’ve <a href=\"http://randyzwitch.com/anomaly-detection-adobe-analytics-api/\">written about previously</a>.</p>",
  "pubDate": "Thu, 06 Nov 2014 21:24:00 +0000",
  "link": "http://randyzwitch.com/twitter-breakoutdetection-r-package-evaluation/",
  "guid": "http://randyzwitch.com/twitter-breakoutdetection-r-package-evaluation/",
  "content": "<p>A couple of weeks ago, Twitter open-sourced their <a href=\"https://blog.twitter.com/2014/breakout-detection-in-the-wild\">BreakoutDetection</a> package for R, a package designed to determine shifts in time-series data. The <a href=\"https://blog.twitter.com/2014/breakout-detection-in-the-wild\">Twitter announcement</a> does a great job of explaining the main technique for detection (E-Divisive with Medians), so I won’t rehash that material here. Rather, I wanted to see how this package works relative to the <a href=\"http://randyzwitch.com/anomaly-detection-adobe-analytics-api/\">anomaly detection</a> feature in the Adobe Analytics API, which I’ve <a href=\"http://randyzwitch.com/anomaly-detection-adobe-analytics-api/\">written about previously</a>.</p>\n\n<h2 id=\"getting-time-series-data-using-rsitecatalyst\">Getting Time-Series Data Using RSiteCatalyst</h2>\n\n<p>To use a real-world dataset to evaluate this package, I’m going to use roughly ten months of daily pageviews generated from my blog. The hypothesis here is that if the BreakoutDetection package works well, it should be able to detect the boundaries around when I publish a blog post (of which the dates I know with certainty) and when articles of mine get shared on sites such as Reddit. From past experience, I get about a 3-day lift in pageviews post-publishing, as the article gets tweeted out, published on <a href=\"http://www.r-bloggers.com/\">R-Bloggers</a> or <a href=\"http://www.juliabloggers.com/\">JuliaBloggers</a> and shared accordingly.</p>\n\n<p>Here’s the code to get daily pageviews using <a href=\"http://cran.r-project.org/web/packages/RSiteCatalyst/index.html\" title=\"RSiteCatalyst\">RSiteCatalyst</a> (Adobe Analytics):</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n</pre></td><td class=\"code\"><pre><span class=\"c1\">#Installing BreakoutDetection package</span><span class=\"w\">\n</span><span class=\"n\">install.packages</span><span class=\"p\">(</span><span class=\"s2\">\"devtools\"</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">devtools</span><span class=\"o\">::</span><span class=\"n\">install_github</span><span class=\"p\">(</span><span class=\"s2\">\"twitter/BreakoutDetection\"</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">BreakoutDetection</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"s2\">\"RSiteCatalyst\"</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">SCAuth</span><span class=\"p\">(</span><span class=\"s2\">\"company\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"secret\"</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#Get pageviews for each day in 2014</span><span class=\"w\">\n</span><span class=\"n\">pageviews_2014</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">QueueOvertime</span><span class=\"p\">(</span><span class=\"s1\">'report-suite'</span><span class=\"p\">,</span><span class=\"w\">\n                               </span><span class=\"n\">date.from</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s1\">'2014-02-24'</span><span class=\"p\">,</span><span class=\"w\">\n                               </span><span class=\"n\">date.to</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s1\">'2014-11-05'</span><span class=\"p\">,</span><span class=\"w\">\n                               </span><span class=\"n\">metric</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s1\">'pageviews'</span><span class=\"p\">,</span><span class=\"w\">\n                               </span><span class=\"n\">date.granularity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s1\">'day'</span><span class=\"p\">)</span><span class=\"w\">\n\n</span><span class=\"c1\">#v1.0.1 of package requires specific column names and dataframe format</span><span class=\"w\">\n</span><span class=\"n\">formatted_df</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">pageviews_2014</span><span class=\"p\">[,</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"datetime\"</span><span class=\"p\">,</span><span class=\"s2\">\"pageviews\"</span><span class=\"p\">)]</span><span class=\"w\">\n</span><span class=\"nf\">names</span><span class=\"p\">(</span><span class=\"n\">formatted_df</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"timestamp\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"count\"</span><span class=\"p\">)</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>One thing to notice here is that BreakoutDetection requires either a single R vector or a specifically formatted data frame. In this case, because I have a timestamp, I use lines 17-18 to get the data into the required format.</p>\n\n<h2 id=\"breakoutdetection---default-example\">BreakoutDetection - Default Example</h2>\n\n<p>In the Twitter announcement, they provide an example, so let’s evaluate those defaults first:</p>\n\n<p><img src=\"/wp-content/uploads/2014/11/breakoutdetection-defaults.png\" alt=\"breakoutdetection-defaults\" /></p>\n\n<p>In order to validate my hypothesis, the package would need to detect 12 ‘breakouts’ or so, as I’ve published 12 blog posts during the sample time period. Mentally drawing lines between the red boundaries, we can see three definitive upward mean shifts, but far fewer than the 12 I expected.</p>\n\n<h2 id=\"breakoutdetection---modifying-the-parameters\">BreakoutDetection - Modifying The Parameters</h2>\n\n<p>Given that the chart above doesn’t fit how I think my data are generated, we can modify two main parameters: beta and min.size. From the documentation:</p>\n\n<blockquote>\n  <p>beta: A real numbered constant used to further control the amount of penalization. This is the default form of penalization, if neither (or both) beta or (and) percent are supplied this argument will be used. The default value is beta=0.008.</p>\n\n  <p>min.size:  The minimum number of observations between change points</p>\n</blockquote>\n\n<p>The first parameter I’m going to experiment with is min.size, because it requires no in-depth knowledge of the EDM technique! The value used in the first example was 24 (days) between intervals, which seems extreme in my case. It’s reasonable that I might publish a blog post per week, so let’s back that number down to 5 and see how the result changes:</p>\n\n<p><img src=\"/wp-content/uploads/2014/11/breakout-5.png\" alt=\"breakout-5\" /></p>\n\n<p>With 17 predicted intervals, we’ve somewhat overshot the number of blog posts mark. Not that the package is wrong per se; the boundaries are surrounding many of the spikes in the data, but perhaps having this many breakpoints isn’t useful from a monitoring standpoint. So setting the min.size parameter somewhere between 5 and 24 points would give us more than 3 breakouts, but less than 17. There is also the <code class=\"language-plaintext highlighter-rouge\">beta</code> parameter that can be played with, but I’ll leave that as an exercise for another day.</p>\n\n<h2 id=\"anomaly-detection---adobe-analytics\">Anomaly Detection - Adobe Analytics</h2>\n\n<p>From my prior post about <a href=\"http://randyzwitch.com/anomaly-detection-adobe-analytics-api/\">Anomaly Detection with the Adobe Analytics API</a>, Adobe has chosen to use Holt-Winters/Exponential Smoothing as their technique. Here’s what that looks like for the same time-period (code as <a href=\"http://randyzwitch.com/wp-content/uploads/2014/11/adobe_anomaly.png\">GitHub Gist</a>):</p>\n\n<p><img src=\"/wp-content/uploads/2014/11/adobe_analytics.png\" alt=\"adobe_analytics\" /></p>\n\n<p>Even though the idea of both techniques are similar, it’s clear that the two methods don’t quite represent the same thing. In the case of the Adobe Analytics Anomaly Detection, it’s looking datapoint-by-datapoint, with a smoothing model built from the prior 35 points. If a point exceeds the <code class=\"language-plaintext highlighter-rouge\">upper-</code> or <code class=\"language-plaintext highlighter-rouge\">lower-control</code> limits, then it’s an anomaly, but not necessarily indicative of a true level shift like the BreakoutDetection package is measuring.</p>\n\n<h2 id=\"conclusion\">Conclusion</h2>\n\n<p>The <a href=\"https://github.com/twitter/BreakoutDetection\">BreakoutDetection package</a> is definitely cool, but it is a bit raw, especially the default graphics. But the package definitely does work, as evidenced by how well it put boundaries around the traffic spikes when I set the <code class=\"language-plaintext highlighter-rouge\">min.size</code> parameter equal to five.</p>\n\n<p>Additionally, I tried to read more about the underlying methodology, but the only references that come up in Google seem to be references to the R package itself! I wish I had a better feeling for how the beta parameter influences the graph, but I guess that will come over time as I use the package more. But I’m definitely glad that Twitter open-sourced this package, as I’ve often wondered about how to detect level shifts in a more operational setting, and now I have a method to do so.</p>"
}