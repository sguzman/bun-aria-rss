{
  "title": "How thermal simulation helps optimize Meta’s data centers",
  "link": "https://engineering.fb.com/2022/09/14/data-center-engineering/data-centers-meta-thermal-simulation-optimization/",
  "dc:creator": "",
  "pubDate": "Wed, 14 Sep 2022 16:00:21 +0000",
  "category": "Data Center Engineering",
  "guid": "https://engineering.fb.com/?p=19218",
  "description": "<p>Data center optimization has always played an important role at Meta. By optimizing our data centers’ environmental controls, we can reduce our environmental impact  while ensuring that people can always depend on our products. With most other complex systems, optimization of energy consumption is a trial-and-error process. But experimenting on any component of a live [...]</p>\n<p><a class=\"btn btn-secondary understrap-read-more-link\" href=\"https://engineering.fb.com/2022/09/14/data-center-engineering/data-centers-meta-thermal-simulation-optimization/\">Read More...</a></p>\n<p>The post <a rel=\"nofollow\" href=\"https://engineering.fb.com/2022/09/14/data-center-engineering/data-centers-meta-thermal-simulation-optimization/\">How thermal simulation helps optimize Meta’s data centers</a> appeared first on <a rel=\"nofollow\" href=\"https://engineering.fb.com\">Engineering at Meta</a>.</p>\n",
  "content:encoded": "<p><span style=\"font-weight: 400;\">Data center optimization has always played an important role at Meta. By </span><a href=\"https://tech.fb.com/engineering/2021/03/sustainable-computing/\"><span style=\"font-weight: 400;\">optimizing our data centers’</span></a><span style=\"font-weight: 400;\"> environmental controls, we can reduce our </span><a href=\"https://tech.fb.com/engineering/2021/06/sustainability-2020/\"><span style=\"font-weight: 400;\">environmental impact </span></a><span style=\"font-weight: 400;\"> while ensuring that people can always depend on our products.</span></p>\n<p><span style=\"font-weight: 400;\">With most other complex systems, </span><a href=\"https://www.sciencedirect.com/science/article/abs/pii/S1364032115016664\"><span style=\"font-weight: 400;\">optimization of energy consumption</span></a><span style=\"font-weight: 400;\"> is a trial-and-error process. But experimenting on any component of a live data center is risky, as a single miscalculation could cause issues like </span><a href=\"https://engineering.fb.com/2021/12/16/data-center-engineering/power-loss-siren/\"><span style=\"font-weight: 400;\">power loss events</span></a><span style=\"font-weight: 400;\">. To help make sure our data centers are always performing at their best, we have developed a digital simulator that replicates the facilities’ cooling and thermal behavior. With our simulation, we can test control policies using either AI or model predictive control — a set of algorithms that interact with the model to predict a data center’s response to particular conditions. Unlike similar systems trained on historical data, our simulator accurately represents even the most extreme circumstances, including hypothetical scenarios, and it can make quantitative predictions for data centers that have not yet been built.</span></p>\n<p><span style=\"font-weight: 400;\">Model predictive control has proved to be a powerful optimization strategy in recent years, but it requires a highly accurate model of the system to be effective. For the best possible simulation, we have maximized the strengths of two different approaches. First, we developed a physics-based model — embedding it with equations that describe thermal processes relevant to our data centers — so that our simulator respects the principles of physics when representing new situations. We combined that method with statistical data science to leverage the knowledge we have gathered in our large fleet of data centers.</span></p>\n<h2><span style=\"font-weight: 400;\">Why a physics-based thermal simulator?</span></h2>\n<p><span style=\"font-weight: 400;\">Using measurements from the many sensors in our facilities, we can create numerical models that predict the energy consumption of the building. These models, although highly accurate, may not generalize well about situations outside the normal operating conditions reflected in the training data.</span></p>\n<p><span style=\"font-weight: 400;\">To quantify and visualize the fluid dynamics of our data centers, Meta works extensively with detailed physics-based models called computational fluid dynamics (CFD) simulations. We can study previously unseen conditions and designs with these models, but they demand a significant amount of computational power, and they take a long time to run.</span></p>\n<p><span style=\"font-weight: 400;\">Thermal simulators, or gray box models, open a realm of new opportunities beyond data science approaches and CFD. They solve thermal balance equations to describe the conditions in an individual room or even row in a facility, producing results quickly and with little input data. We can use the output to understand our data centers’ reactions to extreme weather conditions or to train a reinforcement learning algorithm, an AI system that finds the optimal solution through trial and error in a virtual environment.</span></p>\n<h2><span style=\"font-weight: 400;\">Building a thermal simulator</span><span style=\"font-weight: 400;\"> </span></h2>\n<p><span style=\"font-weight: 400;\">Our dynamic model combines first-principle physics with building-modeling languages, including </span><a href=\"https://modelica.org/modelicalanguage.html\" target=\"_blank\" rel=\"noopener\"><span style=\"font-weight: 400;\">Modelica</span></a><span style=\"font-weight: 400;\">. To simulate a particular data hall, we first need static, site-specific details about the facility’s geometry, construction materials, and HVAC, as well as its system configurations and component efficiencies. Then we numerically re-create the control strategies (using the <a href=\"https://obc.lbl.gov/specification/cdl.html\">control Description Language</a>) governing the behavior of all the HVAC and water equipment as functions of the indoor and outdoor conditions.</span></p>\n<p><img decoding=\"async\" loading=\"lazy\" class=\"alignnone size-medium wp-image-19279\" src=\"https://engineering.fb.com/wp-content/uploads/2022/08/301343926_536545324911389_3944466945410229977_n.jpg?w=916\" alt=\"\" width=\"916\" height=\"547\" srcset=\"https://engineering.fb.com/wp-content/uploads/2022/08/301343926_536545324911389_3944466945410229977_n.jpg 1073w, https://engineering.fb.com/wp-content/uploads/2022/08/301343926_536545324911389_3944466945410229977_n.jpg?resize=916,547 916w, https://engineering.fb.com/wp-content/uploads/2022/08/301343926_536545324911389_3944466945410229977_n.jpg?resize=768,459 768w, https://engineering.fb.com/wp-content/uploads/2022/08/301343926_536545324911389_3944466945410229977_n.jpg?resize=1024,612 1024w, https://engineering.fb.com/wp-content/uploads/2022/08/301343926_536545324911389_3944466945410229977_n.jpg?resize=96,57 96w, https://engineering.fb.com/wp-content/uploads/2022/08/301343926_536545324911389_3944466945410229977_n.jpg?resize=192,115 192w\" sizes=\"(max-width: 992px) 100vw, 62vw\" /></p>\n<p><span style=\"font-weight: 400;\">Once those tasks are complete, we can begin to input data. We choose variables whose impact we want to understand, such as temperature, energy, and water consumption, and we describe them as a time series.</span></p>\n<h2><span style=\"font-weight: 400;\">Example case: A severe winter storm in Texas</span></h2>\n<p><span style=\"font-weight: 400;\">Our data science–based models are typically very accurate when predicting a data hall’s thermal response to normal temperature ranges. But to keep our services running and avoid damage to hardware, we must also understand how data centers behave in extreme conditions that put water and power infrastructure under high stress. We don’t have the data necessary to train a data science–based model to represent severe cases, but a thermal simulator can mimic these situations and predict the effects of our response strategies.</span></p>\n<p><span style=\"font-weight: 400;\">To demonstrate the capability of our simulators, we studied the response of one of our data centers to a severe winter storm in Texas in February 2021. This unprecedented multi-day winter storm started with a 70˚F temperature swing, dropping the temperature below freezing for 10 days and reaching as low as -2˚F.</span></p>\n<p><img decoding=\"async\" loading=\"lazy\" class=\"alignnone size-medium wp-image-19280\" src=\"https://engineering.fb.com/wp-content/uploads/2022/08/301018347_1434478590363858_5086858272074275758_n.jpg?w=916\" alt=\"\" width=\"916\" height=\"651\" srcset=\"https://engineering.fb.com/wp-content/uploads/2022/08/301018347_1434478590363858_5086858272074275758_n.jpg 1024w, https://engineering.fb.com/wp-content/uploads/2022/08/301018347_1434478590363858_5086858272074275758_n.jpg?resize=916,651 916w, https://engineering.fb.com/wp-content/uploads/2022/08/301018347_1434478590363858_5086858272074275758_n.jpg?resize=768,546 768w, https://engineering.fb.com/wp-content/uploads/2022/08/301018347_1434478590363858_5086858272074275758_n.jpg?resize=96,68 96w, https://engineering.fb.com/wp-content/uploads/2022/08/301018347_1434478590363858_5086858272074275758_n.jpg?resize=192,137 192w\" sizes=\"(max-width: 992px) 100vw, 62vw\" /></p>\n<p><span style=\"font-weight: 400;\">We input the conditions recorded at midnight on February 7, 2021, and then let our thermal simulator run on the time series of the following 15 days’ temperature set point, supply fan airflow, set point, and server load of the supply airflow entering the data hall. We did not add any operational data other than these four parameters.</span></p>\n<p><span style=\"font-weight: 400;\">Below is the command of our HVAC economizer — which controls the mixing of hot and cold air — attempting to stabilize the data hall’s internal temperature. The signal varies from 15 to 100 percent, or nearly the full system range. The simulator was able to predict this behavior accurately.</span></p>\n<p><img decoding=\"async\" loading=\"lazy\" class=\"alignnone size-medium wp-image-19281\" src=\"https://engineering.fb.com/wp-content/uploads/2022/08/301242350_812119446464164_3630338259482238337_n.jpg?w=821\" alt=\"\" width=\"821\" height=\"537\" srcset=\"https://engineering.fb.com/wp-content/uploads/2022/08/301242350_812119446464164_3630338259482238337_n.jpg 821w, https://engineering.fb.com/wp-content/uploads/2022/08/301242350_812119446464164_3630338259482238337_n.jpg?resize=768,502 768w, https://engineering.fb.com/wp-content/uploads/2022/08/301242350_812119446464164_3630338259482238337_n.jpg?resize=96,63 96w, https://engineering.fb.com/wp-content/uploads/2022/08/301242350_812119446464164_3630338259482238337_n.jpg?resize=192,126 192w\" sizes=\"(max-width: 992px) 100vw, 62vw\" /></p>\n<p><span style=\"font-weight: 400;\">It’s important to closely monitor the temperature of the supply air entering the data halls, which is affected by both the outside temperature and the heat from the server rooms. To simulate this variable, we must build a model of the full control loop (the command above is an example), mechanical equipment, and server room, using only physical principles, without fitting into sensor data.</span></p>\n<p><span style=\"font-weight: 400;\">The figure below shows the simulated and measured supply air temperatures relative to the temperature set point over the 15-day period we studied. We noted a mean absolute error (MAE) of 0.5</span><span style=\"font-weight: 400;\">˚</span><span style=\"font-weight: 400;\">F for the supply air temperature over the whole period. The MAE has a normal distribution centered at 0</span><span style=\"font-weight: 400;\">˚</span><span style=\"font-weight: 400;\">F (right panel), indicating no systematic bias or drift in our model for the 15-day period of predictive modeling. Additionally, our model accurately simulated the dynamics of the control system that regulates the temperature around the set point, as is particularly evident in the first and last days of this time span. Again, no operational data other than outside air conditions, temperature set point, supply fan airflow set point, and server load were entered in this simulation, demonstrating that the model was truly predictive in this extreme scenario.</span></p>\n<p><img decoding=\"async\" loading=\"lazy\" class=\"alignnone size-medium wp-image-19282\" src=\"https://engineering.fb.com/wp-content/uploads/2022/08/300982325_641371857200200_3084380245276530234_n.webp?w=916\" alt=\"\" width=\"916\" height=\"469\" srcset=\"https://engineering.fb.com/wp-content/uploads/2022/08/300982325_641371857200200_3084380245276530234_n.webp 1958w, https://engineering.fb.com/wp-content/uploads/2022/08/300982325_641371857200200_3084380245276530234_n.webp?resize=916,469 916w, https://engineering.fb.com/wp-content/uploads/2022/08/300982325_641371857200200_3084380245276530234_n.webp?resize=768,393 768w, https://engineering.fb.com/wp-content/uploads/2022/08/300982325_641371857200200_3084380245276530234_n.webp?resize=1024,524 1024w, https://engineering.fb.com/wp-content/uploads/2022/08/300982325_641371857200200_3084380245276530234_n.webp?resize=1536,786 1536w, https://engineering.fb.com/wp-content/uploads/2022/08/300982325_641371857200200_3084380245276530234_n.webp?resize=96,49 96w, https://engineering.fb.com/wp-content/uploads/2022/08/300982325_641371857200200_3084380245276530234_n.webp?resize=192,98 192w\" sizes=\"(max-width: 992px) 100vw, 62vw\" /></p>\n<p><span style=\"font-weight: 400;\">The supply air temperature was steady compared with the plunging temperatures outside, and our simulator also captured that accurately.</span></p>\n<p><span style=\"font-weight: 400;\">We have also validated the simulator on 24 random dates throughout 2021. Our simulator accurately modeled the data center’s response on these dates — which represented a wide range of weather conditions — achieving an MAE of 1.3</span><span style=\"font-weight: 400;\">˚</span><span style=\"font-weight: 400;\">F for the supply air temperature.</span></p>\n<h2><span style=\"font-weight: 400;\">Future research for thermal simulation</span></h2>\n<p><span style=\"font-weight: 400;\">According to the International Energy Agency, </span><a href=\"https://www.iea.org/reports/data-centres-and-data-transmission-networks\"><span style=\"font-weight: 400;\">data centers consume</span></a><span style=\"font-weight: 400;\"> about 1 percent of global electricity demand, contributing to 0.3 percent of all global CO</span><span style=\"font-weight: 400;\">2</span><span style=\"font-weight: 400;\"> emissions. In this context, Meta’s operational data centers have achieved </span><a href=\"https://tech.fb.com/ideas/2020/09/facebooks-path-to-net-zero/\"><span style=\"font-weight: 400;\">net zero carbon</span></a><span style=\"font-weight: 400;\"> emissions, are LEED Gold certified, and are supported by 100 percent renewable energy. They use 32 percent less energy and are 80 percent more water-efficient on average than the industry standard. Meta is committed to restoring more </span><a href=\"https://tech.fb.com/engineering/2021/08/facebook-is-committed-to-being-water-positive-by-2030/\"><span style=\"font-weight: 400;\">water</span></a><span style=\"font-weight: 400;\"> than we consume by 2030, and we hope our simulator will help us continue to cut our resource consumption and ensure that our operations are resilient.</span></p>\n<p><span style=\"font-weight: 400;\">To conserve even more resources, the Physical Modeling Team at Meta is now training our simulator to predict and optimize our data centers’ energy and water consumption, so we can use it to optimize the control strategy and to test new facility and equipment designs. We also work closely with the data science and AI teams at Meta to couple these models with different machine learning methods, such as reinforcement learning, to predict the best set of operating points in real time. Additionally, we’re exploring other novel modeling approaches, combining recent advances in physical sciences and machine learning to find cross-functional approaches that will further improve the efficiency, reliability, and sustainability of our infrastructure.</span></p>\n<p>&nbsp;</p>\n<p>The post <a rel=\"nofollow\" href=\"https://engineering.fb.com/2022/09/14/data-center-engineering/data-centers-meta-thermal-simulation-optimization/\">How thermal simulation helps optimize Meta’s data centers</a> appeared first on <a rel=\"nofollow\" href=\"https://engineering.fb.com\">Engineering at Meta</a>.</p>\n",
  "post-id": 19218
}