{
  "title": "fMRI In Neuroscience: Efficiency of Event-related Experiment Designs",
  "link": "https://theclevermachine.wordpress.com/2013/01/14/fmri-in-neuroscience-efficiency-of-event-related-experiment-designs/",
  "comments": "https://theclevermachine.wordpress.com/2013/01/14/fmri-in-neuroscience-efficiency-of-event-related-experiment-designs/#respond",
  "dc:creator": "dustinstansbury",
  "pubDate": "Tue, 15 Jan 2013 07:51:23 +0000",
  "category": [
    "fMRI",
    "Regression",
    "Simulations",
    "Statistics",
    "BOLD Power Spectrum",
    "Covariance Matrix",
    "fMRI Design Efficiency",
    "General Linear Model",
    "Generalize Least Squares",
    "GLM",
    "GLS",
    "Power Spectrum"
  ],
  "guid": "http://theclevermachine.wordpress.com/?p=3342",
  "description": "Event-related fMRI experiments are used to detect selectivity in the brain to stimuli presented over short durations. An event is generally modeled as an impulse function that occurs at the onset of the stimulus in question. Event-related designs are flexible in that many different classes of stimuli can be intermixed. These designs can minimize confounding [&#8230;]",
  "content:encoded": "<p>Event-related fMRI experiments are used to detect selectivity in the brain to stimuli presented over short durations. An event is generally modeled as an impulse function that occurs at the onset of the stimulus in question. Event-related designs are flexible in that many different classes of stimuli can be intermixed. These designs can minimize confounding behavioral effects due to subject adaptation or expectation. Furthermore, stimulus onsets can be modeled at frequencies that are shorter than the repetition time (TR) of the scanner. However, given such flexibility in design and modeling, how does one determine the schedule for presenting a series of stimuli? Do we space out stimulus onsets periodically across a scan period? Or do we randomize stimulus onsets? Furthermore what is the logic for or against either approach? Which approach is more efficient for gaining incite into the selectivity in the brain?</p>\n<h2>Simulating Two fMRI Experiments: Periodic and Random Stimulus Onsets</h2>\n<p>To get a better understanding of the problem of choosing efficient experiment design, let&#8217;s simulate two simple fMRI experiments. In the first experiment, a stimulus is presented periodically 20 times, once every 4 seconds, for a run of 80 seconds in duration. We then simulate a noiseless BOLD signal evoked in a voxel with a known HRF. In the second experiment, we simulate the noiseless BOLD signal evoked by 20 stimulus onsets that occur at random times over the course of the 80 second run duration.  The code for simulating the signals and displaying output are shown below:</p>\n<pre class=\"brush: matlabkey; collapse: true; light: false; title: ; toolbar: true; notranslate\">\nrand('seed',12345);\nrandn('seed',12345);\nTR = 1 % REPETITION TIME\nt = 1:TR:20; % MEASUREMENTS\nh = gampdf(t,6) + -.5*gampdf(t,10); % ACTUAL HRF\nh = h/max(h); % SCALE TO MAX OF 1\n\n% SOME CONSTANTS...\ntrPerStim = 4; % # TR PER STIMULUS FOR PERIODIC EXERIMENT\nnRepeat = 20; % # OF TOTAL STIMULI SHOWN\nnTRs = trPerStim*nRepeat\nstimulusTrain0 = zeros(1,nTRs);\n\nbeta = 3; % SELECTIVITY/HRF GAIN\n\n% SET UP TWO DIFFERENT STIMULUS PARADIGM...\n% A. PERIODIC, NON-RANDOM STIMULUS ONSET TIMES\nD_periodic = stimulusTrain0;\nD_periodic(1:trPerStim:trPerStim*nRepeat) = 1;\n\n% UNDERLYING MODEL FOR (A)\nX_periodic = conv2(D_periodic,h);\nX_periodic = X_periodic(1:nTRs);\ny_periodic = X_periodic*beta;\n\n% B. RANDOM, UNIFORMLY-DISTRIBUTED STIMULUS ONSET TIMES\nD_random = stimulusTrain0;\nrandIdx = randperm(numel(stimulusTrain0)-5);\nD_random(randIdx(1:nRepeat)) = 1;\n\n% UNDERLYING MODEL FOR (B)\nX_random = conv2(D_random,h);\nX_random = X_random(1:nTRs);\ny_random = X_random*beta;\n\n% DISPLAY STIMULUS ONSETS AND EVOKED RESPONSES\n% FOR EACH EXPERIMENT\nfigure\nsubplot(121)\nstem(D_periodic,'k');\nhold on;\nplot(y_periodic,'r','linewidth',2);\nxlabel('Time (TR)');\ntitle(sprintf('Responses Evoked by\\nPeriodic Stimulus Onset\\nVariance=%1.2f',var(y_periodic)))\n\nsubplot(122)\nstem(D_random,'k');\nhold on;\nplot(y_random,'r','linewidth',2);\nxlabel('Time (TR)');\ntitle(sprintf('Responses Evoked by\\nRandom Stimulus Onset\\nVariance=%1.2f',var(y_random)))\n</pre>\n<div data-shortcode=\"caption\" id=\"attachment_3571\" style=\"width: 520px\" class=\"wp-caption aligncenter\"><a href=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-evoked-responses2.png\"><img aria-describedby=\"caption-attachment-3571\" data-attachment-id=\"3571\" data-permalink=\"https://theclevermachine.wordpress.com/2013/01/14/fmri-in-neuroscience-efficiency-of-event-related-experiment-designs/mriefficiency-evoked-responses/\" data-orig-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-evoked-responses2.png\" data-orig-size=\"840,420\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\"}\" data-image-title=\"mriEfficiency-Evoked-Responses\" data-image-description=\"\" data-image-caption=\"<p>BOLD signals evoked by periodic (left) and random (right) stimulus onsets.</p>\n\" data-medium-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-evoked-responses2.png?w=300\" data-large-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-evoked-responses2.png?w=840\" class=\"size-full wp-image-3571\" alt=\"BOLD signals evoked by periodic (left) and random (right) stimulus onsets.\" src=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-evoked-responses2.png?w=914\" srcset=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-evoked-responses2.png 840w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-evoked-responses2.png?w=150 150w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-evoked-responses2.png?w=300 300w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-evoked-responses2.png?w=768 768w\" sizes=\"(max-width: 840px) 100vw, 840px\"   /></a><p id=\"caption-attachment-3571\" class=\"wp-caption-text\">BOLD signals evoked by periodic (left) and random (right) stimulus onsets.</p></div>\n<p>The black stick functions in the simulation output indicate the stimulus onsets and each red function is the simulated noiseless BOLD signal to those stimuli. The first thing to notice is the dramatically different variances of the BOLD signals evoked for the two stimulus presentation schedules. For the periodic stimuli, the BOLD signal quickly saturates, then oscillates around an effective baseline activation. The estimated variance of the periodic-based signal is 0.18. In contrast, the signal evoked by the random stimulus presentation schedule varies wildly, reaching a maximum amplitude that is roughly 2.5 times as large the maximum amplitude of the signal evoked by periodic stimuli. The estimated variance of the signal evoked by the random stimuli is 7.4, roughly 40 times the variance of the signal evoked by the periodic stimulus.</p>\n<p>So which stimulus schedule allows us to better estimate the HRF and, more importantly, the amplitude of the HRF, as it is the amplitude that is the common proxy for voxel selectivity/activation? Below we repeat the above experiment 50 times. However, instead of simulating noiseless BOLD responses, we introduce 50 distinct, uncorrelated noise conditions, and from the simulated noisy responses, we <a title=\"FIR Basis Set Model\" href=\"https://theclevermachine.wordpress.com/2012/12/16/fmri-in-neuroscience-modeling-the-hrf-with-fir-basis-functions/\" target=\"_blank\">estimate the HRF using an FIR basis set</a> for each  repeated trial. We then compare the estimated HRFs across the 50 trials for the periodic and random stimulus presentation schedules. Note that for each trial, the noise is exactly the same for the two stimulus presentation schedules. Further, we simulate a selectivity/tuning gain of 3 times the maximum HRF amplitude and assume that the HRF to be estimated is 16 TRs/seconds in length. The simulation and output are below:</p>\n<pre class=\"brush: matlabkey; collapse: true; light: false; title: ; toolbar: true; notranslate\">\n%% SIMULATE MULTIPLE TRIALS OF EACH EXPERIMENT\n%% AND ESTIMATE THE HRF FOR EACH\n%% (ASSUME THE VARIABLES DEFINED ABOVE ARE IN WORKSPACE)\n\n% CREATE AN FIR DESIGN MATRIX\n% FOR EACH EXPERIMENT\nhrfLen = 16;  % WE ASSUME TO-BE-ESTIMATED HRF IS 16 TRS LONG\n\n% CREATE FIR DESIGN MATRIX FOR THE PERIODIC STIMULI\nX_FIR_periodic = zeros(nTRs,hrfLen);\nonsets = find(D_periodic);\nidxCols = 1:hrfLen;\nfor jO = 1:numel(onsets)\n\tidxRows = onsets(jO):onsets(jO)+hrfLen-1;\n\tfor kR = 1:numel(idxRows);\n\t\tX_FIR_periodic(idxRows(kR),idxCols(kR)) = 1;\n\tend\nend\nX_FIR_periodic = X_FIR_periodic(1:nTRs,:);\n\n% CREATE FIR DESIGN MATRIX FOR THE RANDOM STIMULI\nX_FIR_random = zeros(nTRs,hrfLen);\nonsets = find(D_random);\nidxCols = 1:hrfLen;\nfor jO = 1:numel(onsets)\n\tidxRows = onsets(jO):onsets(jO)+hrfLen-1;\n\tfor kR = 1:numel(idxRows);\n\t\tX_FIR_random(idxRows(kR),idxCols(kR)) = 1;\n\tend\nend\nX_FIR_random = X_FIR_random(1:nTRs,:);\n\n% SIMULATE AND ESTIMATE HRF WEIGHTS VIA OLS\nnTrials = 50;\n\n% CREATE NOISE TO ADD TO SIGNALS\n% NOTE: SAME NOISE CONDITIONS FOR BOTH EXPERIMENTS\nnoiseSTD = beta*2;\nnoise = bsxfun(@times,randn(nTrials,numel(X_periodic)),noiseSTD);\n\n%% ESTIMATE HRF FROM PERIODIC STIMULUS TRIALS\nbeta_periodic = zeros(nTrials,hrfLen);\nfor iT = 1:nTrials\n\ty = y_periodic + noise(iT,:);\n\tbeta_periodic(iT,:) = X_FIR_periodic\\y';\nend\n\n% CALCULATE MEAN AND STANDARD ERROR OF HRF ESTIMATES\nbeta_periodic_mean = mean(beta_periodic);\nbeta_periodic_se = std(beta_periodic)/sqrt(nTrials);\n\n%% ESTIMATE HRF FROM RANDOM STIMULUS TRIALS\nbeta_random = zeros(nTrials,hrfLen);\nfor iT = 1:nTrials\n\ty = y_random + noise(iT,:);\n\tbeta_random(iT,:) = X_FIR_random\\y';\nend\n\n% CALCULATE MEAN AND STANDARD ERROR OF HRF ESTIMATES\nbeta_random_mean = mean(beta_random);\nbeta_random_se = std(beta_random)/sqrt(nTrials);\n\n% DISPLAY HRF ESTIMATES\nfigure\n% ...FOR THE PERIODIC STIMULI\nsubplot(121);\nhold on;\nh0 = plot(h*beta,'k')\nh1 = plot(beta_periodic_mean,'linewidth',2);\nh2 = plot(beta_periodic_mean+beta_periodic_se,'r','linewidth',2);\nplot(beta_periodic_mean-beta_periodic_se,'r','linewidth',2);\nxlabel('Time (TR)')\nlegend([h0, h1,h2],'Actual HRF','Average \\beta_{periodic}','Standard Error')\ntitle('Periodic HRF Estimate')\n\n% ...FOR THE RANDOMLY-PRESENTED STIMULI\nsubplot(122);\nhold on;\nh0 = plot(h*beta,'k');\nh1 = plot(beta_random_mean,'linewidth',2);\nh2 = plot(beta_random_mean+beta_random_se,'r','linewidth',2);\nplot(beta_random_mean-beta_random_se,'r','linewidth',2);\nxlabel('Time (TR)')\nlegend([h0,h1,h2],'Actual HRF','Average \\beta_{random}','Standard Error')\ntitle('Random HRF Estimate')\n</pre>\n<div data-shortcode=\"caption\" id=\"attachment_3573\" style=\"width: 520px\" class=\"wp-caption aligncenter\"><a href=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-hrf1.png\"><img aria-describedby=\"caption-attachment-3573\" data-attachment-id=\"3573\" data-permalink=\"https://theclevermachine.wordpress.com/2013/01/14/fmri-in-neuroscience-efficiency-of-event-related-experiment-designs/mriefficiency-estimated-hrf/\" data-orig-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-hrf1.png\" data-orig-size=\"840,420\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\"}\" data-image-title=\"mriEfficiency-Estimated-HRF\" data-image-description=\"\" data-image-caption=\"<p>Estimated HRFs from 50 trials of periodic (left) and random (right) stimulus schedules</p>\n\" data-medium-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-hrf1.png?w=300\" data-large-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-hrf1.png?w=840\" class=\"size-full wp-image-3573\" alt=\"Estimated HRFs from 50 trials of periodic (left) and random (right) stimulus schedules\" src=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-hrf1.png?w=914\" srcset=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-hrf1.png 840w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-hrf1.png?w=150 150w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-hrf1.png?w=300 300w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-hrf1.png?w=768 768w\" sizes=\"(max-width: 840px) 100vw, 840px\"   /></a><p id=\"caption-attachment-3573\" class=\"wp-caption-text\">Estimated HRFs from 50 trials of periodic (left) and random (right) stimulus schedules</p></div>\n<p>In the simulation outputs, the average HRF for the random stimulus presentation (right) closely follows the actual HRF tuning. Also, there is little variability of the HRF estimates, as is indicated by the small standard error estimates for each time points. As well, the selectivity/gain term is accurately recovered, giving a mean HRF with nearly the same amplitude as the underlying model. In contrast, the HRF estimated from the periodic-based experiment is much more variable, as indicated by the large standard error estimates. Such variability in the estimates of the HRF reduce our confidence in the estimate for any single trial. Additionally, the scale of the mean HRF estimate is off by nearly 30% of the actual value.</p>\n<p>From these results, it is obvious that the random stimulus presentation rate gives rise to more accurate, and less variable estimates of the HRF function. What may not be so obvious is why this is the case, as there were the same number of stimuli and  the same number of signal measurements in each experiment. To get a better understanding of why this is occurring, let&#8217;s refer back to the variances of the evoked noiseless signals. These are the signals that are underlying the noisy signals used to estimate the HRF. When noise is added it impedes the detection of the underlying trends that are useful for estimating the HRF.  Thus it is important that the variance of the underlying signal is large compared to the noise so that the signal can be detected.</p>\n<p>For the periodic stimulus presentation schedule, we saw that the variation in the BOLD signal was much smaller than the variation in the BOLD signals evoked during the randomly-presented stimuli. Thus the signal evoked by random stimulus schedule provide a better characterization of the underlying signal in the presence of the same amount of noise, and thus provide more information to estimate the HRF. With this in mind we can think of maximizing the efficiency of the an experiment design as maximizing the variance of the BOLD signals evoked by the experiment.</p>\n<h2>An Alternative Perspective: The Frequency Power Spectrum</h2>\n<p>Another helpful interpretation is based on a signal processing perspective. If we assume that neural activity is directly correspondent with the onset of a stimulus event, then we can interpret the train of stimulus onsets as a direct signal of the evoked neural activity. Furthermore, we can interpret the HRF as a low-pass-filter that acts to &#8220;smooth&#8221; the available neural signal in time. Each of these signals&#8211;the neural/stimulus signal and the HRF filtering signal&#8211;has with it an associated power spectrum. The power spectrum for a signal captures the amount of power per unit time that the signal has as a particular frequency <img src=\"https://s0.wp.com/latex.php?latex=%5Comega+&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"&#92;omega \" class=\"latex\" />. The power spectrum for a discrete signal can be calculated from the discrete Fourier transform (DFT) of the signal <img src=\"https://s0.wp.com/latex.php?latex=F%28%5Comega%29&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"F(&#92;omega)\" class=\"latex\" /> as follows</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=P%28%5Comega%29+%3D+%7C+F%28%5Comega%29%7C%5E2&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"P(&#92;omega) = | F(&#92;omega)|^2\" class=\"latex\" /></p>\n<p>Below, we use Matlab&#8217;s <img src=\"https://s0.wp.com/latex.php?latex=%5Ctext%7Bfft.m%7D&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"&#92;text{fft.m}\" class=\"latex\" /> function to calculate the DFT and the associated power spectrum for each of the stimulus/neural signals, as well as the HRF.</p>\n<pre class=\"brush: matlabkey; collapse: true; light: false; title: ; toolbar: true; notranslate\">\n%% POWER SPECTRUM ANALYSES\n%% (ASSUME THE VARIABLES DEFINED ABOVE ARE IN WORKSPACE)\n\n% MAKE SURE WE PAD SUFFICIENTLY\n% FOR CIRCULAR CONVOLUTION\nN = 2^nextpow2(nTRs + numel(h)-1);\nnUnique = ceil(1+N/2); % TAKE ONLY POSITIVE SPECTRA\n\n% CALCULATE POWER SPECTRUM FOR PERIODIC STIMULI EXPERIMENT\nft_D_periodic = fft(D_periodic,N)/N; % DFT\nP_D_periodic = abs(ft_D_periodic).^2; % POWER\nP_D_periodic = 2*P_D_periodic(2:nUnique-1); % REMOVE ZEROTH & NYQUIST\n\n% CALCULATE POWER SPECTRUM FOR RANDOM STIMULI EXPERIMENT\nft_D_random = fft(D_random,N)/N; % DFT\nP_D_random = abs(ft_D_random).^2; % POWER\nP_D_random = 2*P_D_random(2:nUnique-1); % REMOVE ZEROTH & NYQUIST\n\n% CALCULATE POWER SPECTRUM OF HRF\nft_h = fft(h,N)/N; % DFT\nP_h = abs(ft_h).^2; % POWER\nP_h = 2*P_h(2:nUnique-1); % REMOVE ZEROTH & NYQUIST\n\n% CREATE A FREQUENCY SPACE FOR PLOTTING\nF = 1/N*[1:N/2-1];\n\n% DISPLAY STIMULI POWER SPECTRA\nfigure\nsubplot(131)\nhhd = plot(F,P_D_periodic,'b','linewidth',2);\naxis square; hold on;\nhhr = plot(F,P_D_random,'g','linewidth',2);\nxlim([0 .3]); xlabel('Frequency (Hz)');\nset(gca,'Ytick',[]); ylabel('Magnitude');\nlegend([hhd,hhr],'Periodic','Random')\ntitle('Stimulus Power, P_{stim}')\n\n% DISPLAY HRF POWER SPECTRUM\nsubplot(132)\nplot(F,P_h,'r','linewidth',2);\naxis square\nxlim([0 .3]); xlabel('Frequency (Hz)');\nset(gca,'Ytick',[]); ylabel('Magnitude');\ntitle('HRF Power, P_{HRF}')\n\n% DISPLAY EVOKED SIGNAL POWER SPECTRA\nsubplot(133)\nhhd = plot(F,P_D_periodic.*P_h,'b','linewidth',2);\nhold on;\nhhr = plot(F,P_D_random.*P_h,'g','linewidth',2);\naxis square\nxlim([0 .3]); xlabel('Frequency (Hz)');\nset(gca,'Ytick',[]); ylabel('Magnitude');\nlegend([hhd,hhr],'Periodic','Random')\ntitle('Signal Power, P_{stim}.*P_{HRF}')\n</pre>\n<div data-shortcode=\"caption\" id=\"attachment_3577\" style=\"width: 520px\" class=\"wp-caption aligncenter\"><a href=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-power-spectrum5.png\"><img aria-describedby=\"caption-attachment-3577\" data-attachment-id=\"3577\" data-permalink=\"https://theclevermachine.wordpress.com/2013/01/14/fmri-in-neuroscience-efficiency-of-event-related-experiment-designs/mriefficiency-power-spectrum/\" data-orig-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-power-spectrum5.png\" data-orig-size=\"791,296\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\"}\" data-image-title=\"mriEfficiency-Power-Spectrum\" data-image-description=\"\" data-image-caption=\"<p>Power spectrum of neural/stimulus (left), HRF (center), and evoked BOLD (right) signals</p>\n\" data-medium-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-power-spectrum5.png?w=300\" data-large-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-power-spectrum5.png?w=791\" class=\"size-full wp-image-3577\" alt=\"Power spectrum of neural/stimulus (left), HRF (center), and evoked BOLD (right) signals\" src=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-power-spectrum5.png?w=914\" srcset=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-power-spectrum5.png 791w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-power-spectrum5.png?w=150 150w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-power-spectrum5.png?w=300 300w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-power-spectrum5.png?w=768 768w\" sizes=\"(max-width: 791px) 100vw, 791px\"   /></a><p id=\"caption-attachment-3577\" class=\"wp-caption-text\">Power spectrum of neural/stimulus (left), HRF (center), and evoked BOLD (right) signals</p></div>\n<p>On the left of the output we see the power spectra for the stimulus signals. The blue line corresponds to the spectrum for the periodic stimuli, and the green line the spectrum for the randomly-presented stimuli. The large peak in the blue spectrum corresponds to the majority of the stimulus power at 0.25 Hz for the periodic stimuli, as this the fundamental frequency of the periodic stimulus presentation (i.e. every 4 seconds). However, there is little power at any other stimulus frequencies. In contrast the green spectrum indicates that the random stimulus presentation has power at multiple frequencies.</p>\n<p>If we interpret the HRF as a filter, then we can think of the HRF power spectrum as modulating the power spectrum of the neural signals to produce the power of the evoked BOLD signals. The power spectrum for the HRF is plotted in red in the center plot. Notice how a majority of the power for the HRF is at frequencies less than 0.1 Hz, and there is very little power at frequencies above 0.2 Hz. If the neural signal power is modulated by the HRF signal power, we see that there is little resultant power in the BOLD signals evoked by periodic stimulus presentation (blue spectrum in the right plot). In contrast, because the power for the neural signals evoked by random stimuli are spread across the frequency domain, there are a number of frequencies that overlap with those frequencies for which the HRF also has power. Thus after modulating neural/stimulus power with the HRF power, the spectrum of the BOLD signals evoked by the randomly-presented stimuli have much more power across the relevant frequency spectrum than those evoked by the periodic stimuli. This is indicated by the larger area under the green curve in the right plot.</p>\n<p>Using the signal processing perspective allows us to directly gain perspective on the limitations of a particular experiment design which are rooted in the frequency spectrum of the HRF. Therefore, another way we can think of maximizing the efficiency of an experimental design is maximizing the amount of power in the resulting evoked BOLD responses.</p>\n<h2>Yet Another Perspective Based in Statistics: Efficiency Metric</h2>\n<p>Taking a statistics-based approach leads to a formal definition of efficiency, and further, a nice metric for testing the efficiency of an experimental design. Recall that when determining the shape of the HRF, a common approach is to use the GLM model</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=y+%3D+X+%5Cbeta+%2B+%5Cepsilon&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"y = X &#92;beta + &#92;epsilon\" class=\"latex\" /></p>\n<p>Here <img src=\"https://s0.wp.com/latex.php?latex=y+&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"y \" class=\"latex\" /> is the evoked BOLD signal and <img src=\"https://s0.wp.com/latex.php?latex=X&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"X\" class=\"latex\" /> is a design matrix that links a set of linear model parameters <img src=\"https://s0.wp.com/latex.php?latex=%5Cbeta&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"&#92;beta\" class=\"latex\" /> to those responses. The variable <img src=\"https://s0.wp.com/latex.php?latex=%5Cepsilon+&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"&#92;epsilon \" class=\"latex\" /> is a noise term that is unexplained by the model. Using an FIR basis formulation of the model, the weights in <img src=\"https://s0.wp.com/latex.php?latex=%5Cbeta+&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"&#92;beta \" class=\"latex\" /> represent the HRF to a stimulus condition.</p>\n<p>Because fMRI data are a continuous time series, the underlying noise <img src=\"https://s0.wp.com/latex.php?latex=%5Cepsilon&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"&#92;epsilon\" class=\"latex\" /> is generally correlated in time. We can model this noise as a Gaussian process with zero mean and a constant multivariate covariance <img src=\"https://s0.wp.com/latex.php?latex=C_%7B%5Cepsilon%7D&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"C_{&#92;epsilon}\" class=\"latex\" />. Note that this is analogous to the Generalized Least Squares (GLS) formulation of the GLM. In general, the values that comprise <img src=\"https://s0.wp.com/latex.php?latex=C_%7B%5Cepsilon%7D&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"C_{&#92;epsilon}\" class=\"latex\" /> are unknown and have to be estimated from the fMRI data themselves.</p>\n<p>For a known or estimated noise covariance, the Maximum Likelihood Estimator (MLE) for the model parameters <img src=\"https://s0.wp.com/latex.php?latex=%5Cbeta&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"&#92;beta\" class=\"latex\" />(derivation not shown) is:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Chat+%5Cbeta+%3D+%28X%5ETC_%7B%5Cepsilon%7D%5E%7B-1%7DX%29X%5ETC_%7B%5Cepsilon%7D%5E%7B-1%7Dy&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"&#92;hat &#92;beta = (X^TC_{&#92;epsilon}^{-1}X)X^TC_{&#92;epsilon}^{-1}y\" class=\"latex\" /></p>\n<p>Because the ML estimator of the HRF is a linear combination of the design matrix <img src=\"https://s0.wp.com/latex.php?latex=X&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"X\" class=\"latex\" /> and a set of corresponding responses, which are both random variables (<img src=\"https://s0.wp.com/latex.php?latex=X+&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"X \" class=\"latex\" /> can represent any possible experiment design, and <img src=\"https://s0.wp.com/latex.php?latex=y&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"y\" class=\"latex\" /> is by definition random), the estimator is itself a random variable. It thus follows that the estimate for the HRF also has a variance. (We demonstrated how <img src=\"https://s0.wp.com/latex.php?latex=%5Cbeta&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"&#92;beta\" class=\"latex\" /> is a random variable in the 50 simulations above, where for each simulation X was held fixed, but due to the added noise <img src=\"https://s0.wp.com/latex.php?latex=y+&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"y \" class=\"latex\" /> was a random variable. For each noise condition, the estimate for <img src=\"https://s0.wp.com/latex.php?latex=%5Cbeta&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"&#92;beta\" class=\"latex\" /> took on different values.) We saw above how an HRF estimator with a large variance is undesirable, as it reduces our confidence in the estimates of the HRF shape and scale. Therefore we would like to determine an estimator that has a minimum overall variance.</p>\n<p>A formal metric for <strong><em>efficiency</em></strong> of a least-squares estimator is directly related to the variance of the estimator. The efficiency is defined to be the inverse of the sum of the estimator variances. An estimator that has a large sum of variances will have a low efficiency, and vice versa. But how do we obtain the values of the variances for the estimator? The variances can be recovered from the diagonal elements of the estimator covariance matrix <img src=\"https://s0.wp.com/latex.php?latex=C_%7B%5Chat+%5Cbeta%7D&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"C_{&#92;hat &#92;beta}\" class=\"latex\" />, giving the following definition for the efficiency, <img src=\"https://s0.wp.com/latex.php?latex=E&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"E\" class=\"latex\" /></p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=E+%3D+1%2Ftrace%28C_%7B%5Chat+%5Cbeta%7D%29&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"E = 1/trace(C_{&#92;hat &#92;beta})\" class=\"latex\" /></p>\n<p>In <a title=\"Derivation of Estimator Covariance\" href=\"https://theclevermachine.wordpress.com/2013/01/14/derivation-the-covariance-matrix-of-an-ols-estimator-and-applications-to-gls/\" target=\"_blank\">earlier post</a> we found that the covariance matrix <img src=\"https://s0.wp.com/latex.php?latex=C_%7B%5Chat+%5Cbeta%7D&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"C_{&#92;hat &#92;beta}\" class=\"latex\" /> for the GLS estimator (i.e. the formulation above) with a given noise covariance <img src=\"https://s0.wp.com/latex.php?latex=C_%7B%5Cepsilon%7D&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"C_{&#92;epsilon}\" class=\"latex\" /> is:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=C_%7B%5Chat+%5Cbeta%7D+%3D+%28X%5ET+C_%7B%5Cepsilon%7D%5E%7B-1%7D+X%29%5E%7B-1%7D&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"C_{&#92;hat &#92;beta} = (X^T C_{&#92;epsilon}^{-1} X)^{-1}\" class=\"latex\" />.</p>\n<p>Thus the efficiency for the HRF estimator is</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=E+%3D+1%2Ftrace%28%28X%5ET+C_%7B%5Cepsilon%7D%5E%7B-1%7DX%29%5E%7B-1%7D%29&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"E = 1/trace((X^T C_{&#92;epsilon}^{-1}X)^{-1})\" class=\"latex\" /></p>\n<p>Here we see that the efficiency depends only on the known noise covariance (or an estimate of it), and the design matrix used in the model, but not the shape of the HRF. In general the noise covariance is out of the experimenter&#8217;s control (but see the take-homes below ), and must be dealt with post hoc. However, because the design matrix is directly related to the experimental design, the above expression gives a direct way to test the efficiency of experimental designs before they are ever used!</p>\n<p>In the simulations above, the noise processes are drawn from an independent multivariate Gaussian distribution, therefore the noise covariance is equal to the identity (i.e. uncorrelated). We also estimated the HRF using the FIR basis set, thus our model design matrix was <img src=\"https://s0.wp.com/latex.php?latex=X_%7BFIR%7D&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"X_{FIR}\" class=\"latex\" />. This gives the estimate the efficiency for the simulation experiments:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=E_%7Bsimulation%7D+%3D+1%2Ftrace%28X_%7BFIR%7D%5ET+X_%7BFIR%7D%29&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=0&#038;c=20201002\" alt=\"E_{simulation} = 1/trace(X_{FIR}^T X_{FIR})\" class=\"latex\" /></p>\n<p>Below we calculate the efficiency for the FIR estimates under the simulated experiments with periodic and random stimulus presentation designs.</p>\n<pre class=\"brush: matlabkey; collapse: true; light: false; title: ; toolbar: true; notranslate\">\n%% ESTIMATE DESIGN EFFICIENCY\n%% (ASSUME THE VARIABLES DEFINED ABOVE ARE IN WORKSPACE)\n\n% CALCULATE EFFICIENCY OF PERIODIC EXPERIMENT\nE_periodic = 1/trace(pinv(X_FIR_periodic'*X_FIR_periodic));\n\n% CALCULATE EFFICIENCY OF RANDOM EXPERIMENT\nE_random = 1/trace(pinv(X_FIR_random'*X_FIR_random));\n\n% DISPLAY EFFICIENCY ESTIMATES\nfigure\nbar([E_periodic,E_random]);\nset(gca,'XTick',[1,2],'XTickLabel',{'E_periodic','E_random'});\ntitle('Efficiency of Experimental Designs');\ncolormap hot;\n</pre>\n<div data-shortcode=\"caption\" id=\"attachment_3580\" style=\"width: 520px\" class=\"wp-caption aligncenter\"><a href=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-efficiency2.png\"><img aria-describedby=\"caption-attachment-3580\" data-attachment-id=\"3580\" data-permalink=\"https://theclevermachine.wordpress.com/2013/01/14/fmri-in-neuroscience-efficiency-of-event-related-experiment-designs/mriefficiency-estimated-efficiency/\" data-orig-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-efficiency2.png\" data-orig-size=\"512,384\" data-comments-opened=\"1\" data-image-meta=\"{\"aperture\":\"0\",\"credit\":\"\",\"camera\":\"\",\"caption\":\"\",\"created_timestamp\":\"0\",\"copyright\":\"\",\"focal_length\":\"0\",\"iso\":\"0\",\"shutter_speed\":\"0\",\"title\":\"\"}\" data-image-title=\"mriEfficiency-Estimated-Efficiency\" data-image-description=\"\" data-image-caption=\"<p>Estimated efficiency for simulated periodic (left) and random (right) stimulus schedules.</p>\n\" data-medium-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-efficiency2.png?w=300\" data-large-file=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-efficiency2.png?w=512\" class=\"size-full wp-image-3580\" alt=\"Estimated efficiency for simulated periodic (left) and random (right) stimulus schedules.\" src=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-efficiency2.png?w=914\" srcset=\"https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-efficiency2.png 512w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-efficiency2.png?w=150 150w, https://theclevermachine.files.wordpress.com/2013/01/mriefficiency-estimated-efficiency2.png?w=300 300w\" sizes=\"(max-width: 512px) 100vw, 512px\"   /></a><p id=\"caption-attachment-3580\" class=\"wp-caption-text\">Estimated efficiency for simulated periodic (left) and random (right) stimulus schedules.</p></div>\n<p>Here we see that the efficiency metric does indeed indicate that the randomly-presented stimulus paradigm is far more efficient than the periodically-presented paradigm.</p>\n<h2>Wrapping Up</h2>\n<p>In this post we addressed the efficiency of an fMRI experiment design. A few take-homes from the discussion are:</p>\n<ol>\n<li><span style=\"line-height:13px;\">Randomize stimulus onset times. These onset times should take into account the low-pass characteristics (i.e. the power spectrum) of the HRF.</span></li>\n<li>Try to model selectivity to events that occur close in time. The reason for this is that noise covariances in fMRI are highly non-stationary. There are many sources of low-frequency physiological noise such as breathing, pulse, blood pressure, etc, all of which dramatically effect the noise in the fMRI timecourses. Thus any estimate of noise covariances from data recorded far apart in time will likely be erroneous.</li>\n<li>Check an experimental design against other candidate designs using the Efficiency metric.</li>\n</ol>\n<p>Above there is mention of the effects of low-frequency physiological noise. Until now, our simulations have assumed that all noise is independent in time, greatly simplifying the picture of estimating HRFs and corresponding selectivity. However, in a later post we&#8217;ll address how to deal with more realistic time courses that are heavily influenced by sources of physiological noise. Additionally, we&#8217;ll tackle how to go about estimating the noise covariance <img src=\"https://s0.wp.com/latex.php?latex=C_%7B%5Cepsilon%7D+&#038;bg=ffffff&#038;fg=4e4e4e&#038;s=-1&#038;c=20201002\" alt=\"C_{&#92;epsilon} \" class=\"latex\" /> from more realistic fMRI time series.</p>\n",
  "wfw:commentRss": "https://theclevermachine.wordpress.com/2013/01/14/fmri-in-neuroscience-efficiency-of-event-related-experiment-designs/feed/",
  "slash:comments": 0,
  "media:content": [
    {
      "media:title": "dustinstansbury"
    },
    {
      "media:title": "BOLD signals evoked by periodic (left) and random (right) stimulus onsets."
    },
    {
      "media:title": "Estimated HRFs from 50 trials of periodic (left) and random (right) stimulus schedules"
    },
    {
      "media:title": "Power spectrum of neural/stimulus (left), HRF (center), and evoked BOLD (right) signals"
    },
    {
      "media:title": "Estimated efficiency for simulated periodic (left) and random (right) stimulus schedules."
    }
  ]
}