{
  "title": "Creating A Stacked Bar Chart in Seaborn",
  "description": "<p><a href=\"http://randyzwitch.com/wp-content/uploads/2014/09/stacked_bar.csv\">Download chartÂ data</a></p>",
  "pubDate": "Tue, 09 Sep 2014 08:01:39 +0000",
  "link": "http://randyzwitch.com/creating-stacked-bar-chart-seaborn/",
  "guid": "http://randyzwitch.com/creating-stacked-bar-chart-seaborn/",
  "content": "<p><a href=\"http://randyzwitch.com/wp-content/uploads/2014/09/stacked_bar.csv\">Download chartÂ data</a></p>\n\n<p>The other day I was having a heck of a time trying to figure out how to make a stacked bar chart in Seaborn. But in true open-source/community fashion, I ended up getting a response from the creator of Seaborn via Twitter:</p>\n\n<blockquote class=\"twitter-tweet\" lang=\"en\" data-conversation=\"none\">\n  <p>\n    <a href=\"https://twitter.com/randyzwitch\">@randyzwitch</a> I don't really like stacked bar charts, I'd suggest maybe using pointplot / factorplot with kind=point\n  </p>\n\n  <p>\n    â€” Michael Waskom (@michaelwaskom) <a href=\"https://twitter.com/michaelwaskom/status/507608729840152578\">September 4, 2014</a>\n  </p>\n</blockquote>\n\n<p>So there you go. I donâ€™t want to put words in Michaelâ€™s mouth, but if heâ€™s not a fan, then it sounded like it was up to me to find my own solution if I wanted a stacked bar chart. I hacked around on the <a href=\"http://pandas.pydata.org/pandas-docs/stable/visualization.html\">pandas plotting functionality</a> a while, went to the <a href=\"http://matplotlib.org/1.3.1/examples/pylab_examples/bar_stacked.html\">matplotlib documentation/example for a stacked bar chart</a>, tried Seaborn some more and then it hit meâ€¦Iâ€™ve gotten so used to these amazing open-source packages that my brain has atrophied! Creating a stacked bar chart is SIMPLE, even in Seaborn (and even if Michael doesnâ€™t like them ğŸ™‚ )</p>\n\n<h2 id=\"stacked-bar-chart--sum-of-two-series\">Stacked Bar Chart = Sum of Two Series</h2>\n\n<p>In trying so hard to create a stacked bar chart, I neglected the most obvious part. Given two series of data, <code class=\"language-plaintext highlighter-rouge\">Series 1</code> (â€œbottomâ€) and <code class=\"language-plaintext highlighter-rouge\">Series 2</code> (â€œtopâ€), to create a stacked bar chart you just need to create:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-python\" data-lang=\"python\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n</pre></td><td class=\"code\"><pre><span class=\"n\">Series</span> <span class=\"mi\">3</span> <span class=\"o\">=</span> <span class=\"n\">Series</span> <span class=\"mi\">1</span> <span class=\"o\">+</span> <span class=\"n\">Series</span> <span class=\"mi\">2</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>Once you have <code class=\"language-plaintext highlighter-rouge\">Series 3</code> (â€œtotalâ€), then you can use the overlay feature of matplotlib and Seaborn in order to create your stacked bar chart. Plot â€œtotalâ€ first, which will become the base layer of the chart. Because the total by definition will be greater-than-or-equal-to the â€œbottomâ€ series, once you overlay the â€œbottomâ€ seriesÂ on top of the â€œtotalâ€Â series, the â€œtopâ€ series will now be stacked on top:</p>\n\n<h4 id=\"background-total-series\">Background: â€œTotalâ€ Series</h4>\n\n<p><img src=\"/wp-content/uploads/2014/09/background_total.png\" alt=\"background_total\" /></p>\n\n<h4 id=\"overlay-bottom-series\">Overlay: â€œBottomâ€ Series</h4>\n\n<p><img src=\"/wp-content/uploads/2014/09/bottom_plot1.png\" alt=\"bottom_plot\" /></p>\n\n<h2 id=\"end-result-stacked-bar-chart\">End Result: Stacked Bar Chart</h2>\n\n<p>Running the code in the same IPython Notebook cell results in the following chart (<a href=\"http://randyzwitch.com/wp-content/uploads/2014/09/stacked_bar.csv\">download chartÂ data</a>):</p>\n\n<p><img src=\"/wp-content/uploads/2014/09/stacked-bar-seaborn.png\" alt=\"stacked-bar-seaborn\" /></p>\n\n<figure class=\"highlight\"><pre><code class=\"language-python\" data-lang=\"python\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n</pre></td><td class=\"code\"><pre><span class=\"kn\">import</span> <span class=\"nn\">pandas</span> <span class=\"k\">as</span> <span class=\"n\">pd</span>\n<span class=\"kn\">from</span> <span class=\"nn\">matplotlib</span> <span class=\"kn\">import</span> <span class=\"n\">pyplot</span> <span class=\"k\">as</span> <span class=\"n\">plt</span>\n<span class=\"kn\">import</span> <span class=\"nn\">matplotlib</span> <span class=\"k\">as</span> <span class=\"n\">mpl</span>\n<span class=\"kn\">import</span> <span class=\"nn\">seaborn</span> <span class=\"k\">as</span> <span class=\"n\">sns</span>\n<span class=\"o\">%</span><span class=\"n\">matplotlib</span> <span class=\"n\">inline</span>\n\n<span class=\"c1\">#Read in data &amp; create total column\n</span><span class=\"n\">stacked_bar_data</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"p\">.</span><span class=\"n\">read_csv</span><span class=\"p\">(</span><span class=\"s\">\"C:\\stacked_bar.csv\"</span><span class=\"p\">)</span>\n<span class=\"n\">stacked_bar_data</span><span class=\"p\">[</span><span class=\"s\">\"total\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">stacked_bar_data</span><span class=\"p\">.</span><span class=\"n\">Series1</span> <span class=\"o\">+</span> <span class=\"n\">stacked_bar_data</span><span class=\"p\">.</span><span class=\"n\">Series2</span>\n\n<span class=\"c1\">#Set general plot properties\n</span><span class=\"n\">sns</span><span class=\"p\">.</span><span class=\"n\">set_style</span><span class=\"p\">(</span><span class=\"s\">\"white\"</span><span class=\"p\">)</span>\n<span class=\"n\">sns</span><span class=\"p\">.</span><span class=\"n\">set_context</span><span class=\"p\">({</span><span class=\"s\">\"figure.figsize\"</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"mi\">24</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">)})</span>\n\n<span class=\"c1\">#Plot 1 - background - \"total\" (top) series\n</span><span class=\"n\">sns</span><span class=\"p\">.</span><span class=\"n\">barplot</span><span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">stacked_bar_data</span><span class=\"p\">.</span><span class=\"n\">Group</span><span class=\"p\">,</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">stacked_bar_data</span><span class=\"p\">.</span><span class=\"n\">total</span><span class=\"p\">,</span> <span class=\"n\">color</span> <span class=\"o\">=</span> <span class=\"s\">\"red\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\">#Plot 2 - overlay - \"bottom\" series\n</span><span class=\"n\">bottom_plot</span> <span class=\"o\">=</span> <span class=\"n\">sns</span><span class=\"p\">.</span><span class=\"n\">barplot</span><span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">stacked_bar_data</span><span class=\"p\">.</span><span class=\"n\">Group</span><span class=\"p\">,</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">stacked_bar_data</span><span class=\"p\">.</span><span class=\"n\">Series1</span><span class=\"p\">,</span> <span class=\"n\">color</span> <span class=\"o\">=</span> <span class=\"s\">\"#0000A3\"</span><span class=\"p\">)</span>\n\n\n<span class=\"n\">topbar</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">Rectangle</span><span class=\"p\">((</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">),</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"n\">fc</span><span class=\"o\">=</span><span class=\"s\">\"red\"</span><span class=\"p\">,</span> <span class=\"n\">edgecolor</span> <span class=\"o\">=</span> <span class=\"s\">'none'</span><span class=\"p\">)</span>\n<span class=\"n\">bottombar</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">Rectangle</span><span class=\"p\">((</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">),</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"n\">fc</span><span class=\"o\">=</span><span class=\"s\">'#0000A3'</span><span class=\"p\">,</span>  <span class=\"n\">edgecolor</span> <span class=\"o\">=</span> <span class=\"s\">'none'</span><span class=\"p\">)</span>\n<span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"p\">.</span><span class=\"n\">legend</span><span class=\"p\">([</span><span class=\"n\">bottombar</span><span class=\"p\">,</span> <span class=\"n\">topbar</span><span class=\"p\">],</span> <span class=\"p\">[</span><span class=\"s\">'Bottom Bar'</span><span class=\"p\">,</span> <span class=\"s\">'Top Bar'</span><span class=\"p\">],</span> <span class=\"n\">loc</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">ncol</span> <span class=\"o\">=</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">prop</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s\">'size'</span><span class=\"p\">:</span><span class=\"mi\">16</span><span class=\"p\">})</span>\n<span class=\"n\">l</span><span class=\"p\">.</span><span class=\"n\">draw_frame</span><span class=\"p\">(</span><span class=\"bp\">False</span><span class=\"p\">)</span>\n\n<span class=\"c1\">#Optional code - Make plot look nicer\n</span><span class=\"n\">sns</span><span class=\"p\">.</span><span class=\"n\">despine</span><span class=\"p\">(</span><span class=\"n\">left</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">)</span>\n<span class=\"n\">bottom_plot</span><span class=\"p\">.</span><span class=\"n\">set_ylabel</span><span class=\"p\">(</span><span class=\"s\">\"Y-axis label\"</span><span class=\"p\">)</span>\n<span class=\"n\">bottom_plot</span><span class=\"p\">.</span><span class=\"n\">set_xlabel</span><span class=\"p\">(</span><span class=\"s\">\"X-axis label\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\">#Set fonts to consistent 16pt size\n</span><span class=\"k\">for</span> <span class=\"n\">item</span> <span class=\"ow\">in</span> <span class=\"p\">([</span><span class=\"n\">bottom_plot</span><span class=\"p\">.</span><span class=\"n\">xaxis</span><span class=\"p\">.</span><span class=\"n\">label</span><span class=\"p\">,</span> <span class=\"n\">bottom_plot</span><span class=\"p\">.</span><span class=\"n\">yaxis</span><span class=\"p\">.</span><span class=\"n\">label</span><span class=\"p\">]</span> <span class=\"o\">+</span>\n             <span class=\"n\">bottom_plot</span><span class=\"p\">.</span><span class=\"n\">get_xticklabels</span><span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"n\">bottom_plot</span><span class=\"p\">.</span><span class=\"n\">get_yticklabels</span><span class=\"p\">()):</span>\n    <span class=\"n\">item</span><span class=\"p\">.</span><span class=\"n\">set_fontsize</span><span class=\"p\">(</span><span class=\"mi\">16</span><span class=\"p\">)</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<h2 id=\"dont-overthink-things\">Donâ€™t Overthink Things!</h2>\n\n<p>In the end, creating a stacked bar chart in Seaborn took me 4 hours to mess around trying everything under the sun, then 15 minutes once I remembered what a stacked bar chart actually represents. Hopefully this will save someone else from my same misery.</p>\n\n<p><a href=\"http://randyzwitch.com/wp-content/uploads/2014/09/stacked_bar.csv\">Download chartÂ data</a></p>"
}