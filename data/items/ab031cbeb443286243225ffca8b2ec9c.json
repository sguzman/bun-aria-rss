{
  "title": "String Interpolation for Fun and Profit",
  "description": "<p>In a previous post, I showed how I frequently use <a href=\"http://randyzwitch.com/julia-odbc-jl/\">Julia as a ‘glue’ language</a> to connect multiple systems in a complicated data pipeline. For this blog post, I will show two more examples where I use Julia for general programming, rather than for computationally-intense programs.</p>",
  "pubDate": "Mon, 14 Jul 2014 12:01:10 +0000",
  "link": "http://randyzwitch.com/string-interpolation-julia/",
  "guid": "http://randyzwitch.com/string-interpolation-julia/",
  "content": "<p>In a previous post, I showed how I frequently use <a href=\"http://randyzwitch.com/julia-odbc-jl/\">Julia as a ‘glue’ language</a> to connect multiple systems in a complicated data pipeline. For this blog post, I will show two more examples where I use Julia for general programming, rather than for computationally-intense programs.</p>\n\n<h2 id=\"string-buildingintroduction\">String Building: Introduction</h2>\n\n<p>The <a href=\"http://docs.julialang.org/en/latest/manual/strings/\">Strings section of the Julia Manual</a> provides a very in-depth treatment of the considerations when using strings within Julia. For the purposes of my examples, there are only three things to know:</p>\n\n<ul>\n  <li>Strings are immutable within Julia and 1-indexed</li>\n  <li>Strings are easily created through the a syntax familiar to most languages:</li>\n</ul>\n\n<figure class=\"highlight\"><pre><code class=\"language-julia\" data-lang=\"julia\"><span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"n\">authorname</span> <span class=\"o\">=</span> <span class=\"s\">\"randy zwitch\"</span>\n<span class=\"s\">\"randy zwitch\"</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"n\">typeof</span><span class=\"x\">(</span><span class=\"n\">authorname</span><span class=\"x\">)</span>\n<span class=\"kt\">String</span></code></pre></figure>\n\n<ul>\n  <li>String interpolation is easiest done using dollar-sign notation. Additionally, parenthesis can be used to avoid symbol ambiguity:</li>\n</ul>\n\n<figure class=\"highlight\"><pre><code class=\"language-julia\" data-lang=\"julia\"><span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"n\">interpolated</span> <span class=\"o\">=</span> <span class=\"s\">\"the author of this blog post is </span><span class=\"si\">$(authorname)</span><span class=\"s\">\"</span>\n<span class=\"s\">\"the author of this blog post is randy zwitch\"</span></code></pre></figure>\n\n<p><del>If you are using large volumes of textual data, you’ll want to pay attention to the difference between the various string types that Julia provides (<em>UTF8/16/32, ASCII, Unicode, etc</em>), but for the purposes of this blog post we’ll just be using the <em>ASCIIString</em> type by not explicitly declaring the string type and only using ASCII characters.</del></p>\n\n<p>EDIT, 9/8/2016: Starting with version 0.5, Julia defaults to the <code class=\"language-plaintext highlighter-rouge\">String</code> type, which is an UTF-8 character encoding.</p>\n\n<h2 id=\"example-1-repetitive-queries\">Example 1: Repetitive Queries</h2>\n\n<p>As part of my data engineering responsibilities at work, I often get requests to pull a sample of every table in a new database in our Hadoop cluster. This type of request is usually from the business owner, who wants to evaluate the data set has been imported correctly, but doesn’t actually want to write any sort of queries. So using the <a href=\"https://github.com/quinnj/ODBC.jl\">ODBC.jl</a> package, I repeatedly do the same <code class=\"language-plaintext highlighter-rouge\">select * from &lt;tablename&gt;</code> query and save to individual .tab files:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-julia\" data-lang=\"julia\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n</pre></td><td class=\"code\"><pre><span class=\"n\">_</span>\n<span class=\"n\">_</span>       <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"x\">(</span><span class=\"n\">_</span><span class=\"x\">)</span><span class=\"n\">_</span>     <span class=\"o\">|</span>  <span class=\"n\">A</span> <span class=\"n\">fresh</span> <span class=\"n\">approach</span> <span class=\"n\">to</span> <span class=\"n\">technical</span> <span class=\"n\">computing</span>\n<span class=\"x\">(</span><span class=\"n\">_</span><span class=\"x\">)</span>     <span class=\"o\">|</span> <span class=\"x\">(</span><span class=\"n\">_</span><span class=\"x\">)</span> <span class=\"x\">(</span><span class=\"n\">_</span><span class=\"x\">)</span>    <span class=\"o\">|</span>  <span class=\"n\">Documentation</span><span class=\"o\">:</span> <span class=\"n\">http</span><span class=\"o\">://</span><span class=\"n\">docs</span><span class=\"o\">.</span><span class=\"n\">julialang</span><span class=\"o\">.</span><span class=\"n\">org</span>\n<span class=\"n\">_</span> <span class=\"n\">_</span>   <span class=\"n\">_</span><span class=\"o\">|</span> <span class=\"o\">|</span><span class=\"n\">_</span>  <span class=\"n\">__</span> <span class=\"n\">_</span>   <span class=\"o\">|</span>  <span class=\"kt\">Type</span> <span class=\"s\">\"help()\"</span> <span class=\"n\">to</span> <span class=\"n\">list</span> <span class=\"n\">help</span> <span class=\"n\">topics</span>\n<span class=\"o\">|</span> <span class=\"o\">|</span> <span class=\"o\">|</span> <span class=\"o\">|</span> <span class=\"o\">|</span> <span class=\"o\">|</span> <span class=\"o\">|/</span> <span class=\"n\">_</span><span class=\"err\">`</span> <span class=\"o\">|</span>  <span class=\"o\">|</span>\n<span class=\"o\">|</span> <span class=\"o\">|</span> <span class=\"o\">|</span><span class=\"n\">_</span><span class=\"o\">|</span> <span class=\"o\">|</span> <span class=\"o\">|</span> <span class=\"o\">|</span> <span class=\"x\">(</span><span class=\"n\">_</span><span class=\"o\">|</span> <span class=\"o\">|</span>  <span class=\"o\">|</span>  <span class=\"n\">Version</span> <span class=\"mf\">0.3</span><span class=\"o\">.</span><span class=\"mi\">0</span><span class=\"o\">-</span><span class=\"n\">prerelease</span><span class=\"o\">+</span><span class=\"mi\">4028</span> <span class=\"x\">(</span><span class=\"mi\">2014</span><span class=\"o\">-</span><span class=\"mi\">07</span><span class=\"o\">-</span><span class=\"mi\">02</span> <span class=\"mi\">23</span><span class=\"o\">:</span><span class=\"mi\">42</span> <span class=\"kt\">UTC</span><span class=\"x\">)</span>\n<span class=\"n\">_</span><span class=\"o\">/</span> <span class=\"o\">|\\</span><span class=\"n\">__</span><span class=\"err\">'</span><span class=\"n\">_</span><span class=\"o\">|</span><span class=\"n\">_</span><span class=\"o\">|</span><span class=\"n\">_</span><span class=\"o\">|\\</span><span class=\"n\">__</span><span class=\"err\">'</span><span class=\"n\">_</span><span class=\"o\">|</span>  <span class=\"o\">|</span>  <span class=\"n\">Commit</span> <span class=\"mi\">2185</span><span class=\"n\">bd1</span> <span class=\"x\">(</span><span class=\"mi\">11</span> <span class=\"n\">days</span> <span class=\"n\">old</span> <span class=\"n\">master</span><span class=\"x\">)</span>\n<span class=\"o\">|</span><span class=\"n\">__</span><span class=\"o\">/</span>                   <span class=\"o\">|</span>  <span class=\"n\">x86_64</span><span class=\"o\">-</span><span class=\"n\">w64</span><span class=\"o\">-</span><span class=\"n\">mingw32</span>\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"k\">using</span> <span class=\"n\">ODBC</span>\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"n\">ODBC</span><span class=\"o\">.</span><span class=\"n\">connect</span><span class=\"x\">(</span><span class=\"s\">\"Production hiveserver2\"</span><span class=\"x\">,</span> <span class=\"n\">usr</span><span class=\"o\">=</span><span class=\"s\">\"\"</span><span class=\"x\">,</span> <span class=\"n\">pwd</span><span class=\"o\">=</span><span class=\"s\">\"\"</span><span class=\"x\">)</span>\n<span class=\"n\">ODBC</span> <span class=\"n\">Connection</span> <span class=\"n\">Object</span>\n<span class=\"o\">----------------------</span>\n<span class=\"n\">Connection</span> <span class=\"n\">Data</span> <span class=\"n\">Source</span><span class=\"o\">:</span> <span class=\"n\">Production</span> <span class=\"n\">hiveserver2</span>\n<span class=\"n\">Production</span> <span class=\"n\">hiveserver2</span> <span class=\"n\">Connection</span> <span class=\"kt\">Number</span><span class=\"o\">:</span> <span class=\"mi\">1</span>\n<span class=\"n\">Contains</span> <span class=\"n\">resultset</span><span class=\"o\">?</span> <span class=\"n\">No</span>\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"n\">tables</span> <span class=\"o\">=</span> <span class=\"n\">query</span><span class=\"x\">(</span><span class=\"s\">\"show tables in db;\"</span><span class=\"x\">);</span>\n<span class=\"n\">elapsed</span> <span class=\"n\">time</span><span class=\"o\">:</span> <span class=\"mf\">0.167028049</span> <span class=\"n\">seconds</span>\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"k\">for</span> <span class=\"n\">tbl</span> <span class=\"k\">in</span> <span class=\"n\">tables</span><span class=\"x\">[</span><span class=\"o\">:</span><span class=\"n\">tab_name</span><span class=\"x\">]</span>\n<span class=\"n\">query</span><span class=\"x\">(</span><span class=\"s\">\"select * from db.</span><span class=\"si\">$(tbl) </span><span class=\"s\">limit 1000;\"</span><span class=\"x\">;</span> <span class=\"n\">output</span><span class=\"o\">=</span><span class=\"s\">\"C:</span><span class=\"se\">\\\\</span><span class=\"s\">data_dump</span><span class=\"se\">\\\\</span><span class=\"si\">$(tbl)</span><span class=\"s\">.tab\"</span><span class=\"x\">,</span> <span class=\"n\">delim</span><span class=\"o\">=</span><span class=\"sc\">'\\t'</span><span class=\"x\">)</span>\n<span class=\"k\">end</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>While the query is simple, writing/running this hundreds of times would be a waste of effort. So with a simple loop over the array of tables, I can provide a sample of hundreds of tables in .tab files with five lines of code.</p>\n\n<h2 id=\"example-2-generating-query-code\">Example 2: Generating Query Code</h2>\n\n<p>In another task, I was asked to join a handful of Hive tables, then transpose the table from “long” to “wide”, so that each id value only had one row instead of multiple. This is fairly trivial to do using <code class=\"language-plaintext highlighter-rouge\">CASE</code> statements in SQL; the problem arises when you have thousands of potential row values to transpose into columns! Instead of getting carpal tunnel syndrome typing out thousands of <code class=\"language-plaintext highlighter-rouge\">CASE</code> statements, I decided to use Julia to generate the SQL code itself:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-julia\" data-lang=\"julia\"><table class=\"rouge-table\"><tbody><tr><td class=\"gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n</pre></td><td class=\"code\"><pre><span class=\"c\">#Starting portion of query, the groupby columns</span>\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"n\">groupbycols</span> <span class=\"o\">=</span><span class=\"s\">\"select\ninteract.interactionid,\ninteract.agentname,\ninteract.agentid,\ninteract.agentgroup,\ninteract.agentsupervisor,\ninteract.sitename,\ninteract.dnis,\ninteract.agentextension,\ninteract.interactiondirection,\ninteract.interactiontype,\ninteract.customerid,\ninteract.customercity,\ninteract.customerstate,\ninteract.interactiondatetime,\ninteract.durationinms,\"</span>\n\n<span class=\"c\">#Generate CASE statements based on the number of possible values of queryid</span>\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"k\">function</span><span class=\"nf\"> casestatements</span><span class=\"x\">(</span><span class=\"n\">repetitions</span><span class=\"o\">::</span><span class=\"kt\">Int64</span><span class=\"x\">)</span>\n\t<span class=\"k\">for</span> <span class=\"n\">queryid</span> <span class=\"k\">in</span> <span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">repetitions</span>\n\t\t<span class=\"n\">println</span><span class=\"x\">(</span><span class=\"s\">\"MAX(CASE WHEN q.queryid = </span><span class=\"si\">$</span><span class=\"s\">queryid then q.score END) as q</span><span class=\"si\">$(queryid)</span><span class=\"s\">score,\"</span><span class=\"x\">)</span>\n\t<span class=\"k\">end</span>\n\t<span class=\"k\">for</span> <span class=\"n\">queryid</span> <span class=\"k\">in</span> <span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">repetitions</span>\n\t\t<span class=\"n\">println</span><span class=\"x\">(</span><span class=\"s\">\"MIN(CASE WHEN q.queryid = </span><span class=\"si\">$</span><span class=\"s\">queryid then q.startoffsetinms END) as q</span><span class=\"si\">$(queryid)</span><span class=\"s\">startoffset,\"</span><span class=\"x\">)</span>\n\t<span class=\"k\">end</span>\n\t<span class=\"k\">for</span> <span class=\"n\">queryid</span> <span class=\"k\">in</span> <span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">repetitions</span>\n\t\t<span class=\"n\">println</span><span class=\"x\">(</span><span class=\"s\">\"MAX(CASE WHEN q.queryid = </span><span class=\"si\">$</span><span class=\"s\">queryid then q.endoffsetinms END) as q</span><span class=\"si\">$(queryid)</span><span class=\"s\">endoffset,\"</span><span class=\"x\">)</span>\n\t<span class=\"k\">end</span>\n\t<span class=\"c\">#Last clause, so repeat it up to number of repetitions minus 1, then do simple print to get line without comma at end</span>\n\t<span class=\"k\">for</span> <span class=\"n\">queryid</span> <span class=\"k\">in</span> <span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">repetitions</span><span class=\"o\">-</span><span class=\"mi\">1</span>\n\t\t<span class=\"n\">println</span><span class=\"x\">(</span><span class=\"s\">\"SUM(CASE WHEN q.queryid = </span><span class=\"si\">$</span><span class=\"s\">queryid and q.score &gt; q.mediumthreshold THEN 1 END) as q</span><span class=\"si\">$(queryid)</span><span class=\"s\">hits,\"</span><span class=\"x\">)</span>\n\t<span class=\"k\">end</span>\n\t<span class=\"n\">println</span><span class=\"x\">(</span><span class=\"s\">\"SUM(CASE WHEN q.queryid = </span><span class=\"si\">$</span><span class=\"s\">repetitions and q.score &gt; q.mediumthreshold THEN 1 END) as q</span><span class=\"si\">$(repetitions)</span><span class=\"s\">hits\"</span><span class=\"x\">)</span>\n<span class=\"k\">end</span>\n\n<span class=\"c\">#Ending table statement</span>\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"n\">tablestatements</span> <span class=\"o\">=</span> <span class=\"s\">\"from db.table1 as interact\nleft join db.table2 as q on (interact.interactionid = q.interactionid)\nleft join db.table3 as t on (interact.interactionid = t.interactionid)\ngroup by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15;\"</span>\n\n<span class=\"c\">#Submitting all of the statements on one line is usually frowned upon, but this will generate my SQL code</span>\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"n\">println</span><span class=\"x\">(</span><span class=\"n\">groupbycols</span><span class=\"x\">);</span><span class=\"n\">casestatements</span><span class=\"x\">(</span><span class=\"mi\">5</span><span class=\"x\">);</span><span class=\"n\">println</span><span class=\"x\">(</span><span class=\"n\">tablestatements</span><span class=\"x\">)</span>\n<span class=\"n\">select</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">interactionid</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">agentname</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">agentid</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">agentgroup</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">agentsupervisor</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">sitename</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">dnis</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">agentextension</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">interactiondirection</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">interactiontype</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">customerid</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">customercity</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">customerstate</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">interactiondatetime</span><span class=\"x\">,</span>\n<span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">durationinms</span><span class=\"x\">,</span>\n<span class=\"n\">MAX</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">score</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q1score</span><span class=\"x\">,</span>\n<span class=\"n\">MAX</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">score</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q2score</span><span class=\"x\">,</span>\n<span class=\"n\">MAX</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">3</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">score</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q3score</span><span class=\"x\">,</span>\n<span class=\"n\">MAX</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">4</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">score</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q4score</span><span class=\"x\">,</span>\n<span class=\"n\">MAX</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">5</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">score</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q5score</span><span class=\"x\">,</span>\n<span class=\"n\">MIN</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">startoffsetinms</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q1startoffset</span><span class=\"x\">,</span>\n<span class=\"n\">MIN</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">startoffsetinms</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q2startoffset</span><span class=\"x\">,</span>\n<span class=\"n\">MIN</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">3</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">startoffsetinms</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q3startoffset</span><span class=\"x\">,</span>\n<span class=\"n\">MIN</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">4</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">startoffsetinms</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q4startoffset</span><span class=\"x\">,</span>\n<span class=\"n\">MIN</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">5</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">startoffsetinms</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q5startoffset</span><span class=\"x\">,</span>\n<span class=\"n\">MAX</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">endoffsetinms</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q1endoffset</span><span class=\"x\">,</span>\n<span class=\"n\">MAX</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">endoffsetinms</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q2endoffset</span><span class=\"x\">,</span>\n<span class=\"n\">MAX</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">3</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">endoffsetinms</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q3endoffset</span><span class=\"x\">,</span>\n<span class=\"n\">MAX</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">4</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">endoffsetinms</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q4endoffset</span><span class=\"x\">,</span>\n<span class=\"n\">MAX</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">5</span> <span class=\"n\">then</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">endoffsetinms</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q5endoffset</span><span class=\"x\">,</span>\n<span class=\"n\">SUM</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"n\">and</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">score</span> <span class=\"o\">&gt;</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">mediumthreshold</span> <span class=\"n\">THEN</span> <span class=\"mi\">1</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q1hits</span><span class=\"x\">,</span>\n<span class=\"n\">SUM</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"n\">and</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">score</span> <span class=\"o\">&gt;</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">mediumthreshold</span> <span class=\"n\">THEN</span> <span class=\"mi\">1</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q2hits</span><span class=\"x\">,</span>\n<span class=\"n\">SUM</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">3</span> <span class=\"n\">and</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">score</span> <span class=\"o\">&gt;</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">mediumthreshold</span> <span class=\"n\">THEN</span> <span class=\"mi\">1</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q3hits</span><span class=\"x\">,</span>\n<span class=\"n\">SUM</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">4</span> <span class=\"n\">and</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">score</span> <span class=\"o\">&gt;</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">mediumthreshold</span> <span class=\"n\">THEN</span> <span class=\"mi\">1</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q4hits</span><span class=\"x\">,</span>\n<span class=\"n\">SUM</span><span class=\"x\">(</span><span class=\"n\">CASE</span> <span class=\"n\">WHEN</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">queryid</span> <span class=\"o\">=</span> <span class=\"mi\">5</span> <span class=\"n\">and</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">score</span> <span class=\"o\">&gt;</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">mediumthreshold</span> <span class=\"n\">THEN</span> <span class=\"mi\">1</span> <span class=\"n\">END</span><span class=\"x\">)</span> <span class=\"n\">as</span> <span class=\"n\">q5hits</span>\n<span class=\"n\">from</span> <span class=\"n\">db</span><span class=\"o\">.</span><span class=\"n\">table1</span> <span class=\"n\">as</span> <span class=\"n\">interact</span>\n<span class=\"n\">left</span> <span class=\"n\">join</span> <span class=\"n\">db</span><span class=\"o\">.</span><span class=\"n\">table2</span> <span class=\"n\">as</span> <span class=\"n\">q</span> <span class=\"n\">on</span> <span class=\"x\">(</span><span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">interactionid</span> <span class=\"o\">=</span> <span class=\"n\">q</span><span class=\"o\">.</span><span class=\"n\">interactionid</span><span class=\"x\">)</span>\n<span class=\"n\">left</span> <span class=\"n\">join</span> <span class=\"n\">db</span><span class=\"o\">.</span><span class=\"n\">table3</span> <span class=\"n\">as</span> <span class=\"n\">t</span> <span class=\"n\">on</span> <span class=\"x\">(</span><span class=\"n\">interact</span><span class=\"o\">.</span><span class=\"n\">interactionid</span> <span class=\"o\">=</span> <span class=\"n\">t</span><span class=\"o\">.</span><span class=\"n\">interactionid</span><span class=\"x\">)</span>\n<span class=\"n\">group</span> <span class=\"n\">by</span> <span class=\"mi\">1</span><span class=\"x\">,</span><span class=\"mi\">2</span><span class=\"x\">,</span><span class=\"mi\">3</span><span class=\"x\">,</span><span class=\"mi\">4</span><span class=\"x\">,</span><span class=\"mi\">5</span><span class=\"x\">,</span><span class=\"mi\">6</span><span class=\"x\">,</span><span class=\"mi\">7</span><span class=\"x\">,</span><span class=\"mi\">8</span><span class=\"x\">,</span><span class=\"mi\">9</span><span class=\"x\">,</span><span class=\"mi\">10</span><span class=\"x\">,</span><span class=\"mi\">11</span><span class=\"x\">,</span><span class=\"mi\">12</span><span class=\"x\">,</span><span class=\"mi\">13</span><span class=\"x\">,</span><span class=\"mi\">14</span><span class=\"x\">,</span><span class=\"mi\">15</span><span class=\"x\">;</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span>\n</pre></td></tr></tbody></table></code></pre></figure>\n\n<p>The example here only repeats the <code class=\"language-plaintext highlighter-rouge\">CASE</code> statements five times, which wouldn’t really be that much typing. However, for my actual application, the number of possible values was 2153, leading to a query result which was 8157 columns! Suffice to say, I’d still be writing that code if I decided to do it by hand.</p>\n\n<h2 id=\"summary\">Summary</h2>\n\n<p>Like my ‘glue language’ post, I hope this post has shown that Julia can be used for more than grunting about microbenchmark performance. Whereas I used to use Python for doing weird string operations like this, I’m finding that the dollar-sign syntax in Julia feels more comfortable for me than the Python string formatting mini-language (although that’s not particularly difficult either). So if you’ve been hesitant to jump into learning Julia because you think it’s only useful for doing Mandelbrot calculations or complex linear algebra, Julia is just as at-home doing quick general programming tasks as well.</p>"
}