{
  "title": "Permutation-Invariant Neural Networks for Reinforcement Learning",
  "link": "https://blog.otoro.net/2021/11/18/attentionneuron/",
  "guid": "https://blog.otoro.net/2021/11/18/attentionneuron/",
  "description": "<center>\n<video class=\"b-lazy\" autoplay=\"\" muted=\"\" playsinline=\"\" loop=\"\" style=\"display: block; margin: auto; width: 100%;\"><source src=\"/assets/20211118/cover_orig.mp4\" type=\"video/mp4\" /></video>\n<br />\n<i>Reinforcement learning agents typically perform poorly if provided with inputs that were not clearly defined in training. A new approach enables RL agents to perform well, even when subject to corrupt, incomplete, or shuffled inputs.</i>\n</center>\n<p><br /></p>\n\n<hr />\n\n<p><em>Note: This blog post about our <a href=\"https://attentionneuron.github.io/\">paper</a> is written by <a href=\"https://twitter.com/yujin_tang\">Yujin Tang</a> and myself, and was originally posted on <a href=\"https://ai.googleblog.com/2021/11/permutation-invariant-neural-networks.html\">Google AI Blog</a>. It has been cross-posted here for archival purposes.</em></p>\n\n<hr />\n\n<h2 id=\"introduction\">Introduction</h2>\n\n<p style=\"text-align: center;\"><i>‚ÄúThe brain is able to use information coming from the skin as if it were coming from the eyes. We don‚Äôt see with the eyes or hear with the ears, these are just the receptors, seeing and hearing in fact goes on in the brain.‚Äù</i></p>\n\n<p style=\"text-align: right;\">‚Äî <a href=\"https://en.wikipedia.org/wiki/Paul_Bach-y-Rita\">Paul Bach-y-Rita</a> <a href=\"https://en.wikipedia.org/wiki/Livewired_(book)\">¬π</a></p>\n\n<p>People have the amazing ability to use one sensory modality (e.g., touch) to supply environmental information normally gathered by another sense (e.g., vision). This adaptive ability, called <a href=\"https://en.wikipedia.org/wiki/Sensory_substitution\">sensory substitution</a>, is a phenomenon well-known to neuroscience. While difficult adaptations ‚Äî such as adjusting to seeing things <a href=\"https://www.sciencedirect.com/science/article/abs/pii/S0010945217301314\">upside-down</a>, learning to ride a <a href=\"https://ed.ted.com/best_of_web/bf2mRAfC\">‚Äúbackwards‚Äù bicycle</a>, or learning to ‚Äúsee‚Äù by interpreting visual information emitted from a grid of electrodes placed on one‚Äôs tongue ‚Äî require anywhere from weeks, months or even years to attain mastery, people are able to eventually adjust to sensory substitutions.</p>\n\n<table><tr>\n<td>\n<img src=\"/assets/20211118/tongue.jpg\" width=\"100%\" />\n</td>\n<td>\n<video class=\"b-lazy\" autoplay=\"\" muted=\"\" playsinline=\"\" loop=\"\" style=\"display: block; margin: auto; width: 100%;\"><source src=\"/assets/20211118/reverse_bicycle.mp4\" type=\"video/mp4\" /></video>\n</td>\n</tr></table>\n<p><em>Examples of Sensory Substitution. Left__: ‚ÄúTongue Display Unit‚Äù (<a href=\"https://www.sciencedirect.com/science/article/abs/pii/S0006899301026671\">Maris and Bach-y-Rita, 2001</a>; Image: <a href=\"https://www.sciencedirect.com/science/article/pii/S1026309811001702#f000020\">Kaczmarek, 2011</a>). <strong>Right</strong>: The ‚Äúbackwards brain bicycle‚Äù (<a href=\"https://ed.ted.com/best_of_web/bf2mRAfC\">TED Talk</a>, <a href=\"https://gifs.com/gif/the-backwards-brain-bicycle-smarter-every-day-133-yEEQE8\">Figure</a>).</em></p>\n\n<p>In contrast, most neural networks are not able to adapt to sensory substitutions at all. For instance, most <a href=\"https://en.wikipedia.org/wiki/Reinforcement_learning\">reinforcement learning</a> (RL) agents require their inputs to be in a pre-specified format, or else they will fail. They expect fixed-size inputs and assume that each element of the input carries a precise meaning, such as the pixel intensity at a specified location, or state information, like position or velocity. In popular RL benchmark tasks (e.g., <a href=\"https://pybullet.org/wordpress/\">Ant</a> or <a href=\"https://github.com/google/brain-tokyo-workshop/tree/master/learntopredict/cartpole\">Cart-pole</a>), an agent trained using current <a href=\"https://github.com/DLR-RM/stable-baselines3\">RL algorithms</a> will fail if its sensory inputs are changed or if the agent is fed additional noisy inputs that are unrelated to the task at hand.</p>\n\n<p>In <a href=\"https://attentionneuron.github.io/\">The Sensory Neuron as a Transformer: Permutation-Invariant Neural Networks for Reinforcement Learning</a>, a <a href=\"https://arxiv.org/abs/2109.02869\">spotlight paper</a> at <a href=\"https://neurips.cc/\">NeurIPS 2021</a>, we explore permutation invariant neural network agents, which require each of their sensory neurons (receptors that receive sensory inputs from the environment) to figure out the meaning and context of its input signal, rather than explicitly assuming a fixed meaning. Our experiments show that such agents are robust to observations that contain additional redundant or noisy information, and to observations that are corrupt and incomplete.</p>\n\n<table><tr>\n<td>\n<video class=\"b-lazy\" autoplay=\"\" muted=\"\" playsinline=\"\" loop=\"\" style=\"display: block; margin: auto; width: 100%;\"><source src=\"/assets/20211118/ants.mp4\" type=\"video/mp4\" /></video>\n</td>\n<td>\n<video class=\"b-lazy\" autoplay=\"\" muted=\"\" playsinline=\"\" loop=\"\" style=\"display: block; margin: auto; width: 100%;\"><source src=\"/assets/20211118/cartpole.mp4\" type=\"video/mp4\" /></video>\n</td>\n</tr></table>\n<p><em>Permutation invariant reinforcement learning agents adapting to sensory substitutions. <strong>Left</strong>: The ordering of the ant‚Äôs 28 observations are randomly shuffled every 200 time-steps. Unlike the standard policy, our policy is not affected by the suddenly permuted inputs. <strong>Right</strong>: Cart-pole agent given many redundant noisy inputs (Try interactive <a href=\"https://attentionneuron.github.io/#cartpole_demo_special\">web-demo</a>).</em></p>\n\n<p>In addition to adapting to sensory substitutions in state-observation environments (like the ant and cart-pole examples), we show that these agents can also adapt to sensory substitutions in complex visual-observation environments (such as a <a href=\"https://gym.openai.com/envs/CarRacing-v0/\">CarRacing</a> game that uses only pixel observations) and can perform when the stream of input images is constantly being reshuffled:</p>\n\n<table><tr>\n<td>\n<video class=\"b-lazy\" autoplay=\"\" muted=\"\" playsinline=\"\" loop=\"\" style=\"display: block; margin: auto; width: 100%;\"><source src=\"/assets/20211118/carracing_base.mp4\" type=\"video/mp4\" /></video>\n</td>\n<td>\n<video class=\"b-lazy\" autoplay=\"\" muted=\"\" playsinline=\"\" loop=\"\" style=\"display: block; margin: auto; width: 100%;\"><source src=\"/assets/20211118/carracing_yosemite.mp4\" type=\"video/mp4\" /></video>\n</td>\n</tr></table>\n<p><em>We partition the visual input from CarRacing into a 2D grid of small patches, and shuffled their ordering (<strong>Left</strong>). Without any additional training, our agent still performs even when the original training background is replaced with new images (<strong>Right</strong>).</em></p>\n\n<h2 id=\"method\">Method</h2>\n\n<p>Our approach takes observations from the environment at each time-step and feeds each element of the observation into distinct, but identical neural networks (called ‚Äúsensory neurons‚Äù), each with no fixed relationship with one another. Each sensory neuron integrates over time information from only their particular sensory input channel. Because each sensory neuron receives only a small part of the full picture, they need to <a href=\"https://en.wikipedia.org/wiki/Self-organization\">self-organize</a> through communication in order for a global coherent behavior to <a href=\"https://en.wikipedia.org/wiki/Emergence\">emerge</a>.</p>\n\n<p><img src=\"/assets/20211118/schematic_input.png\" width=\"100%\" />\n<em><strong>Illustration of observation segmentation</strong>. We segment each input into elements, which are then fed to independent sensory neurons. For non-vision tasks where the inputs are usually 1D vectors, each element is a scalar. For vision tasks, we crop each input image into non-overlapping patches.</em></p>\n\n<p>We encourage neurons to communicate with each other by training them to broadcast messages. While receiving information locally, each individual sensory neuron also continually broadcasts an output message at each time-step. These messages are consolidated and combined into an output vector, called the global latent code, using an attention mechanism similar to that applied in the <a href=\"https://ai.googleblog.com/2017/08/transformer-novel-neural-network.html\">Transformer</a> architecture. A policy network then uses the global latent code to produce the action that the agent will use to interact with the environment. This action is also fed back into each sensory neuron in the next time-step, closing the communication loop.</p>\n\n<p><img src=\"/assets/20211118/schematic_main.png\" width=\"100%\" />\n<em><strong>Overview of the permutation-invariant RL method</strong>. We first feed each individual observation (o<sub>t</sub>) into a particular sensory neuron (along with the agent‚Äôs previous action, a<sub>t-1</sub>). Each neuron then produces and broadcasts a message independently, and an attention mechanism summarizes them into a global latent code (m<sub>t</sub>) that is given to the agent‚Äôs downstream policy network (ùúã) to produce the agent‚Äôs action a<sub>t</sub>.</em></p>\n\n<p>Why is this system permutation invariant? Each sensory neuron is an identical neural network that is not confined to only process information from one particular sensory input. In fact, in our setup, the inputs to each sensory neuron are not defined. Instead, each neuron must figure out the meaning of its input signal by paying attention to the inputs received by the other sensory neurons, rather than explicitly assuming a fixed meaning. This encourages the agent to process the entire input as an <a href=\"https://arxiv.org/abs/1810.00825\">unordered set</a>, making the system to be permutation invariant to its input.</p>\n\n<p>The particular form of attention we used has been shown to work with <a href=\"https://arxiv.org/abs/1810.00825\">unordered sets</a>. Since our system treats the input as an unordered set, rather than an ordered list, the output will not be affected by the ordering of the sensory neurons (and by extension the ordering of the observations), thus attaining permutation invariance (our <a href=\"https://attentionneuron.github.io/\">paper</a> includes an intuitive explanation about the permutation invariant of attention, for interested readers looking to dive deeper). By processing the input as an unordered set, rather than a fixed-sized list, the agent can use as many sensory neurons as required, thus enabling it to process observations of arbitrary length. Both of these properties will help the agent adapt to sensory substitutions.</p>\n\n<h2 id=\"results\">Results</h2>\n\n<p>We demonstrate the robustness and flexibility of this approach in simpler, state-observation environments, where the observations the agent receives as inputs are low-dimensional vectors holding information about the agent‚Äôs states, such as the position or velocity of its components. The agent in the popular <a href=\"https://pybullet.org/wordpress/\">Ant</a> locomotion task has a total of 28 inputs with information that includes positions and velocities. We shuffle the order of the input vector several times during a trial and show that the agent is rapidly able to adapt and is still able to walk forward.</p>\n\n<p>In <a href=\"https://github.com/google/brain-tokyo-workshop/tree/master/learntopredict/cartpole\">cart-pole</a>, the agent‚Äôs goal is to swing up a cart-pole mounted at the center of the cart and balance it upright. Normally the agent sees only five inputs, but we modify the cartpole environment to provide 15 shuffled input signals, 10 of which are pure noise, and the remainder of which are the actual observations from the environment. The agent is still able to perform the task, demonstrating the system‚Äôs capacity to work with a large number of inputs and attend only to channels it deems useful. Such flexibility may find useful applications for processing a large unspecified number of signals, most of which are noise, from ill-defined systems.</p>\n\n<p>We also apply this approach to high-dimensional vision-based environments where the observation is a stream of pixel images. Here, we investigate screen-shuffled versions of vision-based RL environments, where each observation frame is divided into a grid of patches, and like a puzzle, the agent must process the patches in a shuffled order to determine a course of action to take. To demonstrate our approach on vision-based tasks, we created a shuffled version of Atari Pong.</p>\n\n<table><tr>\n<td>\n<video class=\"b-lazy\" autoplay=\"\" muted=\"\" playsinline=\"\" loop=\"\" style=\"display: block; margin: auto; width: 100%;\"><source src=\"/assets/20211118/pong_occluded.mp4\" type=\"video/mp4\" /></video>\n</td>\n<td>\n<video class=\"b-lazy\" autoplay=\"\" muted=\"\" playsinline=\"\" loop=\"\" style=\"display: block; margin: auto; width: 100%;\"><source src=\"/assets/20211118/pong_base.mp4\" type=\"video/mp4\" /></video>\n</td>\n</tr></table>\n<p><em><strong>Shuffled Pong results</strong>. <strong>Left</strong>: Pong agent trained to play using only 30% of the patches matches performance of Atari opponent. <strong>Right</strong>: Without extra training, when we give the agent more puzzle pieces, its performance increases.</em></p>\n\n<p>Here the agent‚Äôs input is a variable-length list of patches, so unlike typical RL agents, the agent only gets to ‚Äúsee‚Äù a subset of patches from the screen. In the puzzle pong experiment, we pass to the agent a random sample of patches across the screen, which are then fixed through the remainder of the game. We find that we can discard 70% of the patches (at these fixed-random locations) and still train the agent to perform well against the built-in Atari opponent. Interestingly, if we then reveal additional information to the agent (e.g., allowing it access to more image patches), its performance increases, even without additional training. When the agent receives all the patches, in shuffled order, it wins 100% of the time, achieving the same result with agents that are trained while seeing the entire screen.</p>\n\n<p>We find that imposing additional difficulty during training by using unordered observations has additional benefits, such as improving generalization to unseen variations of the task, like when the background of the <a href=\"https://gym.openai.com/envs/CarRacing-v0/\">CarRacing</a> training environment is replaced with a novel image. To understand why the agent is capable of generalizing to new backgrounds, we visualize the patches of the (shuffled) screen to which the agent was paying attention. We find that the absence of fixed-structure in the observations seems to encourage the agent to learn the essential structures in the environment (e.g., road edges) to best perform its task. We see that these attention attributes also transfer over to test environments, helping the agent generalize its policy to new backgrounds.</p>\n\n<table><tr>\n<td>\n<video class=\"b-lazy\" autoplay=\"\" muted=\"\" playsinline=\"\" loop=\"\" style=\"display: block; margin: auto; width: 100%;\"><source src=\"/assets/20211118/carracing_attention.mp4\" type=\"video/mp4\" /></video>\n</td>\n<td>\n<video class=\"b-lazy\" autoplay=\"\" muted=\"\" playsinline=\"\" loop=\"\" style=\"display: block; margin: auto; width: 100%;\"><source src=\"/assets/20211118/carracing_kyoto.mp4\" type=\"video/mp4\" /></video>\n</td>\n</tr></table>\n<p><em>Shuffled CarRacing results. The agent has learned to focus its attention (indicated by the highlighted patches) on the road boundaries. <strong>Left</strong>: Training environment. <strong>Right</strong>: Test environment with new background.</em></p>\n\n<h2 id=\"conclusion\">Conclusion</h2>\n\n<p>The permutation invariant neural network agents presented here can handle ill-defined, varying observation spaces. Our agents are robust to observations that contain redundant or noisy information, or observations that are corrupt and incomplete. We believe that permutation invariant systems open up numerous possibilities in reinforcement learning.</p>\n\n<p>If you‚Äôre interested to learn more about this work, we invite readers to read our <a href=\"https://attentionneuron.github.io/\">interactive article</a> (<a href=\"https://arxiv.org/abs/2109.02869\">pdf</a> version) or watch our <a href=\"https://youtu.be/7nTlXhx0CZI\">video</a>. We also released <a href=\"https://github.com/google/brain-tokyo-workshop\">code</a> to reproduce our experiments.</p>",
  "pubDate": "Thu, 18 Nov 2021 00:00:00 -0600"
}