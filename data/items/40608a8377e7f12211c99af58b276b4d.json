{
  "title": "A Beginner's Look at BenchmarkTools.jl",
  "description": "<p>For the number of years I’ve been programming using Julia, I’ve never really been concerned with performance. Which is to say, I’ve appreciated that <em>other people</em> are interested in performance and have proven that Julia can be as fast as any other performance language out there. But I’ve never been one to pour over the <a href=\"https://docs.julialang.org/en/v1/manual/performance-tips/\">Performance Tips</a> section of the Julia manual trying to squeeze every last bit of performance.</p>",
  "pubDate": "Mon, 16 Dec 2019 00:00:00 +0000",
  "link": "http://randyzwitch.com/benchmarktools-julia-benchmarking/",
  "guid": "http://randyzwitch.com/benchmarktools-julia-benchmarking/",
  "content": "<p>For the number of years I’ve been programming using Julia, I’ve never really been concerned with performance. Which is to say, I’ve appreciated that <em>other people</em> are interested in performance and have proven that Julia can be as fast as any other performance language out there. But I’ve never been one to pour over the <a href=\"https://docs.julialang.org/en/v1/manual/performance-tips/\">Performance Tips</a> section of the Julia manual trying to squeeze every last bit of performance.</p>\n\n<p>But now that I’ve released <a href=\"https://www.omnisci.com/blog/announcing-omnisci.jl-a-julia-client-for-omnisci\">OmniSci.jl</a>, and as a company one of our major selling points is <a href=\"https://www.omnisci.com/platform\">accelerated analytics</a>, I figured it was time to stop assuming I wrote decent-ish code and really pay attention to performance. This post highlights my experience as a beginner, and hopefully will show how others can get started in learning to optimize their Julia code.</p>\n\n<h2 id=\"read-the-manuals\">Read The Manuals!</h2>\n\n<p>As I mentioned above, I’ve written Julia for many years now, and in that time I’ve grown up with many of the tips in the performance tips section of the documentation. Things like <a href=\"https://docs.julialang.org/en/v1/manual/performance-tips/#Write-%22type-stable%22-functions-1\">“write type stable functions”</a> and <a href=\"https://docs.julialang.org/en/v1/manual/performance-tips/#Avoid-global-variables-1\">“avoid global variables”</a> are things that I’ve internalized as good programming practices, as opposed to doing them just because they are performant. But with this long familiarity with the language comes laziness, and by not reading the BenchmarkTools.jl documentation, I started off benchmarking incorrectly. Consider this example:</p>\n\n<div class=\"language-julia highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"k\">using</span> <span class=\"n\">Random</span><span class=\"x\">,</span> <span class=\"n\">OmniSci</span><span class=\"x\">,</span> <span class=\"n\">BenchmarkTools</span><span class=\"x\">,</span> <span class=\"n\">Base</span><span class=\"o\">.</span><span class=\"n\">Threads</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"c\">#change defaults, since examples long-running</span>\n       <span class=\"n\">BenchmarkTools</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_PARAMETERS</span><span class=\"o\">.</span><span class=\"n\">seconds</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span>\n<span class=\"mi\">1000</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"n\">BenchmarkTools</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_PARAMETERS</span><span class=\"o\">.</span><span class=\"n\">samples</span> <span class=\"o\">=</span> <span class=\"mi\">5</span>\n<span class=\"mi\">5</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"c\">#generate test data</span>\n       <span class=\"n\">gendata</span><span class=\"x\">(</span><span class=\"n\">x</span><span class=\"x\">,</span> <span class=\"n\">T</span><span class=\"x\">)</span> <span class=\"o\">=</span> <span class=\"x\">[</span><span class=\"n\">rand</span><span class=\"x\">(</span><span class=\"n\">typemin</span><span class=\"x\">(</span><span class=\"n\">T</span><span class=\"x\">)</span><span class=\"o\">:</span><span class=\"n\">typemax</span><span class=\"x\">(</span><span class=\"n\">T</span><span class=\"x\">))</span> <span class=\"k\">for</span> <span class=\"n\">y</span> <span class=\"k\">in</span> <span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">x</span><span class=\"x\">]</span>\n<span class=\"n\">gendata</span> <span class=\"x\">(</span><span class=\"n\">generic</span> <span class=\"k\">function</span><span class=\"nf\"> with</span> <span class=\"mi\">1</span> <span class=\"n\">method</span><span class=\"x\">)</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"n\">int64_10x6</span> <span class=\"o\">=</span> <span class=\"n\">gendata</span><span class=\"x\">(</span><span class=\"mi\">10</span><span class=\"o\">^</span><span class=\"mi\">6</span><span class=\"x\">,</span> <span class=\"kt\">Int64</span><span class=\"x\">);</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"c\">#Test whether broadcasting more/less efficient than pre-allocating results array</span>\n       <span class=\"k\">function</span><span class=\"nf\"> preallocate</span><span class=\"x\">(</span><span class=\"n\">x</span><span class=\"x\">)</span>\n\n           <span class=\"n\">v</span> <span class=\"o\">=</span> <span class=\"kt\">Vector</span><span class=\"x\">{</span><span class=\"n\">OmniSci</span><span class=\"o\">.</span><span class=\"n\">TStringValue</span><span class=\"x\">}(</span><span class=\"nb\">undef</span><span class=\"x\">,</span> <span class=\"n\">length</span><span class=\"x\">(</span><span class=\"n\">x</span><span class=\"x\">))</span>\n\n           <span class=\"k\">for</span> <span class=\"n\">idx</span> <span class=\"k\">in</span> <span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">length</span><span class=\"x\">(</span><span class=\"n\">x</span><span class=\"x\">)</span>\n               <span class=\"n\">v</span><span class=\"x\">[</span><span class=\"n\">idx</span><span class=\"x\">]</span> <span class=\"o\">=</span> <span class=\"n\">OmniSci</span><span class=\"o\">.</span><span class=\"n\">TStringValue</span><span class=\"x\">(</span><span class=\"n\">x</span><span class=\"x\">[</span><span class=\"n\">idx</span><span class=\"x\">])</span>\n           <span class=\"k\">end</span>\n\n           <span class=\"k\">return</span> <span class=\"n\">v</span>\n       <span class=\"k\">end</span>\n<span class=\"n\">preallocate</span> <span class=\"x\">(</span><span class=\"n\">generic</span> <span class=\"k\">function</span><span class=\"nf\"> with</span> <span class=\"mi\">1</span> <span class=\"n\">method</span><span class=\"x\">)</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"nd\">@benchmark</span> <span class=\"n\">v61</span> <span class=\"o\">=</span> <span class=\"n\">OmniSci</span><span class=\"o\">.</span><span class=\"n\">TStringValue</span><span class=\"o\">.</span><span class=\"x\">(</span><span class=\"n\">int64_10x6</span><span class=\"x\">)</span>\n<span class=\"n\">BenchmarkTools</span><span class=\"o\">.</span><span class=\"n\">Trial</span><span class=\"o\">:</span>\n  <span class=\"n\">memory</span> <span class=\"n\">estimate</span><span class=\"o\">:</span>  <span class=\"mf\">297.55</span> <span class=\"n\">MiB</span>\n  <span class=\"n\">allocs</span> <span class=\"n\">estimate</span><span class=\"o\">:</span>  <span class=\"mi\">6000005</span>\n  <span class=\"o\">--------------</span>\n  <span class=\"n\">minimum</span> <span class=\"n\">time</span><span class=\"o\">:</span>     <span class=\"mf\">750.146</span> <span class=\"n\">ms</span> <span class=\"x\">(</span><span class=\"mf\">0.00</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">median</span> <span class=\"n\">time</span><span class=\"o\">:</span>      <span class=\"mf\">1.014</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">29.38</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">mean</span> <span class=\"n\">time</span><span class=\"o\">:</span>        <span class=\"mf\">1.151</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">28.38</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">maximum</span> <span class=\"n\">time</span><span class=\"o\">:</span>     <span class=\"mf\">1.794</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">43.06</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"o\">--------------</span>\n  <span class=\"n\">samples</span><span class=\"o\">:</span>          <span class=\"mi\">5</span>\n  <span class=\"n\">evals</span><span class=\"o\">/</span><span class=\"n\">sample</span><span class=\"o\">:</span>     <span class=\"mi\">1</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"nd\">@benchmark</span> <span class=\"n\">v62</span> <span class=\"o\">=</span> <span class=\"n\">preallocate</span><span class=\"x\">(</span><span class=\"n\">int64_10x6</span><span class=\"x\">)</span>\n<span class=\"n\">BenchmarkTools</span><span class=\"o\">.</span><span class=\"n\">Trial</span><span class=\"o\">:</span>\n  <span class=\"n\">memory</span> <span class=\"n\">estimate</span><span class=\"o\">:</span>  <span class=\"mf\">297.55</span> <span class=\"n\">MiB</span>\n  <span class=\"n\">allocs</span> <span class=\"n\">estimate</span><span class=\"o\">:</span>  <span class=\"mi\">6000002</span>\n  <span class=\"o\">--------------</span>\n  <span class=\"n\">minimum</span> <span class=\"n\">time</span><span class=\"o\">:</span>     <span class=\"mf\">753.877</span> <span class=\"n\">ms</span> <span class=\"x\">(</span><span class=\"mf\">0.00</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">median</span> <span class=\"n\">time</span><span class=\"o\">:</span>      <span class=\"mf\">1.021</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">28.30</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">mean</span> <span class=\"n\">time</span><span class=\"o\">:</span>        <span class=\"mf\">1.158</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">28.10</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">maximum</span> <span class=\"n\">time</span><span class=\"o\">:</span>     <span class=\"mf\">1.806</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">43.17</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"o\">--------------</span>\n  <span class=\"n\">samples</span><span class=\"o\">:</span>          <span class=\"mi\">5</span>\n  <span class=\"n\">evals</span><span class=\"o\">/</span><span class=\"n\">sample</span><span class=\"o\">:</span>     <span class=\"mi\">1</span>\n</code></pre></div></div>\n\n<p>The benchmark above tests whether it’s worth <a href=\"https://docs.julialang.org/en/v1/manual/performance-tips/#Pre-allocating-outputs-1\">pre-allocating the results array</a> vs. using the more convenient <a href=\"https://docs.julialang.org/en/v1/manual/functions/#man-vectorized-1\">dot broadcasting syntax</a>. The idea here is that growing an array over and over can be inefficient when you know the result size at the outset. Yet, comparing the times above, for all statistics pre-allocating the array is <em>slightly worse</em>, even though we’re passing the compiler more knowledge up front. This didn’t sit well with me, so I consulted the BenchmarkTools.jl manual and found the following about <a href=\"https://github.com/JuliaCI/BenchmarkTools.jl/blob/master/doc/manual.md#interpolating-values-into-benchmark-expressions\">variable interpolation</a>:</p>\n\n<blockquote>\n  <p>A good rule of thumb is that <strong>external variables should be explicitly interpolated into the benchmark expression</strong></p>\n</blockquote>\n\n<p>Interpolating the <code class=\"language-plaintext highlighter-rouge\">int64_10x6</code> input array into the function takes it from being a global variable to a local, and sure enough, we see roughly a <strong>6% improvement</strong> in the minimum time when we pre-allocate the array:</p>\n\n<div class=\"language-julia highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"nd\">@benchmark</span> <span class=\"n\">v61i</span> <span class=\"o\">=</span> <span class=\"n\">OmniSci</span><span class=\"o\">.</span><span class=\"n\">TStringValue</span><span class=\"o\">.</span><span class=\"x\">(</span><span class=\"o\">$</span><span class=\"n\">int64_10x6</span><span class=\"x\">)</span>\n<span class=\"n\">BenchmarkTools</span><span class=\"o\">.</span><span class=\"n\">Trial</span><span class=\"o\">:</span>\n  <span class=\"n\">memory</span> <span class=\"n\">estimate</span><span class=\"o\">:</span>  <span class=\"mf\">297.55</span> <span class=\"n\">MiB</span>\n  <span class=\"n\">allocs</span> <span class=\"n\">estimate</span><span class=\"o\">:</span>  <span class=\"mi\">6000002</span>\n  <span class=\"o\">--------------</span>\n  <span class=\"n\">minimum</span> <span class=\"n\">time</span><span class=\"o\">:</span>     <span class=\"mf\">763.817</span> <span class=\"n\">ms</span> <span class=\"x\">(</span><span class=\"mf\">0.00</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">median</span> <span class=\"n\">time</span><span class=\"o\">:</span>      <span class=\"mf\">960.446</span> <span class=\"n\">ms</span> <span class=\"x\">(</span><span class=\"mf\">24.02</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">mean</span> <span class=\"n\">time</span><span class=\"o\">:</span>        <span class=\"mf\">1.178</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">28.68</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">maximum</span> <span class=\"n\">time</span><span class=\"o\">:</span>     <span class=\"mf\">1.886</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">45.11</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"o\">--------------</span>\n  <span class=\"n\">samples</span><span class=\"o\">:</span>          <span class=\"mi\">5</span>\n  <span class=\"n\">evals</span><span class=\"o\">/</span><span class=\"n\">sample</span><span class=\"o\">:</span>     <span class=\"mi\">1</span>\n\n<span class=\"n\">julia</span><span class=\"o\">&gt;</span> <span class=\"nd\">@benchmark</span> <span class=\"n\">v62i</span> <span class=\"o\">=</span> <span class=\"n\">preallocate</span><span class=\"x\">(</span><span class=\"o\">$</span><span class=\"n\">int64_10x6</span><span class=\"x\">)</span>\n<span class=\"n\">BenchmarkTools</span><span class=\"o\">.</span><span class=\"n\">Trial</span><span class=\"o\">:</span>\n  <span class=\"n\">memory</span> <span class=\"n\">estimate</span><span class=\"o\">:</span>  <span class=\"mf\">297.55</span> <span class=\"n\">MiB</span>\n  <span class=\"n\">allocs</span> <span class=\"n\">estimate</span><span class=\"o\">:</span>  <span class=\"mi\">6000002</span>\n  <span class=\"o\">--------------</span>\n  <span class=\"n\">minimum</span> <span class=\"n\">time</span><span class=\"o\">:</span>     <span class=\"mf\">721.597</span> <span class=\"n\">ms</span> <span class=\"x\">(</span><span class=\"mf\">0.00</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">median</span> <span class=\"n\">time</span><span class=\"o\">:</span>      <span class=\"mf\">1.072</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">30.45</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">mean</span> <span class=\"n\">time</span><span class=\"o\">:</span>        <span class=\"mf\">1.234</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">32.92</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"n\">maximum</span> <span class=\"n\">time</span><span class=\"o\">:</span>     <span class=\"mf\">1.769</span> <span class=\"n\">s</span> <span class=\"x\">(</span><span class=\"mf\">44.51</span><span class=\"o\">%</span> <span class=\"n\">GC</span><span class=\"x\">)</span>\n  <span class=\"o\">--------------</span>\n  <span class=\"n\">samples</span><span class=\"o\">:</span>          <span class=\"mi\">5</span>\n  <span class=\"n\">evals</span><span class=\"o\">/</span><span class=\"n\">sample</span><span class=\"o\">:</span>     <span class=\"mi\">1</span>\n</code></pre></div></div>\n\n<p>Whether that 6% improvement will hold up over time or not, at least conceptually we’re no longer worse off for pre-allocating, which fits my mental model of how things should work.</p>\n\n<h2 id=\"evaluate-your-benchmark-over-the-range-of-inputs-you-care-about\">Evaluate Your Benchmark Over the Range of Inputs You Care About</h2>\n\n<p>In the comparison above, I evaluate the benchmark over <code class=\"language-plaintext highlighter-rouge\">10^6</code> observations. How did I choose 1 million as the “right” number of events to test, instead of just testing 1 or 10 events? My general goal for benchmarking this code is to speed up the methods of loading data into an OmniSciDB database. <code class=\"language-plaintext highlighter-rouge\">TStringValue</code> is one of the internal methods as part of doing a row-wise table load, converting whatever data is present in an array or DataFrame from <code class=\"language-plaintext highlighter-rouge\">::Type{T}</code> into <code class=\"language-plaintext highlighter-rouge\">String</code> (think iterating over a text file by line). Since users trying to accelerate their database operations are probably going to be using millions to billions of data points, I’m interested in understanding how the functions are performing at these volumes of data.</p>\n\n<p>The other conscious decision I made was the environment to test on. I could test this on massive CPU- and GPU-enabled servers, but I’m testing this on my Dell XPS 15 laptop. Why?  Because I’m actually interested in how things are performing under more real-world conditions for a realistic user. Testing the performance characteristics of a high-end server with tons of memory and cores would be fun, but I want to make sure any performance improvements are broadly applicable, instead of just because I am throwing more hardware at the problem.</p>\n\n<p>Less important to me to control for was garbage collection, using a fresh session before each measurement or other “best case scenario” optimizations. I would expect my users to be more analytics and data science focused, so re-using the same session is going to be common. If the performance improvements aren’t completely obvious, I’m not going to incorporate them into the codebase.</p>\n\n<h2 id=\"case-study-speeding-up-tstringvalue\">Case Study: Speeding Up <code class=\"language-plaintext highlighter-rouge\">TStringValue</code></h2>\n\n<p>For my test, I evaluate the following as the methods to benchmark:</p>\n\n<ul>\n  <li>broadcasting: current library default</li>\n  <li>pre-allocating result array</li>\n  <li>pre-allocated result array with <code class=\"language-plaintext highlighter-rouge\">@inbounds</code> macro</li>\n  <li>pre-allocated result array with threads</li>\n  <li>pre-allocated result array with threads and <code class=\"language-plaintext highlighter-rouge\">@inbounds</code></li>\n</ul>\n\n<h3 id=\"10x6-observations\">10x6 observations</h3>\n\n<div id=\"ts_106\" style=\"height:400px;width:950px;\"></div>\n<script type=\"text/javascript\">\n\n    // Initialize after dom ready\n    var myChart = echarts.init(document.getElementById(\"ts_106\"));\n\n    // Load data into the ECharts instance\n    myChart.setOption(\n{\"xAxis\":[{\"splitNumber\":5,\"axisLabel\":{\"show\":true,\"interval\":\"auto\",\"rotate\":0,\"inside\":false,\"formatter\":\"{value}\",\"margin\":8},\"data\":[\"broadcast\",\"pre-allocate\",\"pre-allocate/inbounds\",\"threads\",\"threads/inbounds\"],\"scale\":false,\"gridIndex\":0,\"minInterval\":0,\"zlevel\":0,\"triggerEvent\":false,\"z\":0,\"inverse\":false,\"nameLocation\":\"middle\",\"nameGap\":30,\"silent\":true,\"type\":\"category\"}],\"ec_charttype\":\"xy plot\",\"series\":[{\"name\":\"Min\",\"yAxisIndex\":0,\"xAxisIndex\":0,\"smooth\":false,\"data\":[752.568,748.719,738.013,249.117,241.585],\"markLine\":{\"data\":[],\"lineStyle\":{}},\"type\":\"bar\"},{\"name\":\"Median\",\"yAxisIndex\":0,\"xAxisIndex\":0,\"smooth\":false,\"data\":[990.071,988.012,967.184,253.161,246.792],\"markLine\":{\"data\":[],\"lineStyle\":{}},\"type\":\"bar\"}],\"theme\":{\"geo\":{\"label\":{\"normal\":{\"textStyle\":{\"color\":\"#000000\"}},\"emphasis\":{\"textStyle\":{\"color\":\"rgb(100,0,0)\"}}},\"itemStyle\":{\"normal\":{\"borderColor\":\"#444444\",\"borderWidth\":0.5,\"areaColor\":\"#eeeeee\"},\"emphasis\":{\"borderColor\":\"#444444\",\"borderWidth\":1,\"areaColor\":\"rgba(255,215,0,0.8)\"}}},\"parallel\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"markPoint\":{\"label\":{\"normal\":{\"textStyle\":{\"color\":\"#eeeeee\"}},\"emphasis\":{\"textStyle\":{\"color\":\"#eeeeee\"}}}},\"visualMap\":{\"color\":[\"#e01f54\",\"#e7dbc3\"]},\"funnel\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"bar\":{\"itemStyle\":{\"normal\":{\"barBorderColor\":\"#ccc\",\"barBorderWidth\":0},\"emphasis\":{\"barBorderColor\":\"#ccc\",\"barBorderWidth\":0}}},\"map\":{\"label\":{\"normal\":{\"textStyle\":{\"color\":\"#000000\"}},\"emphasis\":{\"textStyle\":{\"color\":\"rgb(100,0,0)\"}}},\"itemStyle\":{\"normal\":{\"borderColor\":\"#444444\",\"borderWidth\":0.5,\"areaColor\":\"#eeeeee\"},\"emphasis\":{\"borderColor\":\"#444444\",\"borderWidth\":1,\"areaColor\":\"rgba(255,215,0,0.8)\"}}},\"scatter\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"pie\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"graph\":{\"label\":{\"normal\":{\"textStyle\":{\"color\":\"#eeeeee\"}}},\"symbolSize\":4,\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}},\"smooth\":false,\"symbol\":\"emptyCircle\",\"color\":[\"#e01f54\",\"#001852\",\"#f5e8c8\",\"#b8d2c7\",\"#c6b38e\",\"#a4d8c2\",\"#f3d999\",\"#d3758f\",\"#dcc392\",\"#2e4783\",\"#82b6e9\",\"#ff6347\",\"#a092f1\",\"#0a915d\",\"#eaf889\",\"#6699FF\",\"#ff6666\",\"#3cb371\",\"#d5b158\",\"#38b6b6\"],\"lineStyle\":{\"normal\":{\"color\":\"#aaaaaa\",\"width\":1}}},\"backgroundColor\":\"rgba(0,0,0,0)\",\"line\":{\"symbolSize\":4,\"itemStyle\":{\"normal\":{\"borderWidth\":1}},\"smooth\":false,\"symbol\":\"emptyCircle\",\"lineStyle\":{\"normal\":{\"width\":2}}},\"candlestick\":{\"itemStyle\":{\"normal\":{\"borderColor0\":\"#b8d2c7\",\"color\":\"#e01f54\",\"borderColor\":\"#f5e8c8\",\"borderWidth\":1,\"color0\":\"#001852\"}}},\"sankey\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"valueAxis\":{\"axisLine\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}},\"axisLabel\":{\"textStyle\":{\"color\":\"#333\"},\"show\":true},\"splitLine\":{\"show\":true,\"lineStyle\":{\"color\":[\"#ccc\"]}},\"splitArea\":{\"areaStyle\":{\"color\":[\"rgba(250,250,250,0.3)\",\"rgba(200,200,200,0.3)\"]},\"show\":false},\"axisTick\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}}},\"toolbox\":{\"iconStyle\":{\"normal\":{\"borderColor\":\"#999999\"},\"emphasis\":{\"borderColor\":\"#666666\"}}},\"categoryAxis\":{\"axisLine\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}},\"axisLabel\":{\"textStyle\":{\"color\":\"#333\"},\"show\":true},\"splitLine\":{\"show\":false,\"lineStyle\":{\"color\":[\"#ccc\"]}},\"splitArea\":{\"areaStyle\":{\"color\":[\"rgba(250,250,250,0.3)\",\"rgba(200,200,200,0.3)\"]},\"show\":false},\"axisTick\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}}},\"tooltip\":{\"axisPointer\":{\"crossStyle\":{\"color\":\"#cccccc\",\"width\":1},\"lineStyle\":{\"color\":\"#cccccc\",\"width\":1}}},\"timeline\":{\"label\":{\"normal\":{\"textStyle\":{\"color\":\"#293c55\"}},\"emphasis\":{\"textStyle\":{\"color\":\"#293c55\"}}},\"controlStyle\":{\"normal\":{\"color\":\"#293c55\",\"borderColor\":\"#293c55\",\"borderWidth\":0.5},\"emphasis\":{\"color\":\"#293c55\",\"borderColor\":\"#293c55\",\"borderWidth\":0.5}},\"checkpointStyle\":{\"color\":\"#e43c59\",\"borderColor\":\"rgba(194,53,49,0.5)\"},\"itemStyle\":{\"normal\":{\"color\":\"#293c55\",\"borderWidth\":1},\"emphasis\":{\"color\":\"#a9334c\"}},\"lineStyle\":{\"color\":\"#293c55\",\"width\":1}},\"radar\":{\"symbolSize\":4,\"itemStyle\":{\"normal\":{\"borderWidth\":1}},\"smooth\":false,\"symbol\":\"emptyCircle\",\"lineStyle\":{\"normal\":{\"width\":2}}},\"logAxis\":{\"axisLine\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}},\"axisLabel\":{\"textStyle\":{\"color\":\"#333\"},\"show\":true},\"splitLine\":{\"show\":true,\"lineStyle\":{\"color\":[\"#ccc\"]}},\"splitArea\":{\"areaStyle\":{\"color\":[\"rgba(250,250,250,0.3)\",\"rgba(200,200,200,0.3)\"]},\"show\":false},\"axisTick\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}}},\"textStyle\":{},\"gauge\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"boxplot\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"color\":[\"#e01f54\",\"#001852\",\"#f5e8c8\",\"#b8d2c7\",\"#c6b38e\",\"#a4d8c2\",\"#f3d999\",\"#d3758f\",\"#dcc392\",\"#2e4783\",\"#82b6e9\",\"#ff6347\",\"#a092f1\",\"#0a915d\",\"#eaf889\",\"#6699FF\",\"#ff6666\",\"#3cb371\",\"#d5b158\",\"#38b6b6\"],\"title\":{\"textStyle\":{\"color\":\"#333333\"},\"subtextStyle\":{\"color\":\"#aaaaaa\"}},\"dataZoom\":{\"dataBackgroundColor\":\"rgba(47,69,84,0.3)\",\"textStyle\":{\"color\":\"#333333\"},\"handleSize\":\"100%\",\"handleColor\":\"#a7b7cc\",\"fillerColor\":\"rgba(167,183,204,0.4)\",\"backgroundColor\":\"rgba(47,69,84,0)\"},\"timeAxis\":{\"axisLine\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}},\"axisLabel\":{\"textStyle\":{\"color\":\"#333\"},\"show\":true},\"splitLine\":{\"show\":true,\"lineStyle\":{\"color\":[\"#ccc\"]}},\"splitArea\":{\"areaStyle\":{\"color\":[\"rgba(250,250,250,0.3)\",\"rgba(200,200,200,0.3)\"]},\"show\":false},\"axisTick\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}}},\"legend\":{\"textStyle\":{\"color\":\"#333333\"}}},\"yAxis\":[{\"splitNumber\":5,\"axisLabel\":{\"show\":true,\"interval\":\"auto\",\"rotate\":0,\"inside\":false,\"formatter\":\"{value}\",\"margin\":8},\"scale\":false,\"gridIndex\":0,\"minInterval\":0,\"zlevel\":0,\"triggerEvent\":false,\"z\":0,\"inverse\":false,\"nameLocation\":\"middle\",\"nameGap\":50,\"silent\":true,\"type\":\"value\"}],\"toolbox\":{\"feature\":{},\"orient\":\"vertical\",\"itemSize\":15,\"height\":\"auto\",\"zlevel\":0,\"z\":2,\"itemGap\":20,\"right\":\"auto\",\"top\":\"center\",\"width\":\"auto\",\"show\":false,\"showTitle\":true},\"ec_width\":1000,\"ec_height\":500,\"tooltip\":{\"triggerOn\":\"mousemove\",\"enterable\":true,\"borderColor\":\"#333\",\"transitionDuration\":0.4,\"hideDelay\":100,\"padding\":5,\"showDelay\":0,\"borderWidth\":0,\"showContent\":true,\"backgroundColor\":\"rgba(50,50,50,0.7)\",\"trigger\":\"item\",\"alwaysShowContent\":false,\"confine\":false,\"show\":true},\"grid\":[{\"height\":\"auto\",\"show\":false,\"width\":\"auto\",\"backgroundColor\":\"transparent\"}],\"aria\":{\"show\":true},\"title\":[{\"left\":\"left\",\"borderColor\":\"transparent\",\"bottom\":\"auto\",\"padding\":5,\"zlevel\":0,\"borderWidth\":1,\"target\":\"blank\",\"z\":2,\"itemGap\":5,\"shadowOffsetY\":0,\"shadowOffsetX\":0,\"right\":\"auto\",\"top\":\"auto\",\"subtarget\":\"blank\",\"show\":true}],\"ec_renderer\":\"canvas\",\"legend\":{\"itemWidth\":25,\"data\":[\"Min\",\"Median\"],\"borderColor\":\"transparent\",\"orient\":\"horizontal\",\"bottom\":\"auto\",\"height\":\"auto\",\"zlevel\":0,\"padding\":5,\"borderWidth\":1,\"inactiveColor\":\"#ccc\",\"z\":2,\"align\":\"auto\",\"itemGap\":10,\"itemHeight\":14,\"backgroundColor\":\"transparent\",\"shadowOffsetY\":0,\"shadowOffsetX\":0,\"right\":\"auto\",\"top\":\"auto\",\"width\":\"auto\",\"selectedMode\":true,\"show\":true}} );\n</script>\n\n<p>For the first three on the left, these are comparisons of the single-threaded methods. You can see that pre-allocating the output array is marginally faster than broadcasting, and using the <code class=\"language-plaintext highlighter-rouge\">@inbounds</code> macro is incrementally faster still, but neither method provides enough speedup to be worth implementing. The difference between the red and the blue bars represents a garbage collection occurring, but again, the three methods aren’t different enough to notice anything interesting.</p>\n\n<p>For the multi-threaded tests, I’m using 6 threads (one per physical core), and we’re seeing roughly a <strong>3x speedup</strong>. Like the single-threaded tests above, using <code class=\"language-plaintext highlighter-rouge\">@inbounds</code> is only marginally faster, but not enough to widely implement for the cost of increased code complexity. Interestingly, doing these multi-threaded benchmarks didn’t trigger garbage collect <em>at all</em> across my five iterations; not sure if this is specific due to threading or not, but something to explore outside of this blog post.</p>\n\n<h3 id=\"10x7-observations\">10x7 observations</h3>\n\n<p>To see how these calculation methods might change at a larger scale, I bumped up the observations by an order of 10 and saw the following results:</p>\n\n<div id=\"ts_108\" style=\"height:400px;width:950px;\"></div>\n<script type=\"text/javascript\">\n\n    // Initialize after dom ready\n    var myChart = echarts.init(document.getElementById(\"ts_108\"));\n\n    // Load data into the ECharts instance\n    myChart.setOption(\n{\"xAxis\":[{\"splitNumber\":5,\"axisLabel\":{\"show\":true,\"interval\":\"auto\",\"rotate\":0,\"inside\":false,\"formatter\":\"{value}\",\"margin\":8},\"data\":[\"broadcast\",\"pre-allocate\",\"pre-allocate/inbounds\",\"threads\",\"threads/inbounds\"],\"scale\":false,\"gridIndex\":0,\"minInterval\":0,\"zlevel\":0,\"triggerEvent\":false,\"z\":0,\"inverse\":false,\"nameLocation\":\"middle\",\"nameGap\":30,\"silent\":true,\"type\":\"category\"}],\"ec_charttype\":\"xy plot\",\"series\":[{\"name\":\"Min\",\"yAxisIndex\":0,\"xAxisIndex\":0,\"smooth\":false,\"data\":[26.316,27.064,26.219,2.717,2.641],\"markLine\":{\"data\":[],\"lineStyle\":{}},\"type\":\"bar\"},{\"name\":\"Median\",\"yAxisIndex\":0,\"xAxisIndex\":0,\"smooth\":false,\"data\":[39.332,38.925,39.387,17.659,16.659],\"markLine\":{\"data\":[],\"lineStyle\":{}},\"type\":\"bar\"}],\"theme\":{\"geo\":{\"label\":{\"normal\":{\"textStyle\":{\"color\":\"#000000\"}},\"emphasis\":{\"textStyle\":{\"color\":\"rgb(100,0,0)\"}}},\"itemStyle\":{\"normal\":{\"borderColor\":\"#444444\",\"borderWidth\":0.5,\"areaColor\":\"#eeeeee\"},\"emphasis\":{\"borderColor\":\"#444444\",\"borderWidth\":1,\"areaColor\":\"rgba(255,215,0,0.8)\"}}},\"parallel\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"markPoint\":{\"label\":{\"normal\":{\"textStyle\":{\"color\":\"#eeeeee\"}},\"emphasis\":{\"textStyle\":{\"color\":\"#eeeeee\"}}}},\"visualMap\":{\"color\":[\"#e01f54\",\"#e7dbc3\"]},\"funnel\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"bar\":{\"itemStyle\":{\"normal\":{\"barBorderColor\":\"#ccc\",\"barBorderWidth\":0},\"emphasis\":{\"barBorderColor\":\"#ccc\",\"barBorderWidth\":0}}},\"map\":{\"label\":{\"normal\":{\"textStyle\":{\"color\":\"#000000\"}},\"emphasis\":{\"textStyle\":{\"color\":\"rgb(100,0,0)\"}}},\"itemStyle\":{\"normal\":{\"borderColor\":\"#444444\",\"borderWidth\":0.5,\"areaColor\":\"#eeeeee\"},\"emphasis\":{\"borderColor\":\"#444444\",\"borderWidth\":1,\"areaColor\":\"rgba(255,215,0,0.8)\"}}},\"scatter\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"pie\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"graph\":{\"label\":{\"normal\":{\"textStyle\":{\"color\":\"#eeeeee\"}}},\"symbolSize\":4,\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}},\"smooth\":false,\"symbol\":\"emptyCircle\",\"color\":[\"#e01f54\",\"#001852\",\"#f5e8c8\",\"#b8d2c7\",\"#c6b38e\",\"#a4d8c2\",\"#f3d999\",\"#d3758f\",\"#dcc392\",\"#2e4783\",\"#82b6e9\",\"#ff6347\",\"#a092f1\",\"#0a915d\",\"#eaf889\",\"#6699FF\",\"#ff6666\",\"#3cb371\",\"#d5b158\",\"#38b6b6\"],\"lineStyle\":{\"normal\":{\"color\":\"#aaaaaa\",\"width\":1}}},\"backgroundColor\":\"rgba(0,0,0,0)\",\"line\":{\"symbolSize\":4,\"itemStyle\":{\"normal\":{\"borderWidth\":1}},\"smooth\":false,\"symbol\":\"emptyCircle\",\"lineStyle\":{\"normal\":{\"width\":2}}},\"candlestick\":{\"itemStyle\":{\"normal\":{\"borderColor0\":\"#b8d2c7\",\"color\":\"#e01f54\",\"borderColor\":\"#f5e8c8\",\"borderWidth\":1,\"color0\":\"#001852\"}}},\"sankey\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"valueAxis\":{\"axisLine\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}},\"axisLabel\":{\"textStyle\":{\"color\":\"#333\"},\"show\":true},\"splitLine\":{\"show\":true,\"lineStyle\":{\"color\":[\"#ccc\"]}},\"splitArea\":{\"areaStyle\":{\"color\":[\"rgba(250,250,250,0.3)\",\"rgba(200,200,200,0.3)\"]},\"show\":false},\"axisTick\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}}},\"toolbox\":{\"iconStyle\":{\"normal\":{\"borderColor\":\"#999999\"},\"emphasis\":{\"borderColor\":\"#666666\"}}},\"categoryAxis\":{\"axisLine\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}},\"axisLabel\":{\"textStyle\":{\"color\":\"#333\"},\"show\":true},\"splitLine\":{\"show\":false,\"lineStyle\":{\"color\":[\"#ccc\"]}},\"splitArea\":{\"areaStyle\":{\"color\":[\"rgba(250,250,250,0.3)\",\"rgba(200,200,200,0.3)\"]},\"show\":false},\"axisTick\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}}},\"tooltip\":{\"axisPointer\":{\"crossStyle\":{\"color\":\"#cccccc\",\"width\":1},\"lineStyle\":{\"color\":\"#cccccc\",\"width\":1}}},\"timeline\":{\"label\":{\"normal\":{\"textStyle\":{\"color\":\"#293c55\"}},\"emphasis\":{\"textStyle\":{\"color\":\"#293c55\"}}},\"controlStyle\":{\"normal\":{\"color\":\"#293c55\",\"borderColor\":\"#293c55\",\"borderWidth\":0.5},\"emphasis\":{\"color\":\"#293c55\",\"borderColor\":\"#293c55\",\"borderWidth\":0.5}},\"checkpointStyle\":{\"color\":\"#e43c59\",\"borderColor\":\"rgba(194,53,49,0.5)\"},\"itemStyle\":{\"normal\":{\"color\":\"#293c55\",\"borderWidth\":1},\"emphasis\":{\"color\":\"#a9334c\"}},\"lineStyle\":{\"color\":\"#293c55\",\"width\":1}},\"radar\":{\"symbolSize\":4,\"itemStyle\":{\"normal\":{\"borderWidth\":1}},\"smooth\":false,\"symbol\":\"emptyCircle\",\"lineStyle\":{\"normal\":{\"width\":2}}},\"logAxis\":{\"axisLine\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}},\"axisLabel\":{\"textStyle\":{\"color\":\"#333\"},\"show\":true},\"splitLine\":{\"show\":true,\"lineStyle\":{\"color\":[\"#ccc\"]}},\"splitArea\":{\"areaStyle\":{\"color\":[\"rgba(250,250,250,0.3)\",\"rgba(200,200,200,0.3)\"]},\"show\":false},\"axisTick\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}}},\"textStyle\":{},\"gauge\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"boxplot\":{\"itemStyle\":{\"normal\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"},\"emphasis\":{\"borderWidth\":0,\"borderColor\":\"#ccc\"}}},\"color\":[\"#e01f54\",\"#001852\",\"#f5e8c8\",\"#b8d2c7\",\"#c6b38e\",\"#a4d8c2\",\"#f3d999\",\"#d3758f\",\"#dcc392\",\"#2e4783\",\"#82b6e9\",\"#ff6347\",\"#a092f1\",\"#0a915d\",\"#eaf889\",\"#6699FF\",\"#ff6666\",\"#3cb371\",\"#d5b158\",\"#38b6b6\"],\"title\":{\"textStyle\":{\"color\":\"#333333\"},\"subtextStyle\":{\"color\":\"#aaaaaa\"}},\"dataZoom\":{\"dataBackgroundColor\":\"rgba(47,69,84,0.3)\",\"textStyle\":{\"color\":\"#333333\"},\"handleSize\":\"100%\",\"handleColor\":\"#a7b7cc\",\"fillerColor\":\"rgba(167,183,204,0.4)\",\"backgroundColor\":\"rgba(47,69,84,0)\"},\"timeAxis\":{\"axisLine\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}},\"axisLabel\":{\"textStyle\":{\"color\":\"#333\"},\"show\":true},\"splitLine\":{\"show\":true,\"lineStyle\":{\"color\":[\"#ccc\"]}},\"splitArea\":{\"areaStyle\":{\"color\":[\"rgba(250,250,250,0.3)\",\"rgba(200,200,200,0.3)\"]},\"show\":false},\"axisTick\":{\"show\":true,\"lineStyle\":{\"color\":\"#333\"}}},\"legend\":{\"textStyle\":{\"color\":\"#333333\"}}},\"yAxis\":[{\"splitNumber\":5,\"axisLabel\":{\"show\":true,\"interval\":\"auto\",\"rotate\":0,\"inside\":false,\"formatter\":\"{value}\",\"margin\":8},\"scale\":false,\"gridIndex\":0,\"minInterval\":0,\"zlevel\":0,\"triggerEvent\":false,\"z\":0,\"inverse\":false,\"nameLocation\":\"middle\",\"nameGap\":50,\"silent\":true,\"type\":\"value\"}],\"toolbox\":{\"feature\":{},\"orient\":\"vertical\",\"itemSize\":15,\"height\":\"auto\",\"zlevel\":0,\"z\":2,\"itemGap\":20,\"right\":\"auto\",\"top\":\"center\",\"width\":\"auto\",\"show\":false,\"showTitle\":true},\"ec_width\":1000,\"ec_height\":500,\"tooltip\":{\"triggerOn\":\"mousemove\",\"enterable\":true,\"borderColor\":\"#333\",\"transitionDuration\":0.4,\"hideDelay\":100,\"padding\":5,\"showDelay\":0,\"borderWidth\":0,\"showContent\":true,\"backgroundColor\":\"rgba(50,50,50,0.7)\",\"trigger\":\"item\",\"alwaysShowContent\":false,\"confine\":false,\"show\":true},\"grid\":[{\"height\":\"auto\",\"show\":false,\"width\":\"auto\",\"backgroundColor\":\"transparent\"}],\"aria\":{\"show\":true},\"color\":[\"#10222B\",\"#95AB63\",\"#BDD684\",\"#E2F0D6\",\"#F6FFE0\"],\"title\":[{\"left\":\"left\",\"borderColor\":\"transparent\",\"bottom\":\"auto\",\"padding\":5,\"zlevel\":0,\"borderWidth\":1,\"target\":\"blank\",\"z\":2,\"itemGap\":5,\"shadowOffsetY\":0,\"shadowOffsetX\":0,\"right\":\"auto\",\"top\":\"auto\",\"subtarget\":\"blank\",\"show\":true}],\"ec_renderer\":\"canvas\",\"legend\":{\"itemWidth\":25,\"data\":[\"Min\",\"Median\"],\"borderColor\":\"transparent\",\"orient\":\"horizontal\",\"bottom\":\"auto\",\"height\":\"auto\",\"zlevel\":0,\"padding\":5,\"borderWidth\":1,\"inactiveColor\":\"#ccc\",\"z\":2,\"align\":\"auto\",\"itemGap\":10,\"itemHeight\":14,\"backgroundColor\":\"transparent\",\"shadowOffsetY\":0,\"shadowOffsetX\":0,\"right\":\"auto\",\"top\":\"auto\",\"width\":\"auto\",\"selectedMode\":true,\"show\":true}});\n</script>\n\n<p>Like at the 1 million data range, there isn’t much difference between the three single-threaded methods. All three of them are within a few percentage in either direction (all three methods triggered garbage collection in each of their five runs).</p>\n\n<p>For the multi-threaded tests, an interesting performance scenario emerged. Like the 1 million point tests, it’s possible to get a run where garbage collection isn’t triggered, which leads to a large min/median difference in the multi-threaded tests. If you can avoid garbage collection, using six threads here gives nearly a <strong>10x speedup</strong>, and at the median where both single-threaded and multi-threaded trigger garbage collection you still get a <strong>2x speedup</strong>.</p>\n\n<h2 id=\"parallelism--compiler-hinting\">Parallelism &gt; Compiler Hinting</h2>\n\n<p>In the case study above, I’ve demonstrated that for this problem, threading is the first way to pursue speeding up the OmniSci.jl load table methods. While pre-allocating the size of the output array and using the <code class=\"language-plaintext highlighter-rouge\">@inbounds</code> did show some slight speedups, using threads to perform the calculations are where the largest improvements occurred. Incorporating the pre-allocation step naturally comes out from the way I wrote the threading methods, so I’ll incorporate that too. Disabling bounds-checking on arrays using <code class=\"language-plaintext highlighter-rouge\">@inbounds</code> seems more dangerous than it is worth, even though none of these methods should ever get outside of their bounds.</p>\n\n<p>Overall, I hope this post has demonstrated that you don’t have to fancy yourself a high-frequency trader or a bit-twiddler to find ways to improve your Julia code. The first step is reading the manuals for benchmarking, and then like any other pursuit, the only way to get a feeling for what works is to try things.</p>\n\n<p><br /></p>\n\n<p><em>All of the code for this blog post can be found in this <a href=\"https://gist.github.com/randyzwitch/dbe9ce13aa819a1306d62610bb58b173\">GitHub gist</a></em></p>"
}