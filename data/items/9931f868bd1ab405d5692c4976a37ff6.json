{
  "title": "A Footnote in History",
  "link": "https://www.r-bloggers.com/2022/10/a-footnote-in-history/",
  "dc:creator": "Category R on Quantum Jitter",
  "pubDate": "Tue, 01 Nov 2022 00:00:00 +0000",
  "category": "R bloggers",
  "guid": "https://www.quantumjitter.com/project/footnote/",
  "description": "<p>Producing a journal-quality table requires fine-grained and reproducible control over presentation. Surgical targeting of footnotes, capable of adapting to changes in the underlying data, is one example.<br />\nThis post briefly explores the shifts in the ...</p>\n<strong>Continue reading</strong>: <a href=\"https://www.r-bloggers.com/2022/10/a-footnote-in-history/\">A Footnote in History</a>",
  "content:encoded": "<!-- \n<div style=\"min-height: 30px;\">\n[social4i size=\"small\" align=\"align-left\"]\n</div>\n-->\n\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 12px;\">\n[This article was first published on  <strong><a href=\"https://www.quantumjitter.com/project/footnote/\"> Category R on Quantum Jitter</a></strong>, and kindly contributed to <a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers</a>].  (You can report issue about the content on this page <a href=\"https://www.r-bloggers.com/contact-us/\">here</a>)\n<hr>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div>\n<script src=\"https://www.quantumjitter.com/project/footnote/index_files/libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"https://www.quantumjitter.com/project/footnote/index_files/libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<p><img src=\"https://i1.wp.com/www.quantumjitter.com/project/footnote/feature.gif?w=578&#038;ssl=1\" alt=\"\" data-recalc-dims=\"1\"></p>\n<p>Producing a journal-quality table requires fine-grained and reproducible control over presentation. Surgical targeting of footnotes, capable of adapting to changes in the underlying data, is one example.</p>\n<p>This post briefly explores the shifts in the nature of employment whilst at the same time visiting the grammar of tables \n<a href=\"https://gt.rstudio.com/\" rel=\"nofollow\" target=\"_blank\">gt</a>: The natural companion to the grammar of graphics \n<a href=\"https://ggplot2.tidyverse.org/\" rel=\"nofollow\" target=\"_blank\">ggplot2</a>.</p>\n<pre>library(tidyverse)\nlibrary(readxl)\nlibrary(gt)\nlibrary(kableExtra)\n</pre><p>Tables are rendered across all \n<a href=\"https://www.quantumjitter.com/project/\" rel=\"nofollow\" target=\"_blank\">projects</a> on this site; as a minimum at the end to summarise an auto-generated overview of the R packages and functions used. For these tables, \n<a href=\"https://github.com/haozhu233/kableExtra\" rel=\"nofollow\" target=\"_blank\">kableExtra</a> has been the go-to solution which requires simply piping the data frame into <code>kbl()</code>.</p>\n<p>In \n<a href=\"https://www.quantumjitter.com/project/planning/\" rel=\"nofollow\" target=\"_blank\">Digging Deep</a>, the \n<a href=\"https://rstudio.github.io/DT/\" rel=\"nofollow\" target=\"_blank\">DT package</a> is used to produce a <strong>reactable</strong> table; one with sortable and searchable columns. DT is intended as an R interface to the DataTables library, but reactivity is not yet supported in gt.</p>\n<p>As a guiding principle, RStudio – soon to be \n<a href=\"https://posit.co/\" rel=\"nofollow\" target=\"_blank\">Posit</a> – packages are my first port of call. This provides a confidence in cross-package consistency, longevity and an investment in development and support. Hence \n<a href=\"https://gt.rstudio.com/\" rel=\"nofollow\" target=\"_blank\">gt</a> will be the go-to package for the static table further down.</p>\n<p>As the intent is to present a summary in the style of the Financial Times, we’ll need a suitable custom \n<a href=\"https://registry.origami.ft.com/components/o-colors@6.4.2\" rel=\"nofollow\" target=\"_blank\">colour palette</a>.</p>\n<pre>theme_set(theme_bw())\n\ncols <- c(\n  \"#FFF1E5\", \"#F2DFCE\",\n  \"#333333\", \"#800D33\",\n  \"#C00000\", \"#00994D\"\n) |>\n  fct_inorder()\n\ntibble(x = 1:6, y = 1) |>\n  ggplot(aes(x, y, fill = cols)) +\n  geom_col() +\n  geom_label(aes(label = cols), \n             nudge_y = -0.1, fill = \"white\") +\n  annotate(\n    \"label\",\n    x = 3.5, y = 0.5,\n    label = \"Financial Times\",\n    fill = \"white\",\n    alpha = 0.8,\n    size = 6\n  ) +\n  scale_fill_manual(values = as.character(cols)) +\n  theme_void() +\n  theme(legend.position = \"none\")\n</pre><img src=\"https://i2.wp.com/www.quantumjitter.com/project/footnote/index.markdown_strict_files/figure-markdown_strict/theme-1.png?w=450&#038;ssl=1\" data-recalc-dims=\"1\" />\n<p>The labour market data are sourced from the \n<a href=\"https://www.nomisweb.co.uk/datasets/aps168/reports/employment-by-occupation?compare=K02000001\" rel=\"nofollow\" target=\"_blank\">Office for National Statistics</a>.</p>\n<pre>read_data <- function(x) {\n  read_xlsx(\n    x,\n    skip = 12,\n    col_names = c(\n      \"occupation\",\n      \"persons\"\n    ),\n    col_types = c(\n      \"text\",\n      \"numeric\",\n      \"skip\",\n      \"skip\",\n      \"skip\",\n      \"skip\",\n      \"skip\"\n    )\n  )\n} |> \n  mutate(year = x |> str_remove(\".xlsx\") |> as.integer())\n\npop_df <- list(\"2004.xlsx\", \"2021.xlsx\") |> \n  map_dfr(read_data)\n</pre><p>There’s a hierarchy to the data, so I’ll extract the lowest level and then slice off the top and bottom occupations based on their percentage change over time.</p>\n<pre>change_df <- pop_df |> \n  filter(str_starts(occupation, \"\\\\d{4} \")) |> \n  pivot_wider(names_from = year, values_from = persons) |> \n  separate(occupation, into = c(\"soc\", \"occupation\"), sep = 5) |> \n  mutate(change = `2021` / `2004` - 1) |> \n  arrange(desc(change)) |> \n  mutate(group = if_else(row_number() <= 10, \"Risers\", \"Fallers\")) |> \n  slice(c(1:10, (n()-10):n())) |> \n  relocate(group)\n</pre><p>The handling of footnotes is a particularly nice feature in \n<a href=\"https://gt.rstudio.com/\" rel=\"nofollow\" target=\"_blank\">gt</a>: The package automatically assigns, and maintains the order of, the superscripted numbers (could also be symbols) to ensure they flow naturally. And targeting offers a high degree of control and reproducibility.</p>\n<p>For example, two entries in the table below use the abbreviation <em>n.e.c.</em>. The footnote may be targeted at rows which <em>contain that string</em> rather than having to manually identify the rows. And once added, any subsequent footnotes would be renumbered to maintain the flow. So, if I were to change the source datasets to different years or countries, all references to <em>n.e.c.</em> would be automagically found and appropriately footnoted.</p>\n<pre>gt_tbl <- change_df |>\n  gt(rowname_col = c(\"occupation\"), groupname_col = \"group\") |>\n  tab_header(title = \"UK Employment by Occupation\") |> \n  fmt_number(\n    columns = starts_with(\"2\"),\n    decimals = 0\n  ) |>\n  fmt_percent(\n    columns = starts_with(\"c\"),\n    decimals = 0,\n    force_sign = TRUE\n  ) |>\n  sub_missing() |>\n  tab_spanner(\n    label = \"Year\",\n    columns = starts_with(\"2\")\n  ) |> \n  tab_style(\n    style = cell_text(transform = \"capitalize\"),\n    locations = cells_column_labels(!starts_with(\"s\"))\n  ) |> \n  tab_style(\n    style = cell_text(transform = \"uppercase\"),\n    locations = cells_column_labels(\"soc\")\n  ) |> \n  tab_footnote(\n    footnote = \"Not elsewhere classified\",\n    locations = cells_stub(rows = contains(\"n.e.c.\"))\n  ) |>\n  tab_footnote(\n    footnote = \"Count of all persons\",\n    locations = cells_column_spanners()\n  ) |>\n  tab_footnote(\n    footnote = \"Standard Occupational Classification 2020\",\n    locations = cells_column_labels(columns = \"soc\")\n  ) |>\n  tab_footnote(\n    footnote = \"Top & bottom 10 occupations ordered by percent change\",\n    locations = cells_row_groups(groups = c(\"Risers\", \"Fallers\"))\n  ) |>\n  tab_footnote(\n    footnote = \"Figures suppressed as statistically unreliable\",\n    locations = cells_body(\n      columns = c(change, `2021`),\n      rows = is.na(change)\n    )\n  ) |>\n  tab_source_note(source_note = \"Source: Office for National Statistics (ONS)\")\n\ngt_tbl |> \n  opt_stylize(style = 6, color = \"gray\", add_row_striping = TRUE) |> \n  gtsave(\"styled.png\")\n</pre><p><img src=\"https://i1.wp.com/www.quantumjitter.com/project/footnote/styled.png?w=578&#038;ssl=1\" alt=\"\" data-recalc-dims=\"1\"></p>\n<p>The above table uses one of the in-built style theme options. It looks clean and polished. But sometimes the table to be published needs a high degree of customisation to match, for example, a specific branding. \n<a href=\"https://gt.rstudio.com/\" rel=\"nofollow\" target=\"_blank\">gt</a> offers this as we’ll demonstrate by attempting to replicate the style employed by the \n<a href=\"https://markets.ft.com/data/\" rel=\"nofollow\" target=\"_blank\">market data in the Financial Times</a>.</p>\n<pre>gt_ft <- gt_tbl |> \n  tab_options(\n    table.border.top.color = \"#FFF1E5\",\n    table.border.bottom.color = \"#FFF1E5\",\n    table.background.color = \"#FFF1E5\",\n    table.font.size = 8,\n    table.font.color = \"#262A33\",\n    row.striping.include_table_body = TRUE,\n    row.striping.include_stub = TRUE,\n    row.striping.background_color = \"#F2DFCE\",\n    heading.background.color = \"#FFF1E5\",\n    row_group.background.color = \"#FFF1E5\"\n  ) |> \n  opt_vertical_padding(scale = 1.3) |> \n  tab_header(title = html(\"UK Employment by Occupation  \", \n                          local_image(\"logo.png\", height = 15))) |> \n  tab_style(\n    style = list(\n      cell_text(font = \"Financier Display\", size = px(15), align = \"left\"),\n      cell_borders(sides = \"bottom\", weight = px(3), color = \"#262A33\")\n      ),\n    locations = cells_title()\n  ) |>\n  tab_style(\n    style = cell_text(size = 14),\n    locations = cells_row_groups()\n  ) |> \n  tab_style(\n    style = cell_text(color = \"#800D33\", weight = \"bold\"),\n    locations = cells_stub()\n  ) |> \n  tab_style(\n    style = cell_text(weight = \"bold\"),\n    locations = list(cells_column_labels(), \n                     cells_column_spanners(), \n                     cells_row_groups(), \n                     cells_title())\n  ) |> \n  tab_style(\n    style = cell_borders(style = \"hidden\"),\n    locations = list(cells_body(),\n                     cells_row_groups(),\n                     cells_stub())\n  ) |>\n  tab_style(\n    style = cell_text(color = \"#00994D\", weight = \"bold\"),\n    locations = cells_body(\n      columns = change,\n      rows = change >= 0\n    )\n  ) |> \n  tab_style(\n    style = cell_text(color = \"#C00000\", weight = \"bold\"),\n    locations = cells_body(\n      columns = change,\n      rows = change < 0\n    )\n  ) |> \n  tab_style(\n    style = cell_text(color = \"grey40\", size = px(6)),\n    locations = list(cells_footnotes(), cells_source_notes())\n  )\n\ngt_ft |> gtsave(\"ft.png\", zoom = 5)\n</pre><p><img src=\"https://i1.wp.com/www.quantumjitter.com/project/footnote/ft.png?w=578&#038;ssl=1\" alt=\"\" data-recalc-dims=\"1\"></p>\n\n\n\n\n<h2 id=\"r-toolbox\">R Toolbox\n  <a href=\"https://www.quantumjitter.com/project/footnote/#r-toolbox\" rel=\"nofollow\" target=\"_blank\"><svg class=\"anchor-symbol\" aria-hidden=\"true\" height=\"26\" width=\"26\" viewBox=\"0 0 22 22\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n      <path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n    </svg></a>\n</h2>\n<p>Summarising below the packages and functions used in this post enables me to separately create a \n<a href=\"https://www.quantumjitter.com/project/box\" rel=\"nofollow\" target=\"_blank\">toolbox visualisation</a> summarising the usage of packages and functions across all posts.</p>\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Package </th>\n   <th style=\"text-align:left;\"> Function </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> base </td>\n   <td style=\"text-align:left;\"> as.character[1];  as.integer[1];  c[8];  conflicts[1];  cumsum[1];  function[2];  is.na[1];  list[5];  search[1];  sum[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> dplyr </td>\n   <td style=\"text-align:left;\"> filter[6];  arrange[3];  desc[3];  group_by[1];  if_else[4];  mutate[7];  n[1];  relocate[1];  row_number[1];  slice[1];  summarise[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> forcats </td>\n   <td style=\"text-align:left;\"> fct_inorder[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ggplot2 </td>\n   <td style=\"text-align:left;\"> aes[2];  annotate[1];  geom_col[1];  geom_label[1];  ggplot[1];  scale_fill_manual[1];  theme[1];  theme_bw[1];  theme_set[1];  theme_void[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> gt </td>\n   <td style=\"text-align:left;\"> cell_borders[2];  cell_text[9];  cells_body[4];  cells_column_labels[4];  cells_column_spanners[2];  cells_footnotes[1];  cells_row_groups[4];  cells_source_notes[1];  cells_stub[3];  cells_title[2];  fmt_number[1];  fmt_percent[1];  gt[1];  gtsave[2];  html[1];  local_image[1];  opt_stylize[1];  opt_vertical_padding[1];  px[3];  sub_missing[1];  tab_footnote[5];  tab_header[2];  tab_options[1];  tab_source_note[1];  tab_spanner[1];  tab_style[10] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> kableExtra </td>\n   <td style=\"text-align:left;\"> kbl[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> purrr </td>\n   <td style=\"text-align:left;\"> map[1];  map_dfr[1];  map2_dfr[1];  possibly[1];  set_names[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> readr </td>\n   <td style=\"text-align:left;\"> read_lines[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> readxl </td>\n   <td style=\"text-align:left;\"> read_xlsx[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> stringr </td>\n   <td style=\"text-align:left;\"> str_c[5];  str_count[1];  str_detect[2];  str_remove[3];  str_remove_all[1];  str_starts[2] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> tibble </td>\n   <td style=\"text-align:left;\"> as_tibble[1];  tibble[3];  enframe[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> tidyr </td>\n   <td style=\"text-align:left;\"> pivot_wider[1];  separate[1];  unnest[1] </td>\n  </tr>\n</tbody>\n</table>\n\n\n\n\n<h2 id=\"attribution\">Attribution\n  <a href=\"https://www.quantumjitter.com/project/footnote/#attribution\" rel=\"nofollow\" target=\"_blank\"><svg class=\"anchor-symbol\" aria-hidden=\"true\" height=\"26\" width=\"26\" viewBox=\"0 0 22 22\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path d=\"M0 0h24v24H0z\" fill=\"currentColor\"></path>\n      <path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z\"></path>\n    </svg></a>\n</h2>\n<p>Contains public sector information licensed under the \n<a href=\"https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/\" rel=\"nofollow\" target=\"_blank\">Open Government Licence v3.0</a>.</p>\n\n<div style=\"border: 1px solid; background: none repeat scroll 0 0 #EDEDED; margin: 1px; font-size: 13px;\">\n<div style=\"text-align: center;\">To <strong>leave a comment</strong> for the author, please follow the link and comment on their blog: <strong><a href=\"https://www.quantumjitter.com/project/footnote/\"> Category R on Quantum Jitter</a></strong>.</div>\n<hr />\n<a href=\"https://www.r-bloggers.com/\" rel=\"nofollow\">R-bloggers.com</a> offers <strong><a href=\"https://feedburner.google.com/fb/a/mailverify?uri=RBloggers\" rel=\"nofollow\">daily e-mail updates</a></strong> about <a title=\"The R Project for Statistical Computing\" href=\"https://www.r-project.org/\" rel=\"nofollow\">R</a> news and tutorials about <a title=\"R tutorials\" href=\"https://www.r-bloggers.com/how-to-learn-r-2/\" rel=\"nofollow\">learning R</a> and many other topics. <a title=\"Data science jobs\" href=\"https://www.r-users.com/\" rel=\"nofollow\">Click here if you're looking to post or find an R/data-science job</a>.\n\n<hr>Want to share your content on R-bloggers?<a href=\"https://www.r-bloggers.com/add-your-blog/\" rel=\"nofollow\"> click here</a> if you have a blog, or <a href=\"http://r-posts.com/\" rel=\"nofollow\"> here</a> if you don't.\n</div><strong>Continue reading</strong>: <a href=\"https://www.r-bloggers.com/2022/10/a-footnote-in-history/\">A Footnote in History</a>",
  "enclosure": "",
  "post-id": 334108
}