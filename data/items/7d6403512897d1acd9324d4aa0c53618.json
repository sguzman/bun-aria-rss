{
  "title": "zsh-autoquoter makes shell quoting slightly less annoying",
  "description": "<p>Earlier this year I wrote <a href=\"https://github.com/ianthehenry/zsh-autoquoter\">zsh-autoquoter</a>, a little zsh extension that automatically quotes arguments to commands of my choice.</p>\n<p style=\"min-height: 368px;\">\n(asciinema demo)\n</p>\n<p>I&rsquo;ve been using it for a few months now, and I&rsquo;ve gotta say: it&rsquo;s pretty nice! I wish I&rsquo;d written this a long time ago. Here are a few use cases I&rsquo;ve found for it so far:</p>\n<h1 id=\"1-commit-messages\">1. commit messages</h1>\n<p><code>git</code> has a neat feature where you can specify a commit message directly on the command line, with the <code>-m</code> flag:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" class=\"chroma\"><code class=\"language-bash\" data-lang=\"bash\">$ git commit -m <span class=\"s1\">&#39;fix typo&#39;</span>\n</code></pre></div><p>It&rsquo;s really useful for repositories like this blog, where almost every commit is a short little memo like that. But sometimes I want to write something a little more complicated:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" class=\"chroma\"><code class=\"language-bash\" data-lang=\"bash\">$ git commit -m <span class=\"s2\">&#34;\\&#34;fire\\&#34; wasn&#39;t clear; rename to \\&#34;fire_the_missiles\\&#34;&#34;</span>\n</code></pre></div><p>Now, I like to commit &ldquo;early and often,&rdquo; using a patch queue workflow, and then rebase entire branches in order to get them ready for &ldquo;publication&rdquo; to the outside world. So I do this a lot. And it&rsquo;s not <em>that</em> annoying to open up a vim buffer to write this, but it&rsquo;s <em>slightly</em> more friction than just typing it directly.</p>\n<h1 id=\"2-ssh-commands\">2. <code>ssh</code> commands</h1>\n<p>Sometimes I want to run complicated shell commands on remote servers, with globs and pipelines and quoted arguments and all sorts of things, without actually starting up an interactive session on that server.</p>\n<p><code>ssh</code> makes this&hellip; possible. But I find it really difficult to wrangle all the nested quoting that this entails.</p>\n<p>Here&rsquo;s a simple example of what I mean:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" class=\"chroma\"><code class=\"language-bash\" data-lang=\"bash\">$ ssh user@host <span class=\"s2\">&#34;awk &#39;{print </span><span class=\"nv\">$1</span><span class=\"s2\">}&#39; file.txt&#34;</span>\n</code></pre></div><p>See the problem? <code>$1</code> is going to be expanded as a shell variable, and fortunately syntax highlighting makes the mistake obvious. (You do have <a href=\"https://github.com/zsh-users/zsh-syntax-highlighting\">syntax highlighting</a> in your shell, right?)</p>\n<p>To pass a literal <code>$1</code> to <code>awk</code>, you <em>actually</em> have to write:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" class=\"chroma\"><code class=\"language-bash\" data-lang=\"bash\">ssh user@host <span class=\"s1\">&#39;awk &#34;{print $1}&#34; file.txt&#39;</span>\n</code></pre></div><p>Except, of course, that&rsquo;s still wrong. You&rsquo;ve just moved the problem to the remote server. You <em>actually actually</em> have to write something like:</p>\n<div class=\"highlight\"><pre tabindex=\"0\" class=\"chroma\"><code class=\"language-bash\" data-lang=\"bash\">$ ssh user@host <span class=\"s2\">&#34;awk &#39;{print \\$1}&#39; file.txt&#34;</span>\n</code></pre></div><p>(Or is it <code>\\\\$1</code>?)</p>\n<p>But with zsh-autoquoter, you don&rsquo;t have to do any of that. You just type the obvious thing; the same thing you would type if you were running a local command:</p>\n<pre><code>$ ssh user@host awk '{print $1}' file.txt\n</code></pre>\n<p>And it will do the thing you want.</p>\n<h1 id=\"3-todo-lists\">3. <code>todo</code> lists</h1>\n<p>Once upon a time I wrote a little command-line todo list app to help keep track of my stack at work.</p>\n<pre><code>todo 'write a blog post about zsh-autoquoter'\n</code></pre>\n<p>I liked the app; I liked the interface; I liked how simple it was. But it suffered from a simple ergonomic problem: English strings are really annoying to type on the command line.</p>\n<pre><code>todo 'rework dackery'\\''s speech about the &quot;hex machine&quot;'\n</code></pre>\n<p>But now I can add a zsh-autoquoter rule for it, and give it another try.</p>\n<h1 id=\"4-sd---new\">4. <code>sd --new</code></h1>\n<p>A neat feature of <a href=\"https://ianthehenry.com/posts/a-cozy-nest-for-your-scripts/\"><code>sd</code></a> is the ability to quickly stash useful oneliners:</p>\n<pre><code>sd video poster --new 'ffmpeg -i &quot;$1&quot; -vframes 1 &quot;${basename $1}-poster.png&quot; -y'\n</code></pre>\n<p>That <em>particular</em> example happened to fit into single quotes. But I would really like to be able to stash arbitrary commands without worrying about how to escape them. Like this one, for example:</p>\n<pre><code>nix-env -qaA &quot;nixpkgs.$1&quot; --json | jq -r '.[] | .name + &quot; &quot; + .meta.description, &quot;&quot;, (.meta.longDescription | rtrimstr(&quot;\\n&quot;))'\n</code></pre>\n<p>How am I supposed to quote <em>that</em> monstrosity? Well, with zsh-autoquoter, of course.</p>\n<h1 id=\"5-notes-to-self\">5. <code>note</code>s to self</h1>\n<p>For many years I have been taking notes in a simple text file, using a Mac GUI application called <a href=\"https://www.alfredapp.com\">Alfred</a>. I press a shortcut, Alfred pops up, and I type my note:</p>\n<a class=\"image-container\" href=\"https://ianthehenry.com/posts/zsh-autoquoter/alfred_hu9109df11ae5e20ae44a255e1d26d4b3e_52685_1246x1246_fit_box_3.png\"><picture><source type=\"image/webp\"\nsrcset=\"https://ianthehenry.com/posts/zsh-autoquoter/alfred_hu9109df11ae5e20ae44a255e1d26d4b3e_52685_623x623_fit_q75_h1_box_3.webp 623w, https://ianthehenry.com/posts/zsh-autoquoter/alfred_hu9109df11ae5e20ae44a255e1d26d4b3e_52685_1246x1246_fit_q75_h1_box_3.webp 1246w, https://ianthehenry.com/posts/zsh-autoquoter/alfred_hu9109df11ae5e20ae44a255e1d26d4b3e_52685_375x375_fit_q75_h1_box_3.webp 375w, https://ianthehenry.com/posts/zsh-autoquoter/alfred_hu9109df11ae5e20ae44a255e1d26d4b3e_52685_750x750_fit_q75_h1_box_3.webp 750w\"\nsizes=\"(max-width: 400px) 375px, 623px\"><img\nclass=\"\"\nsrcset=\"https://ianthehenry.com/posts/zsh-autoquoter/alfred_hu9109df11ae5e20ae44a255e1d26d4b3e_52685_623x623_fit_box_3.png 623w, https://ianthehenry.com/posts/zsh-autoquoter/alfred_hu9109df11ae5e20ae44a255e1d26d4b3e_52685_1246x1246_fit_box_3.png 1246w, https://ianthehenry.com/posts/zsh-autoquoter/alfred_hu9109df11ae5e20ae44a255e1d26d4b3e_52685_375x375_fit_box_3.png 375w, https://ianthehenry.com/posts/zsh-autoquoter/alfred_hu9109df11ae5e20ae44a255e1d26d4b3e_52685_750x750_fit_box_3.png 750w\"\nalt=\"\"\ntitle=\"\"\nsizes=\"(max-width: 400px) 375px, 623px\"\nwidth=\"623\"\nheight=\"187\"\nstyle=\"background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAYAAABllJ3tAAAATElEQVR4nGI5f/bCpC8fv1n/&#43;/uP4f///wyCggIMzMwsDCDAxMx4lIWDhevzlZMP33z/8pPhx/fvDAwMjAxs7GxgBXzC3J8BAQAA///VWxiK9PaARwAAAABJRU5ErkJggg==);\"\n/></picture></a>\n<p>Using Alfred for this is a little silly, and I would <em>like</em> to replace this &ldquo;workflow&rdquo; with this tiny shell script:</p>\n<pre><code>$ cat ~/bin/note\n</code></pre>\n<div class=\"highlight\"><pre tabindex=\"0\" class=\"chroma\"><code class=\"language-bash\" data-lang=\"bash\"><span class=\"cp\">#!/usr/bin/env bash\n</span><span class=\"cp\"></span>\n<span class=\"nb\">set</span> -euo pipefail\n<span class=\"nb\">printf</span> <span class=\"s1\">&#39;%s %s\\n&#39;</span> <span class=\"k\">$(</span>date <span class=\"s1\">&#39;+%Y-%m-%d&#39;</span><span class=\"k\">)</span> <span class=\"s2\">&#34;</span><span class=\"nv\">$1</span><span class=\"s2\">&#34;</span> &gt;&gt; ~/Dropbox/notes.txt\n</code></pre></div><p>But these notes can be long, free-from things. It would have been a nightmare to write something like this, for example:</p>\n<pre tabindex=\"0\"><code>2022-01-08 TIL about SSH &quot;key types&quot; and &quot;signature types&quot; being different. if\ni want to use this key i have to configure sshd to accept ssh-rsa-sha2-256, not\njust ssh-rsa. the error message says that ssh-rsa isn't supported, but it\nactually means this particular signature type\n</code></pre><p>But not anymore!</p>\n<h1 id=\"those-are-all-of-the-examples\">those are all of the examples</h1>\n<p>Tempted? <a href=\"https://github.com/ianthehenry/zsh-autoquoter\">Give it a spin!</a> The extension should work with any zsh plugin manager, and the readme explains how to configure it and enable the (optional) <a href=\"https://github.com/zsh-users/zsh-syntax-highlighting\">zsh-syntax-highlighting</a> integration.</p>\n<p>Apparently you&rsquo;re supposed to end posts like this with a prominent call to action, so <a href=\"https://en.wikipedia.org/wiki/Luna_moth\">go check out this crazy moth I found on Wikipedia</a>.</p>",
  "pubDate": "Sun, 08 May 2022 00:00:00 +0000",
  "link": "https://ianthehenry.com/posts/zsh-autoquoter/",
  "guid": "https://ianthehenry.com/posts/zsh-autoquoter/"
}