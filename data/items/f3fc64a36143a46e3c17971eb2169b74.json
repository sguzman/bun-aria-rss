{
  "title": "Easy, high performance time zone handling in pandas 0.8.0",
  "link": "",
  "published": "2012-06-05T00:00:00-07:00",
  "updated": "2012-06-05T00:00:00-07:00",
  "author": {
    "name": "Wes McKinney"
  },
  "id": "tag:wesmckinney.com,2012-06-05:/blog/easy-high-performance-time-zone-handling-in-pandas-0-8-0/",
  "summary": "<p>Making time zone handling palatable is surprisingly difficult to get right. The generally agreed-upon \"best practice\" for storing timestamps is to use <a href=\"http://en.wikipedia.org/wiki/Coordinated_Universal_Time\" title=\"UTC\" target=\"_blank\">UTC</a>. Otherwise, you have to worry about daylight savings time ambiguities or non-existent times. The misery of time zone handling is well documented, and <a href=\"http://lucumr.pocoo.org/2011/7/15/eppur-si-muove/\" title=\"Ronacher time zone handling\" target=\"_blank\">summarized nicely last year â€¦</a></p>",
  "content": "<p>Making time zone handling palatable is surprisingly difficult to get right. The generally agreed-upon \"best practice\" for storing timestamps is to use <a href=\"http://en.wikipedia.org/wiki/Coordinated_Universal_Time\" title=\"UTC\" target=\"_blank\">UTC</a>. Otherwise, you have to worry about daylight savings time ambiguities or non-existent times. The misery of time zone handling is well documented, and <a href=\"http://lucumr.pocoo.org/2011/7/15/eppur-si-muove/\" title=\"Ronacher time zone handling\" target=\"_blank\">summarized nicely last year by Armin Ronacher</a>. When you work in UTC, most of your troubles go away; converting a single timestamp or array of timestamps between time zones becomes in essence a \"free\" operation since the time zone is simply metadata for the box containing the invariant UTC timestamp.</p>\n<p>But it's not all fun and games. The Python datetime API in this area\nis generally considered to be severely lacking. But, for most\napplications you can suffer through the API and use <a\nhref=\"http://pytz.sourceforge.net/\" title=\"pytz\"\ntarget=\"_blank\">pytz</a>, which is an adequate solution in most\ncases. pytz notably ships the <a\nhref=\"http://en.wikipedia.org/wiki/Tz_database\" title=\"Olson database\"\ntarget=\"_blank\">Olson timezone database</a> which is the key piece of\ninformation for powering time zone conversions.</p>\n<p>But what about pandas? Among other things, pandas is <strong>really</strong> good for time series data, including very large time series data in the millions of observations. I don't want to make pandas users suffer because of Python's datetime API, so I'm happy to provide a better one (a bit more on this later). The biggest issue is: as with many non-scientific Python libraries, pytz and other tools have a fatal illness known as TMP, a.k.a. <strong>Too Much (pure) Python</strong>. Let me explain:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]:</span> <span class=\"n\">dt</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"p\">(</span><span class=\"mi\">2009</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">15</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]:</span> <span class=\"kn\">import</span> <span class=\"nn\">pytz</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]:</span> <span class=\"n\">tz</span> <span class=\"o\">=</span> <span class=\"n\">pytz</span><span class=\"o\">.</span><span class=\"n\">timezone</span><span class=\"p\">(</span><span class=\"s1\">&#39;US/Eastern&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">]:</span> <span class=\"n\">tz</span><span class=\"o\">.</span><span class=\"n\">localize</span><span class=\"p\">(</span><span class=\"n\">dt</span><span class=\"p\">)</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">]:</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">datetime</span><span class=\"p\">(</span><span class=\"mi\">2009</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">15</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">tzinfo</span><span class=\"o\">=&lt;</span><span class=\"n\">DstTzInfo</span> <span class=\"s1\">&#39;US/Eastern&#39;</span> <span class=\"n\">EDT</span><span class=\"o\">-</span><span class=\"mi\">1</span> <span class=\"n\">day</span><span class=\"p\">,</span> <span class=\"mi\">20</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span> <span class=\"n\">DST</span><span class=\"o\">&gt;</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">5</span><span class=\"p\">]:</span> <span class=\"n\">timeit</span> <span class=\"n\">tz</span><span class=\"o\">.</span><span class=\"n\">localize</span><span class=\"p\">(</span><span class=\"n\">dt</span><span class=\"p\">)</span>\n<span class=\"mi\">10000</span> <span class=\"n\">loops</span><span class=\"p\">,</span> <span class=\"n\">best</span> <span class=\"n\">of</span> <span class=\"mi\">3</span><span class=\"p\">:</span> <span class=\"mf\">33.4</span> <span class=\"n\">us</span> <span class=\"n\">per</span> <span class=\"n\">loop</span>\n</code></pre></div>\n\n<p>So, localizing a single <code>datetime.datetime</code> value takes 33 microseconds, or ~33 seconds per million timestamps. Localize serves a couple of important, but annoying functions: checking for ambiguities (\"fall back\") and non-existent times (\"spring forward\") at DST transition times.</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">7</span><span class=\"p\">]:</span> <span class=\"n\">tz</span><span class=\"o\">.</span><span class=\"n\">localize</span><span class=\"p\">(</span><span class=\"n\">datetime</span><span class=\"p\">(</span><span class=\"mi\">2012</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">11</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">30</span><span class=\"p\">),</span> <span class=\"n\">is_dst</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n<span class=\"o\">---------------------------------------------------------------------------</span>\n<span class=\"n\">NonExistentTimeError</span>                      <span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">)</span>\n<span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">wesm</span><span class=\"o\">/</span><span class=\"n\">code</span><span class=\"o\">/</span><span class=\"n\">pandas</span><span class=\"o\">/&lt;</span><span class=\"n\">ipython</span><span class=\"o\">-</span><span class=\"nb\">input</span><span class=\"o\">-</span><span class=\"mi\">7</span><span class=\"o\">-</span><span class=\"n\">e6d82ff6f746</span><span class=\"o\">&gt;</span> <span class=\"ow\">in</span> <span class=\"o\">&lt;</span><span class=\"n\">module</span><span class=\"o\">&gt;</span><span class=\"p\">()</span>\n<span class=\"o\">----&gt;</span> <span class=\"mi\">1</span> <span class=\"n\">tz</span><span class=\"o\">.</span><span class=\"n\">localize</span><span class=\"p\">(</span><span class=\"n\">datetime</span><span class=\"p\">(</span><span class=\"mi\">2012</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">11</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">30</span><span class=\"p\">),</span> <span class=\"n\">is_dst</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n\n<span class=\"o\">/</span><span class=\"n\">home</span><span class=\"o\">/</span><span class=\"n\">wesm</span><span class=\"o\">/</span><span class=\"n\">code</span><span class=\"o\">/</span><span class=\"n\">repos</span><span class=\"o\">/</span><span class=\"n\">matplotlib</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">pytz</span><span class=\"o\">/</span><span class=\"n\">tzinfo</span><span class=\"o\">.</span><span class=\"n\">pyc</span> <span class=\"ow\">in</span> <span class=\"n\">localize</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">dt</span><span class=\"p\">,</span> <span class=\"n\">is_dst</span><span class=\"p\">)</span>\n    <span class=\"mi\">320</span>             <span class=\"c1\"># If we refuse to guess, raise an exception.</span>\n    <span class=\"mi\">321</span>             <span class=\"k\">if</span> <span class=\"n\">is_dst</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n<span class=\"o\">--&gt;</span> <span class=\"mi\">322</span>                 <span class=\"k\">raise</span> <span class=\"n\">NonExistentTimeError</span><span class=\"p\">(</span><span class=\"n\">dt</span><span class=\"p\">)</span>\n    <span class=\"mi\">323</span>\n    <span class=\"mi\">324</span>             <span class=\"c1\"># If we are forcing the pre-DST side of the DST transition, we</span>\n\n<span class=\"n\">NonExistentTimeError</span><span class=\"p\">:</span> <span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">02</span><span class=\"p\">:</span><span class=\"mi\">30</span><span class=\"p\">:</span><span class=\"mi\">00</span>\n</code></pre></div>\n\n<p>Now, one major problem that I found while examining pytz code is how many temporary datetime.datetime objects are created during a single call to <code>tz.localize</code>. How many do you think?</p>\n<h2>15. 15 temporary <code>datetime.datetime</code> objects</h2>\n<p>Don't believe me? Look for yourself. Just following what is going on inside the function is enough to make your head hurt. The code is vastly complicated by the fact that tz-aware datetimes are not comparable with tz-naive datetimes.</p>\n<p>Obviously, there must be a better and faster way. Some might argue that I should improve pytz, but the problem is that the implementation of time zone logic is dependent on the representation of the timestamps. Over the last few months I have stopped using <code>datetime.datetime</code> in pandas in favor of 64-bit integer timestamps via NumPy's <code>datetime64</code> data type. Storing large arrays of datetime.datetime values is disastrously inefficient in terms of memory and performance in all time series operations. Obviously I can't force this design decision on most Python programmers who are not engaged in high-performance data analysis work.</p>\n<h1>Making time zone handling fast and easy</h1>\n<p>So, here are my requirements for pandas's time zone capabilities:</p>\n<ul>\n<li>All operations must be vectorized and be as fast as possible on large arrays of irregular, not necessarily ordered 64-bit timestamps</li>\n<li>API must be as simple and non-crappy as possible without sacrificing functionality.\npandas 0.8.0 has a new <code>Timestamp</code> data type which is a subclass of datetime.datetime providing nanosecond resolution support and, in my opinion, a strictly superior interface for working with dates and time:</li>\n</ul>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]:</span> <span class=\"n\">stamp</span> <span class=\"o\">=</span> <span class=\"n\">Timestamp</span><span class=\"p\">(</span><span class=\"s1\">&#39;3/11/2012 04:00&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">]:</span> <span class=\"n\">stamp</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">]:</span> <span class=\"o\">&lt;</span><span class=\"n\">Timestamp</span><span class=\"p\">:</span> <span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">04</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">&gt;</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">5</span><span class=\"p\">]:</span> <span class=\"n\">stamp</span><span class=\"o\">.</span><span class=\"n\">value</span>  <span class=\"c1\"># Naive timestamp</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">5</span><span class=\"p\">]:</span> <span class=\"mi\">1331438400000000000</span>\n</code></pre></div>\n\n<p>Timestamps can be created as local or converted to local using <code>tz_localize</code>. Conversions from one time zone to another use <code>tz_convert</code>:</p>\n<div class=\"github\"><pre><span></span><code>In [6]: stamp.tz_localize(&#39;US/Eastern&#39;)\nOut[6]: &lt;Timestamp: 2012-03-11 04:00:00-0400 EDT, tz=US/Eastern&gt;\n\nIn [7]: eastern_stamp = Timestamp(&#39;3/11/2012 04:00&#39;, tz=&#39;US/Eastern&#39;)\n\nIn [8]: eastern_stamp\nOut[8]: &lt;Timestamp: 2012-03-11 04:00:00-0400 EDT, tz=US/Eastern&gt;\n\nIn [9]: eastern_stamp.value\nOut[9]: 1331452800000000000\n\nIn [10]: eastern_stamp.tz_convert(&#39;utc&#39;)\nOut[10]: &lt;Timestamp: 2012-03-11 08:00:00+0000 UTC, tz=UTC&gt;\n</code></pre></div>\n\n<p>Wonder what time it is right now in London (it's 8:50 PM in New York as I type this)?</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">11</span><span class=\"p\">]:</span> <span class=\"n\">Timestamp</span><span class=\"p\">(</span><span class=\"s1\">&#39;now&#39;</span><span class=\"p\">,</span> <span class=\"n\">tz</span><span class=\"o\">=</span><span class=\"s1\">&#39;Europe/London&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">11</span><span class=\"p\">]:</span> <span class=\"o\">&lt;</span><span class=\"n\">Timestamp</span><span class=\"p\">:</span> <span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">07</span><span class=\"o\">-</span><span class=\"mi\">08</span> <span class=\"mi\">17</span><span class=\"p\">:</span><span class=\"mi\">27</span><span class=\"p\">:</span><span class=\"mi\">13</span><span class=\"o\">+</span><span class=\"mi\">0100</span> <span class=\"n\">BST</span><span class=\"p\">,</span> <span class=\"n\">tz</span><span class=\"o\">=</span><span class=\"n\">Europe</span><span class=\"o\">/</span><span class=\"n\">London</span><span class=\"o\">&gt;</span>\n</code></pre></div>\n\n<p>So that's nice. Compared with datetime.datetime, Timestamp doesn't get in your way as much. Timestamps are equal if and only if their UTC timestamps are equal:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">12</span><span class=\"p\">]:</span> <span class=\"n\">eastern_stamp</span> <span class=\"o\">==</span> <span class=\"n\">eastern_stamp</span><span class=\"o\">.</span><span class=\"n\">tz_convert</span><span class=\"p\">(</span><span class=\"s1\">&#39;utc&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">12</span><span class=\"p\">]:</span> <span class=\"kc\">True</span>\n</code></pre></div>\n\n<p>This makes sense, because they refer to the same moment in time. Also, adding timedeltas will do the right thing around DST transitions:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">13</span><span class=\"p\">]:</span> <span class=\"n\">stamp</span> <span class=\"o\">=</span> <span class=\"n\">Timestamp</span><span class=\"p\">(</span><span class=\"s1\">&#39;3/11/2012 01:00&#39;</span><span class=\"p\">,</span> <span class=\"n\">tz</span><span class=\"o\">=</span><span class=\"s1\">&#39;US/Eastern&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">14</span><span class=\"p\">]:</span> <span class=\"n\">stamp</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">14</span><span class=\"p\">]:</span> <span class=\"o\">&lt;</span><span class=\"n\">Timestamp</span><span class=\"p\">:</span> <span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">01</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">0500</span> <span class=\"n\">EST</span><span class=\"p\">,</span> <span class=\"n\">tz</span><span class=\"o\">=</span><span class=\"n\">US</span><span class=\"o\">/</span><span class=\"n\">Eastern</span><span class=\"o\">&gt;</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">17</span><span class=\"p\">]:</span> <span class=\"n\">stamp</span> <span class=\"o\">+</span> <span class=\"n\">timedelta</span><span class=\"p\">(</span><span class=\"n\">hours</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">17</span><span class=\"p\">]:</span> <span class=\"o\">&lt;</span><span class=\"n\">Timestamp</span><span class=\"p\">:</span> <span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">0400</span> <span class=\"n\">EDT</span><span class=\"p\">,</span> <span class=\"n\">tz</span><span class=\"o\">=</span><span class=\"n\">US</span><span class=\"o\">/</span><span class=\"n\">Eastern</span><span class=\"o\">&gt;</span>\n</code></pre></div>\n\n<p>OK, great. Scalar operations. I could have done all this with pytz. I'm really interested in vector operations on large time series.</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">18</span><span class=\"p\">]:</span> <span class=\"n\">rng</span> <span class=\"o\">=</span> <span class=\"n\">date_range</span><span class=\"p\">(</span><span class=\"s1\">&#39;3/11/2012 03:00&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;4/1/2012&#39;</span><span class=\"p\">,</span> <span class=\"n\">freq</span><span class=\"o\">=</span><span class=\"s1\">&#39;S&#39;</span><span class=\"p\">,</span> <span class=\"n\">tz</span><span class=\"o\">=</span><span class=\"s1\">&#39;US/Eastern&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">19</span><span class=\"p\">]:</span> <span class=\"n\">rng</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">19</span><span class=\"p\">]:</span>\n<span class=\"o\">&lt;</span><span class=\"k\">class</span> <span class=\"err\">&#39;</span><span class=\"nc\">pandas</span><span class=\"o\">.</span><span class=\"n\">tseries</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"o\">.</span><span class=\"n\">DatetimeIndex</span><span class=\"s1\">&#39;&gt;</span>\n<span class=\"p\">[</span><span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">03</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">,</span> <span class=\"o\">...</span><span class=\"p\">,</span> <span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">01</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">]</span>\n<span class=\"n\">Length</span><span class=\"p\">:</span> <span class=\"mi\">1803601</span><span class=\"p\">,</span> <span class=\"n\">Freq</span><span class=\"p\">:</span> <span class=\"n\">S</span><span class=\"p\">,</span> <span class=\"n\">Timezone</span><span class=\"p\">:</span> <span class=\"n\">US</span><span class=\"o\">/</span><span class=\"n\">Eastern</span>\n</code></pre></div>\n\n<p>Localizing all of 1.8 million timestamps (without taking advantage of the fact that this range is regular and lacks any DST transitions, which you <strong>cannot</strong> assume in the general, irregular case) would have taken about 1 full minute if we were working with pytz and datetime.datetime objects. Here it takes about 390 ms using a vectorized Cython routine of my devising:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">20</span><span class=\"p\">]:</span> <span class=\"n\">timeit</span> <span class=\"n\">rng</span> <span class=\"o\">=</span> <span class=\"n\">date_range</span><span class=\"p\">(</span><span class=\"s1\">&#39;3/11/2012 03:00&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;4/1/2012&#39;</span><span class=\"p\">,</span> <span class=\"n\">freq</span><span class=\"o\">=</span><span class=\"s1\">&#39;S&#39;</span><span class=\"p\">,</span> <span class=\"n\">tz</span><span class=\"o\">=</span><span class=\"s1\">&#39;US/Eastern&#39;</span><span class=\"p\">)</span>\n<span class=\"mi\">1</span> <span class=\"n\">loops</span><span class=\"p\">,</span> <span class=\"n\">best</span> <span class=\"n\">of</span> <span class=\"mi\">3</span><span class=\"p\">:</span> <span class=\"mi\">415</span> <span class=\"n\">ms</span> <span class=\"n\">per</span> <span class=\"n\">loop</span>\n</code></pre></div>\n\n<p>What's nice about working in UTC is that time zone conversions are now nearly free and do not copy any data (the DatetimeIndex is immutable):</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">22</span><span class=\"p\">]:</span> <span class=\"n\">rng</span><span class=\"o\">.</span><span class=\"n\">tz_convert</span><span class=\"p\">(</span><span class=\"s1\">&#39;Europe/Moscow&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">22</span><span class=\"p\">]:</span>\n<span class=\"o\">&lt;</span><span class=\"k\">class</span> <span class=\"err\">&#39;</span><span class=\"nc\">pandas</span><span class=\"o\">.</span><span class=\"n\">tseries</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"o\">.</span><span class=\"n\">DatetimeIndex</span><span class=\"s1\">&#39;&gt;</span>\n<span class=\"p\">[</span><span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">11</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">,</span> <span class=\"o\">...</span><span class=\"p\">,</span> <span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"o\">-</span><span class=\"mi\">01</span> <span class=\"mi\">08</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">]</span>\n<span class=\"n\">Length</span><span class=\"p\">:</span> <span class=\"mi\">1803601</span><span class=\"p\">,</span> <span class=\"n\">Freq</span><span class=\"p\">:</span> <span class=\"n\">S</span><span class=\"p\">,</span> <span class=\"n\">Timezone</span><span class=\"p\">:</span> <span class=\"n\">Europe</span><span class=\"o\">/</span><span class=\"n\">Moscow</span>\n</code></pre></div>\n\n<p>Scalar values are converted to Timestamp objects with the right hour, minute, second:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">23</span><span class=\"p\">]:</span> <span class=\"n\">rng</span> <span class=\"o\">=</span> <span class=\"n\">date_range</span><span class=\"p\">(</span><span class=\"s1\">&#39;3/6/2012&#39;</span><span class=\"p\">,</span> <span class=\"n\">periods</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">tz</span><span class=\"o\">=</span><span class=\"s1\">&#39;US/Eastern&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">24</span><span class=\"p\">]:</span> <span class=\"n\">ts</span> <span class=\"o\">=</span> <span class=\"n\">Series</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">randn</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">rng</span><span class=\"p\">)),</span> <span class=\"n\">rng</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">25</span><span class=\"p\">]:</span> <span class=\"n\">ts</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">25</span><span class=\"p\">]:</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">06</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">0.807059</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">07</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">0.938366</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">08</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"o\">-</span><span class=\"mf\">1.262472</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">09</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">1.942384</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">10</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"o\">-</span><span class=\"mf\">1.346362</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"o\">-</span><span class=\"mf\">2.570099</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">12</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"o\">-</span><span class=\"mf\">0.606283</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">13</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">0.150267</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">14</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">0.044596</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">15</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">04</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">1.274109</span>\n<span class=\"n\">Freq</span><span class=\"p\">:</span> <span class=\"n\">D</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">26</span><span class=\"p\">]:</span> <span class=\"n\">ts</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"p\">[</span><span class=\"mi\">8</span><span class=\"p\">]</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">26</span><span class=\"p\">]:</span> <span class=\"o\">&lt;</span><span class=\"n\">Timestamp</span><span class=\"p\">:</span> <span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">14</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">0400</span> <span class=\"n\">EDT</span><span class=\"p\">,</span> <span class=\"n\">tz</span><span class=\"o\">=</span><span class=\"n\">US</span><span class=\"o\">/</span><span class=\"n\">Eastern</span><span class=\"o\">&gt;</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">27</span><span class=\"p\">]:</span> <span class=\"n\">ts</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">]</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">27</span><span class=\"p\">]:</span> <span class=\"o\">&lt;</span><span class=\"n\">Timestamp</span><span class=\"p\">:</span> <span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">09</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">-</span><span class=\"mi\">0500</span> <span class=\"n\">EST</span><span class=\"p\">,</span> <span class=\"n\">tz</span><span class=\"o\">=</span><span class=\"n\">US</span><span class=\"o\">/</span><span class=\"n\">Eastern</span><span class=\"o\">&gt;</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">28</span><span class=\"p\">]:</span> <span class=\"n\">ts</span><span class=\"o\">.</span><span class=\"n\">tz_convert</span><span class=\"p\">(</span><span class=\"s1\">&#39;utc&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">28</span><span class=\"p\">]:</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">06</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">+</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">0.807059</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">07</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">+</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">0.938366</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">08</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">+</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"o\">-</span><span class=\"mf\">1.262472</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">09</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">+</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">1.942384</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">10</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">+</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"o\">-</span><span class=\"mf\">1.346362</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">11</span> <span class=\"mi\">05</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">+</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"o\">-</span><span class=\"mf\">2.570099</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">12</span> <span class=\"mi\">04</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">+</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"o\">-</span><span class=\"mf\">0.606283</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">13</span> <span class=\"mi\">04</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">+</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">0.150267</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">14</span> <span class=\"mi\">04</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">+</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">0.044596</span>\n<span class=\"mi\">2012</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">15</span> <span class=\"mi\">04</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"o\">+</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>    <span class=\"mf\">1.274109</span>\n<span class=\"n\">Freq</span><span class=\"p\">:</span> <span class=\"n\">D</span>\n</code></pre></div>\n\n<p>Anyway, this is just a flavor of some of the things you can do in the almost-released version of pandas. Lots more easy-to-use and high-performance data analysis tooling to come.</p>"
}