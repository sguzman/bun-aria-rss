{
  "title": "Bootstrapping time series for improving forecasting accuracy",
  "description": "<p><strong>Bootstrapping</strong> time series? It is meant in a way that we generate multiple new training data for <strong>statistical forecasting</strong> methods like <a href=\"https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average\">ARIMA</a> or <a href=\"https://en.wikipedia.org/wiki/Exponential_smoothing#Triple_exponential_smoothing\">triple exponential smoothing</a> (Holt-Winters method etc.) to improve forecasting accuracy.\nIt is called bootstrapping, and after applying the forecasting method on each new time series, forecasts are then aggregated by average or median - then it is <strong>bagging</strong> - bootstrap aggregating.\nIt is proofed by multiple methods, e.g. in regression, that bagging helps improve predictive accuracy - in methods like classical bagging, random forests, gradient boosting methods and so on.\nThe bagging methods for time series forecasting were used also in the latest <a href=\"https://www.mcompetitions.unic.ac.cy/m4/\">M4 forecasting competition</a>.\nFor residential electricity consumption (load) time series (as used in my previous <a href=\"https://petolau.github.io/blog\">blog posts</a>),\nI proposed three new bootstrapping methods for time series forecasting methods.\nThe first one is an enhancement of the originally proposed method by Bergmeir - <a href=\"https://doi.org/10.1016/j.ijforecast.2015.07.002\">link to article</a> - and two clustering-based methods.\nI also combined classical bagging for regression trees and time series bagging to create ensemble forecasts - I will cover it in some next post. These methods are all covered in the journal article entitled: <a href=\"https://link.springer.com/article/10.1007%2Fs10844-019-00550-3\">Density-based Unsupervised Ensemble Learning Methods for Time Series Forecasting of Aggregated or Clustered Electricity Consumption</a>.</p>\n\n<p>In this blog post, I will cover:</p>\n\n<ul>\n  <li>an introduction to the bootstrapping of time series,</li>\n  <li>new bootstrapping methods will be introduced,</li>\n  <li>extensive experiments with 7 forecasting methods and 4 bootstrapping methods will be described and analysed on a part of M4 competition dataset.</li>\n</ul>\n\n<h2 id=\"bootstrapping-time-series-data\">Bootstrapping time series data</h2>\n\n<p>Firstly, read the M4 competition data, which compromise 100 thousand time series and load all the needed packages.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">M4comp2018</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># M4 data,</span><span class=\"w\">\n</span><span class=\"c1\"># install package by devtools::install_github(\"carlanetto/M4comp2018\")</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># manipulating the data</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">TSrepr</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># forecasting error measures</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">forecast</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># forecasting and bootstrapping methods</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">ggplot2</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># graphics</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">ggsci</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># colours</span><span class=\"w\">\n</span><span class=\"n\">library</span><span class=\"p\">(</span><span class=\"n\">clusterCrit</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"c1\"># int.validity indices</span><span class=\"w\">\n \n</span><span class=\"n\">data</span><span class=\"p\">(</span><span class=\"n\">M4</span><span class=\"p\">)</span></code></pre></figure>\n\n<p>I will use only time series with hourly frequency (so with the highest frequency from M4 dataset, and they can have daily and also weekly seasonality), because I use at work also time series with double-seasonality (quarter-hourly or half-hourly data).\nThe high (or double) period (frequency) also means higher complexity and challenge, therefore it is great for this use case :)</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">hourly_M4</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">Filter</span><span class=\"p\">(</span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">l</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">l</span><span class=\"o\">$</span><span class=\"n\">period</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"s2\">\"Hourly\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">M4</span><span class=\"p\">)</span></code></pre></figure>\n\n<p>Let’s plot random time series from the dataset:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">theme_ts</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">theme</span><span class=\"p\">(</span><span class=\"n\">panel.border</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_rect</span><span class=\"p\">(</span><span class=\"n\">fill</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">NA</span><span class=\"p\">,</span><span class=\"w\"> \n                                              </span><span class=\"n\">colour</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"grey10\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">panel.background</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_blank</span><span class=\"p\">(),</span><span class=\"w\">\n                  </span><span class=\"n\">panel.grid.minor</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_line</span><span class=\"p\">(</span><span class=\"n\">colour</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"grey85\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">panel.grid.major</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_line</span><span class=\"p\">(</span><span class=\"n\">colour</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"grey85\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">panel.grid.major.x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_line</span><span class=\"p\">(</span><span class=\"n\">colour</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"grey85\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">axis.text</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">13</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">face</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"bold\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">axis.title</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">15</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">face</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"bold\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">plot.title</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">16</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">face</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"bold\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">strip.text</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">16</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">face</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"bold\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">strip.background</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_rect</span><span class=\"p\">(</span><span class=\"n\">colour</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"black\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">legend.text</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">15</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">legend.title</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">16</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">face</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"bold\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">legend.background</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_rect</span><span class=\"p\">(</span><span class=\"n\">fill</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"white\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">legend.key</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_rect</span><span class=\"p\">(</span><span class=\"n\">fill</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"white\"</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">legend.position</span><span class=\"o\">=</span><span class=\"s2\">\"bottom\"</span><span class=\"p\">)</span><span class=\"w\">\n \n</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">hourly_M4</span><span class=\"p\">[[</span><span class=\"m\">1</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">x</span><span class=\"p\">),</span><span class=\"w\">\n                  </span><span class=\"n\">Value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">as.numeric</span><span class=\"p\">(</span><span class=\"n\">hourly_M4</span><span class=\"p\">[[</span><span class=\"m\">1</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">x</span><span class=\"p\">)))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">labs</span><span class=\"p\">(</span><span class=\"n\">title</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">hourly_M4</span><span class=\"p\">[[</span><span class=\"m\">1</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">st</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_ts</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-4-1.png\" alt=\"plot of chunk unnamed-chunk-4\" /></p>\n\n<p><strong>Bootstrap aggregating</strong> (bagging) is an <strong>ensemble</strong> meta-algorithm (introduced by Breiman in 1996), which creates multiple versions of learning set to produce multiple numbers of predictions. These predictions are then aggregated, for example by arithmetic mean.\nFor time dependent data with a combination of statistical forecasting methods, the classical bagging can’t be used - so sampling (bootstrapping) with replacement.\nWe have to sample data more sophisticated - based on seasonality or something similar.\nOne of the used bootstrapping method is <strong>Moving Block Bootstrap</strong> (MBB) that uses a block (defined by seasonality for example) for creating new series.\nHowever, we don’t use the whole time series as it is, but we bootstrap only its remainder part from STL decomposition (this bootstrapping method was proposed by Bergmeir et al. in 2016).</p>\n\n<p>This method is implemented in the <code class=\"language-plaintext highlighter-rouge\">forecast</code> package in <code class=\"language-plaintext highlighter-rouge\">bld.mbb.bootstrap</code> function, let’s use it on one time series from M4 competition dataset:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">period</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"m\">24</span><span class=\"o\">*</span><span class=\"m\">7</span><span class=\"w\"> </span><span class=\"c1\"># weekly period</span><span class=\"w\">\n</span><span class=\"n\">data_ts</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">as.numeric</span><span class=\"p\">(</span><span class=\"n\">hourly_M4</span><span class=\"p\">[[</span><span class=\"m\">1</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">data_boot_mbb</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">bld.mbb.bootstrap</span><span class=\"p\">(</span><span class=\"n\">ts</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">freq</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">period</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">100</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">data_boot_mbb</span><span class=\"p\">),</span><span class=\"w\">\n                        </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_boot_mbb</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">)),</span><span class=\"w\">\n                        </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_boot_mbb</span><span class=\"p\">))</span><span class=\"w\">\n                        </span><span class=\"p\">)</span><span class=\"w\">\n \n</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data_plot</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.5</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">data_plot</span><span class=\"p\">[</span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">ID</span><span class=\"p\">)],</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">),</span><span class=\"w\">\n            </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_ts</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-5-1.png\" alt=\"plot of chunk unnamed-chunk-5\" /></p>\n\n<p>We can see that where values of the time series are low, there <strong>bld.mbb</strong> method fails to bootstrap new values around original ones (red line).\nNotice also that variance of bootstrapped time series is very high and values fly somewhere more than 30% against original values.</p>\n\n<p>For this reason, I proposed a smoothed version of the bld.mbb method for reducing variance (Laurinec et al. 2019). I smoothed the remainder part from STL decomposition by exponential smoothing, so extreme noise was removed.\nLet’s use it (source code is available on my <a href=\"https://github.com/PetoLau/petolau.github.io/tree/master/_Rscripts\">GitHub repo</a>):</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">data_boot_smbb</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">smo.bootstrap</span><span class=\"p\">(</span><span class=\"n\">ts</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">freq</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">period</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">100</span><span class=\"p\">)</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">data_boot_smbb</span><span class=\"p\">),</span><span class=\"w\">\n                        </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_boot_smbb</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">)),</span><span class=\"w\">\n                        </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_boot_smbb</span><span class=\"p\">))</span><span class=\"w\">\n                        </span><span class=\"p\">)</span><span class=\"w\">\n \n</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data_plot</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.5</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">data_plot</span><span class=\"p\">[</span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">ID</span><span class=\"p\">)],</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">),</span><span class=\"w\">\n            </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_ts</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-6-1.png\" alt=\"plot of chunk unnamed-chunk-6\" /></p>\n\n<p>We can see that the variance was nicely lowered, but the final time series are sometimes really different from the original.\nIt is not good when we want to use them for forecasting.</p>\n\n<p>Therefore, I developed (designed) another two bootstrapping methods based on <strong>K-means clustering</strong>.\nThe first step of the two methods is identical - automatic clustering of univariate time series - where automatic means that it estimates the number of clusters from a defined range of clusters by Davies-Bouldin index.</p>\n\n<p>The first method, after clustering, samples new values from <strong>cluster members</strong>, so it isn’t creating new values.\nLet’s plot results:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">data_boot_km</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">KMboot</span><span class=\"p\">(</span><span class=\"n\">ts</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">freq</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">period</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">100</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">k_range</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">10</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">data_boot_km</span><span class=\"p\">),</span><span class=\"w\">\n                        </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_boot_km</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">)),</span><span class=\"w\">\n                        </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_boot_km</span><span class=\"p\">))</span><span class=\"w\">\n                       </span><span class=\"p\">)</span><span class=\"w\">\n \n</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data_plot</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.5</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">data_plot</span><span class=\"p\">[</span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">ID</span><span class=\"p\">)],</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">),</span><span class=\"w\">\n            </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_ts</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-7-1.png\" alt=\"plot of chunk unnamed-chunk-7\" /></p>\n\n<p>We can change the range of the number of clusters to be selected to lower to increase the variance of bootstrapped time series.\nLet’s try increase number of clusters to decrease variance:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">data_boot_km</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">KMboot</span><span class=\"p\">(</span><span class=\"n\">ts</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">freq</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">period</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">100</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">k_range</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">14</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">20</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">data_boot_km</span><span class=\"p\">),</span><span class=\"w\">\n                        </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_boot_km</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">)),</span><span class=\"w\">\n                        </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_boot_km</span><span class=\"p\">))</span><span class=\"w\">\n                        </span><span class=\"p\">)</span><span class=\"w\">\n \n</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data_plot</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.5</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">data_plot</span><span class=\"p\">[</span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">ID</span><span class=\"p\">)],</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">),</span><span class=\"w\">\n            </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_ts</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-8-1.png\" alt=\"plot of chunk unnamed-chunk-8\" /></p>\n\n<p>We can see that the variance is much lower against MBB based methods. But we have still the power to increase it if we change the range of number of clusters.</p>\n\n<p>The second proposed K-means based method is sampling new values randomly from <strong>Gaussian distribution</strong> based on parameters of <strong>created clusters</strong> (mean and variance). Let’s use it on our selected time series:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">data_boot_km.norm</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">KMboot.norm</span><span class=\"p\">(</span><span class=\"n\">ts</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">freq</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">period</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">100</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">k_range</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">20</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">data_plot</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">data_boot_km.norm</span><span class=\"p\">),</span><span class=\"w\">\n                        </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_boot_km.norm</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">)),</span><span class=\"w\">\n                        </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_ts</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data_boot_km.norm</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"p\">)</span><span class=\"w\">\n \n</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">data_plot</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.5</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">data_plot</span><span class=\"p\">[</span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">ID</span><span class=\"p\">)],</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">),</span><span class=\"w\">\n            </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_ts</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-9-1.png\" alt=\"plot of chunk unnamed-chunk-9\" /></p>\n\n<p>We can see nicely distributed values around the original time series, but will be it beneficial for forecasting?</p>\n\n<p>We can also check all four bootstrapping methods in one plot by wrapper around above calls:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">print_boot_series</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ntimes</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">100</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">k_range</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">12</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">20</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n  \n  </span><span class=\"n\">data_boot_1</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">bld.mbb.bootstrap</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ntimes</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">data_boot_2</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">smo.bootstrap</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ntimes</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">data_boot_3</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">KMboot</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ntimes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">k_range</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">k_range</span><span class=\"p\">)</span><span class=\"w\">\n  </span><span class=\"n\">data_boot_4</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">KMboot.norm</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ntimes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">k_range</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">k_range</span><span class=\"p\">)</span><span class=\"w\">\n  \n  </span><span class=\"n\">datas_all</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">data.table</span><span class=\"p\">(</span><span class=\"n\">Value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">data_boot_1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">data_boot_2</span><span class=\"p\">),</span><span class=\"w\">\n                                    </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">data_boot_3</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">unlist</span><span class=\"p\">(</span><span class=\"n\">data_boot_4</span><span class=\"p\">)),</span><span class=\"w\">\n                          </span><span class=\"n\">ID</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"n\">ntimes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)),</span><span class=\"w\"> </span><span class=\"m\">4</span><span class=\"p\">),</span><span class=\"w\">\n                          </span><span class=\"n\">Time</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">ntimes</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"m\">4</span><span class=\"p\">),</span><span class=\"w\">\n                          </span><span class=\"n\">Method</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">factor</span><span class=\"p\">(</span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"MBB\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"S.MBB\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"KM\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"KM.boot\"</span><span class=\"p\">),</span><span class=\"w\">\n                                              </span><span class=\"n\">each</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ntimes</span><span class=\"o\">*</span><span class=\"nf\">length</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)))</span><span class=\"w\">\n  </span><span class=\"p\">)</span><span class=\"w\">\n  \n  </span><span class=\"n\">datas_all</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">Method</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">factor</span><span class=\"p\">(</span><span class=\"n\">Method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">levels</span><span class=\"p\">(</span><span class=\"n\">Method</span><span class=\"p\">)[</span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"m\">3</span><span class=\"p\">,</span><span class=\"m\">4</span><span class=\"p\">,</span><span class=\"m\">1</span><span class=\"p\">,</span><span class=\"m\">2</span><span class=\"p\">)])]</span><span class=\"w\">\n  \n  </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">datas_all</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n          </span><span class=\"n\">facet_wrap</span><span class=\"p\">(</span><span class=\"o\">~</span><span class=\"n\">Method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n          </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">ID</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.5</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n          </span><span class=\"n\">geom_line</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">datas_all</span><span class=\"p\">[</span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">on</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">ID</span><span class=\"p\">)],</span><span class=\"w\"> </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Time</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Value</span><span class=\"p\">),</span><span class=\"w\">\n                    </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"firebrick1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.9</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n          </span><span class=\"n\">theme_ts</span><span class=\"p\">)</span><span class=\"w\">\n \n</span><span class=\"p\">}</span><span class=\"w\">\n \n</span><span class=\"n\">print_boot_series</span><span class=\"p\">(</span><span class=\"n\">ts</span><span class=\"p\">(</span><span class=\"n\">hourly_M4</span><span class=\"p\">[[</span><span class=\"m\">200</span><span class=\"p\">]]</span><span class=\"o\">$</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">freq</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">period</span><span class=\"p\">))</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-10-1.png\" alt=\"plot of chunk unnamed-chunk-10\" /></p>\n\n<p>When the time series is non-stationary, the clustering bootstrapping methods can oscillate little-bit badly.\nThe clustering-based bootstrapping methods could be enhanced by for example differencing to be competitive (applicable) for non-stationary time series with a strong linear trend.</p>\n\n<h2 id=\"forecasting-with-bootstrapping\">Forecasting with bootstrapping</h2>\n\n<p>For evaluating four presented <strong>bootstrapping methods for time series</strong>, to see which is the most competitive in general,\nexperiments with 6 statistical forecasting methods were performed on all 414 hourly time series from the M4 competition dataset. \nForecasts from bootstrapped time series were aggregated by the median. Also, simple base methods were evaluated alongside seasonal naive forecast.\nThe six chosen statistical base forecasting methods were:</p>\n\n<ul>\n  <li>STL+ARIMA,</li>\n  <li>STL+ETS (both <code class=\"language-plaintext highlighter-rouge\">forecast</code> package),</li>\n  <li>triple exponential smoothing with damped trend (<code class=\"language-plaintext highlighter-rouge\">smooth</code> package - named ES (AAdA)),</li>\n  <li>Holt-Winters exponential smoothing (<code class=\"language-plaintext highlighter-rouge\">stats</code> package),</li>\n  <li>dynamic optimized theta model (<code class=\"language-plaintext highlighter-rouge\">forecTheta</code> package - named DOTM),</li>\n  <li>and standard theta model (<code class=\"language-plaintext highlighter-rouge\">forecast</code> package).</li>\n</ul>\n\n<p>Forecasting results were evaluated by <a href=\"https://en.wikipedia.org/wiki/Symmetric_mean_absolute_percentage_error\">sMAPE</a> and ranks sorted by sMAPE forecasting accuracy measure.</p>\n\n<p>The source code that generates forecasts from the all mentioned methods above and process results are available on my <a href=\"https://github.com/PetoLau/petolau.github.io/tree/master/_Rscripts\">GitHub repository</a>.</p>\n\n<p>The first visualization of results shows mean sMAPE by base forecasting method:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">res_all</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">sMAPE</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mean</span><span class=\"p\">(</span><span class=\"n\">sMAPE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">na.rm</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">)),</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">Base_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Boot_method</span><span class=\"p\">)])</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">facet_wrap</span><span class=\"p\">(</span><span class=\"o\">~</span><span class=\"n\">Base_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">scales</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"fix\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_bar</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Boot_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">sMAPE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fill</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Boot_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Boot_method</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"identity\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_text</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Boot_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sMAPE</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">paste</span><span class=\"p\">(</span><span class=\"nf\">round</span><span class=\"p\">(</span><span class=\"n\">sMAPE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">))))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">scale_fill_d3</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">scale_color_d3</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_ts</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme</span><span class=\"p\">(</span><span class=\"n\">axis.text.x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">hjust</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">))</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-11-1.png\" alt=\"plot of chunk unnamed-chunk-11\" /></p>\n\n<p>Best methods based on average sMAPE are STL+ETS with s.MBB and DOTM with s.MBB bootstrapping.\nOur proposed <strong>s.MBB</strong> bootstrapping method won’s 5 times from 6 based on average sMAPE.</p>\n\n<p>The next graph shows boxplot of Ranks:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">res_all</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">facet_wrap</span><span class=\"p\">(</span><span class=\"o\">~</span><span class=\"n\">Base_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">scales</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"fix\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_boxplot</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Boot_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fill</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Boot_method</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.8</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">scale_fill_d3</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_ts</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme</span><span class=\"p\">(</span><span class=\"n\">axis.text.x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">hjust</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">))</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-12-1.png\" alt=\"plot of chunk unnamed-chunk-12\" /></p>\n\n<p>We can see very tight results amongst base learners, MBB and s.MBB methods.</p>\n\n<p>So, let’s see average Rank instead:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">res_all</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mean</span><span class=\"p\">(</span><span class=\"n\">Rank</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">na.rm</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">)),</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">Base_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Boot_method</span><span class=\"p\">)])</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">facet_wrap</span><span class=\"p\">(</span><span class=\"o\">~</span><span class=\"n\">Base_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">scales</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"fix\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_bar</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Boot_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fill</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Boot_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Boot_method</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.8</span><span class=\"p\">,</span><span class=\"w\">\n           </span><span class=\"n\">stat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"identity\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_text</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Boot_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"m\">0.22</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">paste</span><span class=\"p\">(</span><span class=\"nf\">round</span><span class=\"p\">(</span><span class=\"n\">Rank</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"m\">2</span><span class=\"p\">))),</span><span class=\"w\"> </span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">5</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">scale_fill_d3</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">scale_color_d3</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_ts</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme</span><span class=\"p\">(</span><span class=\"n\">axis.text.x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">hjust</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">))</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-13-1.png\" alt=\"plot of chunk unnamed-chunk-13\" /></p>\n\n<p>As was seen in the previous plot, it changes and it depends on a forecasting method, but very slightly better results have original MBB method over my s.MBB, but both beats base learner 5 times from 6.\nKM-based bootstraps failed to beat base learner 4 times from 6.</p>\n\n<p>Let’s be more curious about distribution of Ranks…I will show you plot of Rank counts:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"n\">ggplot</span><span class=\"p\">(</span><span class=\"n\">res_all</span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">N</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">.N</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">by</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">.</span><span class=\"p\">(</span><span class=\"n\">Base_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Boot_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"p\">)]</span><span class=\"w\">\n       </span><span class=\"p\">[,</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"w\"> </span><span class=\"o\">:=</span><span class=\"w\"> </span><span class=\"n\">factor</span><span class=\"p\">(</span><span class=\"n\">Rank</span><span class=\"p\">)],</span><span class=\"w\">\n       </span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">Boot_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">N</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">facet_wrap</span><span class=\"p\">(</span><span class=\"o\">~</span><span class=\"n\">Base_method</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">ncol</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">scales</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"free\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">geom_bar</span><span class=\"p\">(</span><span class=\"n\">aes</span><span class=\"p\">(</span><span class=\"n\">fill</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"p\">,</span><span class=\"w\">\n               </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Rank</span><span class=\"p\">),</span><span class=\"w\">\n           </span><span class=\"n\">alpha</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.75</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">position</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"dodge\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">stat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"identity\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">scale_fill_d3</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">scale_color_d3</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme_ts</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\">\n  </span><span class=\"n\">theme</span><span class=\"p\">(</span><span class=\"n\">axis.text.x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">element_text</span><span class=\"p\">(</span><span class=\"n\">size</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">10</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">angle</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">60</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">hjust</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"p\">))</span></code></pre></figure>\n\n<p><img src=\"/images/post_11/unnamed-chunk-14-1.png\" alt=\"plot of chunk unnamed-chunk-14\" /></p>\n\n<p>We can see that KM-based bootstrapping can be first or second too!\nAround 25-times for each forecasting method were these 2 boot. methods first, and around 2-times more second…not that bad.\nAlso, the seasonal naive forecast can be on some types of time series best against more sophisticated statistical forecasting methods…\nHowever, MBB and s.MBB methods are best and most of the time are in the first two ranks.</p>\n\n<h2 id=\"conclusion\">Conclusion</h2>\n\n<p>In this blog post, I showed you how to simply use four various bootstrapping methods on time series data. Then, the results of experiments performed on the M4 competition dataset were shown. Results suggest that bootstrapping can be very useful for improving forecasting accuracy.</p>\n\n<h3 id=\"references\">References</h3>\n\n<p>[1] Bergmeir C., Hyndman R.J., Benitez J.M.: Bagging exponential smoothing methods using stl decomposition and box-cox transformation. International Journal of Forecasting, 32(2):303-312, (2016)</p>\n\n<p>[2] Laurinec P., Loderer M., Lucka M. et al.: Density-based unsupervised ensemble learning methods for time series forecasting of aggregated or clustered electricity consumption, Journal Intelligent Information Systems, 53(2):219-239, (2019). <a href=\"https://doi.org/10.1007/s10844-019-00550-3\">DOI link</a></p>",
  "pubDate": "Mon, 21 Oct 2019 00:00:00 +0000",
  "link": "https://petolau.github.io/Bootstrapping-time-series-for-improving-forecasting-in-R/",
  "guid": {
    "@isPermaLink": true,
    "#text": "https://petolau.github.io/Bootstrapping-time-series-for-improving-forecasting-in-R/"
  }
}