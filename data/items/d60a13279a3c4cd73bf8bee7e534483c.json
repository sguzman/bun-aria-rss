{
  "title": "How accurate is Next Bus IV: visualizing",
  "link": "",
  "id": "http://brooksandrew.github.io/simpleblog/articles/nextbus4_viz",
  "published": "2014-09-18T00:00:00+00:00",
  "updated": "2014-09-18T00:00:00+00:00",
  "author": {
    "name": "andrew brooks",
    "uri": "http://brooksandrew.github.io/simpleblog",
    "email": "andrewbrooksct@gmail.com"
  },
  "content": "<p>See the prior 3 posts for context:</p>\n\n<ul>\n  <li><a href=\"../nextbus1_api\">How accurate is Next Bus I: Extracting data from API</a></li>\n  <li><a href=\"../nextbus2_wrangle\">How accurate is Next Bus II: Wrangling data</a></li>\n  <li><a href=\"../nextbus3_analyze\">How accurate is Next Bus III: Getting the answers</a></li>\n</ul>\n\n<iframe style=\"border: 0px;\" src=\"/simpleblog/assets/html/d3nextbus.html\" width=\"1000\" height=\"600\"></iframe>\n\n<p>This one takes a long time to load.  It makes a <code class=\"highlighter-rouge\">d3.csv</code> call to a 24MB file.  I was surprised to find that reading in the file took \nall this time, but transformations that happen in the app take almost no time at all.</p>\n\n<h3 id=\"one-week-of-next-bus-predictions\">One week of Next Bus predictions</h3>\n<iframe style=\"border: 0px;\" src=\"/simpleblog/assets/html/busScatter.html\" width=\"1000\" height=\"550\"></iframe>\n\n<p>The scatter plot with zoom+pan+brush loaded too slow with the full dataset (24MB) of all 190,000 predictions for the week.\nIt also made for a crowded visualization.  So I took a sample preserving a consistent distance between predictions.  The sampled data (2.5MB) takes every 10th prediction which turns out to be approximately a prediction every 90 seconds.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-r\" data-lang=\"r\"><span class=\"c1\"># keeping just estimates every nth prediction when time between predictions is less than 30 seconds</span><span class=\"w\">\n</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">timediff</span><span class=\"p\">[</span><span class=\"m\">2</span><span class=\"o\">:</span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">)]</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">time</span><span class=\"p\">[</span><span class=\"m\">2</span><span class=\"o\">:</span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">)]</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">time</span><span class=\"p\">[</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"p\">(</span><span class=\"n\">nrow</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">)</span><span class=\"m\">-1</span><span class=\"p\">)]</span><span class=\"w\">\n</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">timediff</span><span class=\"p\">[</span><span class=\"nf\">is.na</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">timediff</span><span class=\"p\">)]</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"w\">\n</span><span class=\"n\">n</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"m\">10</span><span class=\"w\">\n</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">timediffSample</span><span class=\"p\">[</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">timediff</span><span class=\"o\">&lt;</span><span class=\"m\">30</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"nf\">rep</span><span class=\"p\">(</span><span class=\"m\">1</span><span class=\"o\">:</span><span class=\"n\">n</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">length.out</span><span class=\"o\">=</span><span class=\"nf\">sum</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">timediff</span><span class=\"o\">&lt;</span><span class=\"m\">30</span><span class=\"p\">))</span><span class=\"w\">\n</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">timediffSample</span><span class=\"p\">[</span><span class=\"nf\">is.na</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"o\">$</span><span class=\"n\">timediffSample</span><span class=\"p\">)]</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"m\">0</span></code></pre></figure>\n\n\n  <p><a href=\"http://brooksandrew.github.io/simpleblog/articles/nextbus4_viz/\">How accurate is Next Bus IV: visualizing</a> was originally published by andrew brooks at <a href=\"http://brooksandrew.github.io/simpleblog\">andrew brooks</a> on September 18, 2014.</p>"
}