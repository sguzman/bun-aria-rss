{
  "title": "Universal limiting mean return of CPPI investment portfolios",
  "link": "",
  "published": "2019-12-09T16:14:00-08:00",
  "updated": "2019-12-09T16:14:00-08:00",
  "author": {
    "name": "Jonathan Landy"
  },
  "id": "tag:efavdb.com,2019-12-09:/universal-mean-return-formula-of-the-cppi-investment-strategy",
  "summary": "<p><span class=\"caps\">CPPI</span>* is a risk management tactic that can be applied to\nany investment portfolio. The approach entails banking a percentage of\nprofits whenever a new all time high wealth is achieved, thereby\nensuring that a portfolio&#8217;s drawdown never goes below some maximum\npercentage. Here, I review <span class=\"caps\">CPPI</span> and then …</p>",
  "content": "<p><span class=\"caps\">CPPI</span>* is a risk management tactic that can be applied to\nany investment portfolio. The approach entails banking a percentage of\nprofits whenever a new all time high wealth is achieved, thereby\nensuring that a portfolio&#8217;s drawdown never goes below some maximum\npercentage. Here, I review <span class=\"caps\">CPPI</span> and then consider the mean growth rate\nof a <span class=\"caps\">CPPI</span> portfolio. I find that in a certain, common limit, this mean\ngrowth is given by a universal formula,\n(\\ref{cppi_asymptotic_growth}) below. This universal result does not\ndepend in detail on the statistics of the investment in question, but\ninstead only on its mean return and standard deviation. I illustrate\nthe formula&#8217;s accuracy with a simulation in&nbsp;python.</p>\n<p>*<span class=\"caps\">CPPI</span> = &#8220;Constant Proportion Portfolio&nbsp;Insurance&#8221;</p>\n<h2>Introduction</h2>\n<p>The drawdown of an investment portfolio at a given date is equal to\nthe amount of money lost relative to its maximum held capital up to\nthat date. This is illustrated in the figure at right &#8212; a portfolio\nthat once held $100 now holds only $90, so the drawdown is currently\n$10. <a href=\"https://efavdb.com/wp-content/uploads/2019/12/dd.png\"><img alt=\"dd\" src=\"https://efavdb.com/wp-content/uploads/2019/12/dd.png\"></a></p>\n<p><span class=\"caps\">CPPI</span> is a method that can be applied to guarantee that the maximum\nfractional drawdown is never more than some predetermined value &#8212; the\nidea is to simply squirrel away an appropriate portion of earnings\nwhenever we hit a new maximum account value, and only risk what&#8217;s left\nover from that point on. For example, to cap the max loss at 50%, one\nshould only risk 50% of the initial capital and then continue to bank\n50% of any additional earnings whenever a new all time high is&nbsp;reached.</p>\n<p>According to Wikipedia, the first person to study <span class=\"caps\">CPPI</span> was Perold, who derived the statistical properties of a <span class=\"caps\">CPPI</span> portfolio&#8217;s value at time <span class=\"math\">\\(t\\)</span>, assuming the underlying stochastic investment follows a Wiener process. I was introduced to the <span class=\"caps\">CPPI</span> concept by the book &#8220;Algorithmic Trading&#8221; by Ernest Chan. This book implicitly poses the question of what the mean return is for general, discrete investment strategies. Here, I show that a universal formula applies in this case, valid at low to modest leverages and small unit investment Sharpe ratios &#8212; this result is given in equation (\\ref{cppi_asymptotic_growth})&nbsp;below.</p>\n<p>The post proceeds as follows: In the next section, I define some notation and then write down the limiting result. In the following section, I give a numerical example in python. Finally, an appendix contains a derivation of the main result. This makes use of the universal limiting drawdown distribution result from my <a href=\"http://efavdb.github.io/universal-drawdown-statistics-in-investing\">prior post</a>.</p>\n<h2><span class=\"caps\">CPPI</span> formulation and universal mean growth&nbsp;rate</h2>\n<p>In this section, I review the <span class=\"caps\">CPPI</span> strategy and give the limiting mean return result. Consider a portfolio that at time <span class=\"math\">\\(t\\)</span> has&nbsp;value,\n</p>\n<div class=\"math\">$$\n\\begin{align}\\tag{1}\nW_t = S_t + \\Gamma_t\n\\end{align}\n$$</div>\n<p>\nwhere <span class=\"math\">\\(W\\)</span> is our total wealth, <span class=\"math\">\\(S\\)</span> is the banked (safe) portion, and <span class=\"math\">\\(\\Gamma\\)</span> is the portion we are willing to bet or gamble. The savings is set so that each time we reach a new all time high wealth, <span class=\"math\">\\(S\\)</span> is adjusted to be equal to a fraction <span class=\"math\">\\(\\Pi\\)</span> of the net wealth. When this is done, the value of <span class=\"math\">\\(\\Gamma\\)</span> must also be adjusted downwards &#8212; some of the investment money is moved to savings. Before adjustment, the result of a bet moves <span class=\"math\">\\(\\Gamma\\)</span>&nbsp;to\n</p>\n<div class=\"math\">\\begin{align}\\label{gamble_eom_cppi} \\tag{2}\n\\tilde{\\Gamma}_{t+1} \\equiv \\left (1 + f (g_{t} - 1)\\right) \\Gamma_t.\n\\end{align}</div>\n<p>\nHere, the tilde at left indicates this is the value before any reallocation is applied &#8212; in case we have reached a new high, <span class=\"math\">\\(g_t\\)</span> is a stochastic investment outcome variable, and <span class=\"math\">\\(f\\)</span> is our &#8220;leverage&#8221; &#8212; a constant that encodes how heavily we bet on the game. I will assume all <span class=\"math\">\\(g_i\\)</span> are independent random variables that are identically distributed with distribution <span class=\"math\">\\(p(g)\\)</span>. I will assume that <span class=\"math\">\\(f\\)</span> is a fixed value throughout time, and will&nbsp;write\n</p>\n<div class=\"math\">\\begin{align} \\tag{3} \\label{3}\nf = \\frac{1}{\\phi} \\frac{ \\langle g -1 \\rangle }{ \\text{var}(g)}\n\\end{align}</div>\n<p>\nThis re-parameterization helps to make the math work out more nicely below. It is also motivated by the Kelly formula, which specifies the gambling leverage that maximizes wealth at long times (here, setting <span class=\"math\">\\(\\phi \\to 1\\)</span> gives the Kelly&nbsp;exposure).</p>\n<p>The equations above define the <span class=\"caps\">CPPI</span> scheme. The main result of this post is that in the limit where the leverage is not too high, and the stochastic <span class=\"math\">\\(g\\)</span> has small Sharpe ratio (mean return over standard deviation), the mean log wealth at time <span class=\"math\">\\(t\\)</span>&nbsp;satisfies\n</p>\n<div class=\"math\">\\begin{align} \\label{cppi_asymptotic_growth} \\tag{4}\n\\frac{1}{t}\\langle \\log W_{t} - \\log W_{0} \\rangle \\sim \\frac{ \\langle g -1 \\rangle^2 }{ \\text{var}(g)} (1-\\Pi) \\frac{(2 \\phi -1)}{2 \\phi ^2}.\n\\end{align}</div>\n<p>\nThis result can be used to estimate the mean growth of a portfolio to which <span class=\"caps\">CPPI</span> is applied. Before illustrating its accuracy via a simulation below, I highlight a few points about the&nbsp;result:</p>\n<ol>\n<li>The fact that (\\ref{cppi_asymptotic_growth}) is universal makes it very practical to apply to a real world investment: Rather than having to estimate the full distribution for <span class=\"math\">\\(g\\)</span>, we need only estimate its mean and variance to get an estimate for the portfolio&#8217;s long-time mean&nbsp;return.</li>\n<li>The mean return (\\ref{cppi_asymptotic_growth}) is equivalent to that found by Perold for Gaussian processes &#8212; as expected, since the result is&nbsp;&#8220;universal&#8221;.</li>\n<li>The maximum return at fixed <span class=\"math\">\\(\\Pi\\)</span> is again obtained at <span class=\"math\">\\(\\phi = 1\\)</span>, the Kelly&nbsp;maximum.</li>\n<li>If <span class=\"math\">\\(\\phi = 1/2\\)</span>, we are at twice Kelly exposure and the mean return is zero &#8212; this a well known result. At <span class=\"math\">\\(\\phi &lt; 1/2\\)</span>, we are above twice Kelly and the return is&nbsp;negative.</li>\n<li>The mean return is reduced by a factor <span class=\"math\">\\((1-\\Pi)\\)</span> &#8212; the fraction of new high wealths we are exposing to loss. It is interesting that the result is not suppressed faster than this as we hold out more wealth, given that we have lower exposure after a loss than we would&nbsp;otherwise.</li>\n<li>One can ask what <span class=\"math\">\\(\\phi\\)</span> gives us the same mean return using <span class=\"caps\">CPPI</span> as we would obtain at full exposure using <span class=\"math\">\\(\\phi_0\\)</span>. E.g., consider the case of <span class=\"math\">\\(\\Pi = 1/2\\)</span>, which corresponds to insuring that half of our wealth is protected from loss. Equating the mean gains of these two gives\n    <div class=\"math\">\\begin{align}\n    \\frac{1}{2} \\frac{(2 \\phi -1)}{2 \\phi ^2} = \\frac{(2 (2)-1)}{2 (2)^2} = \\frac{3}{8}.\n    \\end{align}</div>\n    The two roots for <span class=\"math\">\\(\\phi\\)</span> are plotted versus <span class=\"math\">\\(\\phi_0\\)</span> below. <a href=\"https://efavdb.com/wp-content/uploads/2019/12/solution_half_safe.png\"><img alt=\"solution_half_safe\" src=\"https://efavdb.com/wp-content/uploads/2019/12/solution_half_safe.png\"></a></li>\n</ol>\n<p>Notice that we can&#8217;t find solutions for all <span class=\"math\">\\(\\phi_0\\)</span> &#8212; it&#8217;s not possible to match the mean return for high leverages at full exposure when we force protection of some of our&nbsp;assets.</p>\n<p>We now turn to a simulation&nbsp;example.</p>\n<h2>Python <span class=\"caps\">CPPI</span>&nbsp;simulation</h2>\n<p>In the code below, we consider a system where in each step we either &#8220;win&#8221; or &#8220;lose&#8221;: If we win, the money we risk grows by a factor of <span class=\"math\">\\(f \\times 1.02\\)</span>, and if we lose, it goes down by a factor of <span class=\"math\">\\(f \\times 1 / 1.02\\)</span>. We take the probability of winning to be <span class=\"math\">\\(0.65\\)</span>. This game has a Sharpe ratio of <span class=\"math\">\\(0.32\\)</span>, small enough that our approximation should work well. The code below carries out a simulated repeated investment game over 100 trials &#8212; we hope that it is clear what is happening at each&nbsp;step.</p>\n<div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n\n<span class=\"c1\"># investment definitions -- a random walk</span>\n<span class=\"n\">LIFT_ON_WIN</span> <span class=\"o\">=</span> <span class=\"mf\">1.02</span>\n<span class=\"n\">LIFT_ON_LOSS</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"o\">/</span> <span class=\"n\">LIFT_ON_WIN</span>\n\n<span class=\"n\">P_WIN</span> <span class=\"o\">=</span> <span class=\"mf\">0.65</span>\n<span class=\"n\">P_LOSS</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"n\">P_WIN</span>\n\n<span class=\"n\">g_minus_1_bar</span> <span class=\"o\">=</span> <span class=\"n\">P_WIN</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">LIFT_ON_WIN</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"n\">P_LOSS</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">LIFT_ON_LOSS</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">var_g</span> <span class=\"o\">=</span> <span class=\"n\">P_WIN</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">LIFT_ON_WIN</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"o\">**</span> <span class=\"mi\">2</span> <span class=\"o\">+</span> <span class=\"n\">P_LOSS</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">LIFT_ON_LOSS</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"o\">**</span> <span class=\"mi\">2</span> <span class=\"o\">-</span> <span class=\"p\">(</span><span class=\"n\">g_minus_1_bar</span><span class=\"p\">)</span> <span class=\"o\">**</span> <span class=\"mi\">2</span>\n<span class=\"n\">full_kelly</span> <span class=\"o\">=</span> <span class=\"n\">g_minus_1_bar</span> <span class=\"o\">/</span> <span class=\"n\">var_g</span>\n\n<span class=\"n\">sharpe</span> <span class=\"o\">=</span> <span class=\"n\">g_minus_1_bar</span> <span class=\"o\">/</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">sqrt</span><span class=\"p\">(</span><span class=\"n\">var_g</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span> <span class=\"s1\">&#39;Sharpe ratio of g unit bet: </span><span class=\"si\">%.4f</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">sharpe</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">simulate_once</span><span class=\"p\">(</span><span class=\"n\">phi</span><span class=\"p\">,</span> <span class=\"n\">pi</span><span class=\"p\">,</span> <span class=\"n\">steps</span><span class=\"p\">):</span>\n    <span class=\"n\">initial_value</span> <span class=\"o\">=</span> <span class=\"mf\">1.0</span>\n    <span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">full_kelly</span> <span class=\"o\">/</span> <span class=\"n\">phi</span>\n\n    <span class=\"n\">current_nav</span> <span class=\"o\">=</span> <span class=\"n\">initial_value</span>\n    <span class=\"n\">current_max</span> <span class=\"o\">=</span> <span class=\"n\">current_nav</span>\n\n    <span class=\"k\">for</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">steps</span><span class=\"p\">):</span>\n        <span class=\"c1\"># update current max</span>\n        <span class=\"n\">current_max</span> <span class=\"o\">=</span> <span class=\"nb\">max</span><span class=\"p\">(</span><span class=\"n\">current_nav</span><span class=\"p\">,</span> <span class=\"n\">current_max</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># calculate current effective nav</span>\n        <span class=\"n\">current_drawdown</span> <span class=\"o\">=</span> <span class=\"n\">current_max</span> <span class=\"o\">-</span> <span class=\"n\">current_nav</span>\n        <span class=\"n\">gamma</span> <span class=\"o\">=</span> <span class=\"n\">current_max</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"n\">pi</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"n\">current_drawdown</span>\n\n        <span class=\"c1\"># play round of investment game</span>\n        <span class=\"n\">dice_roll</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">rand</span><span class=\"p\">()</span>\n        <span class=\"n\">win</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">dice_roll</span> <span class=\"o\">&lt;</span> <span class=\"n\">P_WIN</span><span class=\"p\">)</span>\n        <span class=\"n\">loss</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"n\">win</span>\n        <span class=\"n\">g</span> <span class=\"o\">=</span> <span class=\"n\">LIFT_ON_WIN</span> <span class=\"o\">*</span> <span class=\"n\">win</span> <span class=\"o\">+</span> <span class=\"n\">LIFT_ON_LOSS</span> <span class=\"o\">*</span> <span class=\"n\">loss</span>\n        <span class=\"n\">nav_change</span> <span class=\"o\">=</span> <span class=\"n\">gamma</span> <span class=\"o\">*</span> <span class=\"n\">f</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">g</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># update wealth</span>\n        <span class=\"n\">current_nav</span> <span class=\"o\">+=</span> <span class=\"n\">nav_change</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">current_nav</span>\n\n<span class=\"n\">end_results</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n\n<span class=\"c1\"># kelly and cppi properties</span>\n<span class=\"n\">PHI</span> <span class=\"o\">=</span> <span class=\"mf\">10.0</span>\n<span class=\"n\">PI</span> <span class=\"o\">=</span> <span class=\"o\">.</span><span class=\"mi\">75</span>\n<span class=\"n\">STEPS</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span>\n<span class=\"n\">TRIALS</span> <span class=\"o\">=</span> <span class=\"mi\">100</span>\n\n<span class=\"c1\"># simulation loop</span>\n<span class=\"k\">for</span> <span class=\"n\">trial</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">TRIALS</span><span class=\"p\">):</span>\n<span class=\"n\">end_nav</span> <span class=\"o\">=</span> <span class=\"n\">simulate_once</span><span class=\"p\">(</span><span class=\"n\">phi</span><span class=\"o\">=</span><span class=\"n\">PHI</span><span class=\"p\">,</span> <span class=\"n\">pi</span><span class=\"o\">=</span><span class=\"n\">PI</span><span class=\"p\">,</span> <span class=\"n\">steps</span><span class=\"o\">=</span><span class=\"n\">STEPS</span><span class=\"p\">)</span>\n<span class=\"n\">end_results</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">end_nav</span><span class=\"p\">)</span>\n\n<span class=\"n\">theory</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">g_minus_1_bar</span> <span class=\"o\">**</span> <span class=\"mi\">2</span> <span class=\"o\">/</span> <span class=\"n\">var_g</span><span class=\"p\">)</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"n\">PI</span><span class=\"p\">)</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"n\">PHI</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"n\">PHI</span> <span class=\"o\">**</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span> <span class=\"s1\">&#39;Experiment: </span><span class=\"si\">%2.5f</span><span class=\"s1\">&#39;</span><span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">(</span><span class=\"n\">end_results</span><span class=\"p\">))</span> <span class=\"o\">/</span> <span class=\"n\">STEPS</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span> <span class=\"s1\">&#39;Theory: </span><span class=\"si\">%2.5f</span><span class=\"s1\">&#39;</span><span class=\"o\">%</span> <span class=\"n\">theory</span>\n\n<span class=\"c1\"># OUTPUT:</span>\n<span class=\"c1\"># Sharpe ratio of g unit bet: 0.3249</span>\n<span class=\"c1\"># Experiment: 0.00251</span>\n<span class=\"c1\"># Theory: 0.00251</span>\n</pre></div>\n\n\n<p>The last lines above show the output of our print statements. In particular, the last two lines show the mean growth rate observed over the 100 trials and the theoretical value (\\ref{cppi_asymptotic_growth}) &#8212; these agree to three decimal&nbsp;places.</p>\n<p>Using a loop over <span class=\"math\">\\(\\phi\\)</span> values, I used the code above to obtain the plot below of mean returns vs <span class=\"math\">\\(\\phi\\)</span>. This shows that the limiting result works quite well over most <span class=\"math\">\\(\\phi\\)</span> &#8212; though there is some systematic, modest discrepancy at small <span class=\"math\">\\(\\phi\\)</span>. This is expected as the quadratic expansion for log wealth used below starts to break down at high exposures. Nevertheless, the fit is qualitatively quite good at all <span class=\"math\">\\(\\phi\\)</span>. This suggests that our result (\\ref{cppi_asymptotic_growth}) can be used for quick mean return forecasts for most practical, applied cases of <span class=\"caps\">CPPI</span>.</p>\n<p><a href=\"https://efavdb.com/wp-content/uploads/2019/12/mean_cppi_growth_rate.png\"><img alt=\"mean_cppi_growth_rate\" src=\"https://efavdb.com/wp-content/uploads/2019/12/mean_cppi_growth_rate.png\"></a></p>\n<h2>Appendix: Derivation of mean&nbsp;return</h2>\n<p>We give a rough sketch here of a proof of (\\ref{cppi_asymptotic_growth}). Our aim is to quickly get the universal form in a relatively clean way. Note that these results may be new, or perhaps well known to finance theorists &#8212; I&#8217;m not&nbsp;sure.</p>\n<p>To begin let us&nbsp;define\n</p>\n<div class=\"math\">\\begin{align}\n\\Gamma^*_t = \\max_{t^{\\prime} \\leq t} \\Gamma_t.\n\\end{align}</div>\n<p>\nThis is the maximum <span class=\"math\">\\(\\Gamma\\)</span> seen to date at time <span class=\"math\">\\(t\\)</span>. Necessarily, this is the value of <span class=\"math\">\\(\\Gamma\\)</span> as of the most recent all time high preceeding <span class=\"math\">\\(t\\)</span>. If <span class=\"math\">\\(\\Gamma_t &lt; \\Gamma^*_t\\)</span>, we say that we are in drawdown by value <span class=\"math\">\\(\\Gamma^*_t - \\Gamma_t\\)</span>. At all times, we&nbsp;have\n</p>\n<div class=\"math\">\\begin{align}\\nonumber\nS_t &amp;= \\frac{\\Pi}{1 - \\Pi} \\Gamma^*_t \\\\\n&amp;\\equiv \\rho \\Gamma^*_t.\n\\end{align}</div>\n<p>\nThis result holds because the saved portion is <span class=\"math\">\\(\\Pi\\)</span> times the net wealth when we reach a new high and <span class=\"math\">\\(\\Gamma^*\\)</span> is what&#8217;s left over, <span class=\"math\">\\((1 - \\Pi)\\)</span> times the net wealth at that&nbsp;time.</p>\n<p>From the above definitions, our net wealth after a step is given&nbsp;by\n</p>\n<div class=\"math\">\\begin{align}\\nonumber\nW_{t+1} &amp;= W_{t} \\left ( 1 + f(g_t -1) \\frac{\\Gamma_t}{W_{t}} \\right ) \\\\ \\nonumber\n&amp;= W_{t} \\left ( 1 + f(g_t -1) \\frac{\\Gamma_t}{S_t + \\Gamma_t} \\right ) \\\\\n&amp;= W_{t} \\left ( 1 + f(g_t -1) \\frac{\\frac{\\Gamma_t}{\\Gamma^*_t}}{\\rho+ \\frac{\\Gamma_t}{\\Gamma^*_t}} \\right )\n\\end{align}</div>\n<p>\nIterating and taking the logarithm we&nbsp;obtain\n</p>\n<div class=\"math\">\\begin{align}\\nonumber \\tag{A1} \\label{A1}\n\\log W_{t} &amp;= \\log W_{0} + \\sum_{i=0}^{t-1} \\log \\left ( 1 + f(g_i -1) \\frac{\\frac{\\Gamma_i}{\\Gamma^*_i}}{\\rho+ \\frac{\\Gamma_i}{\\Gamma^*_i}} \\right ) \\\\\n&amp;\\approx \\log W_{0} + \\sum_{i=0}^{t-1} f (g_i -1) \\frac{\\frac{\\Gamma_i}{\\Gamma^*_i}}{\\rho+ \\frac{\\Gamma_i}{\\Gamma^*_i}} - \\frac{f^2}{2} \\left ((g_i -1) \\frac{\\frac{\\Gamma_i}{\\Gamma^*_i}}{\\rho+ \\frac{\\Gamma_i}{\\Gamma^*_i}}\\right)^2 + \\ldots\n\\end{align}</div>\n<p>\nThe series expansion in the second line can be shown to converge quickly provided we have selected a leverage <span class=\"math\">\\(f\\)</span> that always results in a small percentage change in our net wealth each step. Note that it is the breakdown of this expansion that causes the slight divergence at low <span class=\"math\">\\(\\phi\\)</span> in our last plot&nbsp;above.</p>\n<p>Our aim is to evaluate the average of the last equation. The first key point needed to do this is to note that at step <span class=\"math\">\\(i\\)</span>, we have <span class=\"math\">\\(g_i\\)</span> and <span class=\"math\">\\(\\Gamma_i / \\Gamma_i^*\\)</span> independent (the outcome of the unit bet doesn&#8217;t depend on how much we have to wager at this time). This allows us to factor the averages above into one over <span class=\"math\">\\(g\\)</span> and over the <span class=\"math\">\\(\\Gamma_i / \\Gamma_i^*\\)</span> distribution. The former is relatively easy to write down if we assume some properties for <span class=\"math\">\\(f\\)</span> and <span class=\"math\">\\(g\\)</span>. To proceed on the latter, we note&nbsp;that\n</p>\n<div class=\"math\">\\begin{align}\\nonumber\n\\log \\frac{\\Gamma_i}{\\Gamma^*_i} = \\log \\Gamma_i - \\log \\Gamma^*_i\n\\end{align}</div>\n<p>\nis the drawdown of a random walk, with steps defined by (\\ref{gamble_eom_cppi}). We have argued in our last post that the tail of the distribution of this drawdown distribution is such&nbsp;that\n</p>\n<div class=\"math\">\\begin{align}\\nonumber\np( \\log \\Gamma_i - \\log \\Gamma^*_i = -k) \\propto \\exp(\\alpha k).\n\\end{align}</div>\n<p>\nwhere <span class=\"math\">\\(\\alpha\\)</span> is given in that post as an implicit function of the statistics of <span class=\"math\">\\(g\\)</span>. This tail form will hold almost everywhere when the Sharpe ratio is small. We will assume this&nbsp;here.</p>\n<p>Using the change of variables rule, we&nbsp;get\n</p>\n<div class=\"math\">\\begin{align}\\nonumber\np\\left(\\frac{\\Gamma_i}{\\Gamma^*_i} = k\\right) \\sim \\begin{cases}\n\\alpha k^{\\alpha - 1} &amp; \\text{if } x \\in (0, 1) \\\\\n0 &amp; \\text{else}\n\\end{cases}\n\\end{align}</div>\n<p>\nAgain, this is an approximation that assumes we spend relatively little time within one jump from the current all time high &#8212; a result that will hold in the small Sharpe ratio limit. With this result, we&nbsp;obtain\n</p>\n<div class=\"math\">\\begin{align}\\nonumber \\tag{A2} \\label{A2}\n\\left \\langle \\frac{\\frac{\\Gamma_i}{\\Gamma^*_i}}{\\rho+ \\frac{\\Gamma_i}{\\Gamma^*_i}} \\right \\rangle &amp;\\equiv \\int_0^1 \\frac{x}{\\rho + x} \\alpha x^{\\alpha - 1} dx \\\\\n&amp;= \\frac{\\alpha \\, _2F_1\\left(1,\\alpha +1;\\alpha +2;-\\frac{1}{\\rho }\\right)}{\\rho (\\alpha +1) }\n\\end{align}</div>\n<p>\nHere, <span class=\"math\">\\(_2F_1\\)</span> is the hypergeometric function.&nbsp;Similarly,\n</p>\n<div class=\"math\">\\begin{align}\\nonumber \\tag{A3} \\label{A3}\n\\left \\langle \\left( \\frac{\\frac{\\Gamma_i}{\\Gamma^*_i}}{\\rho+ \\frac{\\Gamma_i}{\\Gamma^*_i}} \\right)^2 \\right \\rangle &amp;\\equiv \\int_0^1 \\left( \\frac{x}{\\rho + x} \\right)^2 \\alpha x^{\\alpha - 1} dx \\\\\n&amp;= \\frac{\\alpha \\left(\\frac{\\rho }{\\rho +1}-\\frac{(\\alpha +1) \\, _2F_1\\left(1,\\alpha\n+2;\\alpha +3;-\\frac{1}{\\rho }\\right)}{\\alpha +2}\\right)}{\\rho ^2}\n\\end{align}</div>\n<p>\nNote that both of the last two lines go to one as <span class=\"math\">\\(\\rho \\to 0\\)</span>, the limit where we invest our entire net worth and protect nothing. In this case, the growth equations are just those for a fully invested account. If you plug the last two results into the second line of (\\ref{A1}), you get an expression for the mean&nbsp;return.</p>\n<p>To get the above results, we assumed a small Sharpe ratio. Therefore, to simplify things, we can use the value of <span class=\"math\">\\(\\alpha\\)</span> that we derived in our last post that is valid in this limit. This was given by <span class=\"math\">\\(\\alpha \\sim 2 \\mu / \\sigma^2\\)</span>, where <span class=\"math\">\\(\\mu\\)</span> and <span class=\"math\">\\(\\sigma\\)</span> and mean and standard deviation of the random walk. We now evaluate these to get an expression for <span class=\"math\">\\(\\alpha\\)</span> in terms of the statistics of <span class=\"math\">\\(g\\)</span>. First, we note that the mean drift of <span class=\"math\">\\(\\log \\Gamma\\)</span> is given&nbsp;by\n</p>\n<div class=\"math\">\\begin{align}\\nonumber\n\\mu &amp;\\equiv \\langle \\log(1 + f (g-1)) \\rangle \\ \\nonumber\n&amp;\\sim f \\langle g -1 \\rangle - \\frac{f^2}{2} \\langle (g-1)^2 \\rangle \\\\\n&amp;\\sim f \\langle g -1 \\rangle - \\frac{f^2}{2} \\text{var}(g).\n\\end{align}</div>\n<p>\nThe last line follows from the assumption that the Sharpe ratio for <span class=\"math\">\\(g -1\\)</span> is small, so&nbsp;that\n</p>\n<div class=\"math\">\\begin{align}\\nonumber\n\\langle (g-1)^2 \\rangle &amp;= \\left ( \\langle (g-1)^2 \\rangle - \\langle (g-1) \\rangle^2 \\right) + \\langle (g-1) \\rangle^2 \\\\\n&amp;= \\text{var}(g) \\left ( 1 + \\frac{ \\langle (g-1) \\rangle^2}{\\text{var}(g)} \\right ).\n\\end{align}</div>\n<p>\nSimilarly, one can show&nbsp;that\n</p>\n<div class=\"math\">\\begin{align}\\nonumber\n\\sigma^2 &amp;\\equiv \\text{var} \\log(1 + f (g-1)) \\\\\n&amp;\\sim f^2 \\text{var}(g).\n\\end{align}</div>\n<p>\nThis&nbsp;gives\n</p>\n<div class=\"math\">\\begin{align}\\nonumber\n\\alpha &amp;\\sim 2 \\frac{\\mu}{\\sigma^2} \\\\ \\nonumber\n&amp;\\sim 2 \\frac{ f \\langle g -1 \\rangle - \\frac{f^2}{2} \\text{var}(g)}{ f^2 \\text{var}(g)} \\\\\n&amp;= \\frac{2}{f} \\frac{ \\langle g -1 \\rangle }{ \\text{var}(g)} - 1\n\\end{align}</div>\n<p>\nThe second term in the first line can be neglected because we require the change in value to be a small fraction of our net wealth. We anticipate applying the algorithm to values of <span class=\"math\">\\(f\\)</span> of order <span class=\"math\">\\(f \\sim O( \\frac{ \\langle g -1 \\rangle }{ \\text{var}(g)})\\)</span>, so the above is <span class=\"math\">\\(O(1)\\)</span>. If we plug these results into the limiting form for <span class=\"math\">\\(\\alpha\\)</span> and use (\\ref{3}) for <span class=\"math\">\\(f\\)</span>, we&nbsp;get\n</p>\n<div class=\"math\">\\begin{align} \\tag{A4} \\label{A4}\n\\alpha \\sim 2 \\phi -1.\n\\end{align}</div>\n<p>\nWe won&#8217;t show the details, but if you plug (\\ref{A2}), (\\ref{A3}), and (\\ref{A4}) into (\\ref{A1}), this gives (\\ref{cppi_asymptotic_growth}). To get there, you need to show that a big collapse of terms occurs in the two hypergeometric functions. This collapse can be derived using the series expansion for <span class=\"math\">\\(_2F_1\\)</span> in about one page. The collapse of terms only occurs in the small Sharpe ratio limit, where <span class=\"math\">\\(\\alpha\\)</span> is given as above. We note that for some walks, an exponential form holds everywhere. In this case, the more general expression using <span class=\"math\">\\(_2F_1\\)</span> applies even at high Sharpe ratios &#8212; though we still require <span class=\"math\">\\(f\\)</span>&nbsp;small.</p>\n<script type=\"text/javascript\">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {\n    var align = \"center\",\n        indent = \"0em\",\n        linebreak = \"false\";\n\n    if (false) {\n        align = (screen.width < 768) ? \"left\" : align;\n        indent = (screen.width < 768) ? \"0em\" : indent;\n        linebreak = (screen.width < 768) ? 'true' : linebreak;\n    }\n\n    var mathjaxscript = document.createElement('script');\n    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';\n    mathjaxscript.type = 'text/javascript';\n    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';\n\n    var configscript = document.createElement('script');\n    configscript.type = 'text/x-mathjax-config';\n    configscript[(window.opera ? \"innerHTML\" : \"text\")] =\n        \"MathJax.Hub.Config({\" +\n        \"    config: ['MMLorHTML.js'],\" +\n        \"    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } },\" +\n        \"    jax: ['input/TeX','input/MathML','output/HTML-CSS'],\" +\n        \"    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],\" +\n        \"    displayAlign: '\"+ align +\"',\" +\n        \"    displayIndent: '\"+ indent +\"',\" +\n        \"    showMathMenu: true,\" +\n        \"    messageStyle: 'normal',\" +\n        \"    tex2jax: { \" +\n        \"        inlineMath: [ ['\\\\\\\\(','\\\\\\\\)'] ], \" +\n        \"        displayMath: [ ['$$','$$'] ],\" +\n        \"        processEscapes: true,\" +\n        \"        preview: 'TeX',\" +\n        \"    }, \" +\n        \"    'HTML-CSS': { \" +\n        \"        availableFonts: ['STIX', 'TeX'],\" +\n        \"        preferredFont: 'STIX',\" +\n        \"        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} },\" +\n        \"        linebreaks: { automatic: \"+ linebreak +\", width: '90% container' },\" +\n        \"    }, \" +\n        \"}); \" +\n        \"if ('default' !== 'default') {\" +\n            \"MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {\" +\n                \"var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;\" +\n                \"VARIANT['normal'].fonts.unshift('MathJax_default');\" +\n                \"VARIANT['bold'].fonts.unshift('MathJax_default-bold');\" +\n                \"VARIANT['italic'].fonts.unshift('MathJax_default-italic');\" +\n                \"VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');\" +\n            \"});\" +\n            \"MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {\" +\n                \"var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;\" +\n                \"VARIANT['normal'].fonts.unshift('MathJax_default');\" +\n                \"VARIANT['bold'].fonts.unshift('MathJax_default-bold');\" +\n                \"VARIANT['italic'].fonts.unshift('MathJax_default-italic');\" +\n                \"VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');\" +\n            \"});\" +\n        \"}\";\n\n    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);\n    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);\n}\n</script>",
  "category": ""
}