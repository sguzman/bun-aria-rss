{
  "title": "GroupBy-fu: improvements in grouping and aggregating data in pandas",
  "link": "",
  "published": "2011-07-27T00:00:00-07:00",
  "updated": "2011-07-27T00:00:00-07:00",
  "author": {
    "name": "Wes McKinney"
  },
  "id": "tag:wesmckinney.com,2011-07-27:/blog/groupby-fu-improvements-in-grouping-and-aggregating-data-in-pandas/",
  "summary": "<p>A couple of weeks ago in my <a title=\"Blog post\" href=\"http://wesmckinney.com/blog/?p=8\" target=\"_blank\">inaugural blog post</a> I wrote about the state of GroupBy in pandas and gave an example application. However, I was dissatisfied with the limited expressiveness (see the end of the article), so I decided to invest some serious time in the groupby functionality …</p>",
  "content": "<p>A couple of weeks ago in my <a title=\"Blog post\" href=\"http://wesmckinney.com/blog/?p=8\" target=\"_blank\">inaugural blog post</a> I wrote about the state of GroupBy in pandas and gave an example application. However, I was dissatisfied with the limited expressiveness (see the end of the article), so I decided to invest some serious time in the groupby functionality in <a title=\"pandas\" href=\"http://pandas.sourceforge.net\" target=\"_blank\">pandas</a> over the last 2 weeks in beefing up what you can do. So this article is a part show-and-tell, part quick tutorial on the new features. Note that I haven't added a lot of this to the official documentation yet.</p>\n<h3>GroupBy primer</h3>\n<p>GroupBy may be one of the least well-understood features in pandas. Let's consider a DataFrame (basically a labeled 2D array):</p>\n<div class=\"github\"><pre><span></span><code>In [18]: df\nOut[18]:\n                      A         B        C         D\n2000-03-31 00:00:00   0.6304   -1.493    0.2082    0.3378\n2000-06-30 00:00:00  -0.1041    1.093    0.1227   -0.2362\n2000-09-29 00:00:00  -1.822     0.7325  -0.4964   -1.707\n2000-12-29 00:00:00   0.3325   -0.2213   0.5465    1.265\n2001-03-30 00:00:00   0.8422   -0.1265   0.1234    0.7743\n2001-06-29 00:00:00  -0.07774  -0.3906  -0.6328   -1.259\n2001-09-28 00:00:00  -0.3417   -0.4209   1.724     0.3069\n2001-12-31 00:00:00   0.493    -0.2815   1.314     1.004\n2002-03-29 00:00:00   1.003    -0.4807   0.7232    1.079\n2002-06-28 00:00:00   0.1415   -2.275    0.6178    0.8817\n2002-09-30 00:00:00  -0.6855    0.3921  -1.468     1.522\n2002-12-31 00:00:00  -1.635     0.3083   0.1209   -0.5606\n2003-03-31 00:00:00   0.5707   -0.7125  -0.07677   0.5154\n2003-06-30 00:00:00   0.3646   -0.8574  -0.562     0.2176\n2003-09-30 00:00:00   1.024    -0.8113   0.6771   -1.261\n</code></pre></div>\n\n<p>Here, the index (row labels) contains dates and the columns are names for each time series. When performing a groupby operation, we may different goals:</p>\n<ul>\n<li>Perform an aggregation, like computing the sum of mean of each group. Functionally this means applying a function to each group and putting the aggregated results into a DataFrame</li>\n<li>Slicing the DataFrame into chunks (groups) and then doing something with the slices</li>\n<li>Performing a transformation, like standardizing each group (computing the zscore)</li>\n</ul>\n<p>So there are two tasks: first, grouping the data; second, doing something with the grouped data. As far as grouping, in a totally abstract sense we have to define some kind of mapping that assigns labels (one of the axes) into group buckets. A mapping could be one of many things:</p>\n<ul>\n<li>A Python function, to be called on each label</li>\n<li>A dict, containing {label : group_name} mappings</li>\n<li>An array the same length as the axis containing the group correspondences. This may often be one of the columns in a DataFrame, but need not be. Every other mapping type gets rendered to this form eventually.</li>\n</ul>\n<p>So in the above data, let's say we wanted to group the data by year. Since the row labels are Python datetime objects, we can access the <code>year</code> attribute when calling <code>groupby</code></p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">21</span><span class=\"p\">]:</span> <span class=\"n\">grouped</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">year</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>This returns an object of type <strong>GroupBy</strong>. With this object, you can do a lot of things including: <strong>iteration, aggregation,</strong> or <strong>transformation</strong>. So we could <strong>iterate</strong> like so:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">20</span><span class=\"p\">]:</span> <span class=\"k\">for</span> <span class=\"n\">year</span><span class=\"p\">,</span> <span class=\"n\">group</span> <span class=\"ow\">in</span> <span class=\"n\">grouped</span><span class=\"p\">:</span>\n   <span class=\"o\">....</span><span class=\"p\">:</span>     <span class=\"nb\">print</span> <span class=\"n\">year</span>\n   <span class=\"o\">....</span><span class=\"p\">:</span>     <span class=\"nb\">print</span> <span class=\"n\">group</span>\n   <span class=\"o\">....</span><span class=\"p\">:</span>\n<span class=\"mi\">2000</span>\n                      <span class=\"n\">A</span>        <span class=\"n\">B</span>        <span class=\"n\">C</span>        <span class=\"n\">D</span>\n<span class=\"mi\">2000</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">31</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.6304</span>  <span class=\"o\">-</span><span class=\"mf\">1.493</span>    <span class=\"mf\">0.2082</span>   <span class=\"mf\">0.3378</span>\n<span class=\"mi\">2000</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">30</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">0.1041</span>   <span class=\"mf\">1.093</span>    <span class=\"mf\">0.1227</span>  <span class=\"o\">-</span><span class=\"mf\">0.2362</span>\n<span class=\"mi\">2000</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">1.822</span>    <span class=\"mf\">0.7325</span>  <span class=\"o\">-</span><span class=\"mf\">0.4964</span>  <span class=\"o\">-</span><span class=\"mf\">1.707</span>\n<span class=\"mi\">2000</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.3325</span>  <span class=\"o\">-</span><span class=\"mf\">0.2213</span>   <span class=\"mf\">0.5465</span>   <span class=\"mf\">1.265</span>\n\n<span class=\"mi\">2001</span>\n                      <span class=\"n\">A</span>         <span class=\"n\">B</span>        <span class=\"n\">C</span>        <span class=\"n\">D</span>\n<span class=\"mi\">2001</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.8422</span>   <span class=\"o\">-</span><span class=\"mf\">0.1265</span>   <span class=\"mf\">0.1234</span>   <span class=\"mf\">0.7743</span>\n<span class=\"mi\">2001</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">0.07774</span>  <span class=\"o\">-</span><span class=\"mf\">0.3906</span>  <span class=\"o\">-</span><span class=\"mf\">0.6328</span>  <span class=\"o\">-</span><span class=\"mf\">1.259</span>\n<span class=\"mi\">2001</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">0.3417</span>   <span class=\"o\">-</span><span class=\"mf\">0.4209</span>   <span class=\"mf\">1.724</span>    <span class=\"mf\">0.3069</span>\n<span class=\"mi\">2001</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">31</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.493</span>    <span class=\"o\">-</span><span class=\"mf\">0.2815</span>   <span class=\"mf\">1.314</span>    <span class=\"mf\">1.004</span>\n\n<span class=\"mi\">2002</span>\n                      <span class=\"n\">A</span>        <span class=\"n\">B</span>        <span class=\"n\">C</span>        <span class=\"n\">D</span>\n<span class=\"mi\">2002</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">1.003</span>   <span class=\"o\">-</span><span class=\"mf\">0.4807</span>   <span class=\"mf\">0.7232</span>   <span class=\"mf\">1.079</span>\n<span class=\"mi\">2002</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.1415</span>  <span class=\"o\">-</span><span class=\"mf\">2.275</span>    <span class=\"mf\">0.6178</span>   <span class=\"mf\">0.8817</span>\n<span class=\"mi\">2002</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">30</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">0.6855</span>   <span class=\"mf\">0.3921</span>  <span class=\"o\">-</span><span class=\"mf\">1.468</span>    <span class=\"mf\">1.522</span>\n<span class=\"mi\">2002</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">31</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">1.635</span>    <span class=\"mf\">0.3083</span>   <span class=\"mf\">0.1209</span>  <span class=\"o\">-</span><span class=\"mf\">0.5606</span>\n\n<span class=\"mi\">2003</span>\n                      <span class=\"n\">A</span>        <span class=\"n\">B</span>        <span class=\"n\">C</span>         <span class=\"n\">D</span>\n<span class=\"mi\">2003</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">31</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.5707</span>  <span class=\"o\">-</span><span class=\"mf\">0.7125</span>  <span class=\"o\">-</span><span class=\"mf\">0.07677</span>   <span class=\"mf\">0.5154</span>\n<span class=\"mi\">2003</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">30</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.3646</span>  <span class=\"o\">-</span><span class=\"mf\">0.8574</span>  <span class=\"o\">-</span><span class=\"mf\">0.562</span>     <span class=\"mf\">0.2176</span>\n<span class=\"mi\">2003</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">30</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">1.024</span>   <span class=\"o\">-</span><span class=\"mf\">0.8113</span>   <span class=\"mf\">0.6771</span>   <span class=\"o\">-</span><span class=\"mf\">1.261</span>\n</code></pre></div>\n\n<p>Or <strong>aggregate</strong> like so:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">21</span><span class=\"p\">]:</span> <span class=\"n\">grouped</span><span class=\"o\">.</span><span class=\"n\">aggregate</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">sum</span><span class=\"p\">)</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">21</span><span class=\"p\">]:</span>\n       <span class=\"n\">A</span>        <span class=\"n\">B</span>        <span class=\"n\">C</span>          <span class=\"n\">D</span>\n<span class=\"mi\">2000</span>  <span class=\"o\">-</span><span class=\"mf\">0.9629</span>   <span class=\"mf\">0.1108</span>   <span class=\"mf\">0.3811</span>    <span class=\"o\">-</span><span class=\"mf\">0.3405</span>\n<span class=\"mi\">2001</span>   <span class=\"mf\">0.9159</span>  <span class=\"o\">-</span><span class=\"mf\">1.219</span>    <span class=\"mf\">2.529</span>      <span class=\"mf\">0.8268</span>\n<span class=\"mi\">2002</span>  <span class=\"o\">-</span><span class=\"mf\">1.176</span>   <span class=\"o\">-</span><span class=\"mf\">2.055</span>   <span class=\"o\">-</span><span class=\"mf\">0.006253</span>   <span class=\"mf\">2.921</span>\n<span class=\"mi\">2003</span>   <span class=\"mf\">1.959</span>   <span class=\"o\">-</span><span class=\"mf\">2.381</span>    <span class=\"mf\">0.03838</span>   <span class=\"o\">-</span><span class=\"mf\">0.528</span>\n</code></pre></div>\n\n<p>Or <strong>transform groups</strong> like so (here I standardize each group):</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">22</span><span class=\"p\">]:</span> <span class=\"n\">zscore</span> <span class=\"o\">=</span> <span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"o\">-</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">())</span> <span class=\"o\">/</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">std</span><span class=\"p\">()</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">23</span><span class=\"p\">]:</span> <span class=\"n\">transformed</span> <span class=\"o\">=</span> <span class=\"n\">grouped</span><span class=\"o\">.</span><span class=\"n\">transform</span><span class=\"p\">(</span><span class=\"n\">zscore</span><span class=\"p\">)</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">23</span><span class=\"p\">]:</span>\n                      <span class=\"n\">A</span>        <span class=\"n\">B</span>         <span class=\"n\">C</span>         <span class=\"n\">D</span>\n<span class=\"mi\">2000</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">31</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.7946</span>  <span class=\"o\">-</span><span class=\"mf\">1.316</span>     <span class=\"mf\">0.2598</span>    <span class=\"mf\">0.3396</span>\n<span class=\"mi\">2000</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">30</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.1246</span>   <span class=\"mf\">0.9216</span>    <span class=\"mf\">0.06319</span>  <span class=\"o\">-</span><span class=\"mf\">0.1213</span>\n<span class=\"mi\">2000</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">1.442</span>    <span class=\"mf\">0.61</span>     <span class=\"o\">-</span><span class=\"mf\">1.361</span>    <span class=\"o\">-</span><span class=\"mf\">1.302</span>\n<span class=\"mi\">2000</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.5228</span>  <span class=\"o\">-</span><span class=\"mf\">0.2155</span>    <span class=\"mf\">1.038</span>     <span class=\"mf\">1.084</span>\n<span class=\"mi\">2001</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">30</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">1.142</span>    <span class=\"mf\">1.34</span>     <span class=\"o\">-</span><span class=\"mf\">0.47</span>      <span class=\"mf\">0.5569</span>\n<span class=\"mi\">2001</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">0.571</span>   <span class=\"o\">-</span><span class=\"mf\">0.644</span>    <span class=\"o\">-</span><span class=\"mf\">1.168</span>    <span class=\"o\">-</span><span class=\"mf\">1.438</span>\n<span class=\"mi\">2001</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">1.062</span>   <span class=\"o\">-</span><span class=\"mf\">0.8715</span>    <span class=\"mf\">1.009</span>     <span class=\"mf\">0.0983</span>\n<span class=\"mi\">2001</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">31</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.4917</span>   <span class=\"mf\">0.1758</span>    <span class=\"mf\">0.6299</span>    <span class=\"mf\">0.7827</span>\n<span class=\"mi\">2002</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">29</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">1.149</span>    <span class=\"mf\">0.02675</span>   <span class=\"mf\">0.7159</span>    <span class=\"mf\">0.3864</span>\n<span class=\"mi\">2002</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">28</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">0.3857</span>  <span class=\"o\">-</span><span class=\"mf\">1.422</span>     <span class=\"mf\">0.6118</span>    <span class=\"mf\">0.168</span>\n<span class=\"mi\">2002</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">30</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">0.3469</span>   <span class=\"mf\">0.7316</span>   <span class=\"o\">-</span><span class=\"mf\">1.449</span>     <span class=\"mf\">0.878</span>\n<span class=\"mi\">2002</span><span class=\"o\">-</span><span class=\"mi\">12</span><span class=\"o\">-</span><span class=\"mi\">31</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">1.188</span>    <span class=\"mf\">0.664</span>     <span class=\"mf\">0.1209</span>   <span class=\"o\">-</span><span class=\"mf\">1.432</span>\n<span class=\"mi\">2003</span><span class=\"o\">-</span><span class=\"mi\">03</span><span class=\"o\">-</span><span class=\"mi\">31</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">0.2443</span>   <span class=\"mf\">1.097</span>    <span class=\"o\">-</span><span class=\"mf\">0.1434</span>    <span class=\"mf\">0.7267</span>\n<span class=\"mi\">2003</span><span class=\"o\">-</span><span class=\"mi\">06</span><span class=\"o\">-</span><span class=\"mi\">30</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>  <span class=\"o\">-</span><span class=\"mf\">0.8552</span>  <span class=\"o\">-</span><span class=\"mf\">0.8598</span>   <span class=\"o\">-</span><span class=\"mf\">0.9205</span>    <span class=\"mf\">0.4138</span>\n<span class=\"mi\">2003</span><span class=\"o\">-</span><span class=\"mi\">09</span><span class=\"o\">-</span><span class=\"mi\">30</span> <span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span><span class=\"p\">:</span><span class=\"mi\">00</span>   <span class=\"mf\">1.099</span>   <span class=\"o\">-</span><span class=\"mf\">0.2376</span>    <span class=\"mf\">1.064</span>    <span class=\"o\">-</span><span class=\"mf\">1.14</span>\n</code></pre></div>\n\n<p>Some aggregations are so common that they're provided as instance methods on the GroupBy object:</p>\n<div class=\"github\"><pre><span></span><code>In [24]: grouped.sum()\nOut[24]:\n       A        B        C          D\n2000  -0.9629   0.1108   0.3811    -0.3405\n2001   0.9159  -1.219    2.529      0.8268\n2002  -1.176   -2.055   -0.006253   2.921\n2003   1.959   -2.381    0.03838   -0.528\n\nIn [25]: grouped.mean()\nOut[25]:\n       A        B         C          D\n2000  -0.2407   0.02769   0.09526   -0.08512\n2001   0.229   -0.3049    0.6324     0.2067\n2002  -0.2939  -0.5138   -0.001563   0.7303\n2003   0.6531  -0.7938    0.01279   -0.176\n</code></pre></div>\n\n<p>For those with SQL experience, a DataFrame can be treated like an SQL table. As such, grouping 'by columns\" is quite natural:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"nv\">In</span> [<span class=\"mi\">27</span>]: <span class=\"nv\">df2</span>\n<span class=\"nv\">Out</span>[<span class=\"mi\">27</span>]:\n    <span class=\"nv\">A</span>     <span class=\"nv\">B</span>       <span class=\"nv\">C</span>        <span class=\"nv\">D</span>\n<span class=\"mi\">0</span>   <span class=\"nv\">foo</span>   <span class=\"nv\">one</span>    <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">7883</span>   <span class=\"mi\">0</span>.<span class=\"mi\">7743</span>\n<span class=\"mi\">1</span>   <span class=\"nv\">bar</span>   <span class=\"nv\">one</span>    <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">5866</span>   <span class=\"mi\">0</span>.<span class=\"mi\">06009</span>\n<span class=\"mi\">2</span>   <span class=\"nv\">foo</span>   <span class=\"nv\">two</span>     <span class=\"mi\">0</span>.<span class=\"mi\">9312</span>   <span class=\"mi\">1</span>.<span class=\"mi\">2</span>\n<span class=\"mi\">3</span>   <span class=\"nv\">bar</span>   <span class=\"nv\">three</span>  <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">6417</span>   <span class=\"mi\">0</span>.<span class=\"mi\">3444</span>\n<span class=\"mi\">4</span>   <span class=\"nv\">foo</span>   <span class=\"nv\">two</span>    <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">8841</span>  <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">08126</span>\n<span class=\"mi\">5</span>   <span class=\"nv\">bar</span>   <span class=\"nv\">two</span>     <span class=\"mi\">1</span>.<span class=\"mi\">194</span>   <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">7933</span>\n<span class=\"mi\">6</span>   <span class=\"nv\">foo</span>   <span class=\"nv\">one</span>    <span class=\"o\">-</span><span class=\"mi\">1</span>.<span class=\"mi\">624</span>   <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">1403</span>\n<span class=\"mi\">7</span>   <span class=\"nv\">foo</span>   <span class=\"nv\">three</span>   <span class=\"mi\">0</span>.<span class=\"mi\">5046</span>   <span class=\"mi\">0</span>.<span class=\"mi\">5833</span>\n\n<span class=\"nv\">In</span> [<span class=\"mi\">28</span>]: <span class=\"k\">for</span> <span class=\"nv\">name</span>, <span class=\"nv\">group</span> <span class=\"nv\">in</span> <span class=\"nv\">df2</span>.<span class=\"nv\">groupby</span><span class=\"ss\">(</span><span class=\"s1\">&#39;</span><span class=\"s\">A</span><span class=\"s1\">&#39;</span><span class=\"ss\">)</span>:\n   ....:     <span class=\"nv\">print</span> <span class=\"nv\">name</span>\n   ....:     <span class=\"nv\">print</span> <span class=\"nv\">group</span>\n   ....:\n<span class=\"nv\">bar</span>\n    <span class=\"nv\">A</span>     <span class=\"nv\">B</span>       <span class=\"nv\">C</span>        <span class=\"nv\">D</span>\n<span class=\"mi\">1</span>   <span class=\"nv\">bar</span>   <span class=\"nv\">one</span>    <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">5866</span>   <span class=\"mi\">0</span>.<span class=\"mi\">06009</span>\n<span class=\"mi\">3</span>   <span class=\"nv\">bar</span>   <span class=\"nv\">three</span>  <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">6417</span>   <span class=\"mi\">0</span>.<span class=\"mi\">3444</span>\n<span class=\"mi\">5</span>   <span class=\"nv\">bar</span>   <span class=\"nv\">two</span>     <span class=\"mi\">1</span>.<span class=\"mi\">194</span>   <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">7933</span>\n\n<span class=\"nv\">foo</span>\n    <span class=\"nv\">A</span>     <span class=\"nv\">B</span>       <span class=\"nv\">C</span>        <span class=\"nv\">D</span>\n<span class=\"mi\">0</span>   <span class=\"nv\">foo</span>   <span class=\"nv\">one</span>    <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">7883</span>   <span class=\"mi\">0</span>.<span class=\"mi\">7743</span>\n<span class=\"mi\">2</span>   <span class=\"nv\">foo</span>   <span class=\"nv\">two</span>     <span class=\"mi\">0</span>.<span class=\"mi\">9312</span>   <span class=\"mi\">1</span>.<span class=\"mi\">2</span>\n<span class=\"mi\">4</span>   <span class=\"nv\">foo</span>   <span class=\"nv\">two</span>    <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">8841</span>  <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">08126</span>\n<span class=\"mi\">6</span>   <span class=\"nv\">foo</span>   <span class=\"nv\">one</span>    <span class=\"o\">-</span><span class=\"mi\">1</span>.<span class=\"mi\">624</span>   <span class=\"o\">-</span><span class=\"mi\">0</span>.<span class=\"mi\">1403</span>\n<span class=\"mi\">7</span>   <span class=\"nv\">foo</span>   <span class=\"nv\">three</span>   <span class=\"mi\">0</span>.<span class=\"mi\">5046</span>   <span class=\"mi\">0</span>.<span class=\"mi\">5833</span>\n</code></pre></div>\n\n<p>Note the presence of the \"nuisance\" <strong>B</strong> column when we group by <strong>A</strong>. I want this to work:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">30</span><span class=\"p\">]:</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;A&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">30</span><span class=\"p\">]:</span>\n      <span class=\"n\">C</span>         <span class=\"n\">D</span>\n<span class=\"n\">bar</span>  <span class=\"o\">-</span><span class=\"mf\">0.01137</span>  <span class=\"o\">-</span><span class=\"mf\">0.1296</span>\n<span class=\"n\">foo</span>  <span class=\"o\">-</span><span class=\"mf\">0.3722</span>    <span class=\"mf\">0.4671</span>\n</code></pre></div>\n\n<p>More on dealing with this below.</p>\n<h3>New: Column selection</h3>\n<p>In my <a title=\"Blog post\" href=\"http://wesmckinney.com/blog/?p=8\" target=\"_blank\">last post</a> I mentioned wanting to be able to do a groupby-operation on a single column of a DataFrame using another column or set of columns as the groupers. So in the above example, what I want is:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">grouped</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;C&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;A&#39;</span><span class=\"p\">])</span>\n\n<span class=\"c1\"># or</span>\n<span class=\"n\">grouped</span> <span class=\"o\">=</span> <span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;C&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">([</span><span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;A&#39;</span><span class=\"p\">],</span> <span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;B&#39;</span><span class=\"p\">]])</span>\n</code></pre></div>\n\n<p>This is too verbose / awkward for my tastes. So now you can do:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">111</span><span class=\"p\">]:</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;A&#39;</span><span class=\"p\">)[</span><span class=\"s1\">&#39;C&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">111</span><span class=\"p\">]:</span>\n<span class=\"n\">bar</span>    <span class=\"o\">-</span><span class=\"mf\">0.447919901908</span>\n<span class=\"n\">foo</span>    <span class=\"o\">-</span><span class=\"mf\">0.158016186685</span>\n</code></pre></div>\n\n<p>Behind the scenes, this simply passes the <strong>C</strong> column to a Series GroupBy object along with the already-computed grouping(s).</p>\n<h3>New: Group by multiple columns / key functions</h3>\n<p>The ability to group by multiple criteria (just like SQL) has been one of my most desired GroupBy features for a long time. It's also very hard to implement efficiently. So I bit the bullet and carefully crafted Cython code to speedily do aggregations on data grouped by multiple columns. So now you can do:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">113</span><span class=\"p\">]:</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">([</span><span class=\"s1\">&#39;A&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;B&#39;</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">113</span><span class=\"p\">]:</span>\n    <span class=\"n\">A</span>     <span class=\"n\">B</span>       <span class=\"n\">C</span>        <span class=\"n\">D</span>\n<span class=\"mi\">0</span>   <span class=\"n\">foo</span>   <span class=\"n\">one</span>     <span class=\"mf\">0.3558</span>  <span class=\"o\">-</span><span class=\"mf\">0.4818</span>\n<span class=\"mi\">1</span>   <span class=\"n\">foo</span>   <span class=\"n\">two</span>    <span class=\"o\">-</span><span class=\"mf\">0.2758</span>  <span class=\"o\">-</span><span class=\"mf\">1.271</span>\n<span class=\"mi\">2</span>   <span class=\"n\">foo</span>   <span class=\"n\">three</span>  <span class=\"o\">-</span><span class=\"mf\">0.95</span>     <span class=\"mf\">1.709</span>\n<span class=\"mi\">3</span>   <span class=\"n\">bar</span>   <span class=\"n\">one</span>     <span class=\"mf\">1.916</span>   <span class=\"o\">-</span><span class=\"mf\">0.5093</span>\n<span class=\"mi\">4</span>   <span class=\"n\">bar</span>   <span class=\"n\">two</span>    <span class=\"o\">-</span><span class=\"mf\">2.315</span>    <span class=\"mf\">0.1177</span>\n<span class=\"mi\">5</span>   <span class=\"n\">bar</span>   <span class=\"n\">three</span>  <span class=\"o\">-</span><span class=\"mf\">0.9447</span>   <span class=\"mf\">0.2519</span>\n</code></pre></div>\n\n<p>Iteration with multiple groups flattens the key pairs:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">114</span><span class=\"p\">]:</span> <span class=\"k\">for</span> <span class=\"n\">k1</span><span class=\"p\">,</span> <span class=\"n\">k2</span><span class=\"p\">,</span> <span class=\"n\">group</span> <span class=\"ow\">in</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">([</span><span class=\"s1\">&#39;A&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;B&#39;</span><span class=\"p\">]):</span>\n   <span class=\"o\">.....</span><span class=\"p\">:</span>     <span class=\"nb\">print</span> <span class=\"n\">k1</span><span class=\"p\">,</span> <span class=\"n\">k2</span>\n   <span class=\"o\">.....</span><span class=\"p\">:</span>     <span class=\"nb\">print</span> <span class=\"n\">group</span>\n   <span class=\"o\">.....</span><span class=\"p\">:</span>\n<span class=\"n\">foo</span> <span class=\"n\">one</span>\n    <span class=\"n\">A</span>     <span class=\"n\">B</span>     <span class=\"n\">C</span>        <span class=\"n\">D</span>\n<span class=\"mi\">0</span>   <span class=\"n\">foo</span>   <span class=\"n\">one</span>   <span class=\"mf\">0.8248</span>   <span class=\"mf\">0.3856</span>\n<span class=\"mi\">6</span>   <span class=\"n\">foo</span>   <span class=\"n\">one</span>  <span class=\"o\">-</span><span class=\"mf\">0.1133</span>  <span class=\"o\">-</span><span class=\"mf\">1.349</span>\n\n<span class=\"n\">foo</span> <span class=\"n\">two</span>\n    <span class=\"n\">A</span>     <span class=\"n\">B</span>     <span class=\"n\">C</span>        <span class=\"n\">D</span>\n<span class=\"mi\">2</span>   <span class=\"n\">foo</span>   <span class=\"n\">two</span>  <span class=\"o\">-</span><span class=\"mf\">1.175</span>   <span class=\"o\">-</span><span class=\"mf\">1.036</span>\n<span class=\"mi\">4</span>   <span class=\"n\">foo</span>   <span class=\"n\">two</span>   <span class=\"mf\">0.6239</span>  <span class=\"o\">-</span><span class=\"mf\">1.506</span>\n\n<span class=\"n\">foo</span> <span class=\"n\">three</span>\n    <span class=\"n\">A</span>     <span class=\"n\">B</span>       <span class=\"n\">C</span>      <span class=\"n\">D</span>\n<span class=\"mi\">7</span>   <span class=\"n\">foo</span>   <span class=\"n\">three</span>  <span class=\"o\">-</span><span class=\"mf\">0.95</span>   <span class=\"mf\">1.709</span>\n\n<span class=\"n\">bar</span> <span class=\"n\">one</span>\n    <span class=\"n\">A</span>     <span class=\"n\">B</span>     <span class=\"n\">C</span>       <span class=\"n\">D</span>\n<span class=\"mi\">1</span>   <span class=\"n\">bar</span>   <span class=\"n\">one</span>   <span class=\"mf\">1.916</span>  <span class=\"o\">-</span><span class=\"mf\">0.5093</span>\n\n<span class=\"n\">bar</span> <span class=\"n\">two</span>\n    <span class=\"n\">A</span>     <span class=\"n\">B</span>     <span class=\"n\">C</span>       <span class=\"n\">D</span>\n<span class=\"mi\">5</span>   <span class=\"n\">bar</span>   <span class=\"n\">two</span>  <span class=\"o\">-</span><span class=\"mf\">2.315</span>   <span class=\"mf\">0.1177</span>\n\n<span class=\"n\">bar</span> <span class=\"n\">three</span>\n    <span class=\"n\">A</span>     <span class=\"n\">B</span>       <span class=\"n\">C</span>        <span class=\"n\">D</span>\n<span class=\"mi\">3</span>   <span class=\"n\">bar</span>   <span class=\"n\">three</span>  <span class=\"o\">-</span><span class=\"mf\">0.9447</span>   <span class=\"mf\">0.2519</span>\n</code></pre></div>\n\n<p>As a less trivial example, I loaded some data from the <a title=\"BLS\" href=\"http://www.bls.gov\" target=\"_blank\">Bureau of Labor Statistics</a>, which I'll write more about another time:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">126</span><span class=\"p\">]:</span> <span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">read_table</span><span class=\"p\">(</span><span class=\"s1\">&#39;ce.data.44.FinActOtherCurr.txt&#39;</span><span class=\"p\">,</span>\n                          <span class=\"n\">sep</span><span class=\"o\">=</span><span class=\"s1\">&#39;\\s+&#39;</span><span class=\"p\">,</span> <span class=\"n\">index_col</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">127</span><span class=\"p\">]:</span> <span class=\"n\">df</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">127</span><span class=\"p\">]:</span>\n<span class=\"o\">&lt;</span><span class=\"k\">class</span> <span class=\"err\">&#39;</span><span class=\"nc\">pandas</span><span class=\"o\">.</span><span class=\"n\">core</span><span class=\"o\">.</span><span class=\"n\">frame</span><span class=\"o\">.</span><span class=\"n\">DataFrame</span><span class=\"s1\">&#39;&gt;</span>\n<span class=\"n\">Index</span><span class=\"p\">:</span> <span class=\"mi\">32806</span> <span class=\"n\">entries</span><span class=\"p\">,</span> <span class=\"mi\">0</span> <span class=\"n\">to</span> <span class=\"mi\">32805</span>\n<span class=\"n\">Data</span> <span class=\"n\">columns</span><span class=\"p\">:</span>\n<span class=\"n\">series_id</span>    <span class=\"mi\">32806</span>  <span class=\"n\">non</span><span class=\"o\">-</span><span class=\"n\">null</span> <span class=\"n\">values</span>\n<span class=\"n\">year</span>         <span class=\"mi\">32806</span>  <span class=\"n\">non</span><span class=\"o\">-</span><span class=\"n\">null</span> <span class=\"n\">values</span>\n<span class=\"n\">period</span>       <span class=\"mi\">32806</span>  <span class=\"n\">non</span><span class=\"o\">-</span><span class=\"n\">null</span> <span class=\"n\">values</span>\n<span class=\"n\">value</span>        <span class=\"mi\">32806</span>  <span class=\"n\">non</span><span class=\"o\">-</span><span class=\"n\">null</span> <span class=\"n\">values</span>\n<span class=\"n\">dtypes</span><span class=\"p\">:</span> <span class=\"n\">int64</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"n\">float64</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"nb\">object</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n\n<span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">128</span><span class=\"p\">]:</span> <span class=\"n\">df</span><span class=\"p\">[:</span><span class=\"mi\">15</span><span class=\"p\">]</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">128</span><span class=\"p\">]:</span>\n     <span class=\"n\">series_id</span>       <span class=\"n\">year</span>   <span class=\"n\">period</span>   <span class=\"n\">value</span>\n<span class=\"mi\">0</span>    <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M01</span>      <span class=\"mi\">83</span>\n<span class=\"mi\">1</span>    <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M02</span>      <span class=\"mf\">83.6</span>\n<span class=\"mi\">2</span>    <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M03</span>      <span class=\"mf\">83.4</span>\n<span class=\"mi\">3</span>    <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M04</span>      <span class=\"mf\">84.9</span>\n<span class=\"mi\">4</span>    <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M05</span>      <span class=\"mf\">84.1</span>\n<span class=\"mi\">5</span>    <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M06</span>      <span class=\"mf\">85.4</span>\n<span class=\"mi\">6</span>    <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M07</span>      <span class=\"mf\">86.5</span>\n<span class=\"mi\">7</span>    <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M08</span>      <span class=\"mi\">86</span>\n<span class=\"mi\">8</span>    <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M09</span>      <span class=\"mf\">85.5</span>\n<span class=\"mi\">9</span>    <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M10</span>      <span class=\"mf\">83.6</span>\n<span class=\"mi\">10</span>   <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M11</span>      <span class=\"mf\">83.6</span>\n<span class=\"mi\">11</span>   <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M12</span>      <span class=\"mf\">84.7</span>\n<span class=\"mi\">12</span>   <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1990</span>   <span class=\"n\">M13</span>      <span class=\"mf\">84.5</span>\n<span class=\"mi\">13</span>   <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1991</span>   <span class=\"n\">M01</span>      <span class=\"mf\">82.9</span>\n<span class=\"mi\">14</span>   <span class=\"n\">CEU5500000034</span>   <span class=\"mi\">1991</span>   <span class=\"n\">M02</span>      <span class=\"mf\">83.1</span>\n</code></pre></div>\n\n<p>This data set has 118 unique series_id's and spans 22 years (the period column gives the month of observation), so we're talking about 2596 unique groups. Let's say we wanted to compute the mean value for each year, it's pretty simple with the improved groupby:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">129</span><span class=\"p\">]:</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">([</span><span class=\"s1\">&#39;series_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;year&#39;</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">129</span><span class=\"p\">]:</span>\n<span class=\"o\">&lt;</span><span class=\"k\">class</span> <span class=\"err\">&#39;</span><span class=\"nc\">pandas</span><span class=\"o\">.</span><span class=\"n\">core</span><span class=\"o\">.</span><span class=\"n\">frame</span><span class=\"o\">.</span><span class=\"n\">DataFrame</span><span class=\"s1\">&#39;&gt;</span>\n<span class=\"n\">Index</span><span class=\"p\">:</span> <span class=\"mi\">2596</span> <span class=\"n\">entries</span><span class=\"p\">,</span> <span class=\"mi\">0</span> <span class=\"n\">to</span> <span class=\"mi\">2595</span>\n<span class=\"n\">Data</span> <span class=\"n\">columns</span><span class=\"p\">:</span>\n<span class=\"n\">series_id</span>    <span class=\"mi\">2596</span>  <span class=\"n\">non</span><span class=\"o\">-</span><span class=\"n\">null</span> <span class=\"n\">values</span>\n<span class=\"n\">value</span>        <span class=\"mi\">2596</span>  <span class=\"n\">non</span><span class=\"o\">-</span><span class=\"n\">null</span> <span class=\"n\">values</span>\n<span class=\"n\">year</span>         <span class=\"mi\">2596</span>  <span class=\"n\">non</span><span class=\"o\">-</span><span class=\"n\">null</span> <span class=\"n\">values</span>\n<span class=\"n\">dtypes</span><span class=\"p\">:</span> <span class=\"n\">int64</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"n\">float64</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"nb\">object</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>I was also pretty impressed with how fast this operation is (the power of Cython!):</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">130</span><span class=\"p\">]:</span> <span class=\"n\">timeit</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">([</span><span class=\"s1\">&#39;series_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;year&#39;</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span>\n<span class=\"mi\">10</span> <span class=\"n\">loops</span><span class=\"p\">,</span> <span class=\"n\">best</span> <span class=\"n\">of</span> <span class=\"mi\">3</span><span class=\"p\">:</span> <span class=\"mf\">22.9</span> <span class=\"n\">ms</span> <span class=\"n\">per</span> <span class=\"n\">loop</span>\n</code></pre></div>\n\n<p>I haven't compared this with an SQL engine (SQLite, MySQL, Postgres, ...) but I hope that it's competitive. If you call a non-Cythonized function, the speed goes down considerably:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">132</span><span class=\"p\">]:</span> <span class=\"n\">timeit</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">([</span><span class=\"s1\">&#39;series_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;year&#39;</span><span class=\"p\">])[</span><span class=\"s1\">&#39;value&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">std</span><span class=\"p\">()</span>\n<span class=\"mi\">1</span> <span class=\"n\">loops</span><span class=\"p\">,</span> <span class=\"n\">best</span> <span class=\"n\">of</span> <span class=\"mi\">3</span><span class=\"p\">:</span> <span class=\"mi\">232</span> <span class=\"n\">ms</span> <span class=\"n\">per</span> <span class=\"n\">loop</span>\n</code></pre></div>\n\n<p><strong>Edit:</strong> It's also possible to pass multiple functions instead of column names or to mix and match column names with functions:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">22</span><span class=\"p\">]:</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">([</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">year</span><span class=\"p\">,</span> <span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">month</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">22</span><span class=\"p\">]:</span>\n     <span class=\"n\">A</span>          <span class=\"n\">B</span>         <span class=\"n\">C</span>          <span class=\"n\">D</span>         <span class=\"n\">key_0</span>   <span class=\"n\">key_1</span>\n<span class=\"mi\">0</span>    <span class=\"mf\">0.09433</span>    <span class=\"mf\">0.06146</span>   <span class=\"mf\">0.1891</span>     <span class=\"mf\">0.2079</span>    <span class=\"mi\">2000</span>    <span class=\"mi\">1</span>\n<span class=\"mi\">1</span>    <span class=\"mf\">0.02674</span>   <span class=\"o\">-</span><span class=\"mf\">0.09411</span>   <span class=\"mf\">0.1557</span>    <span class=\"o\">-</span><span class=\"mf\">0.07926</span>   <span class=\"mi\">2000</span>    <span class=\"mi\">2</span>\n<span class=\"mi\">2</span>    <span class=\"mf\">0.07089</span>    <span class=\"mf\">0.3938</span>   <span class=\"o\">-</span><span class=\"mf\">0.08026</span>   <span class=\"o\">-</span><span class=\"mf\">0.416</span>     <span class=\"mi\">2000</span>    <span class=\"mi\">3</span>\n<span class=\"mi\">3</span>    <span class=\"mf\">0.133</span>     <span class=\"o\">-</span><span class=\"mf\">0.04532</span>   <span class=\"mf\">0.03341</span>   <span class=\"o\">-</span><span class=\"mf\">0.2866</span>    <span class=\"mi\">2000</span>    <span class=\"mi\">4</span>\n<span class=\"mi\">4</span>    <span class=\"mf\">0.1301</span>     <span class=\"mf\">0.1803</span>   <span class=\"o\">-</span><span class=\"mf\">0.4241</span>     <span class=\"mf\">0.1482</span>    <span class=\"mi\">2000</span>    <span class=\"mi\">5</span>\n<span class=\"mi\">5</span>   <span class=\"o\">-</span><span class=\"mf\">0.3804</span>    <span class=\"o\">-</span><span class=\"mf\">0.08935</span>   <span class=\"mf\">0.04791</span>    <span class=\"mf\">0.08268</span>   <span class=\"mi\">2000</span>    <span class=\"mi\">6</span>\n<span class=\"mi\">6</span>    <span class=\"mf\">0.2211</span>     <span class=\"mf\">0.2483</span>   <span class=\"o\">-</span><span class=\"mf\">0.3559</span>    <span class=\"o\">-</span><span class=\"mf\">0.06205</span>   <span class=\"mi\">2000</span>    <span class=\"mi\">7</span>\n<span class=\"mi\">7</span>   <span class=\"o\">-</span><span class=\"mf\">0.2908</span>     <span class=\"mf\">0.07606</span>  <span class=\"o\">-</span><span class=\"mf\">0.2001</span>    <span class=\"o\">-</span><span class=\"mf\">0.05225</span>   <span class=\"mi\">2000</span>    <span class=\"mi\">8</span>\n<span class=\"mi\">8</span>   <span class=\"o\">-</span><span class=\"mf\">0.07888</span>   <span class=\"o\">-</span><span class=\"mf\">0.3915</span>    <span class=\"mf\">0.06442</span>    <span class=\"mf\">0.5109</span>    <span class=\"mi\">2000</span>    <span class=\"mi\">9</span>\n<span class=\"mi\">9</span>    <span class=\"mf\">0.3809</span>     <span class=\"mf\">0.4037</span>   <span class=\"o\">-</span><span class=\"mf\">0.2431</span>    <span class=\"o\">-</span><span class=\"mf\">0.2892</span>    <span class=\"mi\">2000</span>    <span class=\"mi\">10</span>\n<span class=\"mi\">10</span>  <span class=\"o\">-</span><span class=\"mf\">0.2765</span>     <span class=\"mf\">0.01461</span>  <span class=\"o\">-</span><span class=\"mf\">0.2653</span>     <span class=\"mf\">0.1335</span>    <span class=\"mi\">2000</span>    <span class=\"mi\">11</span>\n<span class=\"mi\">11</span>   <span class=\"mf\">0.6983</span>    <span class=\"o\">-</span><span class=\"mf\">0.1167</span>    <span class=\"mf\">0.3964</span>     <span class=\"mf\">0.03776</span>   <span class=\"mi\">2000</span>    <span class=\"mi\">12</span>\n<span class=\"mi\">12</span>  <span class=\"o\">-</span><span class=\"mf\">0.2347</span>     <span class=\"mf\">0.2333</span>   <span class=\"o\">-</span><span class=\"mf\">0.06508</span>    <span class=\"mf\">0.3</span>       <span class=\"mi\">2001</span>    <span class=\"mi\">1</span>\n<span class=\"mi\">13</span>   <span class=\"mf\">0.1751</span>     <span class=\"mf\">0.05545</span>  <span class=\"o\">-</span><span class=\"mf\">0.004038</span>   <span class=\"mf\">0.06194</span>   <span class=\"mi\">2001</span>    <span class=\"mi\">2</span>\n<span class=\"mi\">14</span>   <span class=\"mf\">0.08792</span>    <span class=\"mf\">0.03517</span>   <span class=\"mf\">0.05583</span>   <span class=\"o\">-</span><span class=\"mf\">0.4356</span>    <span class=\"mi\">2001</span>    <span class=\"mi\">3</span>\n<span class=\"mi\">15</span>  <span class=\"o\">-</span><span class=\"mf\">0.08408</span>    <span class=\"mf\">0.05567</span>  <span class=\"o\">-</span><span class=\"mf\">0.1705</span>     <span class=\"mf\">0.1914</span>    <span class=\"mi\">2001</span>    <span class=\"mi\">4</span>\n<span class=\"mi\">16</span>   <span class=\"mf\">0.008912</span>   <span class=\"mf\">0.2317</span>    <span class=\"mf\">0.08875</span>    <span class=\"mf\">0.08637</span>   <span class=\"mi\">2001</span>    <span class=\"mi\">5</span>\n<span class=\"mi\">17</span>   <span class=\"mf\">0.3304</span>     <span class=\"mf\">0.3635</span>    <span class=\"mf\">0.005158</span>   <span class=\"mf\">0.3588</span>    <span class=\"mi\">2001</span>    <span class=\"mi\">6</span>\n<span class=\"mi\">18</span>  <span class=\"o\">-</span><span class=\"mf\">0.1324</span>     <span class=\"mf\">0.3419</span>   <span class=\"o\">-</span><span class=\"mf\">0.2527</span>    <span class=\"o\">-</span><span class=\"mf\">0.2249</span>    <span class=\"mi\">2001</span>    <span class=\"mi\">7</span>\n<span class=\"mi\">19</span>   <span class=\"mf\">0.0472</span>     <span class=\"mf\">0.2552</span>   <span class=\"o\">-</span><span class=\"mf\">0.07589</span>   <span class=\"o\">-</span><span class=\"mf\">0.07992</span>   <span class=\"mi\">2001</span>    <span class=\"mi\">8</span>\n<span class=\"mi\">20</span>   <span class=\"mf\">0.07582</span>   <span class=\"o\">-</span><span class=\"mf\">0.2295</span>    <span class=\"mf\">0.1002</span>     <span class=\"mf\">0.1077</span>    <span class=\"mi\">2001</span>    <span class=\"mi\">9</span>\n<span class=\"mi\">21</span>   <span class=\"mf\">0.2368</span>     <span class=\"mf\">0.02214</span>  <span class=\"o\">-</span><span class=\"mf\">0.3866</span>    <span class=\"o\">-</span><span class=\"mf\">0.2671</span>    <span class=\"mi\">2001</span>    <span class=\"mi\">10</span>\n<span class=\"mi\">22</span>   <span class=\"mf\">0.2116</span>    <span class=\"o\">-</span><span class=\"mf\">0.07872</span>  <span class=\"o\">-</span><span class=\"mf\">0.06399</span>    <span class=\"mf\">0.2309</span>    <span class=\"mi\">2001</span>    <span class=\"mi\">11</span>\n</code></pre></div>\n\n<h3>New: Omitting \"nuisance\" columns</h3>\n<p>It's pretty common to group by a column and ignore other columns containing non-floating point data. It used to be that you'd get an error, forcing you to first drop the \"nuisance\" columns, e.g. suppose we only want to group by the <strong>A</strong> column here:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">133</span><span class=\"p\">]:</span> <span class=\"n\">df2</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">133</span><span class=\"p\">]:</span>\n    <span class=\"n\">A</span>     <span class=\"n\">B</span>       <span class=\"n\">C</span>        <span class=\"n\">D</span>\n<span class=\"mi\">0</span>   <span class=\"n\">foo</span>   <span class=\"n\">one</span>     <span class=\"mf\">0.8248</span>   <span class=\"mf\">0.3856</span>\n<span class=\"mi\">1</span>   <span class=\"n\">bar</span>   <span class=\"n\">one</span>     <span class=\"mf\">1.916</span>   <span class=\"o\">-</span><span class=\"mf\">0.5093</span>\n<span class=\"mi\">2</span>   <span class=\"n\">foo</span>   <span class=\"n\">two</span>    <span class=\"o\">-</span><span class=\"mf\">1.175</span>   <span class=\"o\">-</span><span class=\"mf\">1.036</span>\n<span class=\"mi\">3</span>   <span class=\"n\">bar</span>   <span class=\"n\">three</span>  <span class=\"o\">-</span><span class=\"mf\">0.9447</span>   <span class=\"mf\">0.2519</span>\n<span class=\"mi\">4</span>   <span class=\"n\">foo</span>   <span class=\"n\">two</span>     <span class=\"mf\">0.6239</span>  <span class=\"o\">-</span><span class=\"mf\">1.506</span>\n<span class=\"mi\">5</span>   <span class=\"n\">bar</span>   <span class=\"n\">two</span>    <span class=\"o\">-</span><span class=\"mf\">2.315</span>    <span class=\"mf\">0.1177</span>\n<span class=\"mi\">6</span>   <span class=\"n\">foo</span>   <span class=\"n\">one</span>    <span class=\"o\">-</span><span class=\"mf\">0.1133</span>  <span class=\"o\">-</span><span class=\"mf\">1.349</span>\n<span class=\"mi\">7</span>   <span class=\"n\">foo</span>   <span class=\"n\">three</span>  <span class=\"o\">-</span><span class=\"mf\">0.95</span>     <span class=\"mf\">1.709</span>\n</code></pre></div>\n\n<p>If you try to compute the mean of the <strong>B</strong> column, things won't quite work out:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">134</span><span class=\"p\">]:</span> <span class=\"n\">grouped</span> <span class=\"o\">=</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;A&#39;</span><span class=\"p\">)[</span><span class=\"s1\">&#39;B&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span>\n<span class=\"ne\">TypeError</span><span class=\"p\">:</span> <span class=\"n\">unsupported</span> <span class=\"n\">operand</span> <span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"o\">/</span><span class=\"p\">:</span> <span class=\"s1\">&#39;str&#39;</span> <span class=\"ow\">and</span> <span class=\"s1\">&#39;float&#39;</span>\n</code></pre></div>\n\n<p>To cope with this, so-called \"nuisance\" columns are now automatically dropped. While I don't like discarding information, I think \"practicality beats purity\" in this case:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">135</span><span class=\"p\">]:</span> <span class=\"n\">df2</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;A&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">135</span><span class=\"p\">]:</span>\n      <span class=\"n\">C</span>        <span class=\"n\">D</span>\n<span class=\"n\">bar</span>  <span class=\"o\">-</span><span class=\"mf\">0.4479</span>  <span class=\"o\">-</span><span class=\"mf\">0.0466</span>\n<span class=\"n\">foo</span>  <span class=\"o\">-</span><span class=\"mf\">0.158</span>   <span class=\"o\">-</span><span class=\"mf\">0.3593</span>\n</code></pre></div>\n\n<h3>New: “auto-dispatching” to DataFrame / Series</h3>\n<p>Since very few functions in DataFrame and Series/TimeSeries are implemented on the GroupBy classes, you may wish to simply invoke a Series instance method on each group, let's say:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">140</span><span class=\"p\">]:</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;series_id&#39;</span><span class=\"p\">)[</span><span class=\"s1\">&#39;value&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">agg</span><span class=\"p\">(</span><span class=\"n\">Series</span><span class=\"o\">.</span><span class=\"n\">skew</span><span class=\"p\">)</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">140</span><span class=\"p\">]:</span>\n<span class=\"n\">CEU5500000034</span>    <span class=\"o\">-</span><span class=\"mf\">0.253887792525</span>\n<span class=\"n\">CEU5500000035</span>    <span class=\"mf\">0.0938252241898</span>\n<span class=\"n\">CEU5552200034</span>    <span class=\"mf\">0.387563548587</span>\n<span class=\"n\">CEU5552200035</span>    <span class=\"mf\">0.0868489117242</span>\n<span class=\"n\">CEU5552210034</span>    <span class=\"mf\">0.74506367536</span>\n<span class=\"n\">CEU5552210035</span>    <span class=\"mf\">0.551290226183</span>\n<span class=\"o\">&lt;</span><span class=\"n\">snip</span><span class=\"o\">&gt;</span>\n</code></pre></div>\n\n<p>But since we're got Python at our disposal, it's relatively straightforward to override <code>__getattribute__</code> to wrap and dispatch calls to Series/DataFrame instance methods so you can do this:</p>\n<div class=\"github\"><pre><span></span><code>In [141]: df.groupby(&#39;series_id&#39;)[&#39;value&#39;].skew()\nOut[141]:\nCEU5500000034    -0.253887792525\nCEU5500000035    0.0938252241898\nCEU5552200034    0.387563548587\nCEU5552200035    0.0868489117242\nCEU5552210034    0.74506367536\n&lt;snip&gt;\n</code></pre></div>\n\n<p>Some of the more complicated methods, like the super-useful <strong>describe</strong> method can be used in fact:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">142</span><span class=\"p\">]:</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;series_id&#39;</span><span class=\"p\">)[</span><span class=\"s1\">&#39;value&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">describe</span><span class=\"p\">()</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">142</span><span class=\"p\">]:</span>\n                <span class=\"n\">count</span>   <span class=\"n\">mean</span>    <span class=\"n\">std</span>     <span class=\"nb\">min</span>    <span class=\"mi\">10</span><span class=\"o\">%</span>     <span class=\"mi\">50</span><span class=\"o\">%</span>     <span class=\"mi\">90</span><span class=\"o\">%</span>     <span class=\"nb\">max</span>\n<span class=\"n\">CEU5500000034</span>   <span class=\"mi\">279</span>     <span class=\"mf\">96.54</span>   <span class=\"mf\">8.317</span>   <span class=\"mf\">81.7</span>   <span class=\"mi\">84</span>      <span class=\"mf\">98.6</span>    <span class=\"mf\">107.2</span>   <span class=\"mi\">112</span>\n<span class=\"n\">CEU5500000035</span>   <span class=\"mi\">279</span>     <span class=\"mf\">93.88</span>   <span class=\"mf\">28.9</span>    <span class=\"mf\">50.4</span>   <span class=\"mf\">55.28</span>   <span class=\"mf\">91.9</span>    <span class=\"mf\">134.5</span>   <span class=\"mf\">140.2</span>\n<span class=\"n\">CEU5552200034</span>   <span class=\"mi\">278</span>     <span class=\"mf\">97.95</span>   <span class=\"mf\">6.839</span>   <span class=\"mf\">86.9</span>   <span class=\"mf\">89.47</span>   <span class=\"mf\">97.15</span>   <span class=\"mf\">108.2</span>   <span class=\"mf\">113.9</span>\n<span class=\"n\">CEU5552200035</span>   <span class=\"mi\">278</span>     <span class=\"mf\">93.58</span>   <span class=\"mf\">26.18</span>   <span class=\"mi\">58</span>     <span class=\"mf\">60.34</span>   <span class=\"mf\">89.2</span>    <span class=\"mf\">127.4</span>   <span class=\"mf\">137.3</span>\n<span class=\"n\">CEU5552210034</span>   <span class=\"mi\">278</span>     <span class=\"mf\">100.7</span>   <span class=\"mf\">3.95</span>    <span class=\"mf\">94.1</span>   <span class=\"mf\">95.87</span>   <span class=\"mf\">99.8</span>    <span class=\"mi\">106</span>     <span class=\"mf\">113.1</span>\n<span class=\"n\">CEU5552210035</span>   <span class=\"mi\">278</span>     <span class=\"mf\">98.84</span>   <span class=\"mf\">23.86</span>   <span class=\"mf\">71.6</span>   <span class=\"mf\">73.77</span>   <span class=\"mf\">92.6</span>    <span class=\"mf\">137.2</span>   <span class=\"mf\">145.8</span>\n<span class=\"o\">...</span>\n</code></pre></div>\n\n<p>For those interested, the internal code to do this dispatching is short and simple, by the way:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"k\">def</span> <span class=\"fm\">__getattribute__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">attr</span><span class=\"p\">):</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"nb\">object</span><span class=\"o\">.</span><span class=\"fm\">__getattribute__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">attr</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"ne\">AttributeError</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">attr</span><span class=\"p\">):</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_make_wrapper</span><span class=\"p\">(</span><span class=\"n\">attr</span><span class=\"p\">)</span>\n        <span class=\"k\">raise</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">_make_wrapper</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n    <span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">,</span> <span class=\"n\">types</span><span class=\"o\">.</span><span class=\"n\">MethodType</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aggregate</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"bp\">self</span><span class=\"p\">:</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">))</span>\n\n    <span class=\"c1\"># return the class reference</span>\n    <span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">obj</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">wrapper</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"n\">curried</span> <span class=\"o\">=</span> <span class=\"k\">lambda</span> <span class=\"bp\">self</span><span class=\"p\">:</span> <span class=\"n\">f</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aggregate</span><span class=\"p\">(</span><span class=\"n\">curried</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">wrapper</span>\n</code></pre></div>\n\n<h3>Old but not well known: apply multiple functions</h3>\n<p>This has always been around but not well-known by many people. Suppose you want to apply multiple functions to a group and collect all the results. You can pass a dict of functions:</p>\n<div class=\"github\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"p\">[</span><span class=\"mi\">144</span><span class=\"p\">]:</span> <span class=\"n\">grouped</span><span class=\"o\">.</span><span class=\"n\">agg</span><span class=\"p\">({</span><span class=\"s1\">&#39;mean&#39;</span> <span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">,</span> <span class=\"s1\">&#39;variance&#39;</span> <span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">var</span><span class=\"p\">})</span>\n<span class=\"n\">Out</span><span class=\"p\">[</span><span class=\"mi\">144</span><span class=\"p\">]:</span>\n                <span class=\"n\">mean</span>    <span class=\"n\">variance</span>\n<span class=\"n\">CEU5500000034</span>   <span class=\"mf\">96.54</span>   <span class=\"mf\">68.92</span>\n<span class=\"n\">CEU5500000035</span>   <span class=\"mf\">93.88</span>   <span class=\"mf\">832.3</span>\n<span class=\"n\">CEU5552200034</span>   <span class=\"mf\">97.95</span>   <span class=\"mf\">46.6</span>\n<span class=\"n\">CEU5552200035</span>   <span class=\"mf\">93.58</span>   <span class=\"mf\">683.1</span>\n<span class=\"n\">CEU5552210034</span>   <span class=\"mf\">100.7</span>   <span class=\"mf\">15.54</span>\n<span class=\"n\">CEU5552210035</span>   <span class=\"mf\">98.84</span>   <span class=\"mf\">567.1</span>\n<span class=\"n\">CEU5552211034</span>   <span class=\"mf\">100.9</span>   <span class=\"mf\">13.73</span>\n<span class=\"n\">CEU5552211035</span>   <span class=\"mf\">99.34</span>   <span class=\"mi\">622</span>\n<span class=\"o\">&lt;</span><span class=\"n\">snip</span><span class=\"o\">&gt;</span>\n</code></pre></div>\n\n<p>I have a mind to expand on this idea for DataFrame objects to get us closer to the full flexibility of SQL with Pythonic syntax. If anyone has ideas or suggestions please let me know.</p>\n<h3>Conclusions</h3>\n<p>GroupBy is certainly not done. If you use these tools and find them useful, please let me know. If you can think of ways to make them better, that would be nice information too. I think it would be great to implement a full SQL engine on top of pandas (similar to the SAS \"proc sql\"), and this new GroupBy functionality gets us closer to that goal.</p>"
}