{
  "title": "3-pointers after offensive rebounds",
  "link": "",
  "published": "2013-12-26T00:00:00-08:00",
  "updated": "2022-11-03T04:16:07-07:00",
  "author": {
    "name": "Greg Reda"
  },
  "id": "tag:www.gregreda.com,2013-12-26:/2013/12/26/three-pointers-after-offensive-rebounds/",
  "summary": "<p>I love college basketball. A lot. My beloved Marquette Golden Eagles are probably the only sports team that can really put me in agony.</p>\n<p>Last season, I was watching a <a href=\"https://www.espn.com/mens-college-basketball/recap?gameId=330730269\">nail-biter against Notre Dame</a>. With 3:36 left, Notre Dame's Jack Cooley grabbed an offensive board and promptly passed out â€¦</p>",
  "content": "<p>I love college basketball. A lot. My beloved Marquette Golden Eagles are probably the only sports team that can really put me in agony.</p>\n<p>Last season, I was watching a <a href=\"https://www.espn.com/mens-college-basketball/recap?gameId=330730269\">nail-biter against Notre Dame</a>. With 3:36 left, Notre Dame's Jack Cooley grabbed an offensive board and promptly passed out to Pat Connaughton for a successful three-pointer. It was a dagger.</p>\n<p>One thing stuck out to me though - after the shot, <a href=\"https://en.wikipedia.org/wiki/Jay_Bilas\">Jay Bilas</a>, who was calling the game with <a href=\"https://en.wikipedia.org/wiki/Bill_Raftery\">Bill Raftery</a> and <a href=\"https://en.wikipedia.org/wiki/Sean_McDonough\">Sean McDonough</a>, stated that the best time to attempt a 3-pointer is after an offensive rebound.</p>\n<p>Intuitively, this statement makes sense - the defensive front line is crashing the boards in hopes of getting a rebound to end the offensive possession, while the defensive backcourt is out on the wings looking for an outlet pass from their teammates, likely leaving their offensive counterparts unguarded.</p>\n<p>I've never seen any data that indicates whether three pointers are more successful after an offensive rebound though, much less whether it's the best time to shoot one. It seemed like something worth investigating.</p>\n<p>In the following analysis, we'll try to determine whether there is a material difference between \"normal\" 3P% (those not shot after an offensive rebound) and 3P% when the shot was preceded by an offensive rebound.</p>\n<p>I'll be going step by step through data collection, munging, and analysis. If you're just interested in the answer, skip to the last section.</p>\n<h3>Getting the data</h3>\n<p>ESPN has <a href=\"https://www.espn.com/mens-college-basketball/playbyplay?gameId=330620221\">play-by-play data</a> for almost every NCAA Division I game. I've written a python script that will collect all of this data for a given date range. You can find the script <a href=\"https://gist.github.com/gjreda/7175267\">here</a>. If you're unfamiliar with web scraping, <a href=\"/2013/03/03/web-scraping-101-with-python/\">check out the tutorial</a> I wrote previously.</p>\n<h3>Analysis</h3>\n<p>Now let's start our analysis using <a href=\"https://pandas.pydata.org/\">pandas</a>.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"nn\">pandas</span> <span class=\"k\">as</span> <span class=\"nn\">pd</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n<span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"nn\">plt</span>\n<span class=\"kn\">import</span> <span class=\"nn\">glob</span>\n<span class=\"kn\">import</span> <span class=\"nn\">re</span>\n\n<span class=\"c1\"># read PSVs into DataFrame</span>\n<span class=\"n\">games</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"n\">files</span> <span class=\"o\">=</span> <span class=\"n\">glob</span><span class=\"o\">.</span><span class=\"n\">glob</span><span class=\"p\">(</span><span class=\"s1\">&#39;*.psv&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">for</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"n\">files</span><span class=\"p\">:</span>\n    <span class=\"n\">df</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">read_csv</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">,</span> <span class=\"n\">sep</span><span class=\"o\">=</span><span class=\"s1\">&#39;|&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;game_id&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">replace</span><span class=\"p\">(</span><span class=\"s1\">&#39;.psv&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">games</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">)</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Read </span><span class=\"si\">{0}</span><span class=\"s1\"> games&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">games</span><span class=\"p\">)))</span>\n</code></pre></div>\n\n<div class=\"highlight\"><pre><span></span><code><span class=\"go\">Read 2931 games</span>\n</code></pre></div>\n\n<p>To start, we need to find all incidents of a three pointer immediately after an offensive rebound.</p>\n<p>This format is kind of crappy though - since events are in separate columns for the home and away teams, we'd have to write logic to check against each column. Let's munge our data into a slightly different format - one column for <code>team</code>, which will indicate home/away, and another for <code>event</code>, which will store the description of what occurred.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">games_df</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">concat</span><span class=\"p\">(</span><span class=\"n\">games</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># add event_id to maintain event order</span>\n<span class=\"c1\"># we can use the index since pandas defaults to the Nth row of the file</span>\n<span class=\"n\">games_df</span><span class=\"p\">[</span><span class=\"s1\">&#39;event_id&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">games_df</span><span class=\"o\">.</span><span class=\"n\">index</span>\n\n<span class=\"c1\"># melt data into one column for home/away and another for event</span>\n<span class=\"c1\"># maintain play order by sorting on event_id</span>\n<span class=\"n\">melted</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">melt</span><span class=\"p\">(</span><span class=\"n\">games_df</span><span class=\"p\">,</span> <span class=\"n\">id_vars</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;event_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;game_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;time&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;score&#39;</span><span class=\"p\">],</span>\n                     <span class=\"n\">var_name</span><span class=\"o\">=</span><span class=\"s1\">&#39;team&#39;</span><span class=\"p\">,</span> <span class=\"n\">value_name</span><span class=\"o\">=</span><span class=\"s1\">&#39;event&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">sort_index</span><span class=\"p\">(</span><span class=\"n\">by</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;game_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;event_id&#39;</span><span class=\"p\">],</span> <span class=\"n\">inplace</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># drop rows with NaN events - an event only belongs to one team</span>\n<span class=\"n\">melted</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">notnull</span><span class=\"p\">()]</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"mi\">10</span><span class=\"p\">:</span><span class=\"mi\">15</span><span class=\"p\">])</span>\n</code></pre></div>\n\n<div class=\"highlight\"><pre><span></span><code><span class=\"go\">        event_id    game_id   time score  team                                  event</span>\n<span class=\"go\">917522        10  330010066  19:11   0-0  home         Melvin Ejim missed Free Throw.</span>\n<span class=\"go\">11            11  330010066  19:11   0-0  away  Jeremiah Kreisberg Defensive Rebound.</span>\n<span class=\"go\">12            12  330010066  18:37   0-0  away            Justin Sears missed Jumper.</span>\n<span class=\"go\">917525        13  330010066  18:37   0-0  home        Percy Gibson Defensive Rebound.</span>\n<span class=\"go\">917526        14  330010066  18:31   0-0  home  Chris Babb missed Three Point Jumper.</span>\n</code></pre></div>\n\n<p>We need to know whether the three pointers were missed or made - let's write a function called <code>get_shot_result</code> to extract the shot result from the <code>event</code> column. We can apply it to every row that contains a three pointer, storing the results in a new column called <code>shot_result</code>.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"c1\"># label whether three pointers were made or missed</span>\n<span class=\"n\">get_shot_result</span> <span class=\"o\">=</span> <span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">re</span><span class=\"o\">.</span><span class=\"n\">findall</span><span class=\"p\">(</span><span class=\"s1\">&#39;(made|missed)&#39;</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"n\">shot3</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">str</span><span class=\"o\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span><span class=\"s1\">&#39;Three Point&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"s1\">&#39;shot_result&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"n\">shot3</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">apply</span><span class=\"p\">(</span><span class=\"n\">get_shot_result</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>Now let's write a function to label the events that meet our criteria - a three point attempt that was preceded by an offensive rebound. We can use shift(1) to reference the event on the previous row.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"k\">def</span> <span class=\"nf\">criteria</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Labels if the three pointer was preceded by an offensive rebound.&quot;&quot;&quot;</span>\n    <span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;after_oreb&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">((</span><span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">str</span><span class=\"o\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span><span class=\"s1\">&#39;Three Point&#39;</span><span class=\"p\">))</span> <span class=\"o\">&amp;</span> \\\n                        <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">shift</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">str</span><span class=\"o\">.</span><span class=\"n\">contains</span><span class=\"p\">(</span><span class=\"s1\">&#39;Offensive Rebound&#39;</span><span class=\"p\">))</span>\n    <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">after_oreb</span><span class=\"o\">.</span><span class=\"n\">fillna</span><span class=\"p\">(</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">inplace</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">df</span>\n\n<span class=\"n\">melted</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;game_id&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">apply</span><span class=\"p\">(</span><span class=\"n\">criteria</span><span class=\"p\">)</span>\n<span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">shot_result</span><span class=\"o\">.</span><span class=\"n\">notnull</span><span class=\"p\">()]</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>event_id</th>\n      <th>game_id</th>\n      <th>time</th>\n      <th>score</th>\n      <th>team</th>\n      <th>event</th>\n      <th>shot_result</th>\n      <th>after_oreb</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2     </th>\n      <td>  2</td>\n      <td> 330010066</td>\n      <td> 19:31</td>\n      <td> 0-0</td>\n      <td> away</td>\n      <td> Austin Morgan missed Three Point Jumper.</td>\n      <td> missed</td>\n      <td> False</td>\n    </tr>\n    <tr>\n      <th>917518</th>\n      <td>  6</td>\n      <td> 330010066</td>\n      <td> 19:14</td>\n      <td> 0-0</td>\n      <td> home</td>\n      <td>  Will Clyburn missed Three Point Jumper.</td>\n      <td> missed</td>\n      <td>  True</td>\n    </tr>\n    <tr>\n      <th>917526</th>\n      <td> 14</td>\n      <td> 330010066</td>\n      <td> 18:31</td>\n      <td> 0-0</td>\n      <td> home</td>\n      <td> Chris Babb missed Three Point Jumper.</td>\n      <td> missed</td>\n      <td> False</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>Finally, we can calculate the 3P% for our groups and plot the results.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">threes</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">shot_result</span><span class=\"o\">.</span><span class=\"n\">notnull</span><span class=\"p\">()]</span>\n<span class=\"n\">attempts</span> <span class=\"o\">=</span> <span class=\"n\">threes</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">([</span><span class=\"s1\">&#39;shot_result&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;after_oreb&#39;</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">size</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">unstack</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">attempts</span><span class=\"p\">[</span><span class=\"s1\">&#39;perc&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">attempts</span><span class=\"o\">.</span><span class=\"n\">made</span><span class=\"o\">.</span><span class=\"n\">astype</span><span class=\"p\">(</span><span class=\"nb\">float</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"n\">attempts</span><span class=\"o\">.</span><span class=\"n\">made</span> <span class=\"o\">+</span> <span class=\"n\">attempts</span><span class=\"o\">.</span><span class=\"n\">missed</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">attempts</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<div class=\"highlight\"><pre><span></span><code><span class=\"go\">shot_result   made  missed      perc</span>\n<span class=\"go\">after_oreb                          </span>\n<span class=\"go\">False        33244   63608  0.343245</span>\n<span class=\"go\">True          2861    5341  0.348817</span>\n</code></pre></div>\n\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">attempts</span><span class=\"o\">.</span><span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;No&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;Yes&#39;</span><span class=\"p\">]</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">figure</span><span class=\"p\">(</span><span class=\"n\">figsize</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">])</span>\n<span class=\"n\">attempts</span><span class=\"o\">.</span><span class=\"n\">perc</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"s1\">&#39;bar&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">ylabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;3P%&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;After Offensive Rebound?&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">grid</span><span class=\"p\">(</span><span class=\"kc\">False</span><span class=\"p\">);</span>\n</code></pre></div>\n\n<p><img alt=\"3P% after offensive rebound vs not\" src=\"/images/three-point-percent-after-oreb.png\"></p>\n<h3>Digging deeper</h3>\n<p>At the most basic level, the difference is negligible. Not all post-offensive rebound three pointers are created equally though. Let's investigate further to see whether three pointers shot shortly after the rebound are more successful. Let's look at only three pointers that were shot within seven seconds of the offensive rebound.</p>\n<p>To do so, we'll need to munge our data a bit more in order to calculate the seconds elapsed between rebound and shot attempt.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"s1\">&#39;minutes&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">apply</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]))</span>\n<span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"s1\">&#39;seconds&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">apply</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]))</span>\n</code></pre></div>\n\n<p>Notice below that time-outs and end of periods are duplicated within the data (this is because they originally appeared as both a home and away event).</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">duped_cols</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;game_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;event_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;time&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;event&#39;</span><span class=\"p\">]</span>\n<span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">duplicated</span><span class=\"p\">(</span><span class=\"n\">cols</span><span class=\"o\">=</span><span class=\"n\">duped_cols</span><span class=\"p\">)][:</span><span class=\"mi\">3</span><span class=\"p\">]</span>\n</code></pre></div>\n\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>event_id</th>\n      <th>game_id</th>\n      <th>time</th>\n      <th>score</th>\n      <th>team</th>\n      <th>event</th>\n      <th>shot_result</th>\n      <th>after_oreb</th>\n      <th>minutes</th>\n      <th>seconds</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>917546</th>\n      <td> 34</td>\n      <td> 330010066</td>\n      <td> 15:22</td>\n      <td> Official TV Timeout.</td>\n      <td> home</td>\n      <td> Official TV Timeout.</td>\n      <td> NaN</td>\n      <td> False</td>\n      <td> 15</td>\n      <td> 22</td>\n    </tr>\n    <tr>\n      <th>917559</th>\n      <td> 47</td>\n      <td> 330010066</td>\n      <td> 13:40</td>\n      <td>   Yale Full Timeout.</td>\n      <td> home</td>\n      <td>   Yale Full Timeout.</td>\n      <td> NaN</td>\n      <td> False</td>\n      <td> 13</td>\n      <td> 40</td>\n    </tr>\n    <tr>\n      <th>917575</th>\n      <td> 63</td>\n      <td> 330010066</td>\n      <td> 11:53</td>\n      <td> Official TV Timeout.</td>\n      <td> home</td>\n      <td> Official TV Timeout.</td>\n      <td> NaN</td>\n      <td> False</td>\n      <td> 11</td>\n      <td> 53</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>Let's get rid of them so we can easily label events within each period (keeping them in will throw our function off a bit).</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">drop_duplicates</span><span class=\"p\">(</span><span class=\"n\">cols</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;game_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;event_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;event&#39;</span><span class=\"p\">],</span> <span class=\"n\">inplace</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>Now we can label each period based on when the <code>End of ...</code> event appears - events before it are the first half; events after, the second half. To do so, we can use <code>cumsum</code>, which will treat <code>True</code> values as 1. This means we can just shift our results down a row and take the running total.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"s1\">&#39;period_end&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">apply</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"s1\">&#39;End of&#39;</span><span class=\"p\">))</span>\n<span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">period_end</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>event_id</th>\n      <th>game_id</th>\n      <th>time</th>\n      <th>score</th>\n      <th>team</th>\n      <th>event</th>\n      <th>shot_result</th>\n      <th>after_oreb</th>\n      <th>minutes</th>\n      <th>seconds</th>\n      <th>period_end</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>171</th>\n      <td> 171</td>\n      <td> 330010066</td>\n      <td> 0:00</td>\n      <td> End of the 1st Half.</td>\n      <td> away</td>\n      <td> End of the 1st Half.</td>\n      <td> NaN</td>\n      <td> False</td>\n      <td> 0</td>\n      <td> 0</td>\n      <td> True</td>\n    </tr>\n    <tr>\n      <th>480</th>\n      <td> 123</td>\n      <td> 330010120</td>\n      <td> 0:00</td>\n      <td> End of the 1st Half.</td>\n      <td> away</td>\n      <td> End of the 1st Half.</td>\n      <td> NaN</td>\n      <td> False</td>\n      <td> 0</td>\n      <td> 0</td>\n      <td> True</td>\n    </tr>\n    <tr>\n      <th>770</th>\n      <td> 142</td>\n      <td> 330010228</td>\n      <td> 0:00</td>\n      <td> End of the 1st Half.</td>\n      <td> away</td>\n      <td> End of the 1st Half.</td>\n      <td> NaN</td>\n      <td> False</td>\n      <td> 0</td>\n      <td> 0</td>\n      <td> True</td>\n    </tr>\n  </tbody>\n</table>\n\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">calculate_period</span> <span class=\"o\">=</span> <span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">shift</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">cumsum</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">fillna</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span>\n<span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"s1\">&#39;period&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;game_id&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">period_end</span><span class=\"o\">.</span><span class=\"n\">apply</span><span class=\"p\">(</span><span class=\"n\">calculate_period</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>Now we can use the period to calculate the total time left in the game.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">set_index</span><span class=\"p\">(</span><span class=\"s1\">&#39;game_id&#39;</span><span class=\"p\">,</span> <span class=\"n\">inplace</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># 40min regulation game + (# periods - 2 halves) * 5min OTs</span>\n<span class=\"n\">gametime</span> <span class=\"o\">=</span> <span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"mi\">40</span> <span class=\"o\">+</span> <span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"o\">-</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"o\">*</span> <span class=\"mi\">5</span>\n<span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"s1\">&#39;gametime&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"n\">level</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">period</span><span class=\"o\">.</span><span class=\"n\">max</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">apply</span><span class=\"p\">(</span><span class=\"n\">gametime</span><span class=\"p\">)</span>\n<span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">reset_index</span><span class=\"p\">(</span><span class=\"s1\">&#39;game_id&#39;</span><span class=\"p\">,</span> <span class=\"n\">inplace</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>Setting the game_id as the index was necessary for this function since pandas naturally tries to match on indexes.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">(</span><span class=\"s1\">&#39;gametime&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">game_id</span><span class=\"o\">.</span><span class=\"n\">nunique</span><span class=\"p\">()</span>\n</code></pre></div>\n\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">gametime</span>\n<span class=\"mi\">35</span>            <span class=\"mi\">54</span>\n<span class=\"mi\">40</span>          <span class=\"mi\">2365</span>\n<span class=\"mi\">45</span>           <span class=\"mi\">442</span>\n<span class=\"mi\">50</span>            <span class=\"mi\">61</span>\n<span class=\"mi\">55</span>             <span class=\"mi\">7</span>\n<span class=\"mi\">60</span>             <span class=\"mi\">1</span>\n<span class=\"mi\">65</span>             <span class=\"mi\">1</span>\n<span class=\"n\">dtype</span><span class=\"p\">:</span> <span class=\"n\">int64</span>\n</code></pre></div>\n\n<p>Notice above that some games have a total gametime of 35 minutes. All college basketball games are at least 40 minutes, so something is off.</p>\n<p>It turns out there are some inconsistencies in ESPN's play-by-play data - a couple games do not have the \"End of the 1st Half.\" event. This throws off our <code>period</code> and <code>gametime</code> calculations. Such is life when dealing with scraped data though.</p>\n<p>Let's keep things simple and just assume they were normal, non-OT games.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">loc</span><span class=\"p\">[</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">gametime</span> <span class=\"o\">==</span> <span class=\"mi\">35</span><span class=\"p\">,</span> <span class=\"s1\">&#39;gametime&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">40</span>\n</code></pre></div>\n\n<p>Now let's normalize the event times to seconds left in the game. This will allow us to see how much time elapsed between the offensive rebound and three point attempt.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"k\">def</span> <span class=\"nf\">clock_to_secs_left</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Calculates the total seconds left in the game.&quot;&quot;&quot;</span>\n    <span class=\"n\">df</span><span class=\"p\">[</span><span class=\"s1\">&#39;secs_left&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">nan</span>\n    <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">loc</span><span class=\"p\">[</span><span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">period</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"s1\">&#39;secs_left&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">minutes</span> <span class=\"o\">*</span> <span class=\"mi\">60</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1200</span> <span class=\"o\">+</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">seconds</span>\n    <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">loc</span><span class=\"p\">[</span><span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">period</span> <span class=\"o\">&gt;</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"s1\">&#39;secs_left&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">minutes</span> <span class=\"o\">*</span> <span class=\"mi\">60</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"n\">df</span><span class=\"o\">.</span><span class=\"n\">seconds</span>\n    <span class=\"k\">return</span> <span class=\"n\">df</span>\n\n<span class=\"n\">clock_to_secs_left</span><span class=\"p\">(</span><span class=\"n\">melted</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">melted</span><span class=\"p\">[[</span><span class=\"s1\">&#39;game_id&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;time&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;event&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;period&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;secs_left&#39;</span><span class=\"p\">]][:</span><span class=\"mi\">5</span><span class=\"p\">])</span>\n</code></pre></div>\n\n<div class=\"highlight\"><pre><span></span><code><span class=\"go\">     game_id   time                                     event period  secs_left</span>\n<span class=\"go\">0  330010066  19:47                      Chris Babb Turnover.      1       2387</span>\n<span class=\"go\">1  330010066  19:45                      Austin Morgan Steal.      1       2385</span>\n<span class=\"go\">2  330010066  19:31  Austin Morgan missed Three Point Jumper.      1       2371</span>\n<span class=\"go\">3  330010066  19:31          Korie Lucious Defensive Rebound.      1       2371</span>\n<span class=\"go\">4  330010066  19:21              Korie Lucious missed Jumper.      1       2361</span>\n</code></pre></div>\n\n<p>We can finally see how much time elapsed between offensive rebound and three point attempt.</p>\n<p>We'll create a new field which will store the seconds elapsed since the previous event. Then we'll create a new DataFrame called <code>threes_after_orebs</code> which will hold three point attempts that were shot within seven seconds of an offensive rebound.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"s1\">&#39;secs_elapsed&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">secs_left</span><span class=\"o\">.</span><span class=\"n\">shift</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">secs_left</span>\n\n<span class=\"n\">mask</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">secs_elapsed</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"o\">&amp;</span> <span class=\"p\">(</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">secs_elapsed</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">7</span><span class=\"p\">)</span>\n<span class=\"n\">threes_after_orebs</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">after_oreb</span> <span class=\"o\">&amp;</span> <span class=\"n\">mask</span><span class=\"p\">]</span>\n</code></pre></div>\n\n<p>Finally, let's group our data by the seconds elapsed and shot result to get the three point percentage for each bucket, which we can plot.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">grouped</span> <span class=\"o\">=</span> <span class=\"n\">threes_after_orebs</span><span class=\"o\">.</span><span class=\"n\">groupby</span><span class=\"p\">([</span><span class=\"s1\">&#39;shot_result&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;secs_elapsed&#39;</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">size</span><span class=\"p\">()</span>\n<span class=\"n\">grouped</span> <span class=\"o\">=</span> <span class=\"n\">grouped</span><span class=\"o\">.</span><span class=\"n\">unstack</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">fillna</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n\n<span class=\"n\">grouped</span><span class=\"p\">[</span><span class=\"s1\">&#39;attempts&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">grouped</span><span class=\"o\">.</span><span class=\"n\">made</span> <span class=\"o\">+</span> <span class=\"n\">grouped</span><span class=\"o\">.</span><span class=\"n\">missed</span>\n<span class=\"n\">grouped</span><span class=\"p\">[</span><span class=\"s1\">&#39;percentage&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">grouped</span><span class=\"o\">.</span><span class=\"n\">made</span> <span class=\"o\">/</span> <span class=\"n\">grouped</span><span class=\"o\">.</span><span class=\"n\">attempts</span><span class=\"o\">.</span><span class=\"n\">astype</span><span class=\"p\">(</span><span class=\"nb\">float</span><span class=\"p\">)</span>\n\n<span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">threes</span><span class=\"o\">.</span><span class=\"n\">shot_result</span><span class=\"o\">.</span><span class=\"n\">value_counts</span><span class=\"p\">()</span>\n<span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"n\">t</span><span class=\"p\">[</span><span class=\"s1\">&#39;made&#39;</span><span class=\"p\">])</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"n\">t</span><span class=\"p\">[</span><span class=\"s1\">&#39;made&#39;</span><span class=\"p\">]</span> <span class=\"o\">+</span> <span class=\"n\">t</span><span class=\"p\">[</span><span class=\"s1\">&#39;missed&#39;</span><span class=\"p\">])</span>\n\n<span class=\"n\">figsize</span><span class=\"p\">(</span><span class=\"mf\">12.5</span><span class=\"p\">,</span> <span class=\"mi\">7</span><span class=\"p\">)</span>\n\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">grouped</span><span class=\"o\">.</span><span class=\"n\">percentage</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;O-Reb 3P%&#39;</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#377EB8&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">hlines</span><span class=\"p\">(</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">7</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;&quot;Normal&quot; 3P%&#39;</span><span class=\"p\">,</span> <span class=\"n\">linestyles</span><span class=\"o\">=</span><span class=\"s1\">&#39;--&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xlabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;Seconds Since Offensive Rebound&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xticks</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">arange</span><span class=\"p\">(</span><span class=\"mi\">8</span><span class=\"p\">))</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">ylabel</span><span class=\"p\">(</span><span class=\"s1\">&#39;3-Point Percentage&#39;</span><span class=\"p\">,</span> <span class=\"n\">labelpad</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">grid</span><span class=\"p\">(</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">(</span><span class=\"n\">loc</span><span class=\"o\">=</span><span class=\"s1\">&#39;lower right&#39;</span><span class=\"p\">);</span>\n</code></pre></div>\n\n<p><img alt=\"3P% vs seconds since offensive rebound\" src=\"/images/three-pointers-secs-since-oreb.png\"></p>\n<p>It looks like there might be some truth to Jay Bilas' statement that the best time to shoot a three pointer is after an offensive rebound. However, we can go one step further and simulate our way to a numeric value of how correct he was.</p>\n<h3>Simulations</h3>\n<p>To start, we'll create two Series based on the <code>melted</code> DataFrame that we have been using throughout the analysis. One Series, which we'll call <code>normal</code>, will hold the results of three pointers that were normally attempted - that is, they were not shot immediately after an offensive rebound. The other Series, <code>after</code>, will contain the results of those shot after an offensive rebound. <code>True</code> will be used to indicate a made basket.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">convert</span> <span class=\"o\">=</span> <span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"kc\">True</span> <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;made&#39;</span> <span class=\"k\">else</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">normal_criteria</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">after_oreb</span> <span class=\"o\">==</span> <span class=\"kc\">False</span><span class=\"p\">)</span> <span class=\"o\">&amp;</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">shot_result</span><span class=\"o\">.</span><span class=\"n\">notnull</span><span class=\"p\">()</span>\n<span class=\"n\">normal</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"n\">normal_criteria</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">shot_result</span><span class=\"o\">.</span><span class=\"n\">apply</span><span class=\"p\">(</span><span class=\"n\">convert</span><span class=\"p\">)</span>\n\n<span class=\"n\">after_criteria</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">after_oreb</span><span class=\"p\">)</span> <span class=\"o\">&amp;</span> <span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">shot_result</span><span class=\"o\">.</span><span class=\"n\">notnull</span><span class=\"p\">()</span> <span class=\"o\">&amp;</span> \\\n                    <span class=\"p\">(</span><span class=\"n\">melted</span><span class=\"o\">.</span><span class=\"n\">secs_elapsed</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">7</span><span class=\"p\">)</span>\n<span class=\"n\">after</span> <span class=\"o\">=</span> <span class=\"n\">melted</span><span class=\"p\">[</span><span class=\"n\">after_criteria</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">shot_result</span><span class=\"o\">.</span><span class=\"n\">apply</span><span class=\"p\">(</span><span class=\"n\">convert</span><span class=\"p\">)</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;After O-Reb 3P%:&quot;</span><span class=\"p\">,</span> <span class=\"n\">after</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">())</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Sample Size:&quot;</span><span class=\"p\">,</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">after</span><span class=\"p\">))</span>\n<span class=\"nb\">print</span><span class=\"p\">()</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;All other 3P%:&quot;</span><span class=\"p\">,</span> <span class=\"n\">normal</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">())</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Sample Size:&quot;</span><span class=\"p\">,</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">normal</span><span class=\"p\">))</span>\n<span class=\"nb\">print</span><span class=\"p\">()</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Absolute difference: </span><span class=\"si\">%.4f</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">after</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"n\">normal</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()))</span>\n</code></pre></div>\n\n<div class=\"highlight\"><pre><span></span><code><span class=\"go\">After O-Reb 3P%: 0.350169109357</span>\n<span class=\"go\">Sample Size: 4435</span>\n\n<span class=\"go\">All other 3P%: 0.343264007931</span>\n<span class=\"go\">Sample Size: 96838</span>\n\n<span class=\"go\">Absolute difference: 0.0069</span>\n</code></pre></div>\n\n<p>While we have data for 2,932 games, it turns out that three pointers shot within seven seconds of an offensive rebound aren't very common - it only occurred 4,435 times, while \"normal\" three pointers were shot 96,838 times.</p>\n<p>The much smaller population means that we're more uncertain about the \"true\" success rate of those after offensive rebounds.</p>\n<p>Using <a href=\"http://pymc-devs.github.io/pymc/\">pymc</a>, we can run a simulations to determine how likely it is that three pointers after offensive rebounds really are easier, while taking into account this uncertainty.</p>\n<p>We'll first assume a uniform distribution between 30% and 40% for both \"normal\" three pointers and those after offensive rebounds. This means that we believe the \"true\" success rate of each to be somewhere between 30-40%. This seems reasonable given that the 3P% for all of NCAA Division I basketball during the 2012-2013 season was 33.89% [source].</p>\n<p>We then generate observations using our <code>normal</code> and <code>after</code> Series. Our observations are an example of a Bernoulli distribution, meaning that the outcome is binary - the three pointer was either made (True) or missed (False).</p>\n<p>We'll then run 20,000 simulations using our existing data and assumptions.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"nn\">pymc</span> <span class=\"k\">as</span> <span class=\"nn\">pm</span>\n\n<span class=\"c1\"># no chance 3P% is out of this range</span>\n<span class=\"n\">p_normal</span> <span class=\"o\">=</span> <span class=\"n\">pm</span><span class=\"o\">.</span><span class=\"n\">Uniform</span><span class=\"p\">(</span><span class=\"s2\">&quot;p_normal&quot;</span><span class=\"p\">,</span> <span class=\"mf\">0.3</span><span class=\"p\">,</span> <span class=\"mf\">0.4</span><span class=\"p\">)</span>\n<span class=\"n\">p_after</span> <span class=\"o\">=</span> <span class=\"n\">pm</span><span class=\"o\">.</span><span class=\"n\">Uniform</span><span class=\"p\">(</span><span class=\"s2\">&quot;p_after&quot;</span><span class=\"p\">,</span> <span class=\"mf\">0.3</span><span class=\"p\">,</span> <span class=\"mf\">0.4</span><span class=\"p\">)</span>\n\n<span class=\"nd\">@pm</span><span class=\"o\">.</span><span class=\"n\">deterministic</span>\n<span class=\"k\">def</span> <span class=\"nf\">delta</span><span class=\"p\">(</span><span class=\"n\">p_normal</span><span class=\"o\">=</span><span class=\"n\">p_normal</span><span class=\"p\">,</span> <span class=\"n\">p_after</span><span class=\"o\">=</span><span class=\"n\">p_after</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">p_after</span> <span class=\"o\">-</span> <span class=\"n\">p_normal</span>\n\n<span class=\"c1\"># scraped observations</span>\n<span class=\"n\">obs_normal</span> <span class=\"o\">=</span> <span class=\"n\">pm</span><span class=\"o\">.</span><span class=\"n\">Bernoulli</span><span class=\"p\">(</span><span class=\"s2\">&quot;obs_normal&quot;</span><span class=\"p\">,</span> <span class=\"n\">p_normal</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">normal</span><span class=\"p\">,</span> <span class=\"n\">observed</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"n\">obs_after</span> <span class=\"o\">=</span> <span class=\"n\">pm</span><span class=\"o\">.</span><span class=\"n\">Bernoulli</span><span class=\"p\">(</span><span class=\"s2\">&quot;obs_after&quot;</span><span class=\"p\">,</span> <span class=\"n\">p_after</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">after</span><span class=\"p\">,</span> <span class=\"n\">observed</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n\n<span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">pm</span><span class=\"o\">.</span><span class=\"n\">MCMC</span><span class=\"p\">([</span><span class=\"n\">p_normal</span><span class=\"p\">,</span> <span class=\"n\">p_after</span><span class=\"p\">,</span> <span class=\"n\">delta</span><span class=\"p\">,</span> <span class=\"n\">obs_normal</span><span class=\"p\">,</span> <span class=\"n\">obs_after</span><span class=\"p\">])</span>\n<span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">sample</span><span class=\"p\">(</span><span class=\"mi\">20000</span><span class=\"p\">)</span>\n\n<span class=\"n\">p_normal_samples</span> <span class=\"o\">=</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">trace</span><span class=\"p\">(</span><span class=\"s2\">&quot;p_normal&quot;</span><span class=\"p\">)[:]</span>\n<span class=\"n\">p_after_samples</span> <span class=\"o\">=</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">trace</span><span class=\"p\">(</span><span class=\"s2\">&quot;p_after&quot;</span><span class=\"p\">)[:]</span>\n<span class=\"n\">delta_samples</span> <span class=\"o\">=</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">trace</span><span class=\"p\">(</span><span class=\"s2\">&quot;delta&quot;</span><span class=\"p\">)[:]</span>\n</code></pre></div>\n\n<p>Finally, we can plot the results of our simulations.</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"n\">figsize</span><span class=\"p\">(</span><span class=\"mf\">12.5</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">)</span>\n\n<span class=\"n\">ax</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">subplot</span><span class=\"p\">(</span><span class=\"mi\">311</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xlim</span><span class=\"p\">(</span><span class=\"mf\">0.3</span><span class=\"p\">,</span> <span class=\"mf\">0.4</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xticks</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">arange</span><span class=\"p\">(</span><span class=\"mf\">0.3</span><span class=\"p\">,</span> <span class=\"mf\">0.401</span><span class=\"p\">,</span> <span class=\"mf\">0.01</span><span class=\"p\">))</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">ylim</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">hist</span><span class=\"p\">(</span><span class=\"n\">p_normal_samples</span><span class=\"p\">,</span> <span class=\"n\">histtype</span><span class=\"o\">=</span><span class=\"s1\">&#39;stepfilled&#39;</span><span class=\"p\">,</span> <span class=\"n\">bins</span><span class=\"o\">=</span><span class=\"mi\">50</span><span class=\"p\">,</span> <span class=\"n\">normed</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> \n         <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#E41A1C&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;3P% &quot;Normal&quot;&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">vlines</span><span class=\"p\">(</span><span class=\"n\">normal</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">(),</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">,</span> <span class=\"n\">linestyles</span><span class=\"o\">=</span><span class=\"s1\">&#39;--&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;True &quot;Normal&quot; 3P%&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">()</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">grid</span><span class=\"p\">(</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n\n<span class=\"n\">ax</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">subplot</span><span class=\"p\">(</span><span class=\"mi\">312</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xlim</span><span class=\"p\">(</span><span class=\"mf\">0.3</span><span class=\"p\">,</span> <span class=\"mf\">0.4</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xticks</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">arange</span><span class=\"p\">(</span><span class=\"mf\">0.3</span><span class=\"p\">,</span> <span class=\"mf\">0.401</span><span class=\"p\">,</span> <span class=\"mf\">0.01</span><span class=\"p\">))</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">ylim</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">hist</span><span class=\"p\">(</span><span class=\"n\">p_after_samples</span><span class=\"p\">,</span> <span class=\"n\">histtype</span><span class=\"o\">=</span><span class=\"s1\">&#39;stepfilled&#39;</span><span class=\"p\">,</span> <span class=\"n\">bins</span><span class=\"o\">=</span><span class=\"mi\">50</span><span class=\"p\">,</span> <span class=\"n\">normed</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n         <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#4DAF4A&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;3P% After Off. Reb.&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">vlines</span><span class=\"p\">(</span><span class=\"n\">after</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">(),</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">,</span> <span class=\"n\">linestyles</span><span class=\"o\">=</span><span class=\"s1\">&#39;--&#39;</span><span class=\"p\">,</span>\n           <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;True 3P% After Off. Reb.&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">()</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">grid</span><span class=\"p\">(</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n\n<span class=\"n\">ax</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">subplot</span><span class=\"p\">(</span><span class=\"mi\">313</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xlim</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.05</span><span class=\"p\">,</span> <span class=\"mf\">0.05</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xticks</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">arange</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.05</span><span class=\"p\">,</span> <span class=\"mf\">0.051</span><span class=\"p\">,</span> <span class=\"mf\">0.01</span><span class=\"p\">))</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">ylim</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">hist</span><span class=\"p\">(</span><span class=\"n\">delta_samples</span><span class=\"p\">,</span> <span class=\"n\">histtype</span><span class=\"o\">=</span><span class=\"s1\">&#39;stepfilled&#39;</span><span class=\"p\">,</span> <span class=\"n\">bins</span><span class=\"o\">=</span><span class=\"mi\">50</span><span class=\"p\">,</span> <span class=\"n\">normed</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n         <span class=\"n\">color</span><span class=\"o\">=</span><span class=\"s1\">&#39;#377EB8&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;Delta&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">vlines</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">300</span><span class=\"p\">,</span> <span class=\"n\">linestyles</span><span class=\"o\">=</span><span class=\"s1\">&#39;--&#39;</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"s1\">&#39;$H_0$ (No difference)&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">legend</span><span class=\"p\">()</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">grid</span><span class=\"p\">(</span><span class=\"kc\">False</span><span class=\"p\">);</span>\n</code></pre></div>\n\n<p><img alt=\"3P% simulations\" src=\"/images/three-pointer-simulations.png\"></p>\n<p>Notice the much narrower distribution at the top? This is because we had so many observations for \"normal\" three pointers. There wasn't much uncertainty! It's quite different than the second distribution, where the wider width of the distribution indicates are greater level of uncertainty on those attempted after offensive rebounds. This is due to the much smaller sample size.</p>\n<p>The final distribution shows the difference between \"normal\" and \"after\" three pointers in our simulations. Much more often than not, \"after\" three pointers had a higher 3P% in the simulations.</p>\n<p>In what percentage of simulations was \"after\" better than \"normal\" though?</p>\n<div class=\"highlight\"><pre><span></span><code><span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;3P</span><span class=\"si\">% a</span><span class=\"s2\">fter offensive rebounds was more successful &quot;</span>\n      <span class=\"s2\">&quot;in </span><span class=\"si\">{0:.1f}% o</span><span class=\"s2\">f simulations&quot;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">((</span><span class=\"n\">delta_samples</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">mean</span><span class=\"p\">()</span> <span class=\"o\">*</span> <span class=\"mi\">100</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<div class=\"highlight\"><pre><span></span><code><span class=\"go\">3P% after offensive rebounds was more successful in 83.1% of simulations</span>\n</code></pre></div>\n\n<p>Looks like Jay Bilas is pretty right about this one. While the absolute difference in 3P% is small, those after an offensive rebound were more successful in about 83% of our simulations.</p>\n<p>Was there something I missed or got wrong? I'd love to hear from you.</p>",
  "category": [
    "",
    "",
    "",
    "",
    "",
    "",
    ""
  ]
}