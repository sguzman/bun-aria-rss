{
  "title": "The Softmax Function Derivative (Part 1)",
  "link": "https://aimatters.wordpress.com/2019/06/17/the-softmax-function-derivative/",
  "comments": "https://aimatters.wordpress.com/2019/06/17/the-softmax-function-derivative/#comments",
  "dc:creator": "Stephen Oman",
  "pubDate": "Mon, 17 Jun 2019 18:41:00 +0000",
  "category": [
    "Artificial Intelligence",
    "Examples",
    "Machine Learning"
  ],
  "guid": "http://aimatters.wordpress.com/?p=1200",
  "description": "Introduction This post demonstrates the calculations behind the evaluation of the Softmax Derivative using Python. It is based on the excellent article by Eli Bendersky which can be found here. The Softmax Function The softmax function simply takes a vector of N dimensions and returns a probability distribution also of N dimensions. Each element of [&#8230;]",
  "content:encoded": "<h3>Introduction</h3>\n<p>This post demonstrates the calculations behind the evaluation of the Softmax Derivative using Python. It is based on the excellent article by Eli Bendersky which can be found <a href=\"https://eli.thegreenplace.net/2016/the-softmax-function-and-its-derivative/\" target=\"_blank\" rel=\"noopener\">here</a>.</p>\n<h3 id=\"The-Softmax-Function\">The Softmax Function</h3>\n<p>The softmax function simply takes a vector of N dimensions and returns a probability distribution also of N dimensions. Each element of the output is in the range (0,1) and the sum of the elements of N is 1.0.</p>\n<p>Each element of the output is given by the formula:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Csigma%28z_%7Bi%7D%29%3D%5Cfrac%7Be%5E%7Bz_%7Bi%7D%7D%7D+%7B%5Csum_%7Bj%3D1%7D%5EK+e%5E%7Bz_%7Bj%7D%7D%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Csigma%28z_%7Bi%7D%29%3D%5Cfrac%7Be%5E%7Bz_%7Bi%7D%7D%7D+%7B%5Csum_%7Bj%3D1%7D%5EK+e%5E%7Bz_%7Bj%7D%7D%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Csigma%28z_%7Bi%7D%29%3D%5Cfrac%7Be%5E%7Bz_%7Bi%7D%7D%7D+%7B%5Csum_%7Bj%3D1%7D%5EK+e%5E%7Bz_%7Bj%7D%7D%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;sigma(z_{i})=&#92;frac{e^{z_{i}}} {&#92;sum_{j=1}^K e^{z_{j}}}\" class=\"latex\" /></p>\n<p>See <a href=\"https://en.wikipedia.org/wiki/Softmax_function\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/Softmax_function</a> for more details.</p>\n<pre>import numpy as np\nx = np.random.random([5])\n\ndef softmax_basic(z):\n&nbsp; &nbsp; exps = np.exp(z)\n&nbsp; &nbsp; sums = np.sum(exps)\n&nbsp; &nbsp; return np.divide(exps, sums)\n\nsoftmax_basic(x)</pre>\n<p>This should generate an output that looks something like this:</p>\n<pre>array([0.97337094, 0.85251098, 0.62495691, 0.63957056, 0.6969253 ])</pre>\n<p>We expect that the sum of those will be (close to) 1.0:</p>\n<pre>np.sum(softmax_basic(x))</pre>\n<p>And so it is:</p>\n<pre>1.0</pre>\n<h3>Calculating the derivative</h3>\n<p>We need to calculate the partial derivative of the probability outputs <img src=\"https://s0.wp.com/latex.php?latex=S_%7Bi%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=S_%7Bi%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=S_%7Bi%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"S_{i}\" class=\"latex\" /> with respect to each of the inputs <img src=\"https://s0.wp.com/latex.php?latex=x_%7Bj%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=x_%7Bj%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=x_%7Bj%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"x_{j}\" class=\"latex\" />. For example:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;frac{&#92;delta{S_{i}}}{&#92;delta{x_{j}}}=&#92;frac{&#92;delta{&#92;frac{e^{x_{i}}} {&#92;sum_{k=1}^N e^{x_{k}}}}}{&#92;delta{x_{j}}}\" class=\"latex\" /></p>\n<p>Following Bendersky&#8217;s derivation, we need to use the quotient rule for derivatives:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Ctext%7BIf+%7Df%28x%29%3D%5Cfrac%7Bg%28x%29%7D%7Bh%28x%29%7D+%5Ctext%7B+then%3A%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Ctext%7BIf+%7Df%28x%29%3D%5Cfrac%7Bg%28x%29%7D%7Bh%28x%29%7D+%5Ctext%7B+then%3A%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Ctext%7BIf+%7Df%28x%29%3D%5Cfrac%7Bg%28x%29%7D%7Bh%28x%29%7D+%5Ctext%7B+then%3A%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;text{If }f(x)=&#92;frac{g(x)}{h(x)} &#92;text{ then:} \" class=\"latex\" /></p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=f%27%28x%29%3D%5Cfrac%7Bg%27%28x%29h%28x%29-h%27%28x%29g%28x%29%7D%7B%5Bh%28x%29%5D%5E%7B2%7D%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=f%27%28x%29%3D%5Cfrac%7Bg%27%28x%29h%28x%29-h%27%28x%29g%28x%29%7D%7B%5Bh%28x%29%5D%5E%7B2%7D%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=f%27%28x%29%3D%5Cfrac%7Bg%27%28x%29h%28x%29-h%27%28x%29g%28x%29%7D%7B%5Bh%28x%29%5D%5E%7B2%7D%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"f&#039;(x)=&#92;frac{g&#039;(x)h(x)-h&#039;(x)g(x)}{[h(x)]^{2}}\" class=\"latex\" /></p>\n<p>From the Softmax function:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cbegin%7Barray%7D%7Brcl%7D+g_%7Bi%7D+%26+%3D+%26+e%5E%7Bx_%7Bi%7D%7D%5C%5C+h_%7Bi%7D+%26+%3D+%26+%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D+%5Cend%7Barray%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cbegin%7Barray%7D%7Brcl%7D+g_%7Bi%7D+%26+%3D+%26+e%5E%7Bx_%7Bi%7D%7D%5C%5C+h_%7Bi%7D+%26+%3D+%26+%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D+%5Cend%7Barray%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cbegin%7Barray%7D%7Brcl%7D+g_%7Bi%7D+%26+%3D+%26+e%5E%7Bx_%7Bi%7D%7D%5C%5C+h_%7Bi%7D+%26+%3D+%26+%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D+%5Cend%7Barray%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;begin{array}{rcl} g_{i} & = & e^{x_{i}}&#92;&#92; h_{i} & = & &#92;sum_{k=1}^N e^{x_{k}} &#92;end{array}\" class=\"latex\" /></p>\n<p>The derivatives of these functions with respect to <img src=\"https://s0.wp.com/latex.php?latex=x_%7Bj%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=x_%7Bj%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=x_%7Bj%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"x_{j}\" class=\"latex\" /> are:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7Bg_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D+%3D+%5Cleft+%5C%7B+%5Cbegin%7Baligned%7D+%26e%5E%7Bx_%7Bj%7D%7D%2C+%26%26+%5Ctext%7Bif%7D%5C+i%3Dj+%5C%5C+%260%2C+%26%26+%5Ctext%7Botherwise%7D+%5Cend%7Baligned%7D+%5Cright.+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7Bg_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D+%3D+%5Cleft+%5C%7B+%5Cbegin%7Baligned%7D+%26e%5E%7Bx_%7Bj%7D%7D%2C+%26%26+%5Ctext%7Bif%7D%5C+i%3Dj+%5C%5C+%260%2C+%26%26+%5Ctext%7Botherwise%7D+%5Cend%7Baligned%7D+%5Cright.+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7Bg_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D+%3D+%5Cleft+%5C%7B+%5Cbegin%7Baligned%7D+%26e%5E%7Bx_%7Bj%7D%7D%2C+%26%26+%5Ctext%7Bif%7D%5C+i%3Dj+%5C%5C+%260%2C+%26%26+%5Ctext%7Botherwise%7D+%5Cend%7Baligned%7D+%5Cright.+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;frac{&#92;delta{g_{i}}}{&#92;delta{x_{j}}} = &#92;left &#92;{ &#92;begin{aligned} &e^{x_{j}}, && &#92;text{if}&#92; i=j &#92;&#92; &0, && &#92;text{otherwise} &#92;end{aligned} &#92;right. \" class=\"latex\" /></p>\n<p>and</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7Bh_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Cfrac%7B%5Cdelta%28e%5E%7Bx_%7B1%7D%7D%2Be%5E%7Bx_%7B2%7D%7D%2B...%2Be%5E%7Bx_%7BN%7D%7D%29%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3De%5E%7Bx_%7Bj%7D%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7Bh_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Cfrac%7B%5Cdelta%28e%5E%7Bx_%7B1%7D%7D%2Be%5E%7Bx_%7B2%7D%7D%2B...%2Be%5E%7Bx_%7BN%7D%7D%29%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3De%5E%7Bx_%7Bj%7D%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7Bh_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Cfrac%7B%5Cdelta%28e%5E%7Bx_%7B1%7D%7D%2Be%5E%7Bx_%7B2%7D%7D%2B...%2Be%5E%7Bx_%7BN%7D%7D%29%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3De%5E%7Bx_%7Bj%7D%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;frac{&#92;delta{h_{i}}}{&#92;delta{x_{j}}}=&#92;frac{&#92;delta(e^{x_{1}}+e^{x_{2}}+...+e^{x_{N}})}{&#92;delta{x_{j}}}=e^{x_{j}} \" class=\"latex\" /></p>\n<p>Now we have to evalutate the quotient rule for the two seperate cases where <img src=\"https://s0.wp.com/latex.php?latex=i%3Dj&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=i%3Dj&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=i%3Dj&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"i=j\" class=\"latex\" /> and where <img src=\"https://s0.wp.com/latex.php?latex=i%5Cneq%7Bj%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=i%5Cneq%7Bj%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=i%5Cneq%7Bj%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"i&#92;neq{j}\" class=\"latex\" />:</p>\n<p>Starting with <img src=\"https://s0.wp.com/latex.php?latex=i%3Dj&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=i%3Dj&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=i%3Dj&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"i=j\" class=\"latex\" />:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D-e%5E%7Bx_%7Bj%7D%7De%5E%7Bx_%7Bi%7D%7D%7D%7B%5Cleft%5B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%5Cright%5D%5E%7B2%7D%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D-e%5E%7Bx_%7Bj%7D%7De%5E%7Bx_%7Bi%7D%7D%7D%7B%5Cleft%5B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%5Cright%5D%5E%7B2%7D%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D-e%5E%7Bx_%7Bj%7D%7De%5E%7Bx_%7Bi%7D%7D%7D%7B%5Cleft%5B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%5Cright%5D%5E%7B2%7D%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;frac{&#92;delta{&#92;frac{e^{x_{i}}} {&#92;sum_{k=1}^N e^{x_{k}}}}}{&#92;delta{x_{j}}}=&#92;frac{e^{x_{j}}&#92;sum_{k=1}^N e^{x_{k}}-e^{x_{j}}e^{x_{i}}}{&#92;left[&#92;sum_{k=1}^N e^{x_{k}}&#92;right]^{2}} \" class=\"latex\" /></p>\n<p>Now we&#8217;ll just simplify this a bit:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cbegin%7Barray%7D%7Brcl%7D+%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D+%26+%3D+%26+%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%5Cleft%28%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D-e%5E%7Bx_%7Bi%7D%7D%5Cright%29%7D%7B%5Cleft%5B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%5Cright%5D%5E%7B2%7D%7D%5C%5C+%26%3D%26%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D+%5Cdot%7B%7D%5Cfrac%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D-e%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5C%5C+%26%3D%26%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D+%5Cleft%28%5Cfrac%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D-%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5Cright%29%5C%5C+%26%3D%26%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D+%5Cleft%281-%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5Cright%29%5C%5C+%26%3D%26%5Csigma%28x_%7Bj%7D%29%281-%5Csigma%28x_%7Bi%7D%29%29+%5Cend%7Barray%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cbegin%7Barray%7D%7Brcl%7D+%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D+%26+%3D+%26+%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%5Cleft%28%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D-e%5E%7Bx_%7Bi%7D%7D%5Cright%29%7D%7B%5Cleft%5B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%5Cright%5D%5E%7B2%7D%7D%5C%5C+%26%3D%26%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D+%5Cdot%7B%7D%5Cfrac%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D-e%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5C%5C+%26%3D%26%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D+%5Cleft%28%5Cfrac%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D-%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5Cright%29%5C%5C+%26%3D%26%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D+%5Cleft%281-%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5Cright%29%5C%5C+%26%3D%26%5Csigma%28x_%7Bj%7D%29%281-%5Csigma%28x_%7Bi%7D%29%29+%5Cend%7Barray%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cbegin%7Barray%7D%7Brcl%7D+%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D+%26+%3D+%26+%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%5Cleft%28%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D-e%5E%7Bx_%7Bi%7D%7D%5Cright%29%7D%7B%5Cleft%5B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%5Cright%5D%5E%7B2%7D%7D%5C%5C+%26%3D%26%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D+%5Cdot%7B%7D%5Cfrac%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D-e%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5C%5C+%26%3D%26%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D+%5Cleft%28%5Cfrac%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D-%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5Cright%29%5C%5C+%26%3D%26%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D+%5Cleft%281-%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5Cright%29%5C%5C+%26%3D%26%5Csigma%28x_%7Bj%7D%29%281-%5Csigma%28x_%7Bi%7D%29%29+%5Cend%7Barray%7D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;begin{array}{rcl} &#92;frac{&#92;delta{&#92;frac{e^{x_{i}}} {&#92;sum_{k=1}^N e^{x_{k}}}}}{&#92;delta{x_{j}}} & = & &#92;frac{e^{x_{j}}&#92;left(&#92;sum_{k=1}^N e^{x_{k}}-e^{x_{i}}&#92;right)}{&#92;left[&#92;sum_{k=1}^N e^{x_{k}}&#92;right]^{2}}&#92;&#92; &=&&#92;frac{e^{x_{j}}}{&#92;sum_{k=1}^N e^{x_{k}}} &#92;dot{}&#92;frac{&#92;sum_{k=1}^N e^{x_{k}}-e^{x_{i}}}{&#92;sum_{k=1}^N e^{x_{k}}}&#92;&#92; &=&&#92;frac{e^{x_{j}}}{&#92;sum_{k=1}^N e^{x_{k}}} &#92;left(&#92;frac{&#92;sum_{k=1}^N e^{x_{k}}}{&#92;sum_{k=1}^N e^{x_{k}}}-&#92;frac{e^{x_{i}}}{&#92;sum_{k=1}^N e^{x_{k}}}&#92;right)&#92;&#92; &=&&#92;frac{e^{x_{j}}}{&#92;sum_{k=1}^N e^{x_{k}}} &#92;left(1-&#92;frac{e^{x_{i}}}{&#92;sum_{k=1}^N e^{x_{k}}}&#92;right)&#92;&#92; &=&&#92;sigma(x_{j})(1-&#92;sigma(x_{i})) &#92;end{array} \" class=\"latex\" /></p>\n<p>For the case where <img src=\"https://s0.wp.com/latex.php?latex=i%5Cneq+j&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=i%5Cneq+j&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=i%5Cneq+j&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"i&#92;neq j\" class=\"latex\" />:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cbegin%7Barray%7D%7Brcl%7D+%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%26%3D%26%5Cfrac%7B0-e%5E%7Bx_%7Bj%7D%7De%5E%7Bx_%7Bi%7D%7D%7D%7B%5Cleft%5B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%5Cright%5D%5E%7B2%7D%7D%5C%5C+%26%3D%260-%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5Cdot%7B%7D%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5C%5C+%26%3D%260-%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+%5Cend%7Barray%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cbegin%7Barray%7D%7Brcl%7D+%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%26%3D%26%5Cfrac%7B0-e%5E%7Bx_%7Bj%7D%7De%5E%7Bx_%7Bi%7D%7D%7D%7B%5Cleft%5B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%5Cright%5D%5E%7B2%7D%7D%5C%5C+%26%3D%260-%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5Cdot%7B%7D%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5C%5C+%26%3D%260-%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+%5Cend%7Barray%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cbegin%7Barray%7D%7Brcl%7D+%5Cfrac%7B%5Cdelta%7B%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D+%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%26%3D%26%5Cfrac%7B0-e%5E%7Bx_%7Bj%7D%7De%5E%7Bx_%7Bi%7D%7D%7D%7B%5Cleft%5B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%5Cright%5D%5E%7B2%7D%7D%5C%5C+%26%3D%260-%5Cfrac%7Be%5E%7Bx_%7Bj%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5Cdot%7B%7D%5Cfrac%7Be%5E%7Bx_%7Bi%7D%7D%7D%7B%5Csum_%7Bk%3D1%7D%5EN+e%5E%7Bx_%7Bk%7D%7D%7D%5C%5C+%26%3D%260-%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+%5Cend%7Barray%7D&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;begin{array}{rcl} &#92;frac{&#92;delta{&#92;frac{e^{x_{i}}} {&#92;sum_{k=1}^N e^{x_{k}}}}}{&#92;delta{x_{j}}}&=&&#92;frac{0-e^{x_{j}}e^{x_{i}}}{&#92;left[&#92;sum_{k=1}^N e^{x_{k}}&#92;right]^{2}}&#92;&#92; &=&0-&#92;frac{e^{x_{j}}}{&#92;sum_{k=1}^N e^{x_{k}}}&#92;dot{}&#92;frac{e^{x_{i}}}{&#92;sum_{k=1}^N e^{x_{k}}}&#92;&#92; &=&0-&#92;sigma(x_{j})&#92;sigma(x_{i}) &#92;end{array}\" class=\"latex\" /></p>\n<p>Here are some examples of those function:</p>\n<pre>S = softmax_basic(x)\n\n# where i = j\ndiv = S[0] * (1 - S[0])\nprint(\"S[0] :\", S[0], \"div :\", div)\n\ndiv = S[1] * (1 - S[1])\nprint(\"S[1] :\", S[1], \"div :\", div)\n\ndiv = S[2] * (1 - S[2])\nprint(\"S[2] :\", S[2], \"div :\", div)\n\n# where i != j\ndiv = 0 - (S[0] * S[1])\nprint(\"S[0] :\", S[0], \"S[1] :\", S[1], \"div :\", div)\n\ndiv = 0 - (S[1] * S[2])\nprint(\"S[1] :\", S[1], \"S[2] :\", S[2], \"div :\", div)\n\ndiv = 0 - (S[2] * S[3])\nprint(\"S[2] :\", S[2], \"S[3] :\", S[3], \"div :\", div)</pre>\n<p>Here&#8217;s the output (yours may have different numbers):</p>\n<pre>S[0] : 0.16205870737014744 div : 0.13579568273566436\nS[1] : 0.1530827392322831 div : 0.12964841418142392\nS[2] : 0.22661095862407418 div : 0.1752584320555523\nS[0] : 0.16205870737014744 S[1] : 0.1530827392322831 div : -0.024808390840665155\nS[1] : 0.1530827392322831 S[2] : 0.22661095862407418 div : -0.034690226286226845\nS[2] : 0.22661095862407418 S[3] : 0.226342511074585 div : -0.051291693411991836</pre>\n<p>Let&#8217;s tidy up the formula a little so we can come up with a decent implementation in the code.</p>\n<p>Looking at the case where <img src=\"https://s0.wp.com/latex.php?latex=i%3Dj&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=i%3Dj&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=i%3Dj&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"i=j\" class=\"latex\" />:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Csigma%28x_%7Bj%7D%29%281-%5Csigma%28x_%7Bi%7D%29%29%5C%5C+%3D%5Csigma%28x_%7Bj%7D%29+-+%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Csigma%28x_%7Bj%7D%29%281-%5Csigma%28x_%7Bi%7D%29%29%5C%5C+%3D%5Csigma%28x_%7Bj%7D%29+-+%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D%5Csigma%28x_%7Bj%7D%29%281-%5Csigma%28x_%7Bi%7D%29%29%5C%5C+%3D%5Csigma%28x_%7Bj%7D%29+-+%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;frac{&#92;delta{S_{i}}}{&#92;delta{x_{j}}}=&#92;sigma(x_{j})(1-&#92;sigma(x_{i}))&#92;&#92; =&#92;sigma(x_{j}) - &#92;sigma(x_{j})&#92;sigma(x_{i}) \" class=\"latex\" /></p>\n<p>And where <img src=\"https://s0.wp.com/latex.php?latex=i%5Cneq+j&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=i%5Cneq+j&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=i%5Cneq+j&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=0&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"i&#92;neq j\" class=\"latex\" /></p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D0-%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D0-%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D%3D0-%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;frac{&#92;delta{S_{i}}}{&#92;delta{x_{j}}}=0-&#92;sigma(x_{j})&#92;sigma(x_{i}) \" class=\"latex\" /></p>\n<p>We can generalise that formula by calculating the <a href=\"//en.wikipedia.org/wiki/Jacobian_matrix_and_determinant\" target=\"_blank\" rel=\"noopener\">Jacobian</a> matrix. This matrix will look like this:</p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS%7D%7D%7B%5Cdelta%7Bx%7D%7D+%3D+%5Cleft+%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Cfrac%7B%5Cdelta%7BS_%7B1%7D%7D%7D%7B%5Cdelta%7Bx_%7B1%7D%7D%7D+%26+%5Cldots+%26+%5Cfrac%7B%5Cdelta%7BS_%7B1%7D%7D%7D%7B%5Cdelta%7Bx_%7BN%7D%7D%7D+%5C%5C+%5Cldots+%26+%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D+%26+%5Cldots+%5C%5C+%5Cfrac%7B%5Cdelta%7BS_%7BN%7D%7D%7D%7B%5Cdelta%7Bx_%7B1%7D%7D%7D+%26+%5Cldots+%26+%5Cfrac%7B%5Cdelta%7BS_%7BN%7D%7D%7D%7B%5Cdelta%7Bx_%7BN%7D%7D%7D+%5Cend%7Barray%7D+%5Cright+%5D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS%7D%7D%7B%5Cdelta%7Bx%7D%7D+%3D+%5Cleft+%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Cfrac%7B%5Cdelta%7BS_%7B1%7D%7D%7D%7B%5Cdelta%7Bx_%7B1%7D%7D%7D+%26+%5Cldots+%26+%5Cfrac%7B%5Cdelta%7BS_%7B1%7D%7D%7D%7B%5Cdelta%7Bx_%7BN%7D%7D%7D+%5C%5C+%5Cldots+%26+%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D+%26+%5Cldots+%5C%5C+%5Cfrac%7B%5Cdelta%7BS_%7BN%7D%7D%7D%7B%5Cdelta%7Bx_%7B1%7D%7D%7D+%26+%5Cldots+%26+%5Cfrac%7B%5Cdelta%7BS_%7BN%7D%7D%7D%7B%5Cdelta%7Bx_%7BN%7D%7D%7D+%5Cend%7Barray%7D+%5Cright+%5D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS%7D%7D%7B%5Cdelta%7Bx%7D%7D+%3D+%5Cleft+%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Cfrac%7B%5Cdelta%7BS_%7B1%7D%7D%7D%7B%5Cdelta%7Bx_%7B1%7D%7D%7D+%26+%5Cldots+%26+%5Cfrac%7B%5Cdelta%7BS_%7B1%7D%7D%7D%7B%5Cdelta%7Bx_%7BN%7D%7D%7D+%5C%5C+%5Cldots+%26+%5Cfrac%7B%5Cdelta%7BS_%7Bi%7D%7D%7D%7B%5Cdelta%7Bx_%7Bj%7D%7D%7D+%26+%5Cldots+%5C%5C+%5Cfrac%7B%5Cdelta%7BS_%7BN%7D%7D%7D%7B%5Cdelta%7Bx_%7B1%7D%7D%7D+%26+%5Cldots+%26+%5Cfrac%7B%5Cdelta%7BS_%7BN%7D%7D%7D%7B%5Cdelta%7Bx_%7BN%7D%7D%7D+%5Cend%7Barray%7D+%5Cright+%5D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;frac{&#92;delta{S}}{&#92;delta{x}} = &#92;left [ &#92;begin{array}{ccc} &#92;frac{&#92;delta{S_{1}}}{&#92;delta{x_{1}}} & &#92;ldots & &#92;frac{&#92;delta{S_{1}}}{&#92;delta{x_{N}}} &#92;&#92; &#92;ldots & &#92;frac{&#92;delta{S_{i}}}{&#92;delta{x_{j}}} & &#92;ldots &#92;&#92; &#92;frac{&#92;delta{S_{N}}}{&#92;delta{x_{1}}} & &#92;ldots & &#92;frac{&#92;delta{S_{N}}}{&#92;delta{x_{N}}} &#92;end{array} &#92;right ] \" class=\"latex\" /></p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS%7D%7D%7B%5Cdelta%7Bx%7D%7D+%3D+%5Cleft+%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Csigma%28x_%7B1%7D%29+-+%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+0-%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7BN%7D%29+%5C%5C+%5Cldots+%26+%5Csigma%28x_%7Bj%7D%29+-+%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+%26+%5Cldots+%5C%5C+0-%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+%5Csigma%28x_%7BN%7D%29+-+%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7BN%7D%29+%5Cend%7Barray%7D+%5Cright+%5D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS%7D%7D%7B%5Cdelta%7Bx%7D%7D+%3D+%5Cleft+%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Csigma%28x_%7B1%7D%29+-+%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+0-%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7BN%7D%29+%5C%5C+%5Cldots+%26+%5Csigma%28x_%7Bj%7D%29+-+%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+%26+%5Cldots+%5C%5C+0-%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+%5Csigma%28x_%7BN%7D%29+-+%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7BN%7D%29+%5Cend%7Barray%7D+%5Cright+%5D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS%7D%7D%7B%5Cdelta%7Bx%7D%7D+%3D+%5Cleft+%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Csigma%28x_%7B1%7D%29+-+%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+0-%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7BN%7D%29+%5C%5C+%5Cldots+%26+%5Csigma%28x_%7Bj%7D%29+-+%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+%26+%5Cldots+%5C%5C+0-%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+%5Csigma%28x_%7BN%7D%29+-+%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7BN%7D%29+%5Cend%7Barray%7D+%5Cright+%5D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;frac{&#92;delta{S}}{&#92;delta{x}} = &#92;left [ &#92;begin{array}{ccc} &#92;sigma(x_{1}) - &#92;sigma(x_{1})&#92;sigma(x_{1}) & &#92;ldots & 0-&#92;sigma(x_{1})&#92;sigma(x_{N}) &#92;&#92; &#92;ldots & &#92;sigma(x_{j}) - &#92;sigma(x_{j})&#92;sigma(x_{i}) & &#92;ldots &#92;&#92; 0-&#92;sigma(x_{N})&#92;sigma(x_{1}) & &#92;ldots & &#92;sigma(x_{N}) - &#92;sigma(x_{N})&#92;sigma(x_{N}) &#92;end{array} &#92;right ] \" class=\"latex\" /></p>\n<p><img src=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS%7D%7D%7B%5Cdelta%7Bx%7D%7D+%3D+%5Cleft+%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+0+%5C%5C+%5Cldots+%26+%5Csigma%28x_%7Bj%7D%29+%26+%5Cldots+%5C%5C+0+%26+%5Cldots+%26+%5Csigma%28x_%7BN%7D%29%5Cend%7Barray%7D+%5Cright+%5D+-+%5Cleft%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7BN%7D%29+%5C%5C+%5Cldots+%26+%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+%26+%5Cldots+%5C%5C+%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7BN%7D%29+%5Cend%7Barray%7D+%5Cright+%5D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002\" srcset=\"https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS%7D%7D%7B%5Cdelta%7Bx%7D%7D+%3D+%5Cleft+%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+0+%5C%5C+%5Cldots+%26+%5Csigma%28x_%7Bj%7D%29+%26+%5Cldots+%5C%5C+0+%26+%5Cldots+%26+%5Csigma%28x_%7BN%7D%29%5Cend%7Barray%7D+%5Cright+%5D+-+%5Cleft%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7BN%7D%29+%5C%5C+%5Cldots+%26+%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+%26+%5Cldots+%5C%5C+%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7BN%7D%29+%5Cend%7Barray%7D+%5Cright+%5D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002 1x, https://s0.wp.com/latex.php?latex=%5Cfrac%7B%5Cdelta%7BS%7D%7D%7B%5Cdelta%7Bx%7D%7D+%3D+%5Cleft+%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+0+%5C%5C+%5Cldots+%26+%5Csigma%28x_%7Bj%7D%29+%26+%5Cldots+%5C%5C+0+%26+%5Cldots+%26+%5Csigma%28x_%7BN%7D%29%5Cend%7Barray%7D+%5Cright+%5D+-+%5Cleft%5B+%5Cbegin%7Barray%7D%7Bccc%7D+%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+%5Csigma%28x_%7B1%7D%29%5Csigma%28x_%7BN%7D%29+%5C%5C+%5Cldots+%26+%5Csigma%28x_%7Bj%7D%29%5Csigma%28x_%7Bi%7D%29+%26+%5Cldots+%5C%5C+%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7B1%7D%29+%26+%5Cldots+%26+%5Csigma%28x_%7BN%7D%29%5Csigma%28x_%7BN%7D%29+%5Cend%7Barray%7D+%5Cright+%5D+&#038;bg=ffffff&#038;fg=5e5e5e&#038;s=3&#038;c=20201002&#038;zoom=4.5 4x\" alt=\"&#92;frac{&#92;delta{S}}{&#92;delta{x}} = &#92;left [ &#92;begin{array}{ccc} &#92;sigma(x_{1}) & &#92;ldots & 0 &#92;&#92; &#92;ldots & &#92;sigma(x_{j}) & &#92;ldots &#92;&#92; 0 & &#92;ldots & &#92;sigma(x_{N})&#92;end{array} &#92;right ] - &#92;left[ &#92;begin{array}{ccc} &#92;sigma(x_{1})&#92;sigma(x_{1}) & &#92;ldots & &#92;sigma(x_{1})&#92;sigma(x_{N}) &#92;&#92; &#92;ldots & &#92;sigma(x_{j})&#92;sigma(x_{i}) & &#92;ldots &#92;&#92; &#92;sigma(x_{N})&#92;sigma(x_{1}) & &#92;ldots & &#92;sigma(x_{N})&#92;sigma(x_{N}) &#92;end{array} &#92;right ] \" class=\"latex\" /></p>\n<p>The matrix on the left is simply the vector S laid out along a diagonal. Numpy provides a <a href=\"https://docs.scipy.org/doc/numpy/reference/generated/numpy.diag.html?highlight=diag#numpy.diag\" target=\"_blank\" rel=\"noopener\">diag</a>&nbsp;function to do this for us:</p>\n<pre>np.diag(S)</pre>\n<p>And that generates a matrix for us:</p>\n<pre>array([[0.16205871, 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; ],\n&nbsp;&nbsp; &nbsp; &nbsp; [0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.15308274, 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; ],\n&nbsp;&nbsp; &nbsp; &nbsp; [0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.22661096, 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; ],\n&nbsp;&nbsp; &nbsp; &nbsp; [0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.22634251, 0.&nbsp; &nbsp; &nbsp; &nbsp; ],\n&nbsp;&nbsp; &nbsp; &nbsp; [0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.&nbsp; &nbsp; &nbsp; &nbsp; , 0.23190508]])</pre>\n<p>The matrix on the right is comprised of every element in S multiplied by all the elements in S. So we can create the first matrix by repeating S in rows, create the second matrix by repeating S in columns (i.e. transposing the first matrix) and finally, multiplying them together element-wise. Numpy comes to our help again by providing a <a href=\"https://docs.scipy.org/doc/numpy/reference/generated/numpy.tile.html?highlight=tile#numpy.tile\" target=\"_blank\" rel=\"noopener\">tile</a> function:</p>\n<pre>S_vector = S.reshape(S.shape[0],1)\nS_matrix = np.tile(S_vector,S.shape[0])\nprint(S_matrix, '\\n')\nprint(np.transpose(S_matrix))</pre>\n<p>And the output of this (again, yours will have different numbers due to the random initialisation):</p>\n<pre>[[0.16205871 0.16205871 0.16205871 0.16205871 0.16205871]\n&nbsp;[0.15308274 0.15308274 0.15308274 0.15308274 0.15308274]\n&nbsp;[0.22661096 0.22661096 0.22661096 0.22661096 0.22661096]\n&nbsp;[0.22634251 0.22634251 0.22634251 0.22634251 0.22634251]\n&nbsp;[0.23190508 0.23190508 0.23190508 0.23190508 0.23190508]]&nbsp;\n\n[[0.16205871 0.15308274 0.22661096 0.22634251 0.23190508]\n&nbsp;[0.16205871 0.15308274 0.22661096 0.22634251 0.23190508]\n&nbsp;[0.16205871 0.15308274 0.22661096 0.22634251 0.23190508]\n&nbsp;[0.16205871 0.15308274 0.22661096 0.22634251 0.23190508]\n&nbsp;[0.16205871 0.15308274 0.22661096 0.22634251 0.23190508]]</pre>\n<p>Finally, let&#8217;s bring that all together into the single formula to calculate the Jacobian derivative of the Softmax function is:</p>\n<pre>np.diag(S) - (S_matrix * np.transpose(S_matrix))</pre>\n<p>Example output:</p>\n<pre>array([[ 0.13579568, -0.02480839, -0.03672428, -0.03668077, -0.03758224],\n&nbsp;&nbsp; &nbsp; &nbsp; [-0.02480839,&nbsp; 0.12964841, -0.03469023, -0.03464913, -0.03550067],\n&nbsp;&nbsp; &nbsp; &nbsp; [-0.03672428, -0.03469023,&nbsp; 0.17525843, -0.05129169, -0.05255223],\n&nbsp;&nbsp; &nbsp; &nbsp; [-0.03668077, -0.03464913, -0.05129169,&nbsp; 0.17511158, -0.05248998],\n&nbsp;&nbsp; &nbsp; &nbsp; [-0.03758224, -0.03550067, -0.05255223, -0.05248998,&nbsp; 0.17812512]])</pre>\n<p>So that&#8217;s the Softmax function and it&#8217;s derivative.</p>\n<p>In the <a href=\"https://aimatters.wordpress.com/2020/06/14/derivative-of-softmax-layer/\">next part</a>, we&#8217;ll look at how to combine this derivative with the summation function, common in artificial neural networks.</p>\n",
  "wfw:commentRss": "https://aimatters.wordpress.com/2019/06/17/the-softmax-function-derivative/feed/",
  "slash:comments": 3,
  "media:content": {
    "media:title": "stephenoman"
  }
}